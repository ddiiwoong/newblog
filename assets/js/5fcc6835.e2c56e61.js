"use strict";(self.webpackChunkddii=self.webpackChunkddii||[]).push([[839],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var i=r.createContext({}),c=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(i.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,i=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(t),m=a,k=d["".concat(i,".").concat(m)]||d[m]||u[m]||l;return t?r.createElement(k,o(o({ref:n},p),{},{components:t})):r.createElement(k,o({ref:n},p))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,o=new Array(l);o[0]=d;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var c=2;c<l;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},37376:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var r=t(87462),a=t(63366),l=(t(67294),t(3905)),o=["components"],s={layout:"single",title:"ExternalDNS",comments:!0,classes:"wide",description:"ExternalDNS\uc640 CoreDNS\ub97c \ud1b5\ud574 Service\ub97c \uc678\ubd80\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \uc124\uc815\ud558\ub294 \ubc29\ubc95",authors:"jinwoong",toc:!0,toc_label:"Table of Contents",slug:"kubernetes/externaldns/",date:new Date("2024-09-29T00:00:00.000Z"),categories:["Kubernetes"],tags:["Kubernetes","externaldns","coredns","etcd"]},i=void 0,c={permalink:"/kubernetes/externaldns/",editUrl:"https://github.com/ddiiwoong/newblog/tree/main/blog/2024-09-28-externaldns.md",source:"@site/blog/2024-09-28-externaldns.md",title:"ExternalDNS",description:"ExternalDNS\uc640 CoreDNS\ub97c \ud1b5\ud574 Service\ub97c \uc678\ubd80\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \uc124\uc815\ud558\ub294 \ubc29\ubc95",date:"2024-09-29T00:00:00.000Z",formattedDate:"September 29, 2024",tags:[{label:"Kubernetes",permalink:"/tags/kubernetes"},{label:"externaldns",permalink:"/tags/externaldns"},{label:"coredns",permalink:"/tags/coredns"},{label:"etcd",permalink:"/tags/etcd"}],readingTime:5.88,truncated:!1,authors:[{name:"Jinwoong Kim",title:"Technologist and Cloud Consultant",url:"https://www.linkedin.com/in/ddiiwoong/",imageURL:"https://s.gravatar.com/avatar/e8bfebcbeacb5b9a0c90614e792febf2?s=80",key:"jinwoong"}],frontMatter:{layout:"single",title:"ExternalDNS",comments:!0,classes:"wide",description:"ExternalDNS\uc640 CoreDNS\ub97c \ud1b5\ud574 Service\ub97c \uc678\ubd80\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \uc124\uc815\ud558\ub294 \ubc29\ubc95",authors:"jinwoong",toc:!0,toc_label:"Table of Contents",slug:"kubernetes/externaldns/",date:"2024-09-29T00:00:00.000Z",categories:["Kubernetes"],tags:["Kubernetes","externaldns","coredns","etcd"]},nextItem:{title:"Multus on Kind cluster",permalink:"/kubernetes/multus-on-kind/"}},p={authorsImageUrls:[void 0]},u=[{value:"Environment",id:"environment",level:2},{value:"external-dns \uc124\uc815",id:"external-dns-\uc124\uc815",level:2},{value:"CoreDNS\uc5d0 ETCD \uc874 \ucd94\uac00",id:"coredns\uc5d0-etcd-\uc874-\ucd94\uac00",level:3},{value:"ExternalDNS \uc5f0\ub3d9\uc73c\ub85c \ub85c\ub4dc \ubc38\ub7f0\uc11c \uc11c\ube44\uc2a4 \uc0dd\uc131",id:"externaldns-\uc5f0\ub3d9\uc73c\ub85c-\ub85c\ub4dc-\ubc38\ub7f0\uc11c-\uc11c\ube44\uc2a4-\uc0dd\uc131",level:3}],d={toc:u};function m(e){var n=e.components,t=(0,a.Z)(e,o);return(0,l.kt)("wrapper",(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"\uc5d4\ud130\ud504\ub77c\uc774\uc988 \ud658\uacbd\uc5d0\uc11c\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2e4\ud589\ub418\ub294 \uc6cc\ud06c\ub85c\ub4dc\uc5d0 IP \uc8fc\uc18c\ub97c \uc9c1\uc811 \uc0ac\uc6a9\ud558\uc5ec \uc561\uc138\uc2a4\ud558\ub294 \uac83\uc774 \uc77c\ubc18\uc801\uc774\uc9c0 \uc54a\ub2e4. \ub300\uc2e0, \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c Service\ub97c \uc2e4\ud589\ud558\uc5ec \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uace0\uac00\uc6a9\uc131\uc744 \ubcf4\uc7a5\ud55c\ub2e4. \uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/external-dns"},"ExternalDNS")," sigs \ud504\ub85c\uc81d\ud2b8\ub97c \uc0ac\uc6a9\ud558\uc5ec DNS\uc5d0 \uc11c\ube44\uc2a4 \uc774\ub984 \ud56d\ubaa9\ub97c \uc0dd\uc131\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud574 \uc124\uba85\ud558\uace0\uc790 \ud55c\ub2e4."),(0,l.kt)("h2",{id:"environment"},"Environment"),(0,l.kt)("p",null,"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub85c\ub4dc \ubc38\ub7f0\uc11c\ub294 \uc11c\ube44\uc2a4\uc5d0 \ud45c\uc900 IP \uc8fc\uc18c\ub97c \uc81c\uacf5\ud558\uc9c0\ub9cc \uc0ac\uc6a9\uc790\uac00 \uc11c\ube44\uc2a4\uc5d0 \uc811\uc18d\ud558\uae30 \uc704\ud55c ExternalDNS \uc774\ub984\uc744 \uc0dd\uc131\ud558\uc9c0\ub294 \uc54a\ub294\ub2e4. IP \uc8fc\uc18c\ub97c \uc0ac\uc6a9\ud574 \ud074\ub7ec\uc2a4\ud130\uc0c1\uc5d0\uc11c \uc2e4\ud589\ub418\uace0 \uc788\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc5d0 \uc811\uc18d\ud558\ub294 \uac83\uc740 \uadf8\ub2e4\uc9c0 \ud6a8\uc728\uc801\uc774\uc9c0 \uc54a\ub2e4. \ub85c\ub4dc\ubc38\ub7f0\uc11c\uc5d0\uc11c \ud560\ub2f9\ud55c \uac01 IP\uc5d0 \ub300\ud574 DNS\uc5d0 \uc218\ub3d9\uc73c\ub85c \uc774\ub984\uc744 \ub4f1\ub85d\ud558\ub294 \uac83\uc740 \uc2e4\uc9c8\uc801\uc73c\ub85c \uc720\uc9c0\ubcf4\uc218\uac00 \uac70\uc758 \ubd88\uac00\ub2a5\ud55c \ubc29\ubc95\uc774\ub2e4. "),(0,l.kt)("p",null,"\uc791\uc131\ud558\ub294 24\ub144 9\uc6d4 \uc2dc\uc810\uc5d0\ub294 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/external-dns?tab=readme-ov-file#the-latest-release"},"\ub9c1\ud06c"),"\uc5d0\uc11c \ubcfc\uc218 \uc788\ub4ef\uc774 \ub2e4\uc591\ud55c DNS \ud504\ub85c\ubc14\uc774\ub354\uac00 \uc9c0\uc6d0\uc744 \ud55c\ub2e4. "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Google's Cloud DNS "),(0,l.kt)("li",{parentName:"ul"},"Amazon's Route 53 "),(0,l.kt)("li",{parentName:"ul"},"AzureDNS "),(0,l.kt)("li",{parentName:"ul"},"Cloudflare "),(0,l.kt)("li",{parentName:"ul"},"CoreDNS "),(0,l.kt)("li",{parentName:"ul"},"RFC2136 ")),(0,l.kt)("p",null,"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\ub294 \uae30\ubcf8\uc801\uc73c\ub85c CoreDNS\ub97c \uc2e4\ud589\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 DNS \uc774\ub984 \ud574\uc11d\uc744 \uc81c\uacf5\ud55c\ub2e4. \ub0b4\ubd80 \ud074\ub7ec\uc2a4\ud130 DNS \ud574\uacb0\uc774\uc678\uc5d0\ub3c4 \uc678\ubd80 \uc774\ub984 \ud574\uc11d\uc744 \ud1b5\ud574\uc11c CoreDNS\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 \ubaa8\ub4e0 DNS \uc874\uc758 \uc774\ub984\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,l.kt)("h2",{id:"external-dns-\uc124\uc815"},"external-dns \uc124\uc815"),(0,l.kt)("p",null,"kind\ub97c \ud1b5\ud574 \uc124\uce58\ud55c \ud604\uc7ac CoreDNS\ub294 \ub0b4\ubd80 \ud074\ub7ec\uc2a4\ud130 \uc774\ub984\uc5d0 \ub300\ud574\uc11c\ub9cc \ud574\uc11d\ud558\ubbc0\ub85c \uc0c8 DNS \ud56d\ubaa9\uc5d0 \ub300\ud55c \uc874\uc744 \uc124\uc815\ud574\uc57c \ud55c\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub3d9\uc801\uc73c\ub85c \uc11c\ube44\uc2a4 \ub4f1\ub85d\uc744 \uc81c\uacf5\ud558\uae30 \uc704\ud574\uc11c\ub294 ExternalDNS\ub97c \ubc30\ud3ec\ud558\uace0 CoreDNS\uc640 \uc5f0\ub3d9\uc774 \ud544\uc694\ud558\ub2e4. \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc791\ub3d9\ud558\ub3c4\ub85d ExternalDNS\uc640 CoreDNS\ub97c \uc124\uc815\ud558\ub824\uba74 \uc0c8\ub85c\uc6b4 DNS \uc874\uc5d0 ETCD\ub97c \uc0ac\uc6a9\ud558\ub3c4\ub85d \uac01\uac01 \uc124\uc815\ud574\uc57c \ud55c\ub2e4. \uc0c8\ub85c\uc6b4 ETCD \ud30c\ub4dc\ub97c \uc804\uc6a9 ExternalDNS \uc874\uc73c\ub85c \ubc30\ud3ec\ud55c\ub2e4."),(0,l.kt)("p",null,"ETCD\ub97c \ubc30\ud3ec\ud558\ub294 \uac00\uc7a5 \ube60\ub978 \ubc29\ubc95\uc740 \uacf5\uc2dd ETCD \ud5ec\ub984 \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \uc88b\ub2e4. \uba3c\uc800 \ud5ec\ub984 \ubc14\uc774\ub108\ub9ac\ub97c \uc124\uce58\ud55c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3\nchmod 700 get_helm.sh\n./get_helm.sh\n")),(0,l.kt)("p",null,"\uc774\uc81c \ud5ec\ub984\uc744 \uc0ac\uc6a9\ud558\uc5ec CoreDNS\uc640 \uc5f0\ub3d9\ud560 ETCD \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud55c\ub2e4. ",(0,l.kt)("inlineCode",{parentName:"p"},"stable/etcd-operator")," \ucc28\ud2b8\ub294 \ub354 \uc774\uc0c1 \uc720\uc9c0 \uad00\ub9ac\ub418\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0, ",(0,l.kt)("inlineCode",{parentName:"p"},"bitnami/etcd")," \ucc28\ud2b8\ub97c \uc0ac\uc6a9\ud55c\ub2e4. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"helm repo add bitnami https://charts.bitnami.com/bitnami\nhelm install etcd bitnami/etcd --namespace kube-system\n")),(0,l.kt)("p",null,"\uc124\uce58\ud558\uace0 \ub098\uba74 ETCD Client pod\ub3c4 \uc2e4\ud589\ud574\ub193\ub294\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'kubectl run etcd-client --restart=\'Never\' --image docker.io/bitnami/etcd:3.5.16-debian-12-r1 --env ROOT_PASSWORD=$(kubectl get secret --namespace kube-system etcd -o jsonpath="{.data.etcd-root-password}" | base64 -d) --env ETCDCTL_ENDPOINTS="etcd.kube-system.svc.cluster.local:2379" --namespace kube-system --command -- sleep infinity\n')),(0,l.kt)("p",null,"IP \uc8fc\uc18c\ub97c \uc801\uc5b4 \ub454\ub2e4. \ub2e4\uc74c \uc808\uc5d0\uc11c ExternalDNS \ubc0f CoreDNS\uc874 \ud30c\uc77c\uc744 \uc124\uc815\ud558\ub824\uba74 \uc11c\ube44\uc2a4 IP \uc8fc\uc18c\uac00 \ud544\uc694\ud558\ub2e4.  "),(0,l.kt)("h3",{id:"coredns\uc5d0-etcd-\uc874-\ucd94\uac00"},"CoreDNS\uc5d0 ETCD \uc874 \ucd94\uac00"),(0,l.kt)("p",null,"\ub3d9\uc801 \uc774\ub984 \ud574\uc11d\uc744 \uc0ac\uc6a9\ud558\uae30 \uc704\ud574\uc11c\ub294 ExternalDNS\uac00 ETCD \uc11c\ubc84\uc5d0 CoreDNS \uc874\uc744 \uc800\uc7a5\ud574\uc57c \ud55c\ub2e4\ub294 \uac83\uc774\ub2e4. ETCD \uc5f0\ub3d9 \uc601\uc5ed\uc744 \ud65c\uc131\ud654\ud558\ub824\uba74 CoreDNS \ucee8\ud53c\uadf8\ub9f5\uc744 \ud3b8\uc9d1\ud55c\ub2e4.\n\uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uc774\uc804 \ud398\uc774\uc9c0\uc5d0\uc11c \ucde8\ub4dd\ud55c \uc0c8\ub85c\uc6b4 ETCD \uc11c\ube44\uc2a4\uc758 IP \uc8fc\uc18c\ub85c \ubcc0\uacbd\ud574\uc57c \ud55c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"$ kubectl edit cm coredns -n kube-system\n\napiVersion: v1\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health {\n           lameduck 5s\n        }\n        ready\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\n           pods insecure\n           fallthrough in-addr.arpa ip6.arpa\n           ttl 30\n        }\n        prometheus :9153\n        forward . /etc/resolv.conf {\n           max_concurrent 1000\n        }\n        etcd jinwoong k8s\n          stubzones\n          path /skydns\n          endpoint http://10.244.3.4:2379\n        }\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\nkind: ConfigMap\n...\n")),(0,l.kt)("p",null,"\ub2e4\uc74c \ub2e8\uacc4\ub294 \ud074\ub7ec\uc2a4\ud130\uc5d0 ExternalDNS\ub97c \ubc30\ud3ec\ud55c\ub2e4. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: external-dns\n  namespace: kube-system\nspec:\n  strategy:\n    type: Recreate\n  selector:\n    matchLabels:\n      app: external-dns\n  template:\n    metadata:\n      labels:\n        app: external-dns\n    spec:\n      containers:\n      - name: external-dns\n        image: registry.k8s.io/external-dns/external-dns:v0.13.4\n        args:\n        - --source=ingress\n        - --provider=coredns\n        - --log-level=debug # debug only\n        env:\n        - name: ETCD_URLS\n          value: http://10.244.3.4:2379\n")),(0,l.kt)("h3",{id:"externaldns-\uc5f0\ub3d9\uc73c\ub85c-\ub85c\ub4dc-\ubc38\ub7f0\uc11c-\uc11c\ube44\uc2a4-\uc0dd\uc131"},"ExternalDNS \uc5f0\ub3d9\uc73c\ub85c \ub85c\ub4dc \ubc38\ub7f0\uc11c \uc11c\ube44\uc2a4 \uc0dd\uc131"),(0,l.kt)("p",null,"\uae30\uc874\uc5d0 \ub744\uc6cc\ub193\uc740 NGINX \ub514\ud50c\ub85c\uc774\uba3c\ud2b8\ub97c \ub3d9\uc801\uc73c\ub85c DNS \ub4f1\ub85d\uc744 \ud558\uae30 \uc704\ud574\uc11c ",(0,l.kt)("inlineCode",{parentName:"p"},"external-dns.alpha.kubernetes.io/hostname")," \uc5b4\ub178\ud14c\uc774\uc158\uc744 \ucd94\uac00\ud558\uace0 \uc2e0\uaddc LoadBalancer \uc11c\ube44\uc2a4\ub97c \uc0dd\uc131\ud55c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1 \nkind: Service \nmetadata:\n  annotations:\n    external-dns.alpha.kubernetes.io/hostname: nginx.jinwoong.k8s\n  name: nginx-ext-dns\n  namespace: default \nspec:\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 8080 \n  selector:\n    run: nginx-web \n  type: LoadBalancer\n")),(0,l.kt)("p",null,"ExternalDNS \uac00 DNS \ubcc0\uacbd \uc0ac\ud56d\uc744 \uc218\uc2e0\ud558\ub294 \ub370 \uc57d\uac04\uc758 \uc2dc\uac04\uc774 \uac78\ub9ac\uc9c0\ub9cc \uc7a0\uc2dc\ud6c4\uc5d0 \ud655\uc778\ud558\uba74 \ub808\ucf54\ub4dc\uac00 \uc0dd\uc131\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \ud655\uc778\ud558\ub824\uba74 ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl logs -n kube-system -l app=external-dns"),"\ub97c \uc0ac\uc6a9\ud558\uc5ec external-dns \ud30c\ub4dc \ub85c\uadf8\ub97c \ud655\uc778\ud558\uace0, netshoot \ud30c\ub4dc\ub97c \uc0ac\uc6a9\ud574\uc11c nslookup \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud55c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl run tmp-shell --rm -i --tty --image nicolaka/netshoot -- nslookup nginx.jinwoong.k8s\n\ntmp-shell:~# nslookup nginx.jinwoong.k8s\nServer:         10.96.0.10\nAddress:        10.96.0.10#53\nName:   nginx.jinwoong.k8s\nAddress: 10.244.0.11\n")))}m.isMDXComponent=!0}}]);