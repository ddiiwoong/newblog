"use strict";(self.webpackChunkddii=self.webpackChunkddii||[]).push([[4887],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var a=t(67294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var o=a.createContext({}),c=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(o.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,i=e.originalType,o=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(t),d=l,k=m["".concat(o,".").concat(d)]||m[d]||u[d]||i;return t?a.createElement(k,r(r({ref:n},p),{},{components:t})):a.createElement(k,r({ref:n},p))}));function d(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var i=t.length,r=new Array(i);r[0]=m;var s={};for(var o in n)hasOwnProperty.call(n,o)&&(s[o]=n[o]);s.originalType=e,s.mdxType="string"==typeof e?e:l,r[1]=s;for(var c=2;c<i;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},11988:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var a=t(87462),l=t(63366),i=(t(67294),t(3905)),r=["components"],s={layout:"single",title:"What is Tailscale?",comments:!0,classes:"wide",description:"wireguard\uc640 tailscale\uc744 \ube44\uad50\ud558\uace0 kubernetes \ud658\uacbd\uc5d0\uc11c \ud65c\uc6a9\ubc29\uc548 \uac80\ud1a0",categories:["Kubernetes"],tags:["Kubernetes","wireguard","tailscale","vpn","network"]},o=void 0,c={permalink:"/2022/02/05/what-is-tailscale",editUrl:"https://github.com/ddiiwoong/newblog/tree/main/src/blog/blog/2022-02-05-what-is-tailscale.md",source:"@site/blog/2022-02-05-what-is-tailscale.md",title:"What is Tailscale?",description:"wireguard\uc640 tailscale\uc744 \ube44\uad50\ud558\uace0 kubernetes \ud658\uacbd\uc5d0\uc11c \ud65c\uc6a9\ubc29\uc548 \uac80\ud1a0",date:"2022-02-05T00:00:00.000Z",formattedDate:"February 5, 2022",tags:[{label:"Kubernetes",permalink:"/tags/kubernetes"},{label:"wireguard",permalink:"/tags/wireguard"},{label:"tailscale",permalink:"/tags/tailscale"},{label:"vpn",permalink:"/tags/vpn"},{label:"network",permalink:"/tags/network"}],readingTime:28.07,truncated:!0,authors:[],frontMatter:{layout:"single",title:"What is Tailscale?",comments:!0,classes:"wide",description:"wireguard\uc640 tailscale\uc744 \ube44\uad50\ud558\uace0 kubernetes \ud658\uacbd\uc5d0\uc11c \ud65c\uc6a9\ubc29\uc548 \uac80\ud1a0",categories:["Kubernetes"],tags:["Kubernetes","wireguard","tailscale","vpn","network"]},prevItem:{title:"EKS Anywhere on vSphere Homelab",permalink:"/2022/03/06/eks-anywhere"},nextItem:{title:"Synology monitoring with Prometheus and snmp exporter",permalink:"/2021/06/11/synology-prometheus"}},p={authorsImageUrls:[]},u=[{value:"Wireguard",id:"wireguard",level:2},{value:"Wireguard in Calico CNI",id:"wireguard-in-calico-cni",level:3},{value:"\ucc38\uace0\uc790\ub8cc",id:"\ucc38\uace0\uc790\ub8cc",level:3},{value:"Tailscale",id:"tailscale",level:2},{value:"\uae30\ubcf8 \uc791\ub3d9\ubc29\uc2dd",id:"\uae30\ubcf8-\uc791\ub3d9\ubc29\uc2dd",level:3},{value:"Tailscale \ud14c\uc2a4\ud2b8",id:"tailscale-\ud14c\uc2a4\ud2b8",level:2},{value:"talescale \uc124\uce58 (macOS \uae30\uc900)",id:"talescale-\uc124\uce58-macos-\uae30\uc900",level:3},{value:"kubernetes \ud658\uacbd\uad6c\uc131",id:"kubernetes-\ud658\uacbd\uad6c\uc131",level:3},{value:"authKey \ubc1c\uae09 \ubc0f Secret \ub4f1\ub85d",id:"authkey-\ubc1c\uae09-\ubc0f-secret-\ub4f1\ub85d",level:3},{value:"image build &amp; push",id:"image-build--push",level:3},{value:"RBAC \ub9ac\uc18c\uc2a4 \uc0dd\uc131",id:"rbac-\ub9ac\uc18c\uc2a4-\uc0dd\uc131",level:3},{value:"sidecar \ubc30\ud3ec",id:"sidecar-\ubc30\ud3ec",level:3},{value:"Userspace Sidecar \ud14c\uc2a4\ud2b8",id:"userspace-sidecar-\ud14c\uc2a4\ud2b8",level:3},{value:"Proxy \ubaa8\ub4dc \ud14c\uc2a4\ud2b8",id:"proxy-\ubaa8\ub4dc-\ud14c\uc2a4\ud2b8",level:3},{value:"Subnet Router \ubaa8\ub4dc \ud14c\uc2a4\ud2b8",id:"subnet-router-\ubaa8\ub4dc-\ud14c\uc2a4\ud2b8",level:3},{value:"\ud65c\uc6a9\ubc29\uc548",id:"\ud65c\uc6a9\ubc29\uc548",level:2},{value:"\uc815\ub9ac",id:"\uc815\ub9ac",level:2}],m={toc:u};function d(e){var n=e.components,s=(0,l.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},m,s,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4.")),(0,i.kt)("p",null,"\uc774\uc9c1\uc744 \ud558\uace0 \ube14\ub85c\uadf8\uc5d0 \uc190\uc744 \ub193\uace0 \uc788\ub2e4\uac00 \ud398\uc774\uc2a4\ubd81 ",(0,i.kt)("a",{parentName:"p",href:"https://ko-kr.facebook.com/groups/"},"Kubernetes Korea Group"),"\uc5d0 \uc62c\ub77c\uc628 ",(0,i.kt)("a",{parentName:"p",href:"https://gasidaseo.notion.site/c9cd413265ea4ea1b1ae38eb36dfda94"},"\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud0b9 \uc2a4\ud130\ub514 \ubaa8\uc9d1 \uacf5\uace0"),"\ub97c \ubcf4\uac8c\ub418\uc5c8\ub2e4. \uc774\uc9c1\ud6c4\uc5d0 \ub300\ubd80\ubd84\uc758 \ud504\ub85c\uc81d\ud2b8\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uae30\ubc18\uc73c\ub85c \uc9c4\ud589\ub418\ub2e4 \ubcf4\ub2c8 \ub124\ud2b8\uc6cc\ud06c \uc804\ubb38\uac00 \uc774\uc2e0 ",(0,i.kt)("a",{parentName:"p",href:"https://www.facebook.com/jongho.seo.5811"},"\uac00\uc2dc\ub2e4"),"\ub2d8\uc758 ",(0,i.kt)("a",{parentName:"p",href:"https://cloudneta.github.io/"},"\ud300 \ube14\ub85c\uadf8"),"\ub098 \uc774\ub098 \uc5ec\ub7ec \uc591\uc9c8\uc758 \uac8c\uc2dc\uae00\ub4e4\uc744 \ucc38\uace0\ub9cc \ud558\ub2e4\uac00 \uc870\uae08\ub354 \uae4a\uc774 \ud559\uc2b5\uc744 \ud558\uace0 \uc2f6\uc5b4 \uc2a4\ud130\ub514\ub97c \uc2e0\uccad\ud588\uace0, \uac04\ub2e8\ud55c \uba74\uc811(??)\ud6c4\uc5d0 \uc815\uc2dd\uc73c\ub85c \uc2a4\ud130\ub514\uc5d0 \ucc38\uc5ec\ud558\uac8c \ub418\uc5c8\ub2e4.  "),(0,i.kt)("p",null,"\ubcf8\ub860\uc73c\ub85c \ub3cc\uc544\uac00\uc11c calico \uc2a4\ud130\ub514\ub97c \uc9c4\ud589\ud558\ub2e4\uac00 ",(0,i.kt)("a",{parentName:"p",href:"https://www.wireguard.com/"},"wireguard"),"\ub77c\ub294 opensource vpn\uc744 \uc54c\uac8c \ub418\uc5c8\uace0 \ud574\ub2f9 \ud328\ud0a4\uc9c0\ub97c \uc774\uac83\uc800\uac83 \ud14c\uc2a4\ud2b8\ud558\ub2e4\uac00 \uae30\uc874\uc5d0 \uc0ac\uc6a9\uc911\uc778 ",(0,i.kt)("a",{parentName:"p",href:"https://tailscale.com/"},"tailscale")," \uacfc \uc720\uc0ac\ud558\ub2e4\ub294 \uac83\uc744 \uc778\uc9c0\ud558\uace0 \ub0b4\ubd80 \uad6c\uc131\uc744 \uc870\uae08 \ucc3e\uc544\ubcf4\uae30\ub85c \ud588\ub2e4.  "),(0,i.kt)("p",null,"\ud655\uc778\ud574\ubcf4\ub2c8 tailscale\uc740 wireguard \uae30\ubc18\uc73c\ub85c \ud558\ub294 \ub3d9\uc77c \uae30\uc220\uc758 \uc0c1\uc6a9 \uc194\ub8e8\uc158\uc774\uc600\uace0, \uc774\uc5d0 \uba87\uac00\uc9c0 \uacf5\ubd80\ucc28 \uc815\ub9ac\ub97c \uc704\ud574 \ud574\ub2f9 \ud3ec\uc2a4\ud2b8\ub97c \uc791\uc131\ud558\uac8c \ub418\uc5c8\ub2e4. "),(0,i.kt)("h2",{id:"wireguard"},"Wireguard"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.wireguard.com/"},"https://www.wireguard.com/"))),(0,i.kt)("p",null,"\uba3c\uc800 WireGuard\ub97c \uac04\ub2e8\ud558\uac8c \uc815\uc758\ud558\uba74 \ubcf4\uc548\uc5d0 \ucd08\uc810\uc744 \ub450\uace0 \ub2e8\uc21c\ud568\uacfc \uc26c\uc6b4 \uc0ac\uc6a9\uc744 \ub300\ud45c\uc801\uc778 \ud2b9\uc9d5\uc73c\ub85c \ub0b4\uc138\uc6b0\ub294 \uc624\ud508\uc18c\uc2a4 \uae30\ubc18 VPN \uc18c\ud504\ud2b8\uc6e8\uc5b4\ub85c IPsec\uacfc OpenVPN\ubcf4\ub2e4 \uc0ac\uc6a9\ud558\uae30 \uc6a9\uc774\ud558\uace0 \uac00\ubcbc\uc6b4 \uac83\uc744 \uac15\uc810\uc73c\ub85c ",(0,i.kt)("a",{parentName:"p",href:"https://lore.kernel.org/wireguard/CAHmME9qOpDeraWo5rM31EWQW574KEduRBTL-+0A2ZyqBNDeYkg@mail.gmail.com/T/#u"},"Linux 5.6 \ucee4\ub110 \uc774\ud6c4\ubd80\ud130 \uae30\ubcf8 \ud328\ud0a4\uc9c0"),"\ub85c \ud0d1\uc7ac\uac00 \ub418\uc5c8\ub2e4. \uc81c\uc774\uc2a8 \ub3c4\ub128\ud544\ub4dc(Jason Donenfeld, ",(0,i.kt)("a",{parentName:"p",href:"https://twitter.com/zx2c4"},"@zx2c4"),")\uac00 \uc124\uacc4\ud55c WireGuard\ub294 \uc554\ud638\ud654 \ubbfc\ucca9\uc131, \uc989 \ub2e4\uc591\ud55c \uc554\ud638\ud654, \ud0a4 \uad50\ud658, \ud574\uc2f1 \uc54c\uace0\ub9ac\uc998\uc5d0 \ub300\ud55c \uc120\ud0dd\uad8c\uc744 \uc81c\uacf5\ud55c\ub2e4\ub294 \uac1c\ub150\uc744 \ubc84\ub9ac\uace0 \uc544\uc8fc \uac04\uacb0\ud55c \ucf54\ub4dc \uad6c\uc870\ub97c \ud1b5\ud574 \ucee4\ub110\uc5d0\uc11c \uc9c1\uc811 \ub3d9\uc791\ud558\uace0 \uc8fc\uc694 \uc554\ud638 \uc54c\uace0\ub9ac\uc998\uc5d0 \ub300\ud574\uc11c \ubcd1\ub82c\ucc98\ub9ac\ud558\ubbc0\ub85c \ube60\ub978 \uc18d\ub3c4\ub97c \uc790\ub791\ud55c\ub2e4.  "),(0,i.kt)("p",null,"\ud648\ud398\uc774\uc9c0\uc5d0 \uac8c\uc2dc\ub41c \uba87\uac00\uc9c0 \ud2b9\uc9d5\uc744 \uc815\ub9ac\ud558\uba74 "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Simple & Easy-to-use : SSH \ucc98\ub7fc \ud0a4\uad50\ud658 \ubc29\uc2dd\uc73c\ub85c \uc9c4\ud589\ub418\uace0 WireGuard\uc5d0 \uc758\ud574 \uad00\ub9ac\ub418\uae30 \ub54c\ubb38\uc5d0 \uc27d\uac8c \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\uace0, IP\uac00 \ubcc0\uacbd\ub418\ub294 \ubaa8\ubc14\uc77c \ub85c\ubc0d\uc911\uc5d0\uc11c \uc5f0\uacb0\uc774 \ubcf4\uc7a5\ub418\ub294 \uac83\uc774 \ud2b9\uc9d5\uc774\ub2e4. "),(0,i.kt)("li",{parentName:"ul"},"Cryptographically Sound : ",(0,i.kt)("a",{parentName:"li",href:"http://www.noiseprotocol.org/"},"Noise protocol framework"),", ",(0,i.kt)("a",{parentName:"li",href:"http://cr.yp.to/ecdh.html"},"Curve25519"),", ",(0,i.kt)("a",{parentName:"li",href:"http://cr.yp.to/chacha.html"},"ChaCha20"),", ",(0,i.kt)("a",{parentName:"li",href:"http://cr.yp.to/mac.html"},"Poly1305"),", ",(0,i.kt)("a",{parentName:"li",href:"https://blake2.net/"},"BLAKE2"),", ",(0,i.kt)("a",{parentName:"li",href:"https://131002.net/siphash/"},"SipHash24"),", ",(0,i.kt)("a",{parentName:"li",href:"https://eprint.iacr.org/2010/264"},"HKDF")," \uc640 \uac19\uc740 \uac00\uc7a5 \ube60\ub974\uace0 \ucd5c\uc2e0\uc758 \uc554\ud638, \ud574\uc2dc \uc54c\uace0\ub9ac\uc998\uc744 \uc0ac\uc6a9\ud55c\ub2e4.  "),(0,i.kt)("li",{parentName:"ul"},"Minimal Attack Surface : WireGuard\ub294 \uad6c\ud604 \uc6a9\uc774\uc131\uacfc \ub2e8\uc21c\uc131\uc744 \uc5fc\ub450\uc5d0 \ub450\uace0 \uc124\uacc4\ub418\uc5c8\ub2e4. \ub9e4\uc6b0 \uc801\uc740 \ucf54\ub4dc \ub77c\uc778\uc73c\ub85c \uad6c\ud604\ub418\uc11c \ubcf4\uc548 \ucde8\uc57d\uc810\uc5d0 \ub300\ud574 \uc27d\uac8c \uac10\uc0ac\ud560 \uc218 \uc788\ub2e4. \uadf8\ub9cc\ud07c \ucca0\uc800\ud788 \uac80\uc99d\ub420 \uac00\ub2a5\uc131\uc774 \ub192\uace0, \uc608\uc0c1\uce58 \ubabb\ud55c \uacf3\uc5d0\uc11c\uc758 \ubc84\uadf8\ub85c \uc778\ud55c \ucde8\uc57d\uc810\uc774 \ubc1c\uc0dd\ud560 \uac00\ub2a5\uc131\uc774 \uc0c1\ub300\uc801\uc73c\ub85c \uc801\ub2e4\ub294 \uc598\uae30\uac00 \ub41c\ub2e4.  "),(0,i.kt)("li",{parentName:"ul"},"High Performance : \ubaa8\ub4e0 \uac83\uc774 kernel\uc5d0\uc11c \ub3d9\uc791\ud558\uace0 \uc548\uc804\ud55c \ub124\ud2b8\uc6cc\ud0b9\uc774 \ub9e4\uc6b0 \ube60\ub978 \uc18d\ub3c4 \ub85c \ub3d9\uc791\ud558\uae30 \ub54c\ubb38\uc5d0 \uc2a4\ub9c8\ud2b8\ud3f0\uacfc \ubc31\ubcf8 \ub77c\uc6b0\ud130\uc640 \uac19\uc740 \uc791\uc740 \uc784\ubca0\ub514\ub4dc \uc7a5\uce58 \ub4f1 \ubaa8\ub450\uc5d0 \uc801\ud569\ud558\ub2e4.  "),(0,i.kt)("li",{parentName:"ul"},"Well Defined & Thoroughly Considered : Wireguard\ub294 ",(0,i.kt)("a",{parentName:"li",href:"https://www.wireguard.com/papers/wireguard.pdf"},"\ubc31\uc11c"),"\uac00 \ubc1c\ud589\ub420 \uc815\ub3c4\ub85c \uae30\uc220\uc801\uc73c\ub85c \uc5ec\ub7ec\uac00\uc9c0 \uace0\ub824\uc0ac\ud56d\ub4e4\uc744 \uba85\ud655\ud558\uac8c \uc815\uc758\ud574\ub1a8\ub2e4.")),(0,i.kt)("p",null,"\uad00\ub828\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ",(0,i.kt)("a",{parentName:"p",href:"https://www.wireguard.com/papers/wireguard.pdf"},"\ubc31\uc11c")," \ub97c \ucc38\uace0\ud55c\ub2e4."),(0,i.kt)("h3",{id:"wireguard-in-calico-cni"},"Wireguard in Calico CNI"),(0,i.kt)("p",null,"\uc2a4\ud130\ub514\ub97c \uc9c4\ud589\ud560\ub54c\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\uc640 \ud30c\ub4dc \uc0ac\uc774\uc758 \ud328\ud0b7\uc744 \ub124\ud2b8\uc6cc\ud06c \ub808\ubca8\ub85c \uc554\ud638\ud654 \ud558\ub294 \ub3c4\uad6c\ub85c Calico\uc5d0 \ub0b4\uc7a5\ub41c WireGuard \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud574\uc11c \ud30c\ub4dc\uac04 \ud130\ub110\uc744 \uc124\uc815\ud558\uace0 \ud2b8\ub798\ud53d\uc744 \uc554\ud638\ud654 \ud558\ub294 \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud558\uac8c \ub418\uc5c8\ub2e4. Calico CNI\uc5d0\uc11c \uad6c\uc131\ud558\ub294 \ubc29\ubc95\uc740 ",(0,i.kt)("inlineCode",{parentName:"p"},"calicoctl"),"\ub97c \uc0ac\uc6a9\ud574\uc11c \uc124\uc815\ud558\uae30 \ub54c\ubb38\uc5d0 \uac04\ub2e8\ud558\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ calicoctl patch felixconfiguration default --type='merge' -p '{\"spec\":{\"wireguardEnabled\":true}}'\n\n$ calicoctl get felixconfiguration default -o yaml | grep wireguardEnabled\n  wireguardEnabled: true\n")),(0,i.kt)("p",null,"\ud30c\ub4dc\uac04\uc758 ping test\ub97c \uc9c4\ud589\ud558\uace0 \ub09c \uc774\ud6c4 \ud30c\ub4dc \ub808\ubca8\uc5d0\uc11c \ud328\ud0b7 \ub364\ud504\ud55c \ub0b4\uc6a9\uc744 wireshark\ub85c \ud655\uc778\ud55c \ub0b4\uc6a9\uc774\ub2e4. \uadf8\ub9bc\uc5d0\uc11c\ucc98\ub7fc icmp \ud328\ud0b7\uc740 \ud655\uc778\uc774 \uc548\ub418\uace0 udp\uc640 wireguard \ud504\ub85c\ud1a0\ucf5c\uc744 \ud1b5\ud574 \ub370\uc774\ud130\uac00 \uc554\ud638\ud654 \ub41c\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"wg",src:t(29443).Z,width:"1002",height:"575"})),(0,i.kt)("p",null,"\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 tailscale \ud65c\uc6a9\ubc29\uc548\uc744 \uc18c\uac1c\ud558\ub294 \uac83\uc73c\ub85c \uac04\ub2e8\ud558\uac8c calico\ub97c \ud1b5\ud574 wireguard \uc124\uc815\ud558\ub294 \uac83\uc740 \ub118\uc5b4\uac04\ub2e4. \ub2e4\ub978 \uc88b\uc740 \ub0b4\uc6a9\ub4e4\uc740 \ub2e4\uc74c \ub9c1\ud06c\ub4e4\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  "),(0,i.kt)("h3",{id:"\ucc38\uace0\uc790\ub8cc"},"\ucc38\uace0\uc790\ub8cc"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://tech.devsisters.com/posts/wireguard-vpn-1/"},"WireGuard\ub85c \uba4b\uc9c4 VPN \uc11c\ubc84 \uad6c\ucd95\ud558\uae30 - devsisters")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://slowbootkernelhacks.blogspot.com/2020/09/wireguard-vpn.html"},"WireGuard VPN \ud574\ubd80 - Slowboot")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/squat/kilo"},"Kilo - multi-cloud k8s network overlay built on WireGuard")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://git.zx2c4.com/wireguard-go/about/"},"Go implementation of WireGuard"))),(0,i.kt)("h2",{id:"tailscale"},"Tailscale"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://tailscale.com/"},"https://tailscale.com/"))),(0,i.kt)("p",null,"TailScale\uc740 \uc11c\ubc84, \ucef4\ud4e8\ud130 \ubc0f \ud074\ub77c\uc6b0\ub4dc \uc778\uc2a4\ud134\uc2a4\uac04\uc5d0 \ubcf4\uc548 \ub124\ud2b8\uc6cc\ud06c\ub97c \ub9cc\ub4dc\ub294 VPN\uc73c\ub85c Wireguard \ud504\ub85c\ud1a0\ucf5c\uc744 \uc0ac\uc6a9\ud574\uc11c \ub9cc\ub4e0 \ud074\ub77c\uc6b0\ub4dc \uc11c\ube44\uc2a4\uc774\ub2e4. Tailscale\uc774 \uc5b4\ub5bb\uac8c \ub3d9\uc791\ud558\ub294\uc9c0\ub294 ",(0,i.kt)("a",{parentName:"p",href:"https://tailscale.com/blog/how-tailscale-works/"},"\uacf5\uc2dd \ube14\ub85c\uadf8"),"\uc5d0\uc11c \uac04\ub2e8\ud788 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. "),(0,i.kt)("p",null,"\uac04\ub2e8\ud558\uac8c \ube14\ub85c\uadf8 \ub0b4\uc6a9\uc744 \uc815\ub9ac\ud574\ubcf4\uba74 \uae30\uc874\uc758 VPN \ubc29\uc2dd\uc740 Hub-and-spoke \ubc29\uc2dd\uc73c\ub85c \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 Gateway \ubc29\uc2dd\uc73c\ub85c \ubaa8\ub4e0 \ud074\ub77c\uc774\uc5b8\ud2b8\uc640 \uc11c\ubc84\ub97c \uc5f0\uacb0\ud558\ub294\uac8c \uae30\uc874\uc758 \ubc29\uc2dd\uc774\ub2e4. \uc0c8\ub85c\uc6b4 \ud074\ub77c\uc774\uc5b8\ud2b8\ub098 \uc11c\ubc84\uac00 \ucd94\uac00\ub420 \uacbd\uc6b0 \uc0c8\ub85c\uc6b4 \ud0a4\ub97c \ubaa8\ub4e0 \uc0ac\uc6a9\uc790\uc5d0\uac8c \ubc30\ud3ec\ud558\uac8c \ub418\uace0 \uc774\ub294 \uc7a5\ube44\uac00 \uc99d\uac00\ud568\uc5d0 \ub530\ub77c \ub9ce\uc740 \uc791\uc5c5\uc774 \ud544\uc694\ub85c \ud558\uac8c \ub41c\ub2e4."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://tailscale.com/blog/how-tailscale-works/hub-and-spoke-single.svg",alt:"hub"})),(0,i.kt)("p",null,"Wireguard \ud130\ub110\uc744 \uc774\uc6a9\ud558\uba74 \ub178\ub4dc\uac04\uc758 \uc5f0\uacb0\uc774 \uc9c1\uc811 \uc774\ub904\uc9c0\uac8c \ub418\uace0 \uc774\ub294 \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 \uba54\uc26c \ud615\ud0dc\ub85c \uad6c\uc131\ub418\uac8c \ub41c\ub2e4. "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://tailscale.com/blog/how-tailscale-works/mesh-network.svg",alt:"mesh"})),(0,i.kt)("p",null,"\uc774\ub7f0 \uba54\uc26c\ubc29\uc2dd\uc758 \uac00\uc7a5 \ud070 \ub2e8\uc810\uc740 \ud53c\uc5b4\ub07c\ub9ac \uc5f0\uacb0\ud558\ub294 \ub178\ub4dc \ub124\ud2b8\uc6cc\ud06c\uc758 \uacbd\uc6b0 \uc5f0\uacb0\ub418\ub294 \uacbd\uc6b0\uc758 \uc218\uac00 ",(0,i.kt)("inlineCode",{parentName:"p"},"n(n-1)"),"\uc73c\ub85c \uadf8\ub9bc\uc758 \uc608\uc2dc\uc5d0\uc11c\ub3c4 10*9 = 90\uac1c\uc758 \uc5f0\uacb0 \uad6c\uc131\uc774 \ud544\uc694\ud558\uac8c \ub41c\ub2e4. \ubaa8\ub4e0 \ub178\ub4dc\uac00 \ud574\ub2f9 \uc0ac\ud56d\uc73c\ub85c Wireguard\uc758 key\ub97c \ub85c\ud14c\uc774\ud2b8\ud558\uac70\ub098 \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00, \uc81c\uac70\ud560\ub54c\ub9c8\ub2e4 \uac01 \ub178\ub4dc\uc5d0 \uc5c5\ub370\uc774\ud2b8\uac00 \ub418\uc5b4\uc57c \ud55c\ub2e4. \ub9cc\uc57d\uc5d0\ub77c\ub3c4 \uac01 \ub178\ub4dc\uc5d0 static ip\uac00 \uc5c6\uc744 \uacbd\uc6b0 \ub178\ub4dc\ub07c\ub9ac \ucc3e\ub294\uc77c\uc774 \uacb0\uace0 \uc27d\uc9c0\ub294 \uc54a\uc744 \uac83\uc774\ub2e4. \ud2b9\ud788 \ubc29\ud654\ubcbd\uc744 \uc6b4\uc601\ud558\ub294 \uc5d4\ud130\ud504\ub77c\uc774\uc988 \uc870\uc9c1\uc758 \uacbd\uc6b0\uc5d0 \ub354\uc6b1\ub354 \uae4c\ub2e4\ub85c\uc6b4 \uc77c\uc774 \ub41c\ub2e4\uace0 \ub9d0\ud55c\ub2e4."),(0,i.kt)("p",null,"\uadf8\ub798\uc11c Tailscale\uc5d0\uc11c \uc774\uc57c\uae30\ud558\ub294 \uac00\uc7a5 \ud575\uc2ec\uc740 \ub178\ub4dc \uac04\uc758 \ud2b8\ub798\ud53d\uc744 \uac10\uc0ac, \ud1b5\uc81c\ud560 \uc218 \uc788\ub294 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \ub450\ub294\uac83\uc774\ub2e4. \ubc29\ud654\ubcbd\uc774\ub098 static ip\uac00 \uc5c6\ub294 \ud658\uacbd\uc5d0\uc11c\ub3c4 \ub178\ub4dc, \ud53c\uc5b4\uac04\uc758 \ud1b5\uc81c\uac00 \uac00\ub2a5\ud55c \ud658\uacbd\uc744 \uc81c\uacf5\ud558\ub294 \uac83\uc774 \uae30\ubcf8 \uc0ac\uc0c1\uc774\ub2e4. "),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://tailscale.com/blog/how-tailscale-works/mesh-coordination-server.svg",alt:"controlplane"})),(0,i.kt)("h3",{id:"\uae30\ubcf8-\uc791\ub3d9\ubc29\uc2dd"},"\uae30\ubcf8 \uc791\ub3d9\ubc29\uc2dd"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\uac01 \ub178\ub4dc(\ud074\ub77c\uc774\uc5b8\ud2b8)\ub294 \ub79c\ub364 \uacf5\uac1c\ud0a4\uc640 \uac1c\uc778\ud0a4\ub97c \uc0dd\uc131\ud558\uace0 \uacf5\uac1c\ud0a4\ub97c ID(tailscale account)\uc640 \uc5f0\uacb0\ud55c\ub2e4."),(0,i.kt)("li",{parentName:"ul"},"\ub178\ub4dc\ub294 \uc911\uc559\uc758 tailscale\uc11c\ubc84\uc5d0 \uacf5\uac1c\ud0a4\uc640 \ud574\ub2f9 \ub178\ub4dc\uac00 \ud604\uc7ac \uc5f0\uacb0\uac00\ub2a5\ud55c\uc9c0\uc640 \ub3c4\uba54\uc778 \uc815\ubcf4(client name) \uc815\ubcf4\ub97c \uc804\ub2ec\ud55c\ub2e4. "),(0,i.kt)("li",{parentName:"ul"},"\ub178\ub4dc\ub294 tailscale\uc11c\ubc84 \uc5c5\ub370\uc774\ud2b8\ub41c \ub3c4\uba54\uc778\uc758 \uacf5\uac1c\ud0a4 \ubc0f \uc8fc\uc18c \ubaa9\ub85d\uc744 \ub2e4\uc6b4\ub85c\ub4dc \ud55c\ub2e4."),(0,i.kt)("li",{parentName:"ul"},"\ub178\ub4dc\ub294 \ub0b4\ub824\ubc1b\uc740 \uacf5\uac1c \ud0a4 \uc138\ud2b8\ub85c Wireguard \uc778\uc2a4\ud134\uc2a4\ub97c \uad6c\uc131\ud55c\ub2e4.")),(0,i.kt)("p",null,"\uc774\ub294 \ub2e4\uc2dc hub-and-spoke \ubaa8\ub378\ub85c \ub3cc\uc544\uac04\uac83 \uac19\uc9c0\ub9cc \uc2e4\uc81c \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ub370\uc774\ud130 \ud50c\ub808\uc778\uc744 \ubd84\ub9ac\ud574\uc11c \ucc98\ub9ac\ud558\uae30 \ub54c\ubb38\uc5d0 \uc2e4\uc81c \uc911\uc559 \uc11c\ubc84\uac00 \uad00\ub9ac\ud558\ub294 \uac83\uc740 \uacf5\uac1c\ud0a4 \uc138\ud2b8\uc640 \uc5f0\uacb0\uac00\ub2a5\ud55c \ub178\ub4dc \ub9ac\uc2a4\ud2b8 \uc815\ubcf4\ubfd0\uc774\ub2e4."),(0,i.kt)("h2",{id:"tailscale-\ud14c\uc2a4\ud2b8"},"Tailscale \ud14c\uc2a4\ud2b8"),(0,i.kt)("h3",{id:"talescale-\uc124\uce58-macos-\uae30\uc900"},"talescale \uc124\uce58 (macOS \uae30\uc900)"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://tailscale.com/download"},"https://tailscale.com/download"))),(0,i.kt)("p",null,"macOS\uc6a9 CLI \uc124\uce58 \uc815\ubcf4\ub294 \uc544\ub798 \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://tailscale.com/kb/1065/macos-variants/"},"https://tailscale.com/kb/1065/macos-variants/"))),(0,i.kt)("p",null,"macOS\uc6a9 GUI \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 CLI\ub3c4 \ub0b4\uc7a5\ub418\uc5b4 \uc788\uae30 \ub54c\ubb38\uc5d0 ",(0,i.kt)("inlineCode",{parentName:"p"},".zshrc"),"\uc5d0 alias\ub97c \ucd94\uac00\ud588\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'alias tailscale="/Applications/Tailscale.app/Contents/MacOS/Tailscale"\n')),(0,i.kt)("p",null,"2022\ub144 2\uc6d4 5\uc77c\uc790 \uae30\uc900\uc73c\ub85c 1.20.2 \ubc84\uc804\uc744 \uc0ac\uc6a9\ud55c\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ tailscale version\n1.20.2\n  tailscale commit: 312750ddd288cf4073cfaef56a45102b9c1e8421\n  other commit: 2c164d9c7443e2f3014fa54ea45e946b35152680\n  go version: go1.17.6-tse44d304e54\n")),(0,i.kt)("p",null,"windows\uc5d0\uc11c\ub3c4 \uc27d\uac8c \uc124\uce58\uac00 \uac00\ub2a5\ud558\uace0, \ubb3c\ub860 \uc560\uc815\ud558\ub294 Synology\uc5d0\ub3c4 \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud560 \uc218 \uc788\ub2e4. "),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/tailscale/tailscale-synology"},"https://github.com/tailscale/tailscale-synology")),(0,i.kt)("p",null,"\uc124\uce58\ub41c \ud074\ub77c\uc774\uc5b8\ud2b8 \ubaa8\ub450\ub97c tailscale \uacc4\uc815\uc73c\ub85c \ub85c\uadf8\uc778\ud558\uba74 VPN\uc5f0\uacb0\uc774 \ub05d\ub09c\ub2e4. "),(0,i.kt)("p",null,"\uc5f0\uacb0\ub41c \uba38\uc2e0\ub9ac\uc2a4\ud2b8\ub294 \uc544\ub798\uc640 \uac19\uc774 ",(0,i.kt)("a",{parentName:"p",href:"https://login.tailscale.com/admin/machines"},"Machines")," \uba54\ub274 \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uace0 \uac01 \ub178\ub4dc\ub098 \ud074\ub77c\uc774\uc5b8\ud2b8\ub85c \ud560\ub2f9\ub41c ",(0,i.kt)("inlineCode",{parentName:"p"},"100.*")," \ub300\uc5ed IP\ub85c \uc811\uc18d\uc774 \uac00\ub2a5\ud558\ub2e4. "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"machine",src:t(49910).Z,width:"948",height:"1024"})),(0,i.kt)("p",null,"\uc5ec\uae30\uc11c machine name\uc73c\ub85c \uc9c1\uc811 \uc811\uc18d\uc774 \uac00\ub2a5\ud558\uae30 \uc704\ud574\uc11c\ub294 MagicDNS \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud574\uc57c \ud558\ub294\ub370 ",(0,i.kt)("inlineCode",{parentName:"p"},"beta")," \uae30\ub2a5\uc73c\ub85c ",(0,i.kt)("a",{parentName:"p",href:"https://login.tailscale.com/admin/dns"},"\ud65c\uc131\ud654"),"\ub97c \ud560 \uc218 \uc788\uace0 \ub124\ud2b8\uc6cc\ud06c\uc5d0 \uc788\ub294 \uc7a5\uce58\uc758 DNS \uc774\ub984\uc744 \uc790\ub3d9\uc73c\ub85c \ub4f1\ub85d\ud558\ub294 \uae30\ub2a5\uc774\ub2e4."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"DNS \uc124\uc815\uac00\uc774\ub4dc : ",(0,i.kt)("a",{parentName:"li",href:"https://tailscale.com/kb/1081/magicdns/"},"https://tailscale.com/kb/1081/magicdns/"))),(0,i.kt)("p",null,"CLI\ub85c \ud604\uc7ac \uc5f0\uacb0\ub41c client \uc815\ubcf4\ub098 publickey \ub4f1\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ tailscale status\n100.89.226.113  88665a4a51c4         ddiiwoong@   macOS   -\n100.76.233.116  jinwoonuimbp141      ddiiwoong@   macOS   offline\n100.95.209.95   proxy                ddiiwoong@   linux   -\n100.106.65.5    win11                ddiiwoong@   windows -\n\n$ tailscale status --json | jq '.Self.PublicKey'\n\"nodekey:97c4dc44ecdf56******************adb3246d87fd9e270\"\n")),(0,i.kt)("p",null,"DNS \ub4f1\ub85d \ubc29\uc2dd\uc740 \uc544\ub798\uc640 \uac19\uc774 \uad6c\uc131\ub418\uace0"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://tailscale.com/kb/1081/magicdns/magic-dns-naming.png",alt:"magicdns"})),(0,i.kt)("p",null,"\ub0b4\uac00 \ub4f1\ub85d\ud55c \uba38\uc2e0\ub9ac\uc2a4\ud2b8\uc5d0\uc11c win11 \uc740 \ub2e4\uc74c \uc815\ubcf4\ub85c \ub3c4\uba54\uc778\uc774 \ub4f1\ub85d\ub41c\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"win11.ddiiwoong.gmail.com.beta.tailscale.net\n")),(0,i.kt)("p",null,"\ub450\uac00\uc9c0 \ubc29\uc2dd\uc73c\ub85c \ud574\ub2f9 \uba38\uc2e0\uc5d0 ping check\ub97c \ud560 \uc218 \uc788\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ ping win11\nPING win11.ddiiwoong.gmail.com.beta.tailscale.net (100.106.65.5): 56 data bytes\n64 bytes from 100.106.65.5: icmp_seq=0 ttl=128 time=124.031 ms\n64 bytes from 100.106.65.5: icmp_seq=1 ttl=128 time=2.180 ms\n64 bytes from 100.106.65.5: icmp_seq=2 ttl=128 time=2.776 ms\n\n$ ping win11.ddiiwoong.gmail.com.beta.tailscale.net\nPING win11.ddiiwoong.gmail.com.beta.tailscale.net (100.106.65.5): 56 data bytes\n64 bytes from 100.106.65.5: icmp_seq=0 ttl=128 time=5.086 ms\n64 bytes from 100.106.65.5: icmp_seq=1 ttl=128 time=2.060 ms\n64 bytes from 100.106.65.5: icmp_seq=2 ttl=128 time=2.213 ms\n")),(0,i.kt)("h3",{id:"kubernetes-\ud658\uacbd\uad6c\uc131"},"kubernetes \ud658\uacbd\uad6c\uc131"),(0,i.kt)("p",null,"kubernetes \ub9ac\uc18c\uc2a4\ub85c tailscale\uc744 \uad6c\uc131\uc744 \ud574\ubcf4\uc790. \uba3c\uc800 ",(0,i.kt)("inlineCode",{parentName:"p"},"1.16")," \ubc84\uc804 \uc774\uc0c1\uc758 kubernetes \ud074\ub7ec\uc2a4\ud130\ub97c \uc900\ube44\ud55c\ub2e4. \uc544\ub798 \uad6c\uc131\ud658\uacbd\uc740 ",(0,i.kt)("inlineCode",{parentName:"p"},"1.21.5")," \ubc84\uc804\uc73c\ub85c eksctl\ub85c \uc124\uce58\ud55c \uae30\ubcf8 EKS \ud074\ub7ec\uc2a4\ud130\uc774\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ kubectl get node\nNAME                                                 STATUS   ROLES    AGE   VERSION\nip-192-168-101-195.ap-northeast-2.compute.internal   Ready    <none>   19h   v1.21.5-eks-9017834\nip-192-168-134-35.ap-northeast-2.compute.internal    Ready    <none>   19h   v1.21.5-eks-9017834\nip-192-168-186-235.ap-northeast-2.compute.internal   Ready    <none>   19h   v1.21.5-eks-9017834\n")),(0,i.kt)("h3",{id:"authkey-\ubc1c\uae09-\ubc0f-secret-\ub4f1\ub85d"},"authKey \ubc1c\uae09 \ubc0f Secret \ub4f1\ub85d"),(0,i.kt)("p",null,"authKey\ub294 tailscale \ub124\ud2b8\uc6cc\ud06c\uc5d0 \ub4f1\ub85d\ud558\uae30 \uc704\ud55c Key\ub85c \uc544\ub798\uc640 \uac19\uc774 \uad00\ub9ac\ub97c Web\uc5d0\uc11c \ud560 \uc218 \uc788\ub2e4."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"key",src:t(26568).Z,width:"1119",height:"700"})),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://login.tailscale.com/admin/settings/keys"},"Keys")," \uba54\ub274\ub85c \uc774\ub3d9\ud574\uc11c auth Key\ub97c \ubc1c\uae09\ubc1b\ub294\ub2e4. \ubc1c\uae09\uc744 \ud560\ub54c \uc5ec\ub7ec\uba38\uc2e0\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uacbd\uc6b0\ub294 ",(0,i.kt)("inlineCode",{parentName:"p"},"Reusable"),", \uc784\uc2dc\ub85c \ud0a4\ub97c \uc0ac\uc6a9\ud560\ub54c\ub294 ",(0,i.kt)("inlineCode",{parentName:"p"},"Ephemeral")," \uc635\uc158\uc744 \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\ub2e4. \uc544\ub798\uc640 \uac19\uc740 \ud615\uc2dd\uc73c\ub85c \ubc1c\uae09\ub418\uace0, \ud574\ub2f9 key\ub294 kubernetes ",(0,i.kt)("inlineCode",{parentName:"p"},"Secret")," \ub9ac\uc18c\uc2a4\uc5d0 \ub4f1\ub85d\uc744 \ud574\uc11c \uc0ac\uc6a9\ud560 \uac83\uc774\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"tskey-kZAinb5CNTRL-********************\n")),(0,i.kt)("p",null,"\ud574\ub2f9 auth Key\ub97c Secret\uc73c\ub85c \uc0dd\uc131\ud55c\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Secret\nmetadata:\n  name: tailscale-auth\nstringData:\n  AUTH_KEY: tskey-kZAinb5CNTRL-********************\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ kubectl get secret -n tailscale\nNAME                    TYPE                                  DATA   AGE\ndefault-token-fww2j     kubernetes.io/service-account-token   3      18h\ntailscale-auth          Opaque                                3      18h\ntailscale-token-7cgsc   kubernetes.io/service-account-token   3      17h\n")),(0,i.kt)("h3",{id:"image-build--push"},"image build & push"),(0,i.kt)("p",null,"tailscale image\ub97c \ube4c\ub4dc\ud55c\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc544\ub798 \ub9c1\ud06c\ub97c \ucc38\uace0\ud55c\ub2e4.  "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/tailscale/tailscale/tree/main/docs/k8s"},"https://github.com/tailscale/tailscale/tree/main/docs/k8s"))),(0,i.kt)("p",null,"Dockerfile\uc740 \ub2e4\uc74c\uacfc \uac19\uc774 \uacf5\uc2dd \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud55c\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM ghcr.io/tailscale/tailscale:latest\nCOPY run.sh /run.sh\nCMD "/run.sh"\n')),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/tailscale/tailscale/blob/main/docs/k8s/run.sh"},"run.sh"),"\uc744 \uc0b4\ud3b4\ubcf4\uba74 ",(0,i.kt)("inlineCode",{parentName:"p"},"tailscaled")," \ub370\ubaac\uc744 \uc2e4\ud589\ud560\ub54c \uba87\uac00\uc9c0 \ud658\uacbd\ubcc0\uc218\ub97c \uc785\ub825\ubc1b\uc544 \ucc98\ub9ac\ud558\ub294 \uac83\uc744 \uc54c \uc218 \uc788\ub2e4. "),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"AUTH_KEY"),"\uc640 ",(0,i.kt)("inlineCode",{parentName:"p"},"KUBE_SECRET"),"\uc740 \uc704 Secret\uc73c\ub85c \ucc98\ub9ac\ub97c \ud558\uace0 \uc5ec\ub7ec \uc0ac\uc6a9 \ubaa8\ub4dc(router, userspace)\ub3c4 \ucee8\ud14c\uc774\ub108 \uc2e4\ud589\uc2dc \uc785\ub825\ubc1b\uc544 \ucc98\ub9ac\ud55c\ub2e4. \ub610\ud55c, \ub9c8\uc9c0\ub9c9 \uad6c\ubb38\uc744 \ubcf4\uba74 \ubaa9\uc801\uc9c0 IP DNAT \ucc98\ub9ac\ub97c \uc704\ud55c iptables \ub4f1\ub85d \uc635\uc158\ub3c4 \uc788\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'#! /bin/sh\n\nexport PATH=$PATH:/tailscale/bin\n\nAUTH_KEY="${AUTH_KEY:-}"\nROUTES="${ROUTES:-}"\nDEST_IP="${DEST_IP:-}"\nEXTRA_ARGS="${EXTRA_ARGS:-}"\nUSERSPACE="${USERSPACE:-true}"\nKUBE_SECRET="${KUBE_SECRET:-tailscale}"\n\nset -e\n\nTAILSCALED_ARGS="--state=kube:${KUBE_SECRET} --socket=/tmp/tailscaled.sock"\n\nif [[ "${USERSPACE}" == "true" ]]; then\n  if [[ ! -z "${DEST_IP}" ]]; then\n    echo "IP forwarding is not supported in userspace mode"\n    exit 1\n  fi\n  TAILSCALED_ARGS="${TAILSCALED_ARGS} --tun=userspace-networking"\nelse\n  if [[ ! -d /dev/net ]]; then\n    mkdir -p /dev/net\n  fi\n\n  if [[ ! -c /dev/net/tun ]]; then\n    mknod /dev/net/tun c 10 200\n  fi\nfi\n\necho "Starting tailscaled"\ntailscaled ${TAILSCALED_ARGS} &\nPID=$!\n\nUP_ARGS="--accept-dns=false"\nif [[ ! -z "${ROUTES}" ]]; then\n  UP_ARGS="--advertise-routes=${ROUTES} ${UP_ARGS}"\nfi\nif [[ ! -z "${AUTH_KEY}" ]]; then\n  UP_ARGS="--authkey=${AUTH_KEY} ${UP_ARGS}"\nfi\nif [[ ! -z "${EXTRA_ARGS}" ]]; then\n  UP_ARGS="${UP_ARGS} ${EXTRA_ARGS:-}"\nfi\n\necho "Running tailscale up"\ntailscale --socket=/tmp/tailscaled.sock up ${UP_ARGS}\n\nif [[ ! -z "${DEST_IP}" ]]; then\n  echo "Adding iptables rule for DNAT"\n  iptables -t nat -I PREROUTING -d "$(tailscale --socket=/tmp/tailscaled.sock ip -4)" -j DNAT --to-destination "${DEST_IP}"\nfi\n\nwait ${PID}\n')),(0,i.kt)("p",null,"build\ud558\uace0 \ub808\uc9c0\uc2a4\ud2b8\ub9ac\ub85c push \ud558\uc790."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ export IMAGE_TAG=ddiiwoong/tailscale-k8s:latest\n$ docker build . -t $(IMAGE_TAG)\n$ docker push $(IMAGE_TAG)\n$ docker images ddiiwoong/tailscale-k8s:latest\nREPOSITORY            TAG       IMAGE ID       CREATED        SIZE\nddiiwoong/tailscale-k8s   latest    9dc489da64c4   18 hours ago   44.1MB\n")),(0,i.kt)("h3",{id:"rbac-\ub9ac\uc18c\uc2a4-\uc0dd\uc131"},"RBAC \ub9ac\uc18c\uc2a4 \uc0dd\uc131"),(0,i.kt)("p",null,"rbac \uc124\uc815\uc744 \uc704\ud574\uc11c ",(0,i.kt)("inlineCode",{parentName:"p"},"role"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"rolebinding"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"serviceaccount"),"\ub97c \uc0dd\uc131\ud55c\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"export SA_NAME=tailscale\nexport KUBE_SECRET=tailscale-auth\n")),(0,i.kt)("p",null,"\uc704 ENV\uac12\uc744 \uce58\ud658\ud574\uc11c \uc0dd\uc131\ud55c\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: tailscale\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: tailscale\nrules:\n- apiGroups: [""] # "" indicates the core API group\n  resources: ["secrets"]\n  # Create can not be restricted to a resource name.\n  verbs: ["create"]\n- apiGroups: [""] # "" indicates the core API group\n  resourceNames: ["tailscale-auth"]\n  resources: ["secrets"]\n  verbs: ["get", "update"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: tailscale\nsubjects:\n- kind: ServiceAccount\n  name: tailscale\nroleRef:\n  kind: Role\n  name: tailscale\n  apiGroup: rbac.authorization.k8s.io\n')),(0,i.kt)("h3",{id:"sidecar-\ubc30\ud3ec"},"sidecar \ubc30\ud3ec"),(0,i.kt)("p",null,"sidecar \uc0dd\uc131\uc744 \uc704\ud574 manifest\ub97c \ud655\uc778\ud55c\ub2e4. \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf4\uba74 ",(0,i.kt)("inlineCode",{parentName:"p"},"ts-sidecar")," \ucee8\ud14c\uc774\ub108 securityContext\uc5d0 ",(0,i.kt)("inlineCode",{parentName:"p"},"NET_ADMIN")," \uad8c\ud55c\uc774 \ucd94\uac00\ub41c\uac83\uc744 \ubcfc\uc218 \uc788\ub2e4. \uc774\ub294 sidecar \ud30c\ub4dc\uac00 \ud130\ub110 \uc778\ud130\ud398\uc774\uc2a4\ub97c \uad6c\uc131\ud558\uae30 \uc704\ud574 \uc0c1\uc704 \ub178\ub4dc ",(0,i.kt)("inlineCode",{parentName:"p"},"CAP_NET_ADMIN")," \uad8c\ud55c\uc744 \ucde8\ub4dd\ud558\uae30 \uc704\ud568\uc774\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container"},"Set capabilities for a Container")," \ubb38\uc11c\ub97c \ud655\uc778\ud558\uc790. "),(0,i.kt)("p",null,"\uadf8\ub9ac\uace0 \ucd94\uac00 sidecar\ub85c ",(0,i.kt)("inlineCode",{parentName:"p"},"nicolaka/netshoot"),"\ub97c \ucd94\uac00\ud588\ub294\ub370 \uc774\ub294 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/nicolaka/netshoot"},"\ub124\ud2b8\uc6cc\ud06c \uc7a5\uc560 \ucc98\ub9ac\uc5d0 \uc720\uc6a9\ud55c \ud504\ub85c\uc81d\ud2b8"),"\ub85c \uc5ec\ub7ec\uac00\uc9c0 \ub124\ud2b8\uc6cc\ud06c \uc815\ubcf4\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  serviceAccountName: tailscale\n  containers:\n  - name: nginx\n    image: nginx\n  - name: netshoot\n    image: nicolaka/netshoot \n    command: ["tail"]\n    args: ["-f", "/dev/null"]\n  - name: ts-sidecar\n    imagePullPolicy: Always\n    image: ddiiwoong/tailscale-k8s:latest\n    env:\n      # Store the state in a k8s secret\n    - name: KUBE_SECRET\n      value: tailscale-auth\n    - name: USERSPACE\n      value: "false"\n    - name: AUTH_KEY\n      valueFrom:\n        secretKeyRef:\n          name: tailscale-auth\n          key: AUTH_KEY\n          optional: true\n    securityContext:\n      capabilities:\n        add:\n        - NET_ADMIN\n')),(0,i.kt)("p",null,"\uc0dd\uc131\uc744 \ud558\uace0 \uc0b4\ud3b4\ubcf4\uba74 sidecar nginx \ud30c\ub4dc\uac00 \uc0dd\uc131\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ kubectl get pod nginx -n tailscale\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   3/3     Running   0          25s\n")),(0,i.kt)("p",null,"tailscale sidecar \ub85c\uadf8\ub97c \uc7a0\uae50 \uc0b4\ud3b4\ubcf4\uc790. \uc0c8\ub85c\uc6b4 ",(0,i.kt)("inlineCode",{parentName:"p"},"tailscale0")," tun \uc778\ud130\ud398\uc774\uc2a4\uac00 \ucd94\uac00\ub418\uace0 \uc6d0\ub798 pod eth0 \uc778\ud130\ud398\uc774\uc2a4 ip\ub3c4 \ud655\uc778\uc774 \ub41c\ub2e4. \ub610\ud55c ",(0,i.kt)("inlineCode",{parentName:"p"},"wireguard")," device\ub3c4 \uc62c\ub77c\uc624\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'$ kubectl logs nginx ts-sidecar -n tailscale\nStarting tailscaled\nRunning tailscale up\n2022/02/05 12:20:26 logtail started\n2022/02/05 12:20:26 Program starting: v1.20.2-t8e643357d, Go 1.17.6-tse44d304e54: []string{"tailscaled", "--state=kube:tailscale-auth", "--socket=/tmp/tailscaled.sock"}\n2022/02/05 12:20:26 LogID: 31416c9a454e3667661bf0f21ccde8ebf72604d7434660b0db55e838be372bc4\n2022/02/05 12:20:26 logpolicy: using system state directory "/var/lib/tailscale"\nlogpolicy.Read /var/lib/tailscale/tailscaled.log.conf: open /var/lib/tailscale/tailscaled.log.conf: no such file or directory\n2022/02/05 12:20:26 wgengine.NewUserspaceEngine(tun "tailscale0") ...\n2022/02/05 12:20:26 router: disabling tunneled IPv6 due to system IPv6 config: disable_ipv6 is set\n2022/02/05 12:20:26 dns: [rc=unknown ret=direct]\n2022/02/05 12:20:26 dns: using *dns.directManager\n2022/02/05 12:20:26 link state: interfaces.State{defaultRoute=eth0 ifs={eth0:[192.168.118.89/32]} v4=true v6=false}\n2022/02/05 12:20:26 magicsock: disco key = d:1b04c57ebf000fe0\n2022/02/05 12:20:26 Creating wireguard device...\n2022/02/05 12:20:26 Bringing wireguard device up...\n2022/02/05 12:20:26 Bringing router up...\n2022/02/05 12:20:26 external route: up\n2022/02/05 12:20:26 Clearing router settings...\n2022/02/05 12:20:26 Starting link monitor...\n2022/02/05 12:20:26 Engine created.\n2022/02/05 12:20:26 netmap packet filter: (not ready yet)\n2022/02/05 12:20:26 Start\n2022/02/05 12:20:26 using backend prefs\n...\n2022/02/05 12:20:28 active login: ddiiwoong@gmail.com\n2022/02/05 12:20:28 netmap packet filter: 1 filters\n...\n2022/02/05 12:20:28 dns: Set: {DefaultResolvers:[] Routes:{} SearchDomains:[] Hosts:4}\n2022/02/05 12:20:28 dns: Resolvercfg: {Routes:{} Hosts:4 LocalDomains:[]}\n2022/02/05 12:20:28 dns: OScfg: {Nameservers:[] SearchDomains:[] MatchDomains:[]}\n2022/02/05 12:20:28 Taildrop disabled; no state directory\n2022/02/05 12:20:28 peerapi starting without Taildrop directory configured\n2022/02/05 12:20:28 peerapi: serving on http://100.95.209.95:34980\n...\n')),(0,i.kt)("p",null,"netshoot \ud30c\ub4dc\ub0b4\uc5d0\uc11c\ub3c4 ",(0,i.kt)("inlineCode",{parentName:"p"},"tailscale0")," \uc778\ud130\ud398\uc774\uc2a4\uac00 \ucd94\uac00\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ kubectl exec -it nginx -c netshoot -- ip -c addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n3: eth0@if8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default\n    link/ether 6e:f8:f5:f3:47:11 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.118.89/32 scope global eth0\n       valid_lft forever preferred_lft forever\n4: tailscale0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1280 qdisc pfifo_fast state UNKNOWN group default qlen 500\n    link/none\n    inet 100.95.209.95/32 scope global tailscale0\n       valid_lft forever preferred_lft forever\n")),(0,i.kt)("p",null,"\ub85c\uceec\uc5d0\uc11c ",(0,i.kt)("inlineCode",{parentName:"p"},"tailscale")," CLI\ub97c \ud1b5\ud574 IP\uc815\ubcf4\ub3c4 \ub3d9\uc77c\ud55c \uac83\uc744 \ud655\uc778 \ud560 \uc218 \uc788\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ tailscale status\n100.89.226.113  88665a4a51c4         ddiiwoong@   macOS   -\n100.76.233.116  jinwoonuimbp141      ddiiwoong@   macOS   offline\n100.95.209.95   nginx                ddiiwoong@   linux   -\n100.106.65.5    win11                ddiiwoong@   windows -\n")),(0,i.kt)("p",null,"\uba3c\uc800 \uc5b4\ub5a0\ud55c kubernetes \uc11c\ube44\uc2a4\ub3c4 \uc5c6\ub294 \uac83\uc744 \ud655\uc778\ud558\uace0, \ubbf8\ub9ac magicdns\ub97c \uad6c\uc131\ud574\ub1a8\uae30 \ub54c\ubb38\uc5d0 ",(0,i.kt)("inlineCode",{parentName:"p"},"nginx")," \uc8fc\uc18c\ub85c \uc9c1\uc811 \ud1b5\uc2e0\uc744 \uc2dc\ub3c4\ud574\ubcf4\uc790. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ kubectl get svc -n A\nNo resources found in A namespace.\n\n$ ping nginx\nPING nginx.ddiiwoong.gmail.com.beta.tailscale.net (100.95.209.95): 56 data bytes\n64 bytes from 100.95.209.95: icmp_seq=0 ttl=255 time=193.606 ms\n64 bytes from 100.95.209.95: icmp_seq=1 ttl=255 time=95.747 ms\n64 bytes from 100.95.209.95: icmp_seq=2 ttl=255 time=94.441 ms\n\n$ curl http://nginx\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n...\n")),(0,i.kt)("h3",{id:"userspace-sidecar-\ud14c\uc2a4\ud2b8"},"Userspace Sidecar \ud14c\uc2a4\ud2b8"),(0,i.kt)("p",null,"userspace \ubaa8\ub4dc\ub85c \uc2e4\ud589\ud574\ubcf4\uc790. \uc704\uc640 \ucc28\uc774\uc810\uc740 ",(0,i.kt)("inlineCode",{parentName:"p"},"NET_ADMIN")," \uad8c\ud55c\uc744 \ube7c\uace0, ",(0,i.kt)("inlineCode",{parentName:"p"},"runAsUser: 1000"),"\uc640 ",(0,i.kt)("inlineCode",{parentName:"p"},"runAsGroup: 1000"),"\uc744 \ucd94\uac00\ud588\ub2e4. \ud574\ub2f9 \ud074\ub77c\uc774\uc5b8\ud2b8\ub098 \ub178\ub4dc\uac00 \uc678\ubd80\ub85c \ud1b5\uc2e0\uc744 \uc704\ud574\uc11c\ub294 ",(0,i.kt)("a",{parentName:"p",href:"https://tailscale.com/kb/1112/userspace-networking/"},"SOCKS5 \uc774\ub098 HTTP proxy \ubaa8\ub4dc"),"\ub85c \uc2e4\ud589\ub418\uc5b4\uc57c \ud55c\ub2e4. \uc774\ubc88 \ub370\ubaa8\uc5d0\uc11c\ub294 \uad6c\uc131\ud558\uc9c0 \uc54a\ub294\ub2e4."),(0,i.kt)("p",null,"userspace \ubaa8\ub4dc\ub294 \uc8fc\ub85c \uc11c\ubc84\ub9ac\uc2a4 \uc6cc\ud06c\ub85c\ub4dc(Heroku, Google Cloud Run, AWS Lambda, Github Action)\uc5d0\uc11c \ud65c\uc6a9\uc744 \ud560 \ub54c \uc88b\ub2e4. \ub2e8 \ubcf4\uc548\uc744 \uc704\ud574 authKey\ub97c ",(0,i.kt)("inlineCode",{parentName:"p"},"ephemeral")," \ud615\ud0dc\ub85c \uad6c\uc131\ud558\ub294\uac8c \uc88b\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  serviceAccountName: tailscale\n  containers:\n  - name: nginx\n    image: nginx\n  - name: netshoot\n    image: nicolaka/netshoot \n    command: ["tail"]\n    args: ["-f", "/dev/null"]\n  - name: ts-sidecar\n    imagePullPolicy: Always\n    image: ddiiwoong/tailscale-k8s:latest\n    securityContext:\n      runAsUser: 1000\n      runAsGroup: 1000\n    env:\n    - name: KUBE_SECRET\n      value: tailscale-auth\n    - name: USERSPACE\n      value: "true"\n    - name: AUTH_KEY\n      valueFrom:\n        secretKeyRef:\n          name: tailscale-auth\n          key: AUTH_KEY\n          optional: true\n')),(0,i.kt)("p",null,"\ub3d9\uc77c\ud558\uac8c \uc811\uc18d\uc774 \uac00\ub2a5\ud55c\ub370, userspace \ubaa8\ub4dc \uc774\uae30 \ub54c\ubb38\uc5d0 netshoot \ucee8\ud14c\uc774\ub108\ub85c \uc778\ud130\ud398\uc774\uc2a4\ub97c \ud655\uc778\ud558\uba74 \uad8c\ud55c\uc774 \uc5c6\uae30 \ub54c\ubb38\uc5d0 eth0 \ub9cc \ud655\uc778 \uac00\ub2a5\ud558\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ kubectl exec -it nginx -c netshoot -- ip -c addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n3: eth0@if10: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default\n    link/ether 3a:c5:b6:cf:d1:bd brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.117.251/32 scope global eth0\n       valid_lft forever preferred_lft forever\n")),(0,i.kt)("h3",{id:"proxy-\ubaa8\ub4dc-\ud14c\uc2a4\ud2b8"},"Proxy \ubaa8\ub4dc \ud14c\uc2a4\ud2b8"),(0,i.kt)("p",null,"\uae30\uc874\uc758 \ubc30\ud3ec\ub41c Service \ub9ac\uc18c\uc2a4\uc5d0 \uc5f0\uacb0\ud558\ub294 \ubc29\uc2dd\uc774\ub2e4. \ubbf8\ub9ac nginx\ub97c \ub744\uc6cc \ub193\uace0 ClusterIP\ub97c \ud655\uc778\ud55c\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ kubectl create deployment nginx --image nginx\n$ kubectl expose deployment nginx --port 80\n$ kubectl get svc nginx -o=jsonpath='{.spec.clusterIP}'\ndeployment.apps/nginx created\nservice/nginx exposed\n10.100.213.92%\n")),(0,i.kt)("p",null,"Proxy \ud30c\ub4dc\ub97c \ubc30\ud3ec\ud55c\ub2e4. \ucc38\uace0\ud560 \uc0ac\ud56d\uc740 ",(0,i.kt)("inlineCode",{parentName:"p"},"sysctler")," \ucee8\ud14c\uc774\ub108\uc778\ub370, \uae30\ubcf8\uc801\uc73c\ub85c ",(0,i.kt)("inlineCode",{parentName:"p"},"net.ipv4.ip_forward")," \ud50c\ub798\uadf8\ub294 ",(0,i.kt)("inlineCode",{parentName:"p"},"Kubelet"),"\uc5d0\uc11c \ud654\uc774\ud2b8\ub9ac\uc2a4\ud2b8 \ucc98\ub9ac\uac00 \ub418\uc5b4 \uc788\uc9c0 \uc54a\uc73c\ubbc0\ub85c \ub0b4\ubd80\uc5d0\uc11c IP Forwarding\uc744 \uc704\ud574\uc11c \ucd94\uac00 \uc124\uc815\uc774 \ud544\uc694\ud558\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: proxy\nspec:\n  serviceAccountName: tailscale\n  initContainers:\n  - name: sysctler\n    image: busybox\n    securityContext:\n      privileged: true\n    command: ["/bin/sh"]\n    args:\n      - -c\n      - sysctl -w net.ipv4.ip_forward=1\n    resources:\n      requests:\n        cpu: 1m\n        memory: 1Mi\n  containers:\n  - name: tailscale\n    imagePullPolicy: Always\n    image: ddiiwoong/tailscale-k8s:latest\n    env:\n    - name: KUBE_SECRET\n      value: tailscale-auth\n    - name: USERSPACE\n      value: "false"\n    - name: AUTH_KEY\n      valueFrom:\n        secretKeyRef:\n          name: tailscale-auth\n          key: AUTH_KEY\n          optional: true\n    - name: DEST_IP\n      value: 10.100.213.92\n    securityContext:\n      capabilities:\n        add:\n        - NET_ADMIN\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl get pod -n tailscale\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-6799fc88d8-5g49v   1/1     Running   0          5m59s\nproxy                    1/1     Running   0          22s\n")),(0,i.kt)("p",null,"\uc815\uc0c1\uc801\uc73c\ub85c \ubc30\ud3ec\ub41c proxy \ucee8\ud14c\uc774\ub108\ub85c \uc811\uc18d\ud574\ubcf4\uba74 \ub3d9\uc77c\ud558\uac8c \uc811\uadfc\uc774 \ub418\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ tailscale status\n100.89.226.113  88665a4a51c4         ddiiwoong@   macOS   -\n100.76.233.116  jinwoonuimbp141      ddiiwoong@   macOS   offline\n100.95.209.95   proxy                ddiiwoong@   linux   idle, tx 788 rx 1452\n100.106.65.5    win11                ddiiwoong@   windows -\n\n$ curl https://proxy\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n...\n")),(0,i.kt)("h3",{id:"subnet-router-\ubaa8\ub4dc-\ud14c\uc2a4\ud2b8"},"Subnet Router \ubaa8\ub4dc \ud14c\uc2a4\ud2b8"),(0,i.kt)("p",null,"Tailscale\uc5d0\uc11c Subnet Router \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud558\uba74 \uc804\uccb4 \ud074\ub7ec\uc2a4\ud130\uc758 subnet \ub300\uc5ed\uc73c\ub85c \uc811\uadfc\uc774 \uac00\ub2a5\ud558\ub2e4. "),(0,i.kt)("p",null,"\uae30\ubcf8\uc801\uc73c\ub85c EKS API\ub294 \uc11c\ube44\uc2a4 subnet\uc73c\ub85c ",(0,i.kt)("inlineCode",{parentName:"p"},"10.100.0.0/16")," \ub610\ub294 ",(0,i.kt)("inlineCode",{parentName:"p"},"172.20.0.0/16")," \uc744 \uc0ac\uc6a9\ud55c\ub2e4. \ubc30\ud3ec\ud55c eksctl\ub85c \uad6c\uc131\ud55c EKS \ud074\ub7ec\uc2a4\ud130 subnet\uc740 3\uac1c AZ\uc5d0 19bit\ub85c \ub098\ub258\uc5b4 \ubc30\ud3ec\ub418\uc5c8\uace0 ",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.96.0/19"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.128.0/19"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.160.0/19"),"\uc73c\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\ub2e4. "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ kubectl get node -o wide\nNAME                                                 STATUS   ROLES    AGE   VERSION               INTERNAL-IP       EXTERNAL-IP   OS-IMAGE         KERNEL-VERSION                CONTAINER-RUNTIME\nip-192-168-101-195.ap-northeast-2.compute.internal   Ready    <none>   23h   v1.21.5-eks-9017834   192.168.101.195   <none>        Amazon Linux 2   5.4.172-90.336.amzn2.x86_64   docker://20.10.7\nip-192-168-134-35.ap-northeast-2.compute.internal    Ready    <none>   23h   v1.21.5-eks-9017834   192.168.134.35    <none>        Amazon Linux 2   5.4.172-90.336.amzn2.x86_64   docker://20.10.7\nip-192-168-186-235.ap-northeast-2.compute.internal   Ready    <none>   23h   v1.21.5-eks-9017834   192.168.186.235   <none>        Amazon Linux 2   5.4.172-90.336.amzn2.x86_64   docker://20.10.7\n\n$ kubectl get pod -o wide\nNAME                     READY   STATUS    RESTARTS   AGE     IP                NODE                                                 NOMINATED NODE   READINESS GATES\nnginx-6799fc88d8-5g49v   1/1     Running   0          11m     192.168.112.183   ip-192-168-101-195.ap-northeast-2.compute.internal   <none>           <none>\nproxy                    1/1     Running   0          5m39s   192.168.155.196   ip-192-168-134-35.ap-northeast-2.compute.internal    <none>           <none>\n\n$ kubectl get svc -o wide\nNAME    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE   SELECTOR\nnginx   ClusterIP   10.100.213.92   <none>        80/TCP    11m   app=nginx\n")),(0,i.kt)("p",null,"\ud574\ub2f9 subnet \ub300\uc5ed\uc744 \uc811\uc18d\ud558\uae30 \uc704\ud574\uc11c \uc11c\ube44\uc2a4 \ub300\uc5ed\uc778 ",(0,i.kt)("inlineCode",{parentName:"p"},"10.100.0.0/16"),"\uc640 \ud30c\ub4dc \ub300\uc5ed\uc778 ",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.96.0/19"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.128.0/19"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"192.168.160.0/19"),"\ub97c \uc124\uc815\ud574\uc11c router \ubaa8\ub4dc\ub85c tailscale\uc744 \uc2e4\ud589\ud558\uc790."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nmetadata:\n  name: subnet-router\n  labels:\n    app: tailscale\nspec:\n  serviceAccountName: tailscale\n  containers:\n  - name: tailscale\n    imagePullPolicy: Always\n    image: ddiiwoong/tailscale-k8s:latest\n    env:\n    - name: KUBE_SECRET\n      value: tailscale-auth\n    - name: USERSPACE\n      value: "true"\n    - name: AUTH_KEY\n      valueFrom:\n        secretKeyRef:\n          name: tailscale-auth\n          key: AUTH_KEY\n          optional: true\n    - name: ROUTES\n      value: 10.100.0.0/16,192.168.96.0/19,192.168.128.0/19,192.168.160.0/19\n    securityContext:\n      runAsUser: 1000\n      runAsGroup: 1000\n')),(0,i.kt)("p",null,"\ubc30\ud3ec\ub41c router \ub514\ubc14\uc774\uc2a4\uc640, \ub0b4\ubd80\uc758 \uc11c\ube44\uc2a4\uc5d0 \uc811\uadfc\ud558\uae30 \uc704\ud574 \ud30c\ub4dc\uc640 \uc11c\ube44\uc2a4 IP\ub97c \ud655\uc778\ud55c\ub2e4."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ tailscale status\n100.89.226.113  88665a4a51c4         ddiiwoong@   macOS   -\n100.76.233.116  jinwoonuimbp141      ddiiwoong@   macOS   offline\n100.95.209.95   subnet-router        ddiiwoong@   linux   idle, tx 1556 rx 2908\n100.106.65.5    win11                ddiiwoong@   windows -\n\n$ kubectl get pod -n tailscale\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-6799fc88d8-5g49v   1/1     Running   0          39m\nsubnet-router            1/1     Running   0          9m47s\n\n$ kubectl get pod -n tailscale -o wide\nNAME                     READY   STATUS    RESTARTS   AGE   IP                NODE                                                 NOMINATED NODE   READINESS GATES\nnginx-6799fc88d8-5g49v   1/1     Running   0          39m   192.168.112.183   ip-192-168-101-195.ap-northeast-2.compute.internal   <none>           <none>\nsubnet-router            1/1     Running   0          10m   192.168.137.188   ip-192-168-134-35.ap-northeast-2.compute.internal    <none>           <none>\n\n$ kubectl get svc -n tailscale\nNAME    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\nnginx   ClusterIP   10.100.213.92   <none>        80/TCP    40m\n")),(0,i.kt)("p",null,"\ubc14\ub85c \uc811\uc18d\uc744 \ud574\ubcf4\uba74 \uc811\uc18d\uc774 \uc548\ub41c\ub2e4\ub294\uac78 \uc54c\uc218 \uc788\ub2e4. ",(0,i.kt)("a",{parentName:"p",href:"https://login.tailscale.com/admin/machines"},"tailscale \uc11c\ube44\uc2a4"),"\ub85c \uc774\ub3d9\ud574 route \uc124\uc815\uc5d0\uc11c \uc811\uadfc\ud560 \ub300\uc5ed\uc744 \uc544\ub798\uc640 \uac19\uc774 \ud65c\uc131\ud654\ud558\uace0 curl\ub85c \uc811\uc18d\ud574\ubcf4\uba74 \uc815\uc0c1\uc801\uc73c\ub85c \uc811\uadfc\uc774 \ub41c\ub2e4\ub294\uac78 \uc54c\uc218 \uc788\ub2e4. \uc774\uac78\ub85c \uc0dd\uac01\ud574\ubd24\uc744 \ub54c ",(0,i.kt)("inlineCode",{parentName:"p"},"NetworkPolicy")," \ub4f1\uacfc \ud568\uaed8 \uc124\uc815\uc744 \ud558\uba74 \ub0b4\ubd80 \ub9ac\uc18c\uc2a4 \uc811\uadfc \ud1b5\uc81c\ub3c4 \uac00\ub2a5\ud560 \uac83\uc73c\ub85c \uc0dd\uac01\ub41c\ub2e4. "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"router",src:t(20853).Z,width:"1172",height:"720"})),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ curl 192.168.112.183\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n...\n\n$ curl 10.100.213.92\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n...\n")),(0,i.kt)("h2",{id:"\ud65c\uc6a9\ubc29\uc548"},"\ud65c\uc6a9\ubc29\uc548"),(0,i.kt)("p",null,"\uae30\uc874\uc5d0\ub294 \uc9d1 \ub0b4\ubd80\uc5d0 \uc788\ub294 \uc790\uc6d0 NAS\ub098 macOS \ub4f1\uc744 \uc6d0\uaca9\uc73c\ub85c \uad00\ub9ac\ud558\uae30 \uc704\ud55c \uc6a9\ub3c4\uc600\ub2e4\uba74, \uc774\ubc88 \ud14c\uc2a4\ud2b8\ub97c \ud1b5\ud574 \uae30\ubcf8 Personal \ubb34\ub8cc Plan\uc73c\ub85c\ub3c4 \ud65c\uc6a9\uac00\ub2a5\ud55c \uba87\uac00\uc9c0 \uc720\uc2a4\ucf00\uc774\uc2a4\ub97c \uc0dd\uac01\ud574\ubd24\ub2e4.  "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\ucd94\uac00\uc801\uc778 VPN \uad6c\uc131\uc5c6\uc774 \uc6d0\uaca9\uc9c0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc874\uc7ac\ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub514\ubc84\uae45 \ubc0f \uad00\ub9ac \uac00\ub2a5 (Telepresence \ub300\uccb4)"),(0,i.kt)("li",{parentName:"ul"},"sidecar \ubaa8\ub4dc\ub85c \ud65c\uc6a9\uc2dc Private \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud55c \uc11c\ube44\uc2a4 \uad6c\uc131 \ubc0f IP\uad00\ub9ac \ubd88\ud544\uc694 "),(0,i.kt)("li",{parentName:"ul"},"Prometheus Service Discovry\ub97c tailscale\ub85c \uc9c4\ud589\ud558\uc5ec \uac1c\uc778 \uad00\ub9ac \ub514\ubc14\uc774\uc2a4 \uc804\uccb4 \ubaa8\ub2c8\ud130\ub9c1"),(0,i.kt)("li",{parentName:"ul"},"\ubaa8\ubc14\uc77c \uc6f9\uc571 \ud14c\uc2a4\ud2b8\uc2dc \ubcf8\uc778 \ud734\ub300\ud3f0\uc73c\ub85c \uc9c1\uc811 \uc561\uc138\uc2a4 \uac00\ub2a5"),(0,i.kt)("li",{parentName:"ul"},"\ud604\uc7ac \uac1c\uc778 \ud504\ub85c\uc81d\ud2b8\ub85c \ud65c\uc6a9\uc911\uc778 Plex(\ubbf8\ub514\uc5b4\uc11c\ubc84), \ub178\ud2b8 \uc571 \ub4f1\uc744 \uc11c\ube44\uc2a4 \uad6c\uc131\uc5c6\uc774 ACL \ubc0f MFA \uc801\uc6a9\uc744 \ud1b5\ud55c \ubcf4\uc548 \uac15\ud654"),(0,i.kt)("li",{parentName:"ul"},"wireguard \ud504\ub85c\ud1a0\ucf5c\uc744 \ud65c\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \uc5b4\ub514\uc11c\ub4e0 \ub04a\uae40\uc5c6\uc774 \ud074\ub7ec\uc2a4\ud130 \ub9ac\uc18c\uc2a4 \uc811\uadfc"),(0,i.kt)("li",{parentName:"ul"},"\ud604\uc7ac \uad6c\uc131\uc911\uc778 site-to-site vpn \ub300\uccb4 (OCI-OCI\uac04)")),(0,i.kt)("p",null,"\ub354 \ub9ce\uc740 \ud65c\uc6a9\ubc29\uc548\uc774 \uc788\uc744\ud150\ub370 \uc77c\ub2e8 \uc0dd\uac01\ub098\ub294 \uac83\ub4e4\ub9cc \uc801\uc5b4\ubcf4\uc558\ub2e4."),(0,i.kt)("h2",{id:"\uc815\ub9ac"},"\uc815\ub9ac"),(0,i.kt)("p",null,"\uc774\ubc88 \ud3ec\uc2a4\ud305\uc740 \ub124\ud2b8\uc6cc\ud06c \uc2a4\ud130\ub514\ub97c \uc9c4\ud589\ud558\uba74\uc11c \uacfc\uc81c\ub85c \uc791\uc131\ub41c \ubd80\ubd84\uc774 \uc5c6\uc9c0 \uc54a\ub2e4. \uc815\ub9d0 \uc774\ubc88 \uc2a4\ud130\ub514\ub294 \uc5ed\ub300\uae09\uc73c\ub85c \ud004\ub9ac\ud2f0\ub098 \uc5ec\ub7ec\uac00\uc9c0\uba74\uc5d0\uc11c \uc88b\uc740 \uc810\uc774 \ub9ce\ub2e4. \ud56d\uc0c1 \ub300\ub2e8\ud558\ub2e4\uace0 \ub290\ub07c\ub294 \ubd84\ub4e4\uacfc \ud568\uaed8\ud558\uace0 \uc788\uc5b4\uc11c \ub9c8\uc9c0\ub9c9\uae4c\uc9c0 \uc644\uc8fc\ud560 \uc218 \uc788\ub3c4\ub85d \uc870\uae08 \ub354 \uacf5\ubd80\ud574\uc57c \uaca0\ub2e4\ub294 \uc0dd\uac01\uc774 \ub4e0\ub2e4. \ub2e4\uc2dc\ud55c\ubc88 ",(0,i.kt)("a",{parentName:"p",href:"https://www.facebook.com/jongho.seo.5811"},"\uac00\uc2dc\ub2e4"),"\ub2d8\uc744 ",(0,i.kt)("inlineCode",{parentName:"p"},"shout-out")," \ud558\uace0 2022\ub144 \uccab \ud3ec\uc2a4\ud305\uc740 \uc774\uac83\uc73c\ub85c \ub9c8\ubb34\ub9ac\ud55c\ub2e4."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4.")))}d.isMDXComponent=!0},20853:function(e,n,t){n.Z=t.p+"assets/images/subnetmode-1a9c172f146ddde3e0182a3f40eb7393.png"},26568:function(e,n,t){n.Z=t.p+"assets/images/tailscale-key-7bc957707fe91c3c4465cb95ad0af640.png"},49910:function(e,n,t){n.Z=t.p+"assets/images/tailscale-web-3a41c37cafdc8bbc9c7868e3dfe96040.png"},29443:function(e,n,t){n.Z=t.p+"assets/images/wg-9118a771c7d571be3495eeef652b7e06.png"}}]);