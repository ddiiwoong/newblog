<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Act as a catalyst RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Act as a catalyst Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Act as a catalyst JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-4ZT898XDT2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4ZT898XDT2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4ZT898XDT2",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Cloud Catalyst" href="/opensearch.xml">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4362752107119680" crossorigin="anonymous"></script><title data-rh="true">2 posts tagged with &quot;Agones&quot; | Cloud Catalyst</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ddii.dev/tags/agones/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="naver-site-verification" content="cbcc03783e5594725d3951f4e7f16ede80e69881"><meta data-rh="true" property="og:title" content="2 posts tagged with &quot;Agones&quot; | Cloud Catalyst"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ddii.dev/tags/agones/"><link data-rh="true" rel="alternate" href="https://ddii.dev/tags/agones/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ddii.dev/tags/agones/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UTLA0DRN66-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.1e7a31ee.css">
<link rel="preload" href="/assets/js/runtime~main.1737c962.js" as="script">
<link rel="preload" href="/assets/js/main.827bab8b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-catalyst.svg" alt="Cloud Catalyst" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo-catalyst.svg" alt="Cloud Catalyst" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Cloud Catalyst</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Posts</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="introduction" href="/docs/prometheus/introduction/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/prometheus/introduction/">Prometheus</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tags/">Tags</a><a class="navbar__item navbar__link" href="/presentation/">Presentation</a><a class="navbar__item navbar__link" href="/archive/">Archive</a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/pang4u/">Pang4u</a><a href="https://github.com/ddiiwoong/newblog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/gatewayapi/">AWS Gateway API Controller</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/headless-service/">Kubernetes Headless Service</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/externaldns/">ExternalDNS</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/multus-on-kind/">Multus on Kind cluster</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/readinessandprobe/">파드 Readiness &amp; Probe</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 posts tagged with &quot;Agones&quot;</h1><a href="/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/kubernetes/openinfraday18/">Provisioning Dedicated Game Server on Kubernetes Cluster</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2018-07-01T00:00:00.000Z" itemprop="datePublished">July 1, 2018</time> · <!-- -->One min read</div></header><div class="markdown" itemprop="articleBody"><p>6월 28일에 Openinfraday에서 발표한 내용</p><p><a href="https://www.slideshare.net/openstack_kr/openinfra-days-korea-2018-track-4-provisioning-dedicated-game-server-on-kubernetes-cluster" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://image.slidesharecdn.com/43dgs06270307-180628163517/95/openinfra-days-korea-2018-track-4-provisioning-dedicated-game-server-on-kubernetes-cluster-1-638.jpg?cb=1530203766" alt="Slideshare" class="img_E7b_"></a></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="발표-영상">발표 영상<a class="hash-link" href="#발표-영상" title="Direct link to heading">​</a></h2><p><a href="https://youtu.be/LtGGzKBoVZQ?t=0s" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="http://img.youtube.com/vi/LtGGzKBoVZQ/0.jpg" alt="Video" class="img_E7b_"></a></p><p>Custom Resource 에 대한 내용은 상세하게 더 정리해야겠다.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/ci-cd/">CI/CD</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kubernetes/">Kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/agones/">Agones</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/spinnaker/">Spinnaker</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Provisioning Dedicated Game Server on Kubernetes Cluster" href="/kubernetes/openinfraday18/"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/kubernetes/mutating-web-hook/">Mutating Webhook</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2018-06-27T00:00:00.000Z" itemprop="datePublished">June 27, 2018</time> · <!-- -->9 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="admission-controller-확장">Admission controller 확장<a class="hash-link" href="#admission-controller-확장" title="Direct link to heading">​</a></h2><p>Kubernetes(이하 k8s)기반 개발 과제를 수행하다보니 Custom Resource를 사용할수 밖에 없는 상황들이 발생하였다.<br>
<!-- -->그런 와중에 istio와 같은 Service Mesh Layer를 리서치하던 중에 튀어나온 MutatingAdmissionWebhook 용어를 이해하기 위에 조사한 내용을 정리해본다.</p><p><a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/</a></p><p>Admission controller는 쿠버네티스 api-server의 오브젝트(Pod,등) 생성 요청을 가로체어 제어를 할 수 있는 확장 기능으로 플러그인 형태로 사용자가 추가 할 수 있다.<br>
<!-- -->좀더 자세히 확인해보자 </p><ul><li>클러스터 관리자가 kube-api를 직접 컴파일 하고 구성해야 하기 때문에 유연하게 사용하기 어려움</li><li>1.7 버전 이후부터는 이러한 제한사항을 해결하기 위해 alpha feature로  <a href="https://v1-9.docs.kubernetes.io/docs/admin/extensible-admission-controllers/#initializers" target="_blank" rel="noopener noreferrer">Initializers</a> 와 <a href="https://v1-9.docs.kubernetes.io/docs/admin/extensible-admission-controllers/#external-admission-webhooks" target="_blank" rel="noopener noreferrer">External Admission Webhooks</a> 기능이 도입됨</li><li>External Admission Webhooks 는 k8s 리소스의 유효성 검사를 하는데 활용, 유효성 검사를 통과 하지 못하면 해 당 리소스는 쿠버네티스에서 생성되질 않게 할 수 있음.</li><li>1.9 버전에서는 External Admission Webhooks 은 beta로 승격되어 MutatingAdmissionWebhook 및 ValidatingAdmissionWebhook으로 나눠졌지만 Initializers 는 alpha 로 유지됨</li><li>MutatingAdmissionWebhook 은 유효성 검사 이외에도 승인 과정시 k8s object에 변경을 할수 있음<ul><li>예를 들면 resource quota를 변경한다던지  Agones 및 istio와 같은 Custom Resource 를 수정하여 object를 생성이 가능함</li><li>Webhook 방식은 gRPC 프로토콜을 사용하는 데 개발언어에 구애 받지 않고 확장을 할 수 있다는 장점이 있음</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="webhook을-언제-쓰는가">Webhook을 언제 쓰는가?<a class="hash-link" href="#webhook을-언제-쓰는가" title="Direct link to heading">​</a></h2><p>Webhook을 사용하여 k8s cluster-admin이 api-server를 다시 컴파일하지 않고도 object생성 요청시 mutating(변경) 및 validation(유효성검증) 을 하는 플러그인을 만들 수 있다. </p><p>이를 통해 개발자는 모든 resource 에서 여러 작업 ( &quot;CREATE&quot;, &quot;UPDATE&quot;, &quot;DELETE&quot;...)에 대한 승인 로직에 대해 사용자 정의 할 수있는 유연성을 제공받는다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="use-case">Use-Case<a class="hash-link" href="#use-case" title="Direct link to heading">​</a></h2><ul><li><p>resource를 생성하기 전에 변경<br>
<!-- -->(예, Istio 에서 처럼 traffic management 와 policy enforcement 을 위해 Envoy sidecar container를 injection)</p></li><li><p>StorageClass Provisioning 자동화<br>
<!-- -->(PersistentVolumeClaim object 생성을 모니터링하고 미리 정의 된 정책에 따라 객체에 storage를 자동으로 추가. 사용자는 StorageClass 생성 에 신경 쓸 필요가 없음)</p></li><li><p>복잡한 custom resource 검증 (Agones와 같은)namespace 제한<br>
<!-- -->멀티 테넌트 시스템에서는 reserved namespace에 resource생성을 금지시킬때 사용할수 있음</p></li><li><p>참고 예시<br>
<a href="https://github.com/kelseyhightower/denyenv-validating-admission-webhook" target="_blank" rel="noopener noreferrer">https://github.com/kelseyhightower/denyenv-validating-admission-webhook</a></p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="어떻게-동작하는가">어떻게 동작하는가?<a class="hash-link" href="#어떻게-동작하는가" title="Direct link to heading">​</a></h2><p>MutatingWebhookConfiguration 내에 정의된 룰에 따라 etcd로 전달되기 전에 request를 intercept한다.<br>
<!-- -->webhook 서버에 승인 요청을 전송하여 변이를 실행한다.<br>
<!-- -->webhook 서버는 API를 준수하는 단순한 http서버.</p><p><img loading="lazy" alt="Alt text" src="/assets/images/mutating-b4b8965d675e621d8560c81accf497c7.jpg" width="1600" height="1643" class="img_E7b_"></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="튜토리얼">튜토리얼<a class="hash-link" href="#튜토리얼" title="Direct link to heading">​</a></h2><p><a href="https://github.com/morvencao/kube-mutating-webhook-tutorial" target="_blank" rel="noopener noreferrer">https://github.com/morvencao/kube-mutating-webhook-tutorial</a>  </p><p>위 튜토리얼은 object가 생성되기 전에 pod에 nginx sidecar container를 inject하는 MutatingAdmissionWebhook을 배포하는 내용을 담고 있다.</p><p>우선 admissionregistration.k8s.io/v1beta1 API를 사용할수 있는 k8s 1.9+ 이상의 클러스터가 필요하다.  </p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="확인방법">확인방법<a class="hash-link" href="#확인방법" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl api-versions | grep admissionregistration.k8s.io/v1beta1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>아래와 같은 결과가 나와야함</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">admissionregistration.k8s.io/v1beta1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="build하기">Build하기<a class="hash-link" href="#build하기" title="Direct link to heading">​</a></h2><p>일단 Go가 설치되어 있어야 한다.
<code>~/go/src</code> 아래에 clone을 하였음.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd ~/go/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/morvencao/kube-mutating-webhook-tutorial.git</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>의존성 관리를 위해 repo는 dep를 사용함</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd kube-mutating-webhook-tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ go get -u github.com/golang/dep/cmd/dep</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>build 파일 확인하고 registry 위치를 바꿈</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">dep ensure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o kube-mutating-webhook-tutorial .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker build --no-cache -t registry.*****.io/agones/sidecar-injector:v1 .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf kube-mutating-webhook-tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker push registry.*****.io/agones/sidecar-injector:v1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>build하고 docker image push</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sending build context to Docker daemon  44.29MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 1/3 : FROM alpine:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 3fd9065eaf02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 2/3 : ADD kube-mutating-webhook-tutorial /kube-mutating-webhook-tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 8679ccbab536</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 3/3 : ENTRYPOINT [&quot;./kube-mutating-webhook-tutorial&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Running in 7699ff5c0885</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing intermediate container 7699ff5c0885</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 2014100d460e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully built 2014100d460e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully tagged registry.*****.io/agones/sidecar-injector:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The push refers to repository [registry.*****.io/agones/sidecar-injector]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2456c1309a51: Pushed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd7100a72410: Layer already exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v1: digest: sha256:15c335daeba40ddcbfbc3631ab6daa7cf623b63420f0ae8b657755322ef0582d size: 739</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>sidecar deployment에 사용되는 secret(cert/key)을 생성한다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">./deployment/webhook-create-signed-cert.sh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --service sidecar-injector-webhook-svc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --secret sidecar-injector-webhook-certs \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace default</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>위에서 생성된 클러스터의 caBundle값을 가지고 MutatingWebhookConfiguration 생성한다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cat deployment/mutatingwebhook.yaml | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deployment/webhook-patch-ca-bundle.sh &gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deployment/mutatingwebhook-ca-bundle.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>resource들 deploy</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -f deployment/nginxconfigmap.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f deployment/configmap.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f deployment/deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f deployment/service.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f deployment/mutatingwebhook-ca-bundle.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap &quot;nginx-configmap&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap &quot;sidecar-injector-webhook-configmap&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.extensions &quot;sidecar-injector-webhook-deployment&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service &quot;sidecar-injector-webhook-svc&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mutatingwebhookconfiguration.admissionregistration.k8s.io &quot;sidecar-injector-webhook-cfg&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>webhook deployment 확인</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                   READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sidecar-injector-webhook-deployment-796955558f-js6bb   1/1       Running   0          3m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sidecar-injector-webhook-deployment   1         1         1            1           3m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>default 네임스페이스에 sidecar-injector 라벨링을 한다. 이렇게 하면 해당 네임스페이스에 생성되는 모든 app에 자동으로 injection하게 됨</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get namespace -L sidecar-injector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME             STATUS    AGE       SIDECAR-INJECTOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">agones-system    Active    1d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default          Active    19d       enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ibm-cert-store   Active    19d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ibm-system       Active    19d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress-test     Active    6d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-public      Active    19d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system      Active    19d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spinnaker        Active    12d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xonotic          Active    1d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>샘플앱을 디플로이 해보자</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat &lt;&lt;EOF | kubectl create -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sidecar-injector-webhook.morven.me/inject: &quot;yes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: tutum/curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command: [&quot;/bin/sleep&quot;,&quot;infinity&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imagePullPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.extensions &quot;sleep&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>sidecar container injection 확인<br>
<!-- -->아래 결과를 보면 하나의 deployment 하나의 container 생성을 요청했지만 nginx sidecar 컨테이너가 injection 된것을 확인할 수 있다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                   READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sidecar-injector-webhook-deployment-796955558f-js6bb   1/1       Running   0          2h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep-74b46f8bd7-r9l7f                                 2/2       Running   0          42s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl describe pod sleep-74b46f8bd7-r9l7f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name:           sleep-74b46f8bd7-r9l7f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:      default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:           10.178.188.16/10.178.188.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start Time:     Wed, 27 Jun 2018 13:12:47 +0900</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:         app=sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pod-template-hash=3060294683</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:    kubernetes.io/psp=ibm-privileged-psp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sidecar-injector-webhook.morven.me/inject=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sidecar-injector-webhook.morven.me/status=injected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status:         Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP:             172.30.169.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Controlled By:  ReplicaSet/sleep-74b46f8bd7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sleep:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Container ID:  docker://728ca7f8e741ad29369312bc006c79683e7e605f3b04586df2477e233f93e451</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image:         tutum/curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image ID:      docker-pullable://tutum/curl@sha256:b6f16e88387acd4e6326176b212b3dae63f5b2134e69560d0b0673cfb0fb976f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Port:          &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host Port:     &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      /bin/sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    State:          Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Started:      Wed, 27 Jun 2018 13:13:01 +0900</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ready:          True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Restart Count:  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment:    &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-czzpj (ro)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sidecar-nginx:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Container ID:   docker://94fd41a0e153de6d5639873ccbd6b6325cee1ea8351dd02ab4a48ab4004d0b58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image:          nginx:1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image ID:       docker-pullable://nginx@sha256:72daaf46f11cc753c4eab981cbf869919bd1fee3d2170a2adeac12400f494728</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Port:           80/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host Port:      0/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    State:          Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Started:      Wed, 27 Jun 2018 13:13:08 +0900</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ready:          True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Restart Count:  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment:    &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      /etc/nginx from nginx-conf (rw)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type           Status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Initialized    True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ready          True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PodScheduled   True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default-token-czzpj:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type:        Secret (a volume populated by a Secret)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SecretName:  default-token-czzpj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Optional:    false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nginx-conf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type:        ConfigMap (a volume populated by a ConfigMap)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name:        nginx-configmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Optional:    false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QoS Class:       BestEffort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node-Selectors:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type    Reason                 Age   From                    Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ----    ------                 ----  ----                    -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Scheduled              1m    default-scheduler       Successfully assigned sleep-74b46f8bd7-r9l7f to 10.178.188.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  SuccessfulMountVolume  1m    kubelet, 10.178.188.16  MountVolume.SetUp succeeded for volume &quot;nginx-conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  SuccessfulMountVolume  1m    kubelet, 10.178.188.16  MountVolume.SetUp succeeded for volume &quot;default-token-czzpj&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulling                1m    kubelet, 10.178.188.16  pulling image &quot;tutum/curl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulled                 55s   kubelet, 10.178.188.16  Successfully pulled image &quot;tutum/curl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Created                55s   kubelet, 10.178.188.16  Created container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Started                55s   kubelet, 10.178.188.16  Started container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulling                55s   kubelet, 10.178.188.16  pulling image &quot;nginx:1.12.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulled                 48s   kubelet, 10.178.188.16  Successfully pulled image &quot;nginx:1.12.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Created                48s   kubelet, 10.178.188.16  Created container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Started                48s   kubelet, 10.178.188.16  Started container</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="정리">정리<a class="hash-link" href="#정리" title="Direct link to heading">​</a></h2><p>결국 위에서 언급한것 처럼 MutationWebhook은 istio RouteRule같은 별도의 CustomResource등을 injection 하거나 agones 등과 같이 게임서버외에 client sdk 통신을 위한 injection 형태로 기존 resource에 추가적인 변경(mutation) 또는 검증(validation)등의 추가적인 작업을 kube-api의 컴파일없이 가능하다는데 목적이 있다고 볼 수 있다. 추가적으로 기능에 대한 내용은 이후 다시 정리해볼 예정이다.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/mutating-webhook/">Mutating Webhook</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kubernetes/">Kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/admission-controller/">Admission Controller</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/istio/">Istio</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/agones/">Agones</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Mutating Webhook" href="/kubernetes/mutating-web-hook/"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/archive/">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/tags/">Tags</a></li></ul></div><div class="col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/pang4u/">Pang4U</a></li><li class="footer__item"><a href="https://ko-fi.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Buy Me a Coffee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kr.linkedin.com/in/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.1737c962.js"></script>
<script src="/assets/js/main.827bab8b.js"></script>
</body>
</html>