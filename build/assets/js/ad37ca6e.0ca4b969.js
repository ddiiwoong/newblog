"use strict";(self.webpackChunkddii=self.webpackChunkddii||[]).push([[6350],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return d}});var i=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},l=Object.keys(e);for(i=0;i<l.length;i++)t=l[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)t=l[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=i.createContext({}),c=function(e){var n=i.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=c(e.components);return i.createElement(o.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(t),d=a,k=m["".concat(o,".").concat(d)]||m[d]||p[d]||l;return t?i.createElement(k,r(r({ref:n},u),{},{components:t})):i.createElement(k,r({ref:n},u))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,r=new Array(l);r[0]=m;var s={};for(var o in n)hasOwnProperty.call(n,o)&&(s[o]=n[o]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var c=2;c<l;c++)r[c]=t[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},85147:function(e,n,t){t.r(n),t.d(n,{assets:function(){return u},contentTitle:function(){return o},default:function(){return d},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return p}});var i=t(87462),a=t(63366),l=(t(67294),t(3905)),r=["components"],s={layout:"single",title:"Cilium",comments:!0,classes:"wide",description:"Cilium\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4",slug:"kubernetes/cilium-1/",date:new Date("2018-07-06T00:00:00.000Z"),categories:["Kubernetes"],tags:["Cilium","Kubernetes","network policy","Istio","BPF","CNI"]},o=void 0,c={permalink:"/kubernetes/cilium-1/",editUrl:"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-07-06-cilium-1.md",source:"@site/blog/2018-07-06-cilium-1.md",title:"Cilium",description:"Cilium\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4",date:"2018-07-06T00:00:00.000Z",formattedDate:"July 6, 2018",tags:[{label:"Cilium",permalink:"/tags/cilium"},{label:"Kubernetes",permalink:"/tags/kubernetes"},{label:"network policy",permalink:"/tags/network-policy"},{label:"Istio",permalink:"/tags/istio"},{label:"BPF",permalink:"/tags/bpf"},{label:"CNI",permalink:"/tags/cni"}],readingTime:16.09,truncated:!1,authors:[],frontMatter:{layout:"single",title:"Cilium",comments:!0,classes:"wide",description:"Cilium\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4",slug:"kubernetes/cilium-1/",date:"2018-07-06T00:00:00.000Z",categories:["Kubernetes"],tags:["Cilium","Kubernetes","network policy","Istio","BPF","CNI"]},prevItem:{title:"Operators & CRDs(CustomResourceDefinitions) on Kubernetes",permalink:"/kubernetes/operator/"},nextItem:{title:"Spinnaker on Kubernetes #1",permalink:"/kubernetes/spinnaker-advanced-1/"}},u={authorsImageUrls:[]},p=[{value:"Cilium \ub204\uad6c\ub0d0 \ub10c?",id:"cilium-\ub204\uad6c\ub0d0-\ub10c",level:2},{value:"Cilium Architecture",id:"cilium-architecture",level:2},{value:"Main Feature",id:"main-feature",level:2},{value:"Requirement",id:"requirement",level:2},{value:"Start minikube",id:"start-minikube",level:2},{value:"Check minikube cluster status",id:"check-minikube-cluster-status",level:2},{value:"Install etcd (dependency of cilium)",id:"install-etcd-dependency-of-cilium",level:2},{value:"Check all pods (etcd)",id:"check-all-pods-etcd",level:2},{value:"Install Cilium",id:"install-cilium",level:2},{value:"Check deployment",id:"check-deployment",level:2},{value:"Deploy Demo App.",id:"deploy-demo-app",level:2},{value:"L3/L4 Policy \uc801\uc6a9",id:"l3l4-policy-\uc801\uc6a9",level:2},{value:"L7 \uc815\ucc45 \uc801\uc6a9",id:"l7-\uc815\ucc45-\uc801\uc6a9",level:2}],m={toc:p};function d(e){var n=e.components,s=(0,a.Z)(e,r);return(0,l.kt)("wrapper",(0,i.Z)({},m,s,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"cilium-\ub204\uad6c\ub0d0-\ub10c"},"Cilium \ub204\uad6c\ub0d0 \ub10c?"),(0,l.kt)("p",null,"\ucc98\uc74c\uc5d0 \ub180\ub790\ub2e4. \ubc88\uc5ed\ud558\uba74 '\uc790\uad81', '\uc12c\ubaa8', '\uc18d\ub208\uc379'\ub4f1 \uc775\uc219\uce58 \uc54a\uc740 \ub2e8\uc5b4\ub77c\uc11c \ub180\ub790\uc9c0\ub9cc \ucc28\uadfc\ud788 \ubcf4\ub2e4\ubcf4\ub2c8 \uacb0\uad6d OS\ub0b4\ubd80(\ub9ac\ub205\uc2a4 \ucee4\ub110)\uc5d0\uc11c\ubd80\ud130 \ucee8\ud14c\uc774\ub108\uac04 \ub610\ub294 \uc678\ubd80\uc640\uc758 \uc5f0\uacb0\uc744 \ubcf4\ud638\ud558\ub294 \uc5ed\ud560\uc774\ub77c\uace0 \ud558\ub2c8 \uc774\ud574\uac00 \ub418\ub294 \uac83 \uac19\ub2e4."),(0,l.kt)("p",null,"\ud648\ud398\uc774\uc9c0\uc5d0 \uc815\uc758\ub41c \ub0b4\uc6a9\uc744 \ubcf4\uba74 \uc544\ub798 \ub0b4\uc6a9\uacfc \uac19\ub2e4. "),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://cilium.readthedocs.io/en/v1.1/intro/#what-is-cilium"},"Cilium")," - Docker \ubc0f Kubernetes\uc640 \uac19\uc740 Linux \ucee8\ud14c\uc774\ub108 \uad00\ub9ac \ud50c\ub7ab\ud3fc\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubc30\ud3ec\ub41c \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8 \uc11c\ube44\uc2a4 \uac04\uc758 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0\uc744 \ubcf4\ud638\ud558\ub294 \uc624\ud508 \uc18c\uc2a4 \uc18c\ud504\ud2b8\uc6e8\uc5b4")),(0,l.kt)("p",null,"\ud398\ubd81\uc5d0 ",(0,l.kt)("a",{parentName:"p",href:"https://www.facebook.com/groups/korelnxuser/"},"\ud55c\uad6d \ub9ac\ub205\uc2a4 \uc0ac\uc6a9\uc790 \uadf8\ub8f9"),"\uc5d0\uc11c\ub3c4 ",(0,l.kt)("a",{parentName:"p",href:"https://www.facebook.com/tommy.lee.98229"},"Tommy Lee"),"\ub2d8\uc774\ub098 ",(0,l.kt)("a",{parentName:"p",href:"https://www.facebook.com/changan.song"},"\uc1a1\ucc3d\uc548"),"\ub2d8\uc774 \uba87\uba87 \uac8c\uc2dc\ubb3c\uc744 \uc62c\ub824\uc8fc\uc154\uc11c \uad00\uc2ec\uc788\uac8c \ubcf4\ub358\uc911\uc5d0 \uc544\ub798\uc640 \uac19\uc740 \ub0b4\uc6a9\uc744 \ubcf4\uace0 \uc774\uac70\ub2e4 \ud558\uace0 \ud30c\ubcf4\uae30 \uc2dc\uc791\ud588\ub2e4."),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Cilium\uc740 Docker \ubc0f Kubernetes\uc640 \uac19\uc740 \ub9ac\ub205\uc2a4 \ucee8\ud14c\uc774\ub108 \ud504\ub808\uc784 \uc6cc\ud06c\uc5d0 API \uae30\ubc18\uc758 \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548 \ud544\ud130\ub9c1\uc744 \uc81c\uacf5\ud558\uba70,\n\ub610\ud55c, BPF\ub77c\ub294 \uc0c8\ub85c\uc6b4 Linux \ucee4\ub110 \uae30\uc220\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108/POD ID\ub97c \uae30\ubc18\uc73c\ub85c \ub124\ud2b8\uc6cc\ud06c \uacc4\uce35 \ubc0f \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8 \uacc4\uce35 \ubcf4\uc548 \uc815\ucc45\uc744 \uc815\uc758 \ubc0f \uc801\uc6a9\ud558\ub294 \uac83\uc5d0 \uc788\uc5b4\uc11c \uac04\ub2e8\ud558\uba74\uc11c \ud6a8\uc728\uc801\uc778 \ubc29\ubc95\uc744 \uc81c\uacf5\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.")),(0,l.kt)("p",null,"\uc717\ubd84\ub4e4\ucc98\ub7fc \ucee4\ub110 \uc790\uccb4\ub97c \ubd84\uc11d\ud558\uace0 \uacf5\ubd80\ud558\uace0 \uae30\uc5ec\ud558\ub824\uba74 \uc18c\uc694\ub418\ub294 \uc2dc\uac04\uc774 \ub354 \uac78\ub9b4\uac70 \uac19\uace0 \uc11c\ube44\uc2a4\ub97c \uc6b4\uc601\ud558\uace0 \uac1c\ubc1c\ud558\ub294 \uc785\uc7a5\uc5d0\uc11c\ub294 \ub0b4 \ud504\ub85c\uc81d\ud2b8\uc5d0 \uc801\uc6a9 \uac00\ub2a5\uc131\uc744 \uac80\uc99d\ud558\ub294\uac83\uc774 \ub098\uc744\uac83 \uac19\uc544 \uc815\ub9ac\ub97c \ud574\ubcf8\ub2e4."),(0,l.kt)("p",null,"iptables\uc744 \uae30\ubc18\uc73c\ub85c IP\uc640 Port\uae30\ubc18\uc758 \uc804\ud1b5\uc801\uc778 \ud3ec\uc6cc\ub529 \uae30\uc220\uc740 \ubc8c\uc368 20\ub144\uc774\ub77c\ub294 \uc138\uc6d4\ub3d9\uc548 \ub110\ub9ac \uc0ac\uc6a9\ub418\uc5b4 \uc654\ub2e4. \ud2b9\ud788 \ud37c\ube14\ub9ad/\ud504\ub77c\uc774\ube57 \ud074\ub77c\uc6b0\ub4dc \uc81c\ud488\uad70\ub4e4 \ubaa8\ub450 iptables\uae30\ubc18\uc758 Security Group\ub4f1\uc744 \uae30\ubcf8\uc73c\ub85c \uc81c\uacf5\ud558\uace0 \uc788\uace0 Kubernetes \ub9c8\uc800\ub3c4 CNI \ud575\uc2ec\uc73c\ub85c iptables\uc744 \ud65c\uc6a9\ud558\uace0 \uc788\ub2e4.  "),(0,l.kt)("p",null,"\ub3d9\uc801\uc73c\ub85c \ubcc0\ud654\ud558\uace0 \ub9e4\uc6b0 \ubcf5\uc7a1\ud55c \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub294 \uc2dc\ub300\uc5d0 \uc804\ud1b5\uc801\uc778 \ubc29\uc2dd\uc758 IP, Port\uad00\ub9ac\ub294 \ube44\ud6a8\uc728\uc801\uc778 \uce21\uba74\uc774 \uc5c6\uc9c0 \uc54a\ub2e4. BPF(\uc544\ub798\uc778\uc6a9)\uc744 \ud65c\uc6a9\ud558\uc5ec \ub9ac\ub205\uc2a4 \ucee4\ub110\ub0b4\uc5d0\uc11c \ub370\uc774\ud130 \ud3ec\uc6cc\ub529\uc744 \ud560 \uc218 \uc788\uace0 Kubernetes Service\uae30\ubc18 Load Balancing\uc774\ub098 istio\uc640 \uac19\uc740 Service Mesh\ub97c \uc704\ud55c Proxy Injection \uc744 \ud1b5\ud574 \uc5ec\ub7ec \ud65c\uc6a9\uc744 \ud560 \uc218 \uc788\uc744\uac70\ub77c\uace0 Cilium \ud504\ub85c\uc81d\ud2b8\ub294 \uc774\uc57c\uae30 \ud558\uace0 \uc788\ub2e4. "),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\ubc84\ud074\ub9ac \ud328\ud0b7 \ud544\ud130(Berkeley Packet Filter, BPF)"),(0,l.kt)("p",{parentName:"blockquote"},"BPF\ub294 \ubc84\ud074\ub9ac \ud328\ud0b7 \ud544\ud130(Berkeley Packet Filter)\uc758 \uc904\uc784\ub9d0\uc774\ub2e4. \uc774\ub984 \uadf8\ub300\ub85c \ud328\ud0b7\uc744 \uac78\ub7ec\ub0b4\ub294 \ud544\ud130\uc774\ub2e4. \uadf8\ub7f0\ub370 BSD\uc5d0\uc11c\uc758 BPF\ub294 \ub124\ud2b8\uc6cc\ud06c \ud0ed(\ub9ac\ub205\uc2a4\uc758 PF_PACKET)\uae4c\uc9c0 \uc544\uc6b0\ub974\ub294 \uac1c\ub150\uc774\ub2e4. \uc61b\ub0a0 \uc61b\uc801\uc5d0 \uc720\ub2c9\uc2a4\uc5d0\ub294 CSPF(CMU/Stanford Packet Filter)\ub77c\ub294 \uac8c \uc788\uc5c8\ub294\ub370 BPF\ub77c\ub294 \uc0c8 \uad6c\uc870\uac00 \uc774\ub97c \ub300\uccb4\ud588\ub2e4. \uc774\ud6c4 \ub9ac\ub205\uc2a4\uc5d0\uc11c\ub294 \ub124\ud2b8\uc6cc\ud06c \ud0ed\uc744 \ub098\ub984\uc758 \ubc29\uc2dd\uc73c\ub85c \uad6c\ud604\ud558\uace0 \ud328\ud0b7 \ud544\ud130 \ubd80\ubd84\ub9cc \uac00\uc838\uc654\ub2e4. \ub9ac\ub205\uc2a4\uc758 \ud328\ud0b7 \ud544\ud130\ub97c \ub9ac\ub205\uc2a4 \uc18c\ucf13 \ud544\ud130\ub9c1(LSF: Linux Socket Filtering)\uc774\ub77c\uace0\ub3c4 \ud55c\ub2e4.",(0,l.kt)("br",{parentName:"p"}),"\n","(\ubc1c\ucdcc) ",(0,l.kt)("a",{parentName:"p",href:"https://wariua.github.io/facility/extended-bpf.html"},"https://wariua.github.io/facility/extended-bpf.html")," ")),(0,l.kt)("p",null,"Cilium\uc740 Dockercon 2017\uc5d0\uc11c \ucd5c\ucd08 ",(0,l.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=ilKlmTDdFgk"},"announce"),"\ub97c \ud558\uc600\uace0 2018\ub144 4\uc6d4 24\uc77c\uc5d0 1.0\uc774 \uc815\uc2dd Release\ub41c \uc774\ud6c4 \ub9ce\uc740 \uad00\uc2ec\uc744 \ubc1b\uc744\uac83\uc73c\ub85c \uc608\uc0c1\ub418\uc5b4 \uc2e4\uc81c \uc11c\ube44\uc2a4\uc5d0 \uc801\uc6a9\ud574\ubcfc \ud544\uc694\uac00 \uc788\uc744\uac70 \uac19\uc544 minikube\ub85c \ud14c\uc2a4\ud2b8\ud55c \ub0b4\uc6a9\uc744 \ub044\uc839\uc5ec \ubcf8\ub2e4. "),(0,l.kt)("h2",{id:"cilium-architecture"},"Cilium Architecture"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"Cilium Architecture",src:t(79321).Z,width:"700",height:"624"})),(0,l.kt)("h2",{id:"main-feature"},"Main Feature"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\uace0\ud6a8\uc728 BPF Datapath  ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\ubaa8\ub4e0 \ub370\uc774\ud130 \uacbd\ub85c\uac00 \ud074\ub7ec\uc2a4\ud130 \uc804\uccb4\uc5d0 \uc644\uc804 \ubd84\uc0b0"),(0,l.kt)("li",{parentName:"ul"},"Envoy\uac19\uc740 proxy injection \uc81c\uacf5, \ucd94\ud6c4 sidecar proxy \ud615\ud0dc \uc81c\uacf5\uc608\uc815"))),(0,l.kt)("li",{parentName:"ul"},"CNI, CMM plugins  ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"Kubernetes, Mesos, Docker\uc5d0 \uc27d\uac8c \ud1b5\ud569\uac00\ub2a5"))),(0,l.kt)("li",{parentName:"ul"},"Packet, API \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548",(0,l.kt)("br",{parentName:"li"}),"\ud328\ud0b7\uae30\ubc18 \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548\uacfc API \uc778\uc99d\uc744 \uacb0\ud569\ud558\uc5ec \uc804\ud1b5\uc801\uc778 \ud328\ud0b7\uae30\ubc18 \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548\uacfc \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4 \uc544\ud0a4\ud14d\ucc98 \ubaa8\ub450\uc5d0\uac8c \ubcf4\uc548 \uc81c\uacf5\uac00\ub2a5  ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://docs.cilium.io/en/doc-1.0/concepts/#arch-id-security"},"ID\uae30\ubc18")," - Source IP\uc5d0\ub9cc \uc758\uc874\ud558\uc9c0 \uc54a\uace0 \ubaa8\ub4e0\ud328\ud0b7\uc5d0 workload identity\ub97c encoding\ud558\uc5ec \uc2dd\ubcc4\uc131 \uac15\ud654  "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://docs.cilium.io/en/doc-1.0/policy/language/#ip-cidr-based"},"IP/CIDR\uae30\ubc18"),"\uc774\uc678\uc5d0\ub3c4 ",(0,l.kt)("a",{parentName:"li",href:"http://docs.cilium.io/en/doc-1.0/policy/language/#services-based"},"Kubernetes Service\uae30\ubc18"),"\uc73c\ub85c \uc815\ucc45 \uc124\uc815\uac00\ub2a5"),(0,l.kt)("li",{parentName:"ul"},"L7\uae30\ubc18 ",(0,l.kt)("a",{parentName:"li",href:"http://docs.cilium.io/en/doc-1.0/policy/language/#layer-7-examples"},"API\ubcf4\uc548")," \uc801\uc6a9\uac00\ub2a5"))),(0,l.kt)("li",{parentName:"ul"},"\ubd84\uc0b0,\ud655\uc7a5\uac00\ub2a5\ud55c Load Balacing\nBPF\ub97c \uc0ac\uc6a9\ud55c \uace0\uc131\ub2a5 L3,L4 Load Balancer \uc81c\uacf5\n(Hasing, Weighted round-robin)",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"kube-proxy \ub300\uccb4 - Kubernetes ClusterIP\uac00 \uc0dd\uc131\ub420\ub54c BPF\uae30\ubc18\uc73c\ub85c \uc790\ub3d9\uc73c\ub85c \uc801\uc6a9\ub428 "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://docs.cilium.io/en/doc-1.0/api/"},"API driven")," - \uc9c1\uc811 API\ub97c \ud65c\uc6a9\ud558\uc5ec \ud655\uc7a5\uac00\ub2a5"))),(0,l.kt)("li",{parentName:"ul"},"\ub2e8\uc21c\ud654\ub41c \ub124\ud2b8\uc6cc\ud06c \ubaa8\ub378",(0,l.kt)("br",{parentName:"li"}),"Overlay/VXLAN, Direct/Native Routing \uc9c0\uc6d0"),(0,l.kt)("li",{parentName:"ul"},"\uac00\uc2dc\uc131  ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://github.com/cilium/microscope"},"Microscope")," - \ud074\ub7ec\uc2a4\ud130 \ub808\ubca8\uc5d0\uc11c \ubaa8\ub4e0 \uc774\ubca4\ud2b8 \ud544\ud130\ub9c1 \uac00\ub2a5"),(0,l.kt)("li",{parentName:"ul"},"API\uae30\ubc18 \uac00\uc2dc\uc131 \uc81c\uacf5"))),(0,l.kt)("li",{parentName:"ul"},"\uc6b4\uc601",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\ud074\ub7ec\uc2a4\ud130 \ud5ec\uc2a4\uccb4\ud06c - HTTP, ICMP\uae30\uc900 \ud074\ub7ec\uc2a4\ud130 latency \uccb4\ud06c\uac00\ub2a5"),(0,l.kt)("li",{parentName:"ul"},"Prometheus \ud1b5\ud569 - \ubaa8\ub4e0 \uba54\ud2b8\ub9ad\uc744 Prometheus\ub85c \uc804\ub2ec\uac00\ub2a5"),(0,l.kt)("li",{parentName:"ul"},"\ud074\ub7ec\uc2a4\ud130 \ubd84\uc11d \ubc0f ",(0,l.kt)("a",{parentName:"li",href:"http://docs.cilium.io/en/doc-1.0/troubleshooting/#cluster-diagnosis-tool"},"\ub9ac\ud3ec\ud2b8\ud234")," ")))),(0,l.kt)("h2",{id:"requirement"},"Requirement"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"kubectl >= 1.7.0"),(0,l.kt)("li",{parentName:"ul"},"minikube >= 0.22.3")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl/"},"kubectl")," \uc124\uce58\uc640 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/minikube/releases"},"minikube")," \uad6c\uc131\uc740 \ubcc4\ub3c4\ub85c \ud574\uc57c\ud55c\ub2e4."),(0,l.kt)("h2",{id:"start-minikube"},"Start minikube"),(0,l.kt)("p",null,"\ub109\ub109\ud558\uac8c 4GB \uc774\uc0c1 \uba54\ubaa8\ub9ac\ub85c minikube\ub97c \uad6c\ub3d9\ud55c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ minikube start --kubernetes-version v1.9.0 --network-plugin=cni --extra-config=kubelet.network-plugin=cni --memory=5120 \n")),(0,l.kt)("h2",{id:"check-minikube-cluster-status"},"Check minikube cluster status"),(0,l.kt)("p",null,"minikube\uad6c\uc131\uc774 \uc644\ub8cc\ub418\uba74 \uc544\ub798\uc640 \uac19\uc774 \ud074\ub7ec\uc2a4\ud130 \uc0c1\ud0dc\ub97c \ud655\uc778\ud560\uc218 \uc788\ub2e4. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'$ kubectl get cs\nNAME                 STATUS    MESSAGE              ERROR\ncontroller-manager   Healthy   ok\nscheduler            Healthy   ok\netcd-0               Healthy   {"health": "true"}\n')),(0,l.kt)("h2",{id:"install-etcd-dependency-of-cilium"},"Install etcd (dependency of cilium)"),(0,l.kt)("p",null,"cilium \uc758\uc874\uc131\uc744 \uc704\ud574 etcd\ub97c \ubcc4\ub3c4\ub85c \ubc30\ud3ec\ud55c\ub2e4. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'$ kubectl create -n kube-system -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/kubernetes/addons/etcd/standalone-etcd.yaml  \nservice "etcd-cilium" created\nstatefulset.apps "etcd-cilium" created\n')),(0,l.kt)("h2",{id:"check-all-pods-etcd"},"Check all pods (etcd)"),(0,l.kt)("p",null,"\ubaa8\ub4e0 pod\uac00 ",(0,l.kt)("inlineCode",{parentName:"p"},"Running")," \uc0c1\ud0dc\uc778\uc9c0 \ud655\uc778\ud55c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl get pods --all-namespaces\nNAMESPACE     NAME                               READY     STATUS    RESTARTS   AGE\nkube-system   etcd-cilium-0                      1/1       Running   0          1m\nkube-system   etcd-minikube                      1/1       Running   0          3m\nkube-system   kube-addon-manager-minikube        1/1       Running   0          4m\nkube-system   kube-apiserver-minikube            1/1       Running   0          3m\nkube-system   kube-controller-manager-minikube   1/1       Running   0          3m\nkube-system   kube-dns-86f4d74b45-lhzfv          3/3       Running   0          4m\nkube-system   kube-proxy-tcd7h                   1/1       Running   0          4m\nkube-system   kube-scheduler-minikube            1/1       Running   0          4m\nkube-system   storage-provisioner                1/1       Running   0          4m\n")),(0,l.kt)("h2",{id:"install-cilium"},"Install Cilium"),(0,l.kt)("p",null,"Kubernetes \ud074\ub7ec\uc2a4\ud130\uc5d0 Cilium\uc744 \uc778\uc2a4\ud1a8\ud55c\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c DaemonSet \ud615\ud0dc\ub85c \ubc30\ud3ec\ub418\uae30 \ub54c\ubb38\uc5d0 Node\ub2f9 \ud55c\uac1c\uc758 Cilium Pod\ub97c \ubcfc \uc218 \uc788\ub2e4. Cilium\uc740 ",(0,l.kt)("inlineCode",{parentName:"p"},"kube-system")," namespace\uc5d0\uc11c \uc2e4\ud589\ub41c\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/kubernetes/1.9/cilium.yaml\nconfigmap "cilium-config" created\nsecret "cilium-etcd-secrets" created\ndaemonset.extensions "cilium" created\nclusterrolebinding.rbac.authorization.k8s.io "cilium" created\nclusterrole.rbac.authorization.k8s.io "cilium" created\nserviceaccount "cilium" created\n')),(0,l.kt)("p",null,"kube-system namespace\uc5d0 RBAC\uc124\uc815\uacfc \ud568\uaed8 Cilium\uc774 \ubc30\ud3ec\ub418\uace0, ConfigMap, DaemonSet \ud615\ud0dc\ub85c \ubc30\ud3ec\uac00 \ub41c\ub2e4. "),(0,l.kt)("h2",{id:"check-deployment"},"Check deployment"),(0,l.kt)("p",null,"Cilium Deployment\uac00 ",(0,l.kt)("inlineCode",{parentName:"p"},"READY")," \uc0c1\ud0dc\ub85c \ubc14\ub014\ub54c\uae4c\uc9c0 \uae30\ub2e4\ub9b0\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl get daemonsets -n kube-system\nNAME      DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\ncilium    1         1         1         1            0           <none>          2m\n")),(0,l.kt)("h2",{id:"deploy-demo-app"},"Deploy Demo App."),(0,l.kt)("p",null,"\uc544\ub798 \ub370\ubaa8\uadf8\ub9bc\uc744 \ubcf4\uba74 \uc2a4\ud0c0\uc6cc\uc988\uc758 \uc601\uac10\uc744 \ubc1b\uc544\uc11c\uc778\uc9c0 deathstar, xwing \ub4f1\uc73c\ub85c \uad6c\ubd84\ud55c\uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4. deathstar deployments\uc758 \uacbd\uc6b0 80\ud3ec\ud2b8\ub85c http \uc6f9\uc11c\ubc84\uac00 2\uac1c\uc758 pod replica\ub85c Load Balancing\ub418\uace0 \uc788\ub2e4. deathstar \uc11c\ube44\uc2a4\ub294 \uc6b0\uc8fc\uc120\uc774 \ucc29\ub959\ud560\uc218 \uc788\ub3c4\ub85d \ud65c\uc8fc\ub85c\ub97c \uc11c\ube44\uc2a4\ud558\uace0 \uc788\ub2e4. \ud558\uc9c0\ub9cc \uc81c\uad6d\uad70\uc758 tiefighter \ub9cc \ucc29\ub959\ud558\ub3c4\ub85d \ud574\uc57c\ud558\ubbc0\ub85c \ubcf4\uc548\uc124\uc815\uc744 \ud574\uc57c\ud558\ub294 \uc0c1\ud669\uc774\ub2e4. "),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"https://cilium.readthedocs.io/en/v1.1/_images/cilium_http_gsg.png",alt:"starwars"})),(0,l.kt)("p",null,"\uc544\ub798 ",(0,l.kt)("inlineCode",{parentName:"p"},"http-sw-app.yaml")," \uc740 \uc138\uac00\uc9c0 deployment\ub97c \uac00\uc9c0\uace0 \uc788\uace0 \uac01\uac01\uc758 deployment\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"(org=empire, class=deathstar)"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"(org=empire, class=tiefighter)"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"(org=alliance, class=xwing)"),"\uc640 \uac19\uc774 label \uc815\ubcf4\ub97c \uac00\uc9c4\ub2e4. deathstar Service\ub294 ",(0,l.kt)("inlineCode",{parentName:"p"},"(org=empire, class=deathstar)")," label\uc744 \uac00\uc9c0\uace0 Load Balancing\uc744 \ud55c\ub2e4. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/http-sw-app.yaml\nservice "deathstar" created\ndeployment "deathstar" created\ndeployment "tiefighter" created\ndeployment "xwing" created\n')),(0,l.kt)("p",null,"\ucd1d 4\uac1c\uc758 pod\uc640 1\uac1c\uc758 \uc11c\ube44\uc2a4\ub97c \ud655\uc778\ud560\uc218 \uc788\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl get pods,svc\nNAME                             READY     STATUS    RESTARTS   AGE\npod/deathstar-566c89f458-mqgfs   1/1       Running   0          1h\npod/deathstar-566c89f458-wlc4c   1/1       Running   0          1h\npod/tiefighter                   1/1       Running   0          1h\npod/xwing                        1/1       Running   0          1h\n\nNAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\nservice/deathstar    ClusterIP   10.109.80.174   <none>        80/TCP    1h\nservice/kubernetes   ClusterIP   10.96.0.1       <none>        443/TCP   4h\n")),(0,l.kt)("p",null,"\uac01\uac01\uc758 pod\ub294 Cilium\uc5d0\uc11c\ub294 ",(0,l.kt)("a",{parentName:"p",href:"https://cilium.readthedocs.io/en/v1.1/concepts/#endpoint"},"Endpoints"),"\ud615\ud0dc\ub85c \ud45c\ud604\ub41c\ub2e4. \uc544\ub798\uc640 \uac19\uc774 ingress, egress policy\ub97c \ud655\uc778\ud560\uc218 \uc788\uace0 \uc544\uc9c1 \uc544\ubb34\ub7f0 network policy \uc801\uc6a9\uc744 \ud558\uc9c0 \uc54a\uc558\uae30 \ub54c\ubb38\uc5d0 \ubaa8\ub450 ",(0,l.kt)("inlineCode",{parentName:"p"},"Disabled")," \uc0c1\ud0dc\ub85c \ubcf4\uc778\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl -n kube-system get pods -l k8s-app=cilium\nNAME           READY     STATUS    RESTARTS   AGE\ncilium-jmxk2   1/1       Running   0          4h\n\n$ kubectl -n kube-system exec cilium-jmxk2 -- cilium endpoint list\nENDPOINT   POLICY (ingress)   POLICY (egress)   IDENTITY   LABELS (source:key[=value])                                                    IPv6                 IPv4            STATUS\n           ENFORCEMENT        ENFORCEMENT\n5023       Disabled           Disabled          2008       k8s:io.cilium.k8s.policy.serviceaccount=istio-ingress-service-account          f00d::a0f:0:0:139f   10.15.170.241   ready\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n                                                           k8s:istio=ingress\n7415       Disabled           Disabled          9270       k8s:class=deathstar                                                            f00d::a0f:0:0:1cf7   10.15.16.224    ready\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default\n                                                           k8s:io.kubernetes.pod.namespace=default\n                                                           k8s:org=empire\n7979       Disabled           Disabled          4          reserved:health                                                                f00d::a0f:0:0:1f2b   10.15.96.215    ready\n17917      Disabled           Disabled          60941      k8s:class=tiefighter                                                           f00d::a0f:0:0:45fd   10.15.58.61     ready\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default\n                                                           k8s:io.kubernetes.pod.namespace=default\n                                                           k8s:org=empire\n22602      Disabled           Disabled          53004      k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:584a   10.15.190.2     ready\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n                                                           k8s:istio-mixer-type=telemetry\n                                                           k8s:istio=mixer\n31992      Disabled           Disabled          33709      k8s:io.cilium.k8s.policy.serviceaccount=istio-egressgateway-service-account    f00d::a0f:0:0:7cf8   10.15.85.192    ready\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n                                                           k8s:istio=egressgateway\n33958      Disabled           Disabled          64389      k8s:io.cilium.k8s.policy.serviceaccount=istio-citadel-service-account          f00d::a0f:0:0:84a6   10.15.59.151    ready\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n                                                           k8s:istio=citadel\n49215      Disabled           Disabled          40629      k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:c03f   10.15.48.171    ready\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n                                                           k8s:istio-mixer-type=policy\n                                                           k8s:istio=mixer\n55129      Disabled           Disabled          9270       k8s:class=deathstar                                                            f00d::a0f:0:0:d759   10.15.17.253    ready\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default\n                                                           k8s:io.kubernetes.pod.namespace=default\n                                                           k8s:org=empire\n55930      Disabled           Disabled          46893      k8s:app=prometheus                                                             f00d::a0f:0:0:da7a   10.15.196.220   ready\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=prometheus\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n57491      Disabled           Disabled          775        k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:e093   10.15.253.210   ready\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n                                                           k8s:istio=statsd-prom-bridge\n57651      Disabled           Disabled          44171      k8s:io.cilium.k8s.policy.serviceaccount=istio-ingressgateway-service-account   f00d::a0f:0:0:e133   10.15.74.164    ready\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n                                                           k8s:istio=ingressgateway\n61352      Disabled           Disabled          888        k8s:io.cilium.k8s.policy.serviceaccount=istio-pilot-service-account            f00d::a0f:0:0:efa8   10.15.118.68    ready\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\n                                                           k8s:istio=pilot\n61355      Disabled           Disabled          36797      k8s:class=xwing                                                                f00d::a0f:0:0:efab   10.15.56.79     ready\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default\n                                                           k8s:io.kubernetes.pod.namespace=default\n                                                           k8s:org=alliance\n")),(0,l.kt)("p",null,"\ud604\uc7ac \uc0c1\ud0dc\uc5d0\uc11c\ub294 \ubaa8\ub4e0 \uc6b0\uc8fc\uc120\uc774 deathstar\uc5d0 \ucc29\ub959\uc774 \uac00\ub2a5\ud558\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl exec xwing -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\nShip landed\n\n$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\nShip landed\n")),(0,l.kt)("h2",{id:"l3l4-policy-\uc801\uc6a9"},"L3/L4 Policy \uc801\uc6a9"),(0,l.kt)("p",null,"\uacb0\uad6d \ud558\uace0 \uc2f6\uc740\uac74 \uc81c\uad6d\uad70 \uc6b0\uc8fc\uc120 \uc989, tiefighter\ub9cc \uc811\uadfc\uc774 \uac00\ub2a5\ud574\uc57c \ud558\ubbc0\ub85c \uc544\ub798\ucc98\ub7fc \uc815\ucc45\uc744 \uc124\uc815\ud55c\ub2e4. "),(0,l.kt)("p",null,"\uc815\ucc45\uc740 \uc9c1\uad00\uc801\uc73c\ub85c \uc124\uc815\uc774 \uac00\ub2a5\ud558\ub2e4."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"org=empire, class=deathstar")," label\uc744 \uac00\uc9c4 endpoint\ub85c\uc758 ingress \ubc29\ud5a5\uc758 80\ud3ec\ud2b8 \uc811\uadfc\uc740 ",(0,l.kt)("inlineCode",{parentName:"p"},"org=empire")," label\uc744 \uac00\uc9c4 pod\ub9cc \uac00\ub2a5\ud558\ub3c4\ub85d \ud55c\ub2e4\ub294 \uc758\ubbf8\uc774\ub2e4. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'apiVersion: "cilium.io/v2"\nkind: CiliumNetworkPolicy\ndescription: "L3-L4 policy to restrict deathstar access to empire ships only"\nmetadata:\n  name: "rule1"\nspec:\n  endpointSelector:\n    matchLabels:\n      org: empire\n      class: deathstar\n  ingress:\n  - fromEndpoints:\n    - matchLabels:\n        org: empire\n    toPorts:\n    - ports:\n      - port: "80"\n        protocol: TCP\n')),(0,l.kt)("p",null,"\ub610\ub294 "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/sw_l3_l4_policy.yaml\n")),(0,l.kt)("p",null,"\uc704\uc640 \uac19\uc774 \uc124\uc815\ud558\uace0 \ub098\uc11c tiefighter\ub97c \ucc29\ub959\uc2dc\ucf1c\ubcf4\uc790."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\nShip landed\n")),(0,l.kt)("p",null,"\uc815\uc0c1\ucc29\ub959!",(0,l.kt)("br",{parentName:"p"}),"\n","\uc774\ubc88\uc5d0\ub294 xwing \ucc28\ub840"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl exec xwing -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\n\n")),(0,l.kt)("p",null,"\ucc29\ub959\uc2e4\ud328!"),(0,l.kt)("p",null,"\uc774\uc5b4\uc11c \uc815\ucc45\uc744 \ub2e4\uc2dc \ud655\uc778\ud574\ubcf4\uba74 Enabled\ub85c \ubcc0\ud55c \uc815\ucc45 2\uac1c\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.",(0,l.kt)("br",{parentName:"p"}),"\n","(pod\uac00 2\uac1c\uc774\ubbc0\ub85c 2\uac1c\uc758 \uc815\ucc45\uc744 \ubcfc \uc218 \uc788\ub2e4)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl -n kube-system exec cilium-jmxk2 -- cilium endpoint list\n")),(0,l.kt)("p",null,"\uc0c1\uc138 \uc815\ucc45 \ud655\uc778 (Very Simple!!)"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl get cnp\nNAME            AGE\nistio-sidecar   2h\nrule1           5m\n\n$  kubectl describe cnp rule1\nName:         rule1\nNamespace:    default\nLabels:       <none>\nAnnotations:  <none>\nAPI Version:  cilium.io/v2\nKind:         CiliumNetworkPolicy\nMetadata:\n  Cluster Name:\n  Creation Timestamp:  2018-07-06T07:25:15Z\n  Generation:          0\n  Resource Version:    30312\n  Self Link:           /apis/cilium.io/v2/namespaces/default/ciliumnetworkpolicies/rule1\n  UID:                 ba0d7964-80ed-11e8-8077-080027b1075c\nSpec:\n  Endpoint Selector:\n    Match Labels:\n      Any : Class:  deathstar\n      Any : Org:    empire\n  Ingress:\n    From Endpoints:\n      Match Labels:\n        Any : Org:  empire\n    To Ports:\n      Ports:\n        Port:      80\n        Protocol:  TCP\nStatus:\n  Nodes:\n    Minikube:\n      Enforcing:              true\n      Last Updated:           0001-01-01T00:00:00Z\n      Local Policy Revision:  65\n      Ok:                     true\nEvents:                       <none>\n")),(0,l.kt)("h2",{id:"l7-\uc815\ucc45-\uc801\uc6a9"},"L7 \uc815\ucc45 \uc801\uc6a9"),(0,l.kt)("p",null,"\ub9c8\uc9c0\ub9c9\uc73c\ub85c deathstar API\ub97c \ud638\ucd9c\ud558\ub294 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \uc815\ucc45\uc744 \uc81c\uc5b4\ud558\ub294\uac83\uc744 \ud14c\uc2a4\ud2b8\ud574\ubcf8\ub2e4."),(0,l.kt)("p",null,"\uc544\ub798 \uc608\uc2dc\ucc98\ub7fc exhaust-port API(\ud3ec\ud2b8\ub97c \uc18c\uc9c4\uc2dc\ud0a4\ub294 API)\ub97c \uc218\ud589\ud558\uba74 \ud2b9\uc815 pod\uac00 \uc5d0\ub7ec\uac00 \ub098\uace0 \uc7ac\uae30\ub3d9 \ub418\ub294\uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl exec tiefighter -- curl -s -XPUT deathstar.default.svc.cluster.local/v1/exhaust-port\n\nPanic: deathstar exploded\n\ngoroutine 1 [running]:\nmain.HandleGarbage(0x2080c3f50, 0x2, 0x4, 0x425c0, 0x5, 0xa)\n        /code/src/github.com/empire/deathstar/\n        temp/main.go:9 +0x64\nmain.main()\n        /code/src/github.com/empire/deathstar/\n        temp/main.go:5 +0x85\n\n$ kubectl get pod\nNAME                         READY     STATUS    RESTARTS   AGE\ndeathstar-566c89f458-mqgfs   0/1       Error     0          1h\ndeathstar-566c89f458-wlc4c   1/1       Running   0          1h\ntiefighter                   1/1       Running   0          1h\nxwing                        1/1       Running   0          1h\n\n$ kubectl get pod\nNAME                         READY     STATUS    RESTARTS   AGE\ndeathstar-566c89f458-mqgfs   1/1       Running   1          1h\ndeathstar-566c89f458-wlc4c   1/1       Running   0          1h\ntiefighter                   1/1       Running   0          1h\nxwing                        1/1       Running   0          1h\n")),(0,l.kt)("p",null,"\uadf8\ub798\uc11c \uc774\ubc88\uc5d0\ub294 exhaust-port API\ub294 \ucc28\ub2e8\ud558\uace0 request-landing API\ub9cc \ud5c8\uc6a9\ud558\ub294 \uc815\ucc45\uc744 \ud14c\uc2a4\ud2b8\ud574\ubcf8\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'apiVersion: "cilium.io/v2"\nkind: CiliumNetworkPolicy\ndescription: "L7 policy to restrict access to specific HTTP call"\nmetadata:\n  name: "rule1"\nspec:\n  endpointSelector:\n    matchLabels:\n      org: empire\n      class: deathstar\n  ingress:\n  - fromEndpoints:\n    - matchLabels:\n        org: empire\n    toPorts:\n    - ports:\n      - port: "80"\n        protocol: TCP\n      rules:\n        http:\n        - method: "POST"\n          path: "/v1/request-landing"\n')),(0,l.kt)("p",null,"\ub610\ub294"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl apply -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/sw_l3_l4_l7_policy.yaml\n\nciliumnetworkpolicy.cilium.io/rule1 configured\n")),(0,l.kt)("p",null,"\uc774\ud6c4 \ub3d9\uc77c\ud55c \ud14c\uc2a4\ud2b8\ub97c \ud574\ubcf4\uba74 \ub2e4\ub978 \uacb0\uacfc\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\nShip landed\n\n$ kubectl exec tiefighter -- curl -s -XPUT deathstar.default.svc.cluster.local/v1/exhaust-port\nAccess denied\n")),(0,l.kt)("p",null,"\ub2e4\uc2dc\ud55c\ubc88 \uc0c1\uc138 \uc815\ucc45 \ud655\uc778\uc744 \ud574\ubcf4\uba74 ingress POST \ud5c8\uc6a9\uc815\ucc45\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'$ kubectl describe ciliumnetworkpolicies rule1\nName:         rule1\nNamespace:    default\nLabels:       <none>\nAnnotations:  kubectl.kubernetes.io/last-applied-configuration={"apiVersion":"cilium.io/v2","description":"L7 policy to restrict access to specific HTTP call","kind":"CiliumNetworkPolicy","metadata":{"annotations":...\nAPI Version:  cilium.io/v2\nKind:         CiliumNetworkPolicy\nMetadata:\n  Cluster Name:\n  Creation Timestamp:  2018-07-06T07:25:15Z\n  Generation:          0\n  Resource Version:    32814\n  Self Link:           /apis/cilium.io/v2/namespaces/default/ciliumnetworkpolicies/rule1\n  UID:                 ba0d7964-80ed-11e8-8077-080027b1075c\nSpec:\n  Endpoint Selector:\n    Match Labels:\n      Any : Class:  deathstar\n      Any : Org:    empire\n  Ingress:\n    From Endpoints:\n      Match Labels:\n        Any : Org:  empire\n    To Ports:\n      Ports:\n        Port:      80\n        Protocol:  TCP\n      Rules:\n        Http:\n          Method:  POST\n          Path:    /v1/request-landing\nStatus:\n  Nodes:\n    Minikube:\n      Annotations:\n        Kubectl . Kubernetes . Io / Last - Applied - Configuration:  {"apiVersion":"cilium.io/v2","description":"L7 policy to restrict access to specific HTTP call","kind":"CiliumNetworkPolicy","metadata":{"annotations":{},"name":"rule1","namespace":"default"},"spec":{"endpointSelector":{"matchLabels":{"class":"deathstar","org":"empire"}},"ingress":[{"fromEndpoints":[{"matchLabels":{"org":"empire"}}],"toPorts":[{"ports":[{"port":"80","protocol":"TCP"}],"rules":{"http":[{"method":"POST","path":"/v1/request-landing"}]}}]}]}}\n\n      Enforcing:              true\n      Last Updated:           0001-01-01T00:00:00Z\n      Local Policy Revision:  70\n      Ok:                     true\nEvents:                       <none>\n')),(0,l.kt)("p",null,"cilium CLI\ub85c\ub3c4 \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'\ue0b0 kubectl -n kube-system exec cilium-jmxk2 cilium policy get\n[\n  {\n    "endpointSelector": {\n      "matchLabels": {\n        "reserved:init": ""\n      }\n    },\n    "ingress": [\n      {\n        "fromEntities": [\n          "host"\n        ]\n      }\n    ],\n    "egress": [\n      {\n        "toPorts": [\n          {\n            "ports": [\n              {\n                "port": "53",\n                "protocol": "UDP"\n              }\n            ]\n          }\n        ],\n        "toEntities": [\n          "all"\n        ]\n      },\n      {\n        "toEndpoints": [\n          {\n            "matchLabels": {\n              "k8s:io.kubernetes.pod.namespace": "istio-system"\n            }\n          }\n        ]\n      }\n    ],\n    "labels": [\n      {\n        "key": "io.cilium.k8s.policy.name",\n        "value": "istio-sidecar",\n        "source": "k8s"\n      },\n      {\n        "key": "io.cilium.k8s.policy.namespace",\n        "value": "default",\n        "source": "k8s"\n      }\n    ]\n  },\n  {\n    "endpointSelector": {\n      "matchLabels": {\n        "any:class": "deathstar",\n        "any:org": "empire",\n        "k8s:io.kubernetes.pod.namespace": "default"\n      }\n    },\n    "ingress": [\n      {\n        "fromEndpoints": [\n          {\n            "matchLabels": {\n              "any:org": "empire",\n              "k8s:io.kubernetes.pod.namespace": "default"\n            }\n          }\n        ],\n        "toPorts": [\n          {\n            "ports": [\n              {\n                "port": "80",\n                "protocol": "TCP"\n              }\n            ],\n            "rules": {\n              "http": [\n                {\n                  "path": "/v1/request-landing",\n                  "method": "POST"\n                }\n              ]\n            }\n          }\n        ]\n      }\n    ],\n    "labels": [\n      {\n        "key": "io.cilium.k8s.policy.name",\n        "value": "rule1",\n        "source": "k8s"\n      },\n      {\n        "key": "io.cilium.k8s.policy.namespace",\n        "value": "default",\n        "source": "k8s"\n      }\n    ]\n  }\n]\nRevision: 71\n')),(0,l.kt)("p",null,"\uc774\uc678\uc5d0\ub3c4 Cilium Metric\uc744 Prometheus\uc5d0\uc11c \ud655\uc778\ud558\ub294\uac83\ub3c4 \uac04\ub2e8\ud558\uac8c \ud560\uc218 \uc788\ub2e4\uace0 \ud55c\ub2e4. "),(0,l.kt)("p",null,"\uc5ec\uae30\uae4c\uc9c0\uac00 \uae30\ubcf8\uc801\uc73c\ub85c L3/L4, L7 \uae30\ubc18 network policy\ub97c \uc801\uc6a9\ud574\ubcf8\uac83\uc774\uace0 \ub2e4\uc74c\ubc88\uc5d0\ub294 istio\uc640 \uc5f0\uacc4 \ubd80\ubd84\uc774\ub098 \uc2e4\uc81c Cluster \uad6c\uc131\ubc29\ubc95\uc5d0 \ub300\ud574\uc11c \ub2e4\ub904\ubcf4\ub3c4\ub85d \ud558\uaca0\ub2e4."))}d.isMDXComponent=!0},79321:function(e,n,t){n.Z=t.p+"assets/images/cilium_arch-96f6efd4a70465e9cbfd890e9da1f159.png"}}]);