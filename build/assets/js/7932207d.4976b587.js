"use strict";(self.webpackChunkddii=self.webpackChunkddii||[]).push([[1991],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return k}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),k=r,d=u["".concat(s,".").concat(k)]||u[k]||m[k]||o;return n?a.createElement(d,l(l({ref:t},p),{},{components:n})):a.createElement(d,l({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=u;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var c=2;c<o;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},33671:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return k},frontMatter:function(){return i},metadata:function(){return c},toc:function(){return m}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),l=["components"],i={layout:"single",title:"EKS Anywhere Advanced Usages",comments:!0,classes:"wide",description:"EKS Anywhere \ub85c \uad6c\uc131\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ud65c\uc6a9 ",authors:"jinwoong",toc:!0,toc_label:"Table of Contents",slug:"kubernetes/eks-anywhere-adv/",date:new Date("2022-03-18T00:00:00.000Z"),categories:["Kubernetes"],tags:["Kubernetes","vsphere","eks anywhere","eks-anywhere","eks connector","eks","opentelemetry","cilium","observability","prometheus","grafana","loki","microservice","istio"]},s=void 0,c={permalink:"/kubernetes/eks-anywhere-adv/",editUrl:"https://github.com/ddiiwoong/newblog/tree/main/blog/2022-03-18-eks-anywhere-adv.md",source:"@site/blog/2022-03-18-eks-anywhere-adv.md",title:"EKS Anywhere Advanced Usages",description:"EKS Anywhere \ub85c \uad6c\uc131\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ud65c\uc6a9 ",date:"2022-03-18T00:00:00.000Z",formattedDate:"March 18, 2022",tags:[{label:"Kubernetes",permalink:"/tags/kubernetes"},{label:"vsphere",permalink:"/tags/vsphere"},{label:"eks anywhere",permalink:"/tags/eks-anywhere"},{label:"eks connector",permalink:"/tags/eks-connector"},{label:"eks",permalink:"/tags/eks"},{label:"opentelemetry",permalink:"/tags/opentelemetry"},{label:"cilium",permalink:"/tags/cilium"},{label:"observability",permalink:"/tags/observability"},{label:"prometheus",permalink:"/tags/prometheus"},{label:"grafana",permalink:"/tags/grafana"},{label:"loki",permalink:"/tags/loki"},{label:"microservice",permalink:"/tags/microservice"},{label:"istio",permalink:"/tags/istio"}],readingTime:17.06,truncated:!0,authors:[{name:"Jinwoong Kim",title:"Technologist and Cloud Consultant",url:"https://www.linkedin.com/in/ddiiwoong/",imageURL:"https://s.gravatar.com/avatar/e8bfebcbeacb5b9a0c90614e792febf2?s=80",key:"jinwoong"}],frontMatter:{layout:"single",title:"EKS Anywhere Advanced Usages",comments:!0,classes:"wide",description:"EKS Anywhere \ub85c \uad6c\uc131\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ud65c\uc6a9 ",authors:"jinwoong",toc:!0,toc_label:"Table of Contents",slug:"kubernetes/eks-anywhere-adv/",date:"2022-03-18T00:00:00.000Z",categories:["Kubernetes"],tags:["Kubernetes","vsphere","eks anywhere","eks-anywhere","eks connector","eks","opentelemetry","cilium","observability","prometheus","grafana","loki","microservice","istio"]},prevItem:{title:"EKS CNI Custom Networking",permalink:"/kubernetes/eks-cni-custom/"},nextItem:{title:"EKS Anywhere on vSphere Homelab",permalink:"/kubernetes/eks-anywhere/"}},p={authorsImageUrls:[void 0]},m=[{value:"EKS Connector",id:"eks-connector",level:2},{value:"\ud074\ub7ec\uc2a4\ud130 \ub4f1\ub85d",id:"\ud074\ub7ec\uc2a4\ud130-\ub4f1\ub85d",level:3},{value:"Istio \ud658\uacbd \uad6c\uc131",id:"istio-\ud658\uacbd-\uad6c\uc131",level:2},{value:"Istio \uc124\uce58",id:"istio-\uc124\uce58",level:3},{value:"metric-server \uc124\uce58",id:"metric-server-\uc124\uce58",level:2},{value:"Observability Stack \uc124\uce58",id:"observability-stack-\uc124\uce58",level:2},{value:"Prometheus, Loki \uc124\uce58",id:"prometheus-loki-\uc124\uce58",level:3},{value:"OpenTelemetry Collector \uad6c\uc131",id:"opentelemetry-collector-\uad6c\uc131",level:3},{value:"Fluentbit \uad6c\uc131",id:"fluentbit-\uad6c\uc131",level:3},{value:"bookinfo productpage \uc811\uc18d \ubc0f trace \ud655\uc778",id:"bookinfo-productpage-\uc811\uc18d-\ubc0f-trace-\ud655\uc778",level:3},{value:"\uc815\ub9ac",id:"\uc815\ub9ac",level:2}],u={toc:m};function k(e){var t=e.components,i=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\uc9c0\ub09c\uae00\uc5d0 \uc774\uc5b4 \uc774\ubc88\uc5d0\ub294 \ud648\ub7a9\uc73c\ub85c \uad6c\uc131\ud55c EKS Anywhere \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc6b4\uc601, \uac1c\ubc1c\ud658\uacbd \uad6c\uc131\uc744 \uc704\ud55c \uc5ec\ub7ec\uac00\uc9c0 \ub3c4\uad6c\ub97c \uc124\uce58\ud574\ubcf4\ub294 \uacfc\uc815\uc744 \uc815\ub9ac\ud558\uace0\uc790 \ud55c\ub2e4. "),(0,o.kt)("p",null,"\uc9c0\ub09c \ud3ec\uc2a4\ud305\uc740 \ub2e4\uc74c \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\uc774\uc804\uae00 - ",(0,o.kt)("a",{parentName:"p",href:"https://ddii.dev/kubernetes/eks-anywhere/"},"vSphere homelab \ud658\uacbd\uc5d0\uc11c EKS Anywhere \uad6c\uc131\ud558\uae30"))),(0,o.kt)("h2",{id:"eks-connector"},"EKS Connector"),(0,o.kt)("p",null,"EKS Connector\ub97c \ud1b5\ud574 EKS Anywhere\ub97c \ud3ec\ud568\ud55c \uc678\ubd80\uc758 \ubaa8\ub4e0 \ud074\ub7ec\uc2a4\ud130\ub97c AWS \ucf58\uc194\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc788\ub2e4. eks connector \ucee8\ud14c\uc774\ub108\ub97c \ud1b5\ud574 proxy \ud615\ud0dc\ub85c \uc678\ubd80 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 API\uc11c\ubc84\uc5d0\uc11c \uc815\ubcf4\ub97c \uac00\uc838\uc640 AWS System Manager\ub85c \uc804\ub2ec\ud558\ub294 \ube44\ub3d9\uae30 \ubc29\uc2dd\uc73c\ub85c \uc6cc\ud06c\ub85c\ub4dc \uad00\ub9ac\ub97c \uc9c4\ud589\ud55c\ub2e4."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\uc720\uc800\uac00\uc774\ub4dc - ",(0,o.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/eks/latest/userguide/eks-connector.html"},"https://docs.aws.amazon.com/eks/latest/userguide/eks-connector.html"),"  "),(0,o.kt)("li",{parentName:"ul"},"AWS \ube14\ub85c\uadf8 - ",(0,o.kt)("a",{parentName:"li",href:"https://aws.amazon.com/blogs/containers/connect-any-kubernetes-cluster-to-amazon-eks/"},"https://aws.amazon.com/blogs/containers/connect-any-kubernetes-cluster-to-amazon-eks/"))),(0,o.kt)("h3",{id:"\ud074\ub7ec\uc2a4\ud130-\ub4f1\ub85d"},"\ud074\ub7ec\uc2a4\ud130 \ub4f1\ub85d"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://d2908q01vomqb2.cloudfront.net/fe2ef495a1152561572949784c16bf23abb28057/2021/09/15/Screen-Shot-2021-09-03-at-4.28.27-PM.png",alt:"overview"})),(0,o.kt)("p",null,"EKS Anywhere\ub97c \ud3ec\ud568\ud55c \uc678\ubd80 K8s \ud074\ub7ec\uc2a4\ud130\ub294 AWS CLI, eksctl, \ucf58\uc194\uc744 \uc0ac\uc6a9\ud574\uc11c \ub4f1\ub85d(register)\uc774 \uac00\ub2a5\ud558\ub2e4. eksctl\ub85c \ub4f1\ub85d\uc744 \uc9c4\ud589\ud558\uba74 \uba3c\uc800 \uad00\ub828\ub41c Role\uc744 \uc0dd\uc131\ud574\uc8fc\uace0 \ub610\ud55c ClusterRole, ClusterRoleBinding \ubc0f Connector StatefulSet\uc744 \ubc30\ud3ec\ud560 \uc218 \uc788\ub3c4\ub85d \uc790\ub3d9\uc73c\ub85c manifest\ub97c \uc0dd\uc131\ud574\uc8fc\uae30 \ub54c\ubb38\uc5d0 eksctl\ub85c \ud074\ub7ec\uc2a4\ud130 \ub4f1\ub85d\uc744 \uc9c4\ud589\ud558\ub294 \uac83\uc774 \ud3b8\ud558\ub2e4. AWS Managed IAM \uc5ed\ud560\uc778 ",(0,o.kt)("inlineCode",{parentName:"p"},"AWSServiceRoleForAmazonEKSConnector"),"\uc744 \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc744 \uc9c4\ud589\ud558\uae30 \ub54c\ubb38\uc5d0 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\uc744 \ud55c\ub2e4. \uc5d0\ub7ec\uac00 \ub09c \uc774\ud6c4\uc5d0 AWS \ucf58\uc194\uc774\ub098 CLI\ub97c \ud1b5\ud574 \ud655\uc778\ud558\uba74 \uc0c8\ub86d\uac8c \uc0dd\uc131\ub41c ",(0,o.kt)("inlineCode",{parentName:"p"},"AWSServiceRoleForAmazonEKSConnector")," IAM \uc5ed\ud560\uacfc \ud574\ub2f9 \uc5ed\ud560\uc5d0 \uc5f0\uacb0\ub41c Policy\uc778 ",(0,o.kt)("inlineCode",{parentName:"p"},"AmazonEKSConnectorServiceRolePolicy"),"\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'> eksctl register cluster --name homelab --provider eks_anywhere --profile jinwoong\n\n2022-03-09 18:50:44 [\u2139]  creating IAM role "eksctl-20220309185044427640"\n2022-03-09 18:50:49 [\u2139]  deleting IAM role "eksctl-20220309185044427640"\nError: error registering cluster: error calling RegisterCluster: ResourcePropagationDelayException: Service linked role \'arn:aws:iam::492935017096:role/aws-service-role/eks-connector.amazonaws.com/AWSServiceRoleForAmazonEKSConnector\' is propagating, please retry later.\n')),(0,o.kt)("p",null,"\uc2e4\ud328\ub97c \uc9c4\ud589\ud55c \ud6c4\uc5d0 \ub2e4\uc2dc \ub4f1\ub85d \uc2dc\ub3c4\ub97c \ud558\uba74 \uc544\ub798 \ucd9c\ub825\ub85c\uadf8\uc640 \uac19\uc774 \uba85\ub839\uc5b4\ub97c \uc2e4\ud589\ud55c \ub514\ub809\ud1a0\ub9ac\uc5d0 EKS Connector \uad00\ub828 \ub9ac\uc18c\uc2a4 manifests(eks-connector.yaml,eks-connector-clusterrole.yaml,eks-connector-console-dashboard-full-access-group.yaml)\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'> eksctl register cluster --name homelab --provider eks_anywhere --profile jinwoong\n2022-03-08 22:59:15 [\u2139\ufe0f]  creating IAM role "eksctl-20220308225915739385"\n2022-03-08 22:59:29 [\u2139\ufe0f]  registered cluster "homelab" successfully\n2022-03-08 22:59:29 [\u2139\ufe0f]  wrote file eks-connector.yaml to /Users/jinwoong/study/eks-anywhere-homelab\n2022-03-08 22:59:29 [\u2139\ufe0f]  wrote file eks-connector-clusterrole.yaml to /Users/jinwoong/study/eks-anywhere-homelab\n2022-03-08 22:59:29 [\u2139\ufe0f]  wrote file eks-connector-console-dashboard-full-access-group.yaml to /Users/jinwoong/study/eks-anywhere-homelab\n2022-03-08 22:59:29 [!]  note: "eks-connector-clusterrole.yaml" and "eks-connector-console-dashboard-full-access-group.yaml" give full EKS Console access to IAM identity "arn:aws:iam::492935017096:user/jinwoong", edit if required; read https://docs.aws.amazon.com/eks/latest/userguide/connector-grant-access.html for more info\n2022-03-08 22:59:29 [\u2139\ufe0f]  run kubectl apply -f eks-connector.yaml,eks-connector-clusterrole.yaml,eks-connector-console-dashboard-full-access-group.yaml before 11 Mar 22 13:59 UTC to connect the cluster\n')),(0,o.kt)("p",null,"eks-connector.yaml \uc5d0\ub294 ",(0,o.kt)("inlineCode",{parentName:"p"},"Namespace"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Secret"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Role"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"ServiceAccount"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"RoleBinding"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"ConfigMap"),"\uacfc \ubc30\ud3ec\ub420 ",(0,o.kt)("inlineCode",{parentName:"p"},"StatefulSet")," \uc774 \ub2f4\uaca8\uc788\uc5b4 \ud574\ub2f9 \ud30c\uc77c\uc740 \uadf8\ub300\ub85c \uc0ac\uc6a9\ud558\uba74 \ub41c\ub2e4."),(0,o.kt)("p",null,"\ud558\uc9c0\ub9cc \uc2e4\uc81c \ucf58\uc194\uc5d0\uc11c \ub178\ub4dc\uc640 \uc6cc\ud06c\ub85c\ub4dc \uc815\ubcf4\ub97c \ubcf4\uae30 \uc704\ud574\uc11c eks-connector-console-dashboard-full-access-group.yaml\uc5d0 \ucf58\uc194 \uc811\uc18d\uc774 \ud544\uc694\ud55c IAM \uc0ac\uc6a9\uc790\uc640 \uc811\uadfc\uc744 \uc704\ud55c \ud2b9\uc815 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc815\ubcf4\ub97c ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterRole")," \ubc0f ",(0,o.kt)("inlineCode",{parentName:"p"},"ClusterRoleBinding"),"\uc5d0 \ucd94\uac00\ud574\uc57c \ud55c\ub2e4. "),(0,o.kt)("p",null,"\uc790\uc138\ud55c \ub0b4\uc6a9\uc740 ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/connector-grant-access.html"},"https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/connector-grant-access.html"),"\uc5d0\uc11c \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4. "),(0,o.kt)("p",null,"\uc704\uc5d0\uc11c \uc0dd\uc131\ub41c manifests\uac00 EKS Anywhere \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc801\uc6a9\ub418\uba74 StatefulSet \ud615\ud0dc\ub85c \ubc30\ud3ec\ub41c EKS Connect \uc5d0\uc774\uc804\ud2b8\ub294 Amazon EventBridge\ub97c \ud1b5\ud574 EKS\uc5d0 \uc54c\ub9bc\uc744 \ubcf4\ub0b4\ub294 System Manager \uc11c\ube44\uc2a4\uc5d0 \uc5f0\uacb0\ud55c\ub2e4. \uc774\ud6c4 EKS Connect\ub294 \uc5f0\uacb0\ub41c \ud074\ub7ec\uc2a4\ud130\uc758 kubernetes API \uc11c\ubc84\uc5d0 EKS \ucf58\uc194 \uc694\uccad\uc744 \uc804\ub2ec\ud558\ubbc0\ub85c \uc0dd\uc131\ud55c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c EKS Connect \uc5ed\ud560\uacfc \uc5f0\uacb0\ud558\uc5ec AWS IAM \uc5d4\ud2f0\ud2f0\ub97c \uac00\uc7a5(impersonate) \ud560 \uc218\uc788\ub294 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud558\uac8c \ub41c\ub2e4. "),(0,o.kt)("p",null,"statefulset\uc744 \uc880\ub354 \uc0b4\ud3b4\ubcf4\uba74 \uc704\uc5d0\uc11c \uc774\uc57c\uae30\ud558\ub294 \uc5d0\uc774\uc804\ud2b8 \uc5ed\ud560\uc744 \ud558\ub294 ",(0,o.kt)("inlineCode",{parentName:"p"},"connector-agent")," \uc640 \ud504\ub85d\uc2dc \uc5ed\ud560\uc744 \ud558\ub294 ",(0,o.kt)("inlineCode",{parentName:"p"},"connector-proxy")," \ucee8\ud14c\uc774\ub108 \ub450\uac1c\uac00 \ub5a0\uc788\ub294\uac78 \ubcfc \uc218 \uc788\ub2e4. \uc0ac\uc6a9\uc790\uac00 \ucf58\uc194\uc5d0\uc11c \ud574\ub2f9 \ud074\ub7ec\uc2a4\ud130\uc758 \ub178\ub4dc\ub098 \uc6cc\ud06c\ub85c\ub4dc \uc815\ubcf4\ub97c \uc870\ud68c\ud558\uac8c \ub418\uba74 EKS\ub294 System Manager \uc11c\ube44\uc2a4\uc5d0\uac8c \uc138\uc158\uc744 \uc694\uccad\ud558\uace0 \uc774\ud6c4 System Manager\uac00 \ube44\ub3d9\uae30 \ubc29\uc2dd\uc73c\ub85c ",(0,o.kt)("inlineCode",{parentName:"p"},"connector-agent")," \ucee8\ud14c\uc774\ub108\ub97c invoke\ud558\uba74 ",(0,o.kt)("inlineCode",{parentName:"p"},"connector-proxy")," \ucee8\ud14c\uc774\ub108 \uc704\uc5d0\uc11c \ub9c8\uc6b4\ud2b8\ub41c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub85c \uc778\uc99d\uc744 \ud558\uace0 \uac00\uc7a5(impersonation)\ud55c \uc0c1\ud0dc\ub85c EKS Anywhere \ud074\ub7ec\uc2a4\ud2b8\uc758 API\ub97c \ud638\ucd9c\ud574\uc11c \uad00\ub828\ub41c \ub0b4\uc6a9\uc744 \uac00\uc838\uc640\uc11c \ubcf4\uc5ec\uc8fc\uac8c \ub41c\ub2e4."),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://d2908q01vomqb2.cloudfront.net/fe2ef495a1152561572949784c16bf23abb28057/2021/09/15/Screen-Shot-2021-09-05-at-7.51.33-AM.png",alt:"connector"})),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'> kubectl describe statefulset eks-connector -n eks-connector\nName:               eks-connector\nNamespace:          eks-connector\nCreationTimestamp:  Wed, 09 Mar 2022 22:53:23 +0900\nSelector:           app=eks-connector\nLabels:             app=eks-connector\nAnnotations:        <none>\nReplicas:           2 desired | 2 total\nUpdate Strategy:    RollingUpdate\n  Partition:        0\nPods Status:        2 Running / 0 Waiting / 0 Succeeded / 0 Failed\nPod Template:\n  ...\n  Containers:\n   connector-agent:\n    Image:      public.ecr.aws/amazon-ssm-agent/amazon-ssm-agent:3.1.90.0\n    Port:       <none>\n    Host Port:  <none>\n    Environment:\n      AWS_EC2_METADATA_DISABLED:  true\n    Mounts:\n      /etc/amazon/ssm/amazon-ssm-agent.json from eks-agent-config (rw,path="amazon-ssm-agent.json")\n      /etc/amazon/ssm/seelog.xml from eks-agent-config (rw,path="seelog.xml")\n      /var/eks/shared from eks-connector-shared (rw)\n      /var/lib/amazon/ssm/Vault from eks-agent-vault (rw)\n   connector-proxy:\n    Image:      public.ecr.aws/eks-connector/eks-connector:0.0.3\n    Port:       <none>\n    Host Port:  <none>\n    Args:\n      server\n    Environment:\n      POD_NAME:   (v1:metadata.name)\n    Mounts:\n      /var/eks/shared from eks-connector-shared (rw)\n      /var/lib/amazon/ssm/Vault from eks-agent-vault (rw)\n      /var/run/secrets/kubernetes.io/serviceaccount from service-account-token (rw)\n  ...\n')),(0,o.kt)("h2",{id:"istio-\ud658\uacbd-\uad6c\uc131"},"Istio \ud658\uacbd \uad6c\uc131"),(0,o.kt)("p",null,"Istio \ud658\uacbd\uc5d0\uc11c \uc571\uc744 \ubc30\ud3ec\ud558\uace0 Tracing \uac00\uc2dc\uc131 \ud655\ubcf4\ub97c \ud558\ub294 \uc2e4\uc2b5\uc744 \uc9c4\ud589\ud558\uae30 \uc704\ud574 \uac04\ub2e8\ud558\uac8c \uad6c\uc131\uc5d0 \ub300\ud55c \uadf8\ub9bc\uc744 \uadf8\ub824\ubd24\ub2e4. "),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"istio",src:n(59624).Z,width:"1148",height:"388"})),(0,o.kt)("p",null,"Istio \ud658\uacbd\uc5d0\uc11c sidecar \ud615\ud0dc\ub85c envoy proxy\uac00 \uac01 Observability \uad6c\uc131\uc694\uc18c\ub85c \ub370\uc774\ud130\uac00 \uc804\ub2ec\ub418\ub3c4\ub85d \uad6c\uc131\ud55c\ub2e4. \uc774\ub54c \uc0ac\uc6a9\ub418\ub294 \uc624\ud508\uc18c\uc2a4 \uc2a4\ud0dd\uc740 \ub2e4\uc74c\uacfc \uac19\ub2e4."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Tracing "),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Collect : ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/open-telemetry/opentelemetry-collector"},"OpenTelemetry Collector")),(0,o.kt)("li",{parentName:"ul"},"Backend : ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/grafana/tempo"},"Tempo")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Logging"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Collect : ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/fluent/fluent-bit"},"Fluentbit")),(0,o.kt)("li",{parentName:"ul"},"Backend : ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/grafana/loki"},"Loki")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Metrics"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Collect : ",(0,o.kt)("a",{parentName:"li",href:"https://istio.io/latest/docs/ops/integrations/prometheus/"},"Exporters")),(0,o.kt)("li",{parentName:"ul"},"Backend : ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/prometheus"},"Prometheus")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Visualization"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/grafana/grafana"},"Grafana"))))),(0,o.kt)("h3",{id:"istio-\uc124\uce58"},"Istio \uc124\uce58"),(0,o.kt)("p",null,"IstioOperator\ub97c \ud1b5\ud574 Istio\ub97c \uc124\uce58\ud55c\ub2e4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"> istioctl operator init\n")),(0,o.kt)("p",null,"IstioOperator\uac00 \uc124\uce58\ub418\uba74 \ub9ac\uc18c\uc2a4\ub97c \ubc30\ud3ec\ud558\uc5ec istio \uc11c\ube44\uc2a4\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\ub2e4. envoy proxy\uc5d0\ub294 \ub2e4\uc591\ud55c \ud5e4\ub354\ub4e4\uc744 \ud1b5\ud574 trace \uc815\ubcf4\ub97c propagate \ud560 \uc218 \uc788\ub2e4. \ub2e4\uc74c\uacfc \uac19\uc774 ",(0,o.kt)("inlineCode",{parentName:"p"},"x-b3-traceid"),"\ub97c traceid\ub85c \ub85c\uadf8 \ud3ec\ub9f7\uc744 \uad6c\uc131\ud558\ub3c4\ub85d \ud558\uace0 trace \ud65c\uc131\ud654\ub97c \uc704\ud574 ",(0,o.kt)("inlineCode",{parentName:"p"},"enableTracing: true")," \ub97c \uc124\uc815\ud558\uace0 Prometheus\uc5d0\uc11c \uc2a4\ud06c\ub7a9\uc744 \ud560 \uc218 \uc788\ub3c4\ub85d ",(0,o.kt)("inlineCode",{parentName:"p"},"enablePrometheusMerge: true"),"\ub85c \uc124\uc815\ud55c\ub2e4."),(0,o.kt)("p",null,"\ub9c8\uc9c0\ub9c9\uc73c\ub85c zipkin \ud504\ub85c\ud1a0\ucf5c\ub85c OpenTelemetry Collector\ub85c \uc804\ub2ec\ud560\uac83\uc774\uae30 \uc5d4\ub4dc\ud3ec\uc778\ub4dc \uc815\ubcf4\ub3c4 \ubbf8\ub9ac \uc791\uc131\ud588\ub2e4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nmetadata:\n  name: istio-operator\n  namespace: istio-system\nspec:\n  profile: default\n  meshConfig:\n    accessLogFile: /dev/stdout\n    accessLogFormat: |\n      [%START_TIME%] "%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%" %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% "%UPSTREAM_TRANSPORT_FAILURE_REASON%" %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% "%REQ(X-FORWARDED-FOR)%" "%REQ(USER-AGENT)%" "%REQ(X-REQUEST-ID)%" "%REQ(:AUTHORITY)%" "%UPSTREAM_HOST%" %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME% traceID=%REQ(x-b3-traceid)%\n    enableTracing: true\n    enablePrometheusMerge: true\n    defaultConfig:\n      tracing:\n        sampling: 100\n        max_path_tag_length: 99999\n        zipkin:\n          address: otel-collector.tracing.svc:9411\n')),(0,o.kt)("p",null,"Istio\uc758 \ub300\ud45c\uc801\uc778 \uc0d8\ud50c\uc571\uc778 ",(0,o.kt)("a",{parentName:"p",href:"https://istio.io/latest/docs/examples/bookinfo/"},"bookinfo"),"\ub97c ",(0,o.kt)("inlineCode",{parentName:"p"},"bookinfo")," \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \uc124\uce58\ud55c\ub2e4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> kubectl create ns bookinfo\n> kubectl label namespace bookinfo istio-injection=enabled --overwrite\n> kubectl apply -n bookinfo -f https://raw.githubusercontent.com/istio/istio/release-1.10/samples/bookinfo/platform/kube/bookinfo.yaml\n")),(0,o.kt)("p",null,"\uc11c\ube44\uc2a4 \uc811\uadfc\uc744 \uc704\ud55c ",(0,o.kt)("inlineCode",{parentName:"p"},"Gateway"),"\uc640 ",(0,o.kt)("inlineCode",{parentName:"p"},"VirtualService")," \ub3c4 \uad6c\uc131\ud55c\ub2e4. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: bookinfo-gateway\n  namespace: bookinfo\nspec:\n  selector:\n    istio: ingressgateway # use istio default controller\n  servers:\n  - port:\n      number: 80\n      name: http\n      protocol: HTTP\n    hosts:\n    - "*" # Mind the hosts. This matches all\n---\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: bookinfo\n  namespace: bookinfo\nspec:\n  hosts:\n  - "*"\n  gateways:\n  - tracing/bookinfo-gateway\n  - bookinfo-gateway\n  http:\n  - match:\n    - uri:\n        prefix: "/"\n    route:\n    - destination:\n        host: productpage.bookinfo.svc.cluster.local\n        port:\n          number: 9080\n')),(0,o.kt)("p",null,"\uc11c\ube44\uc2a4 \ud655\uc778\uc744 \uc704\ud574 ",(0,o.kt)("inlineCode",{parentName:"p"},"LoadBalancer"),"\ub85c \uad6c\uc131\ub41c istio-ingressgateway EXTERNAL-IP\uc778 ",(0,o.kt)("a",{parentName:"p",href:"http://192.168.31.10/productpage"},"http://192.168.31.10/productpage"),"\ub85c \uc811\uc18d\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"\u276f kubectl get svc -n istio-system\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)                                      AGE\nistio-ingressgateway   LoadBalancer   10.97.92.31      192.168.31.10   15021:30184/TCP,80:32738/TCP,443:31058/TCP   2d23h\nistiod                 ClusterIP      10.107.186.201   <none>          15010/TCP,15012/TCP,443/TCP,15014/TCP        2d23h\n")),(0,o.kt)("h2",{id:"metric-server-\uc124\uce58"},"metric-server \uc124\uce58"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/metrics-server"},"https://github.com/kubernetes-sigs/metrics-server")),(0,o.kt)("p",null,"HPA \ub098 Kubernetes \ub300\uc2dc\ubcf4\ub4dc\ub97c \ud65c\uc6a9\ud558\uae30 \uc704\ud574\uc11c metric-server\ub97c \uc124\uce58\ud55c\ub2e4. kubelet tls \uc778\uc99d\uc11c \uc5d0\ub7ec\uac00 \ub0a0 \uacbd\uc6b0 \uc124\uce58 \ud30c\uc77c\uc744 \ubc1b\uc544\uc11c ARG\uc5d0 ",(0,o.kt)("inlineCode",{parentName:"p"},"--kubelet-insecure-tls")," \ud50c\ub798\uadf8\ub97c \ucd94\uac00\ud574\uc11c \uc124\uce58\ud558\uba74 \ub41c\ub2e4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"> kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml\nserviceaccount/metrics-server created\nclusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created\nclusterrole.rbac.authorization.k8s.io/system:metrics-server created\nrolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created\nclusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created\nclusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created\nservice/metrics-server created\ndeployment.apps/metrics-server created\napiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created\n\n> kubectl top nodes\nNAME             CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   \n192.168.31.186   175m         9%     2228Mi          29%       \n192.168.31.187   82m          4%     893Mi           11%       \n192.168.31.188   64m          3%     795Mi           10%       \n192.168.31.189   134m         6%     1817Mi          23%       \n192.168.31.190   43m          2%     636Mi           8% \n")),(0,o.kt)("h2",{id:"observability-stack-\uc124\uce58"},"Observability Stack \uc124\uce58"),(0,o.kt)("p",null,"\ucc28\ud2b8\ub85c \uc77c\uad04\ubc30\ud3ec\ub97c \uc704\ud574 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/grafana/helm-charts/tree/main/charts/loki-stack"},"Loki-stack"),"\ub97c \uc0ac\uc6a9\ud588\uace0, \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uad6c\uc131\uc73c\ub85c \uad6c\uc131 \ubcc0\uacbd\uc744 \ud55c chart values\ub294 \ub2e4\uc74c\uacfc \uac19\ub2e4. "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/prometheus"},"Prometheus")," - \uc2dc\uacc4\uc5f4 \ub370\uc774\ud130(\uba54\ud2b8\ub9ad)\uc744 \uc218\uc9d1\ud558\uace0 \uc800\uc7a5\ud558\ub294 \ud504\ub85c\uc81d\ud2b8\uc774\uba70, \ud0a4-\ubc38\ub958 \ud615\ud0dc\ub85c \ucffc\ub9ac\uc640 \uc5f0\uc0b0\uc774 \uac00\ub2a5\ud55c \ubaa8\ub2c8\ud130\ub9c1 \uc2dc\uc2a4\ud15c\uc774\ub2e4. node-exporter, alertmanager, pushgateway \ub3c4 \ucc28\ud2b8\ub85c \uac19\uc774 \uc124\uce58\ud55c\ub2e4. "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/grafana/grafana"},"Grafana")," - \ub370\uc774\ud130\ub97c \uc2dc\uac01\ud654\ud558\ub294 \ud50c\ub7ab\ud3fc\uc73c\ub85c \ub2e4\uc591\ud55c \ub85c\uadf8, \uba54\ud2b8\ub9ad, \ud2b8\ub808\uc774\uc2a4 \ub370\uc774\ud130\ub97c \uc2dc\uc791\ud654\ud558\uace0 \uc54c\ub9bc \uad00\ub9ac\ub97c \ud560 \uc218 \uc788\ub2e4."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/grafana/loki"},"Loki")," - \ub2e4\ub978 \ub85c\uae45 \uc2dc\uc2a4\ud15c\uacfc \ub2ec\ub9ac \ub85c\uadf8\ub97c \uc81c\uc678\ud55c \uba54\ud0c0\ub370\uc774\ud130 \uc778\ub371\uc2f1\ub9cc \ud558\uae30 \ub54c\ubb38\uc5d0 Prometheus\ucc98\ub7fc \ub808\uc774\ube14\uc744 \uc5fc\ub450\uc5d0 \ub450\uace0 \uc124\uacc4\ub41c \ub85c\uae45 \ub370\uc774\ud130\uc2a4\ud1a0\uc5b4 \uc2dc\uc2a4\ud15c\uc774\ub2e4."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/fluent/fluent-bit"},"Fluent Bit")," - \ub85c\uae45 \uceec\ub809\ud130(Collector)\ub85c fluentd \ubcf4\ub2e4 \uacbd\ub7c9\ud654\ub418\uace0 \ube60\ub978 \ub85c\uadf8 \ud504\ub85c\uc138\uc2a4\uc774\uc790 \uc804\ub2ec\uc790(Forwarder)\ub85c \ub2e4\ub978 \ub85c\uae45 \uceec\ub809\ud130\uc778 promtail, filebeat, logstash\ub294 false\ub85c \uc124\uc815\ud55c\ub2e4. "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/grafana/tempo"},"Tempo")," - Tempo\ub294 \ubd84\uc0b0 \ucd94\uc801(Tracing)\uc744 \uc704\ud55c \ube44\uc6a9 \ud6a8\uc728\uc801\uc778 \ubc31\uc5d4\ub4dc \ub370\uc774\ud130\uc2a4\ud1a0\uc5b4 \ud504\ub85c\uc81d\ud2b8\ub85c \uc704\uc5d0\uc11c \uad6c\uc131\ud55c Prometheus, Grafana, Loki \ub4f1\uacfc \uac19\uc740 \ub2e4\ub978 Observability \ud504\ub85c\uc81d\ud2b8\uc640 \ud1b5\ud569\uc774 \uc26c\uc6b4\uac83\uc774 \ud2b9\uc9d5\uc774\ub2e4.")),(0,o.kt)("h3",{id:"prometheus-loki-\uc124\uce58"},"Prometheus, Loki \uc124\uce58"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Prometheus"),"\uc640 ",(0,o.kt)("inlineCode",{parentName:"p"},"Loki"),"\ub294 Loki-Stack\uc73c\ub85c \uad6c\uc131\ud55c\ub2e4. fluent-bit\ub294 \ubcc4\ub3c4 \uad6c\uc131 \ud30c\uc77c\uc744 \ud544\uc694\ub85c \ud558\uae30 \ub54c\ubb38\uc5d0 \ub098\uc911\uc5d0 \uc124\uce58\ud560 \uc608\uc815\uc774\ub2e4. Prometheus\ub294 Persistent Volume\uc740 \ubcc4\ub3c4\ub85c \uad6c\uc131\ud558\uc9c0 \uc54a\uc740 \uc0c1\ud0dc\ub85c ",(0,o.kt)("inlineCode",{parentName:"p"},"persistentVolume"),"\uc744 ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),"\ub85c \uc124\uc815\ud558\uc5ec \ubc30\ud3ec\ud55c\ub2e4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"> kubectl create ns tracing\n> helm repo add grafana https://grafana.github.io/helm-charts\n> helm repo update\n> helm install loki grafana/loki-stack --version 2.4.1 -n tracing -f - << 'EOF'\nfluent-bit:\n  enabled: false\npromtail:\n  enabled: false\nprometheus:\n  enabled: true\n  server:\n    persistentVolume:\n      enabled: false\n  alertmanager:\n    persistentVolume:\n      enabled: false\nEOF\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Tempo"),"\ub294 \ub85c\uadf8 \uc815\ubcf4\uc640 tracing\uc744 \uc218\uc2e0\ud560 \ub9ac\uc2dc\ubc84 \ud504\ub85c\ud1a0\ucf5c \ub4e4(zipkin, otlp)\uc744 \uc815\uc758\ud55c \ucc44\ub85c Chart\ub85c \ubc30\ud3ec\ud55c\ub2e4. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"helm install tempo grafana/tempo --version 0.7.4 -n tracing -f - << 'EOF'\ntempo:\n  extraArgs:\n    \"distributor.log-received-traces\": true\n  receivers:\n    zipkin:\n    otlp:\n      protocols:\n        http:\n        grpc:\nEOF\n")),(0,o.kt)("h3",{id:"opentelemetry-collector-\uad6c\uc131"},"OpenTelemetry Collector \uad6c\uc131"),(0,o.kt)("p",null,"\uc774\uc81c\uae4c\uc9c0 observability \uad00\ub828 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\ub4e4\uc744 \uad6c\uc131\ud588\uc73c\ub2c8 \ub9c8\uc9c0\ub9c9\uc73c\ub85c \ud2b8\ub808\uc774\uc2f1\uc744 \uc704\ud55c \ub3c4\uad6c\uc778 ",(0,o.kt)("a",{parentName:"p",href:"https://opentelemetry.io/docs/collector/getting-started/"},"OpenTelemetry Collector"),"\ub97c \uc124\uce58\ud55c\ub2e4. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: ConfigMap\nmetadata:\n name: otel-collector-conf\n labels:\n   app: opentelemetry\n   component: otel-collector-conf\ndata:\n otel-collector-config: |\n   receivers:   \n     zipkin:\n        endpoint: 0.0.0.0:9411\n   exporters:\n     otlp:\n       endpoint: tempo.tracing.svc.cluster.local:55680\n       insecure: true\n   service:\n     pipelines:\n       traces:\n         receivers: [zipkin]\n         exporters: [otlp]\n")),(0,o.kt)("p",null,"\ucd08\uae30 Collect \uad6c\uc131 \ucee8\ud53c\uadf8\ub294 \ub2e4\ub984\uacfc \uac19\uc774 \uc124\uc815\ud588\ub2e4. \uc790\uc138\ud55c \uc124\uc815 \ubc29\ubc95\uc740 ",(0,o.kt)("a",{parentName:"p",href:"https://opentelemetry.io/docs/collector/configuration/"},"https://opentelemetry.io/docs/collector/configuration/"),"\uc5d0\uc11c \ud655\uc778\uac00\ub2a5\ud558\ub2e4."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"spec.config.receivers.zipkin.endpoint"),"\ub294 trace\uc815\ubcf4\ub97c \ubc1b\uc744 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uad6c\uc131\uc73c\ub85c zipkin \ud3ec\ub9f7\uc73c\ub85c \uc218\uc2e0\ud55c\ub2e4. "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"spec.config.exporters[]"),"\uc5d0\uc11c\ub294 Tempo\ub85c \ubcf4\ub0b4\uae30 \uc704\ud55c endpoint \uc124\uc815\uc744 \ud55c\ub2e4."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"spec.config.service"),"\uc5d0\uc11c\ub294 \uc774\ud6c4 collector\uc5d0\uc11c \uc0ac\uc6a9\ud560 protocol\uc774\ub098 backend datasource \uc5d0 \ub300\ud55c \uc124\uc815\uc774\uba70 \ubc18\ub4dc\uc2dc \ud65c\uc131\ud654\uac00 \ub418\uc5b4\uc57c \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\ub2e4.  ")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Service\nmetadata:\n  name: otel-collector\n  labels:\n    app: opentelemetry\n    component: otel-collector\nspec:\n  ports:\n  - name: otlp # Default endpoint for OpenTelemetry receiver.\n    port: 55680\n    protocol: TCP\n    targetPort: 55680\n  - name: jaeger-grpc # Default endpoint for Jaeger gRPC receiver\n    port: 14250\n  - name: jaeger-thrift-http # Default endpoint for Jaeger HTTP receiver.\n    port: 14268\n  - name: zipkin # Default endpoint for Zipkin receiver.\n    port: 9411\n  - name: metrics # Default endpoint for querying metrics.\n    port: 8888\n  - name: prometheus # prometheus exporter\n    port: 8889\n  selector:\n    component: otel-collector\n")),(0,o.kt)("p",null,"Service\uc5d0\uc11c \uc8fc\ub8cc \uc0ac\uc6a9\ud558\uac8c\ub420 \ud3ec\ud2b8\ub294 ",(0,o.kt)("inlineCode",{parentName:"p"},"zipkin"),"\uc758 ",(0,o.kt)("inlineCode",{parentName:"p"},"9411"),"\uc774\ub2e4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: otel-collector\n  labels:\n    app: opentelemetry\n    component: otel-collector\nspec:\n  selector:\n    matchLabels:\n      app: opentelemetry\n      component: otel-collector\n  template:\n    metadata:\n      labels:\n        app: opentelemetry\n        component: otel-collector\n    spec:\n      containers:\n      - command:\n          - "/otelcontribcol"\n          - "--config=/conf/otel-collector-config.yaml"\n          - "--mem-ballast-size-mib=683"\n          - "--log-level=DEBUG"\n        image: otel/opentelemetry-collector-contrib:0.29.0\n        name: otel-collector\n        ports:\n        - containerPort: 55679 # Default endpoint for ZPages.\n        - containerPort: 55680 # Default endpoint for OpenTelemetry receiver.\n        - containerPort: 14250 # Default endpoint for Jaeger HTTP receiver.\n        - containerPort: 14268 # Default endpoint for Jaeger HTTP receiver.\n        - containerPort: 9411 # Default endpoint for Zipkin receiver.\n        - containerPort: 8888  # Default endpoint for querying metrics.\n        - containerPort: 8889  # prometheus exporter       \n        volumeMounts:\n        - name: otel-collector-config-vol\n          mountPath: /conf\n      volumes:\n        - configMap:\n            name: otel-collector-conf\n            items:\n              - key: otel-collector-config\n                path: otel-collector-config.yaml\n          name: otel-collector-config-vol\n')),(0,o.kt)("h3",{id:"fluentbit-\uad6c\uc131"},"Fluentbit \uad6c\uc131"),(0,o.kt)("p",null,"\ud074\ub7ec\uc2a4\ud130 dataplane\uacfc controlplane\uc758 logging \ub370\uc774\ud130\ub97c ",(0,o.kt)("inlineCode",{parentName:"p"},"Loki")," \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub85c \uc804\ub2ec\ud558\uae30 \uc704\ud55c config\ub85c \ud655\uc778\ud558\uace0 Chart\ub97c \ubc30\ud3ec\ud55c\ub2e4. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"> helm repo add fluent https://fluent.github.io/helm-charts\n> helm repo update\n> helm install fluent-bit fluent/fluent-bit --version 0.16.1 -n tracing -f - << 'EOF'\nlogLevel: trace\nconfig:\n  service: |\n    [SERVICE]\n        Flush 1\n        Daemon Off\n        Log_Level trace\n        Parsers_File custom_parsers.conf\n        HTTP_Server On\n        HTTP_Listen 0.0.0.0\n        HTTP_Port {{ .Values.service.port }}\n  inputs: |\n    [INPUT]\n        Name tail\n        Path /var/log/containers/*.log\n        Parser cri\n        Tag kube.*\n        Mem_Buf_Limit 5MB\n  outputs: |\n    [OUTPUT]\n        name loki\n        match *\n        host loki.tracing.svc\n        port 3100\n        tenant_id \"\"\n        labels job=fluentbit\n        label_keys $trace_id\n        auto_kubernetes_labels on\n  customParsers: |\n    [PARSER]\n        Name cri\n        Format regex\n        Regex ^(?<time>[^ ]+) (?<stream>stdout|stderr) (?<logtag>[^ ]*) (?<message>.*)$\n        Time_Key    time\n        Time_Format %Y-%m-%dT%H:%M:%S.%L%z\nEOF\n")),(0,o.kt)("p",null,"\ub9c8\uc9c0\ub9c9\uc73c\ub85c \uc704 3\uac00\uc9c0 \ub370\uc774\ud130\uc18c\uc2a4(Prometheus, Loki, Tempo)\uac00 \ub4f1\ub85d\ub41c \uc0c1\ud0dc\uc758 ",(0,o.kt)("inlineCode",{parentName:"p"},"Grafana")," Chart\ub97c \ubc30\ud3ec\ud55c\ub2e4. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'> helm install grafana grafana/grafana -n tracing --version 6.13.5\xa0 -f - << \'EOF\'\ndatasources:\n  datasources.yaml:\n    apiVersion: 1\n    datasources:\n      - name: Tempo\n        type: tempo\n        access: browser\n        orgId: 1\n        uid: tempo\n        url: http://tempo.tracing.svc:3100\n        isDefault: true\n        editable: true\n      - name: Prometehus\n        type: prometheus\n        access: browser\n        orgId: 1\n        uid: prometheus\n        url: http://loki-prometheus-server.tracing.svc\n        isDefault: false\n        editable: true\n      - name: Loki\n        type: loki\n        access: browser\n        orgId: 1\n        uid: loki\n        url: http://loki.tracing.svc:3100\n        isDefault: false\n        editable: true\n        jsonData:\n          derivedFields:\n            - datasourceName: Tempo\n              matcherRegex: "traceID=(\\\\w+)"\n              name: TraceID\n              url: "$${__value.raw}"\n              datasourceUid: tempo\nenv:\n  JAEGER_AGENT_PORT: 6831\nadminUser: admin\nadminPassword: password\nservice:\n  type: LoadBalancer\nEOF\n')),(0,o.kt)("h3",{id:"bookinfo-productpage-\uc811\uc18d-\ubc0f-trace-\ud655\uc778"},"bookinfo productpage \uc811\uc18d \ubc0f trace \ud655\uc778"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"LoadBalancer"),"\ub85c \uad6c\uc131\ub41c istio-ingressgateway EXTERNAL-IP\uc778 ",(0,o.kt)("a",{parentName:"p",href:"http://192.168.31.10/productpage"},"http://192.168.31.10/productpage"),"\ub85c \uc811\uc18d\ud558\ub294 \uc0c1\ud0dc\uc5d0\uc11c trace\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"> ISTIOINGRESSGW=$(kubectl get pod -n istio-system -l app=istio-ingressgateway -o jsonpath='{.items[0].status.hostIP}')\necho -e \"PRODUCTPAGE UI URL = http://$ISTIOINGRESSGW/productpage\"\nPRODUCTPAGE UI URL = http://192.168.31.187/productpage\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'> for i in {1..100};  do curl -s $ISTIOINGRESSGW/productpage | grep -o "<title>.*</title>" ; done\n')),(0,o.kt)("p",null,"Grafana Explorer \uba54\ub274\uc5d0\uc11c ",(0,o.kt)("inlineCode",{parentName:"p"},"Loki")," \ub370\uc774\ud130\uc18c\uc2a4\ub97c \uc120\ud0dd\ud558\uace0 Log browser\uc5d0 ",(0,o.kt)("inlineCode",{parentName:"p"},'{app="productpage"}'),"\ub97c \uc785\ub825\ud558\uac8c \ub418\uba74 \ud558\ub098\uc758 \ud2b8\ub79c\uc7ad\uc158\uc5d0 \ub300\ud55c \ud2b8\ub808\uc774\uc2a4 \uc815\ubcf4\ub97c \ub85c\uadf8\ub0b4\uc5d0\uc11c \ud655\uc778\ud558\uace0 \ud574\ub2f9 traceid \ubc84\ud2bc\uc744 \ud074\ub9ad\ud558\uac70\ub098 ",(0,o.kt)("inlineCode",{parentName:"p"},"Tempo")," \uba54\ub274\uc5d0\uc11c \ud0d0\uc0c9\uc744 \ud558\uba74 \uad00\ub828\ub41c trace \uc815\ubcf4\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"tempo",src:n(12383).Z,width:"1920",height:"1091"})),(0,o.kt)("h2",{id:"\uc815\ub9ac"},"\uc815\ub9ac"),(0,o.kt)("p",null,"\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 eks-anywhere \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc5ec\ub7ec\uac00\uc9c0 3rd party \uad6c\uc131\uc694\uc18c\ub4e4\uc744 \uc124\uce58\ud558\uace0 \uc2e4\uc81c \uc6b4\uc601\ud658\uacbd\uacfc \uc720\uc0ac\ud558\uac8c \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud574\ubd24\ub2e4. EKS\ub97c \uc0ac\uc6a9\ud558\ub294 \uad00\uc810\uc5d0\uc11c \uc720\uc0ac\ud55c \uacbd\ud5d8\uc744 \ubc14\ud0d5\uc73c\ub85c \uac1c\ubc1c\ud658\uacbd\uc744 \uac00\uc838\uac08\uc218 \uc788\uae30\uc5d0 vSphere\ub97c \uae30\ubc18\uc73c\ub85c \uc0ac\ub0b4 \uc11c\ube44\uc2a4\ub97c \uac1c\ubc1c\ud558\ub294 \ud300\uc5d0\uac8c\ub294 \uc88b\uc740 \ud558\ub098\uc758 \uc120\ud0dd\uc9c0\uac00 \ucd94\uac00\ub418\uc5c8\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4. Direct Connect\ub098 VPN\uacfc \uac19\uc774 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0\uc131\ub9cc \ud655\ubcf4\ub41c\ub2e4\uba74 \uc2e4\uc81c \uae30\uc5c5\ud658\uacbd\uc5d0\uc11c\ub294 AWS \ub124\uc774\ud2f0\ube0c \uc11c\ube44\uc2a4\uc640\uc758 \uc5f0\uacc4\uac00 \ub354 \uc6a9\uc774\ud574\uc9c0\uae30 \ub54c\ubb38\uc5d0 \uc88b\uc740 \uac1c\ubc1c, \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc73c\ub85c \ub2e4\uac00\uac08 \uc218 \uc788\uc744\uac70\ub77c \uc0dd\uac01\ud55c\ub2e4.  "),(0,o.kt)("p",null,"\uc7ac\ubbf8\uc788\ub294 \uacbd\ud5d8\uc774\uc5c8\uace0 \ub2f9\ubd84\uac04\uc740 \uac1c\uc778\ud504\ub85c\uc81d\ud2b8\ub97c \uc9c4\ud589\ud558\ub294 \ud648\ub7a9 \ud658\uacbd\uc740 EKS Anywhere\ub85c \uc815\ucc29\ud574\uc11c \ud14c\uc2a4\ud2b8\ub97c \uacc4\uc18d \uc9c4\ud589\ud558\ub824\uace0 \ud55c\ub2e4. "),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4.")))}k.isMDXComponent=!0},59624:function(e,t,n){t.Z=n.p+"assets/images/istio_o11y-120b56627de7c677da542503b0d01b49.png"},12383:function(e,t,n){t.Z=n.p+"assets/images/tempo-grafana-efca4b49fa3a35fde86bb842172288e4.png"}}]);