"use strict";(self.webpackChunkddii=self.webpackChunkddii||[]).push([[9450],{16029:function(e){e.exports=JSON.parse('{"blogPosts":[{"id":"kubernetes/kops-cilium/","metadata":{"permalink":"/kubernetes/kops-cilium/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2023-03-18-kops-cillium.md","source":"@site/blog/2023-03-18-kops-cillium.md","title":"kOps with Cilium","description":"Cilium CNI \uae30\ubc18 kOps \uad6c\uc131","date":"2023-03-18T00:00:00.000Z","formattedDate":"March 18, 2023","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"kOps","permalink":"/tags/k-ops"},{"label":"Cloud9","permalink":"/tags/cloud-9"},{"label":"CloudFormation","permalink":"/tags/cloud-formation"},{"label":"CNI","permalink":"/tags/cni"},{"label":"Networking","permalink":"/tags/networking"},{"label":"Cilium","permalink":"/tags/cilium"}],"readingTime":11.97,"truncated":true,"authors":[{"name":"Jinwoong Kim","title":"Technologist and Cloud Consultant","url":"https://www.linkedin.com/in/ddiiwoong/","imageURL":"https://s.gravatar.com/avatar/e8bfebcbeacb5b9a0c90614e792febf2?s=80","key":"jinwoong"}],"frontMatter":{"layout":"single","title":"kOps with Cilium","comments":true,"classes":"wide","description":"Cilium CNI \uae30\ubc18 kOps \uad6c\uc131","authors":"jinwoong","toc":true,"toc_label":"Table of Contents","slug":"kubernetes/kops-cilium/","date":"2023-03-18T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","kOps","Cloud9","CloudFormation","CNI","Networking","Cilium"]},"nextItem":{"title":"kOps with Cloud9","permalink":"/kubernetes/kops-cloud9/"}},"content":"## PKOS Study #2\\n\\n\uac00\uc2dc\ub2e4\ub2d8\uc758 Production Kubernetes Online Study (=PKOS) 2\uae30 \uba64\ubc84\uac00 \ub418\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ud130\ub514\ub97c \uc9c4\ud589\ud558\uace0 \uc788\ub2e4. \uc774\uc815\ud6c8\ub2d8\uc758 \uc9d1\ud544\ud558\uc2e0 \\"24\ub2e8\uacc4 \uc2e4\uc2b5\uc73c\ub85c \uc815\ubcf5\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\\" \ucc45\uc744 \uae30\ubc18\uc73c\ub85c \ud558\ub294 \uc2a4\ud130\ub514\uc774\uba70 \ucd1d (4+1)\uc8fc\uac04 \uc9c4\ud589\uc774 \ub418\uace0 \uc788\uace0 \ub450\ubc88\uc9f8 \uc2a4\ud130\ub514 \uc77c\uc815\uc774 \ub9c8\ubb34\ub9ac \ub418\uc5c8\ub2e4. \\n\\n\\n\uc774\ubc88 \uc2a4\ud130\ub514 \uacfc\uc81c\uc5d0\uc11c\ub294 Cilium\uc744 \uae30\ubc18\uc73c\ub85c \ud558\ub294 kOps \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uace0 \ub124\ud2b8\uc6cc\ud06c \uad6c\uc131\uc774 \uc5b4\ub5bb\uac8c \ub418\ub294\uc9c0 \ud655\uc778\ud574\ubcf4\uace0\uc790 \ud55c\ub2e4. Cilium\ub294 Linux \ucee4\ub110 \ub0b4\uc5d0 \uac15\ub825\ud55c \ubcf4\uc548 \uac00\uc2dc\uc131 \ubc0f \uc81c\uc5b4 \ub85c\uc9c1\uc744 \ub3d9\uc801\uc73c\ub85c \uc0bd\uc785\ud560 \uc218 \uc788\ub294 BPF\ub77c\ub294 Linux \ucee4\ub110 \uae30\uc220\uc744 \uc0ac\uc6a9\ud558\ub294 CNI\uc774\ub2e4. \\n\\nhttps://cilium.io/\\nhttps://kops.sigs.k8s.io/networking/cilium/\\n\\n## kOps with Cloud9\\n\\n\uae00\uc744 \uc791\uc131\ud558\ub294 \ub0a0\uc9dc \uae30\uc900(23\ub144 3\uc6d4 18\uc77c), \ubc84\uc804\uc740 1.25.11 \uc73c\ub85c \uc9c4\ud589\uc744 \ud55c\ub2e4. \uc9c0\ub09c\ubc88 \uad6c\uc131\uacfc \ub3d9\uc77c\ud558\uac8c Bastion\uc740 Cloud9\uc5d0\uc11c \uad6c\uc131\uc744 \uc9c4\ud589\ud558\uc600\ub2e4. \uc9c0\ub09c\ubc88 \uc791\uc131\ud55c Cloud9 \uae30\ubc18 \uc778\uc2a4\ud134\uc2a4\ub294 \uc544\ub798 \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n[https://github.com/jinwoongk/aws-cloud9-bootstrapping-example/blob/main/example_instancestack.yaml](https://github.com/jinwoongk/aws-cloud9-bootstrapping-example/blob/main/example_instancestack.yaml)\\n\\n\x3c!--truncate--\x3e\\n\\n## Cilium CNI \uae30\ubc18 kOps \ubc30\ud3ec\\n\\nCloud9\uc774 \uad6c\uc131\ub418\uace0 \ub098\uba74 \ud574\ub2f9 \ud658\uacbd\uc5d0\uc11c \uae30\ubcf8 \uad6c\uc131\ud560 Cluster yaml\uc744 \uc791\uc131\ud55c\ub2e4. yaml\uc758 \ud06c\uae30 \ub54c\ubb38\uc5d0 \ubd80\ubd84\uc744 \ub098\ub220\uc11c \uc124\uba85\ud55c\ub2e4.\\n\\n```yaml\\napiVersion: kops.k8s.io/v1alpha2\\nkind: Cluster\\nmetadata:\\n  creationTimestamp: null\\n  name: prosv.kr\\nspec:\\n  kubeProxy:\\n    enabled: false\\n    metricsBindAddress: 0.0.0.0\\n  networking:\\n    cilium:\\n      enableNodePort: true\\n      ipam: eni\\n      hubble:\\n        enabled: true\\n...\\n```\\n\\nkOps\ub97c \uad6c\uc131\ud560 \ub54c\ub294 Cluster CRD\ub97c \uc791\uc131\ud558\ub294\uac83\uc774 \uae30\ubcf8\uc778\ub370 \ud074\ub7ec\uc2a4\ud130 \uc774\ub984\uc740 \ud604\uc7ac \uc0ac\uc6a9\uc911\uc778 \ud14c\uc2a4\ud2b8 \ub3c4\uba54\uc778\uc744 \uc785\ub825\ud55c\ub2e4.   \\n\uadf8\ub9ac\uace0 Cilium \uc744 \uae30\ubcf8 CNI\uc73c\ub85c \uad6c\uc131\ud560 \uc608\uc815\uc774\uae30 \ub54c\ubb38\uc5d0 Kube-Proxy\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ube44\ud65c\uc131\ud654 \ud55c\ub2e4. Cilium\uc774 AWS\uc5d0\uc11c \ud560\ub2f9\ub41c managed IP \uc8fc\uc18c\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uace0 AWS VPC\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c \uac01 \ud30c\ub4dc\uc5d0 \uc9c1\uc811 \uc5f0\uacb0\ud558\ub3c4\ub85d `networking.cilium.ipam=eni` \uc124\uc815\uc744 \ucd94\uac00\ud558\uace0, hubble\uc744 \ud65c\uc131\ud654\ud558\uae30 \uc704\ud55c `networking.cilium.hubble.enabled: true` \uc124\uc815\ub3c4 \ucd94\uac00\ud55c\ub2e4.  \\nhttps://docs.cilium.io/en/stable/network/concepts/ipam/eni/\\n\\n\\ncilium \uc124\uc815\uc5d0\uc11c\uc758 \ub2e4\uc591\ud55c \uc635\uc158\uc740 \ub2e4\uc74c\uc744 \ucc38\uc870\ud560 \uc218 \uc788\ub2e4.  \\nhttps://kops.sigs.k8s.io/networking/cilium/\\n\\n\\n```yaml\\n...\\n  api:\\n    dns: {}\\n  authorization:\\n    rbac: {}\\n  channel: stable\\n  cloudProvider: aws\\n  certManager:\\n    enabled: true\\n  awsLoadBalancerController:\\n    enabled: true\\n  externalDns:\\n    provider: external-dns\\n  metricsServer:\\n    enabled: true\\n  kubeDNS:\\n    provider: CoreDNS\\n    nodeLocalDNS:\\n      enabled: true\\n      memoryRequest: 5Mi\\n      cpuRequest: 25m\\n  configBase: s3://jinwoong-k8s-s3/prosv.kr\\n...\\n```\\n\\n\uc704\uc5d0\uc11c \ucd94\uac00\ud55c \uc124\uc815\uc740 \ub2e4\uc74c\uacfc \uac19\ub2e4.\\n\\n- [certManager \ud65c\uc131\ud654](https://kops.sigs.k8s.io/addons/#cert-manager)\\n- [awsLoadBalancerController \ud65c\uc131\ud654](https://kops.sigs.k8s.io/addons/#aws-load-balancer-controller) \ubc0f [externalDns \uad6c\uc131](https://kops.sigs.k8s.io/cluster_spec/#externaldns)\\n- [metricsServer \ud65c\uc131\ud654](https://kops.sigs.k8s.io/addons/#metrics-server)\\n- [kubeDNS \uad6c\uc131](https://kops.sigs.k8s.io/cluster_spec/#kubedns)\\n- [\uae30\ubcf8 config \uc800\uc7a5\uc18c s3 \uc9c0\uc815](https://kops.sigs.k8s.io/state/#s3-state-store)\\n\\n```yaml\\n...\\n  etcdClusters:\\n  - cpuRequest: 200m\\n    etcdMembers:\\n    - encryptedVolume: true\\n      instanceGroup: control-plane-ap-northeast-2a\\n      name: a\\n    memoryRequest: 100Mi\\n    name: main\\n  - cpuRequest: 100m\\n    etcdMembers:\\n    - encryptedVolume: true\\n      instanceGroup: control-plane-ap-northeast-2a\\n      name: a\\n    memoryRequest: 100Mi\\n    name: events\\n  iam:\\n    allowContainerRegistry: true\\n    legacy: false\\n  kubelet:\\n    anonymousAuth: false\\n    maxPods: 100\\n...\\n```\\n\uc704\uc5d0\uc11c \ucd94\uac00\ud55c \uc124\uc815\uc740 \ub2e4\uc74c\uacfc \uac19\ub2e4.\\n\\n- [etcd \ud074\ub7ec\uc2a4\ud130 \uad6c\uc131](https://kops.sigs.k8s.io/cluster_spec/#etcdclusters)\\n  - instancGroup CRD\uc5d0\uc11c \uc6d0\ud558\ub294 \uba38\uc2e0\ud0c0\uc785, \uae30\ubcf8 \ub178\ub4dc \uc774\ubbf8\uc9c0, \ub178\ub4dc \uac1c\uc218 \ub4f1\uc744 \uad6c\uc131\ud560 \uc218 \uc788\ub2e4.\\n- [ECR \uc811\uadfc\uc744 \uc704\ud55c IAM \uad6c\uc131](https://kops.sigs.k8s.io/iam_roles/#access-to-aws-ec2-container-registry-ecr)\\n- [kubelet \uad6c\uc131](https://kops.sigs.k8s.io/cluster_spec/#kubelet)\\n\\n\\n```yaml\\n...\\n  kubernetesApiAccess:\\n  - 0.0.0.0/0\\n  - ::/0\\n  kubernetesVersion: 1.24.11\\n  masterPublicName: api.prosv.kr\\n  networkCIDR: 172.30.0.0/16\\n  nonMasqueradeCIDR: 100.64.0.0/10\\n  sshAccess:\\n  - 0.0.0.0/0\\n  - ::/0\\n  subnets:\\n  - cidr: 172.30.32.0/19\\n    name: ap-northeast-2a\\n    type: Public\\n    zone: ap-northeast-2a\\n  - cidr: 172.30.64.0/19\\n    name: ap-northeast-2c\\n    type: Public\\n    zone: ap-northeast-2c\\n  topology:\\n    dns:\\n      type: Public\\n    masters: public\\n    nodes: public\\n...\\n```\\n\\n\uc704\uc5d0\uc11c \ucd94\uac00\ud55c \uc124\uc815\uc740 \ub2e4\uc74c\uacfc \uac19\ub2e4.\\n\\n- [kube-API \uc811\uadfc\uc81c\uc5b4 \uc124\uc815](https://kops.sigs.k8s.io/cluster_spec/#kubernetesapiaccess)\\n- [\uae30\uc874 VPC\ub0b4 CIDR \uc0ac\uc6a9\uc744 \uc704\ud55c \uad6c\uc131](https://kops.sigs.k8s.io/run_in_existing_vpc/)\\n- [\ub124\ud2b8\uc6cc\ud06c \ud1a0\ud3f4\ub85c\uc9c0 \uad6c\uc131](https://kops.sigs.k8s.io/topology/)\\n\\n\\nInstanceGroup \uacfc SSHCredential \ub97c \uc791\uc131\ud55c\ub2e4.\\n\\n```yaml\\napiVersion: kops.k8s.io/v1alpha2\\nkind: InstanceGroup\\nmetadata:\\n  creationTimestamp: null\\n  labels:\\n    kops.k8s.io/cluster: prosv.kr\\n  name: control-plane-ap-northeast-2a\\nspec:\\n  image: 099720109477/ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-20230302\\n  instanceMetadata:\\n    httpPutResponseHopLimit: 3\\n    httpTokens: required\\n  machineType: t3.medium\\n  maxSize: 1\\n  minSize: 1\\n  role: Master\\n  subnets:\\n  - ap-northeast-2a\\n```\\n\\n```yaml\\napiVersion: kops.k8s.io/v1alpha2\\nkind: InstanceGroup\\nmetadata:\\n  creationTimestamp: null\\n  labels:\\n    kops.k8s.io/cluster: prosv.kr\\n  name: nodes-ap-northeast-2a\\nspec:\\n  image: 099720109477/ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-20230302\\n  instanceMetadata:\\n    httpPutResponseHopLimit: 1\\n    httpTokens: required\\n  machineType: t3.medium\\n  maxSize: 1\\n  minSize: 1\\n  role: Node\\n  subnets:\\n  - ap-northeast-2a\\n```\\n\\n```yaml\\napiVersion: kops.k8s.io/v1alpha2\\nkind: InstanceGroup\\nmetadata:\\n  creationTimestamp: null\\n  labels:\\n    kops.k8s.io/cluster: prosv.kr\\n  name: nodes-ap-northeast-2c\\nspec:\\n  image: 099720109477/ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-20230302\\n  instanceMetadata:\\n    httpPutResponseHopLimit: 1\\n    httpTokens: required\\n  machineType: t3.medium\\n  maxSize: 1\\n  minSize: 1\\n  role: Node\\n  subnets:\\n  - ap-northeast-2c\\n```\\n\\n```yaml\\napiVersion: kops.k8s.io/v1alpha2\\nkind: SSHCredential\\nmetadata:\\n  creationTimestamp: null\\n  labels:\\n    kops.k8s.io/cluster: prosv.kr\\n  name: admin\\nspec:\\n  publicKey: ssh-rsa AAAA.....\\n    root@ip-172-31-50-160\\n```\\n\\n\uc791\uc131\ud55c \ubaa8\ub4e0 \ud30c\uc77c\uc744 \ud558\ub098\uc758 \ud30c\uc77c\ub85c \uc800\uc7a5\ud55c \ud6c4 \ub2e4\uc74c\uacfc \uac19\uc774 kops CLI\ub85c \ubc30\ud3ec\ub97c \uc9c4\ud589\ud55c\ub2e4. \uc804\uccb4 \ud30c\uc77c\uc740 \ub2e4\uc74c \ub9c1\ud06c \uc608\uc2dc\ub97c \ucc38\uc870\ud55c\ub2e4.  \\nhttps://raw.githubusercontent.com/ddiiwoong/kops-config/main/kops.yaml\\n\\n\\n```sh\\nkops create -f kops.yaml\\n\\nkops update cluster --name prosv.kr --ssh-public-key ~/.ssh/id_rsa.pub --yes\\n```\\n\\n\ubc30\ud3ec\uacfc \uc644\ub8cc\ub41c \uc774\ud6c4\uc5d0 \uad6c\uc131\ub41c \ud30c\ub4dc\ub97c \ud655\uc778\ud574\ubcf4\uba74 \ub300\ubd80\ubd84\uc740 \uae30\uc874 VPC CNI \uad6c\uc131\uc694\uc18c\uc640 \ub3d9\uc77c\ud558\uc9c0\ub9cc \uba87\uac00\uc9c0 \ucc28\uc774\uc810\uc740 \ub178\ub4dc\ub9c8\ub2e4 \uad6c\uc131\ub418\uc5b4 \uc788\ub358 kube-proxy \ub300\uc2e0 cilium \ub370\ubaac\uc14b \ud30c\ub4dc\uc640 cilium \uc624\ud37c\ub808\uc774\ud130 \ud30c\ub4dc\uac00 \uad6c\uc131\ub41c\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n```sh\\n$ kubectl get pod -n kube-system\\nNAME                                            READY   STATUS    RESTARTS      AGE\\n...\\ncilium-l6j9d                                    1/1     Running   0             24h\\ncilium-operator-697c58f5d5-8kk8m                1/1     Running   0             24h\\ncilium-q9j27                                    1/1     Running   0             24h\\ncilium-rx8zx                                    1/1     Running   0             24h\\n...\\nexternal-dns-598d5f5c76-pqp6r                   1/1     Running   0             24h\\nhubble-relay-85df7fbcbf-79n52                   1/1     Running   0             24h\\nhubble-relay-85df7fbcbf-rfchd                   1/1     Running   0             24h\\nhubble-ui-5986c56d45-wn95w                      3/3     Running   0             23h\\n...\\n```\\n\\n## CNI \ud14c\uc2a4\ud2b8\\n\\n\ud14c\uc2a4\ud2b8\uc6a9 netshoot \ud30c\ub4dc\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```yaml\\ncat <<EOF | kubectl create -f -\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: netshoot-pod\\nspec:\\n  replicas: 2\\n  selector:\\n    matchLabels:\\n      app: netshoot-pod\\n  template:\\n    metadata:\\n      labels:\\n        app: netshoot-pod\\n    spec:\\n      containers:\\n      - name: netshoot-pod\\n        image: nicolaka/netshoot\\n        command: [\\"tail\\"]\\n        args: [\\"-f\\", \\"/dev/null\\"]\\n      terminationGracePeriodSeconds: 0\\nEOF\\n```\\n\\n\ubc30\ud3ec\ud55c netshoot \ud30c\ub4dc\uc758 IP\ub97c \ud655\uc778\ud55c\ub2e4.\\n\\n```sh\\n# kubectl get pod -o=custom-columns=NAME:.metadata.name,IP:.status.podIP\\nNAME                            IP\\nnetshoot-pod-7757d5dd99-9mb7s   172.30.47.42\\nnetshoot-pod-7757d5dd99-df68s   172.30.68.92\\n```\\n\\nhubble \uc811\uadfc\uc744 \uc704\ud574 https://docs.cilium.io/en/stable/gettingstarted/hubble_setup/ \uc744 \ucc38\uc870\ud574\uc11c hubble, cilium CLI\ub97c Cloud9\uc5d0 \uc124\uce58\ud55c\ub2e4. Hubble API\uc5d0 \uc561\uc138\uc2a4\ud558\ub824\uba74 \ub85c\uceec \uba38\uc2e0\uc5d0\uc11c Hubble \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \ud3ec\ud2b8 \ud3ec\uc6cc\ub4dc\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```sh\\n$ cilium hubble port-forward&\\nForwarding from 0.0.0.0:4245 -> 4245\\nForwarding from [::]:4245 -> 4245\\n\\n$ hubble status\\nHealthcheck (via localhost:4245): Ok\\nCurrent/Max Flows: 12,285/12,285 (100.00%)\\nFlows/s: 12.41\\nConnected Nodes: 3/3\\n```\\n\\n\uc678\ubd80\ub85c \ud1b5\uc2e0\ud558\ub294 \ud2b8\ub798\ud53d\uc744 \ubc1c\uc0dd\uc2dc\ud0a4\uace0 `hubble observe` \uba85\ub839\uc744 \ud1b5\ud574 flow\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```\\n$ kubectl exec -it netshoot-pod-7757d5dd99-k4pf7 -- curl -s wttr.in/seoul                                              \\n\\n$ hubble observe --pod netshoot-pod-7757d5dd99-k4pf7                                                                   \\nMar 18 17:24:57.786: default/netshoot-pod-7757d5dd99-k4pf7:35019 (ID:22269) -> 169.254.20.10:53 (world) to-stack FORWARDED (UDP)\\nMar 18 17:24:57.788: default/netshoot-pod-7757d5dd99-k4pf7:35019 (ID:22269) <- 169.254.20.10:53 (world) to-endpoint FORWARDED (UDP)\\nMar 18 17:24:57.788: default/netshoot-pod-7757d5dd99-k4pf7:51562 (ID:22269) -> 169.254.20.10:53 (world) to-stack FORWARDED (UDP)\\nMar 18 17:24:57.789: default/netshoot-pod-7757d5dd99-k4pf7:51562 (ID:22269) <- 169.254.20.10:53 (world) to-endpoint FORWARDED (UDP)\\nMar 18 17:24:57.789: default/netshoot-pod-7757d5dd99-k4pf7:57074 (ID:22269) -> 169.254.20.10:53 (world) to-stack FORWARDED (UDP)\\nMar 18 17:24:57.790: default/netshoot-pod-7757d5dd99-k4pf7:57074 (ID:22269) <- 169.254.20.10:53 (world) to-endpoint FORWARDED (UDP)\\nMar 18 17:24:57.790: default/netshoot-pod-7757d5dd99-k4pf7:49895 (ID:22269) -> 169.254.20.10:53 (world) to-stack FORWARDED (UDP)\\nMar 18 17:24:57.791: default/netshoot-pod-7757d5dd99-k4pf7:49895 (ID:22269) <- 169.254.20.10:53 (world) to-endpoint FORWARDED (UDP)\\nMar 18 17:24:57.792: default/netshoot-pod-7757d5dd99-k4pf7:42920 (ID:22269) -> 169.254.20.10:53 (world) to-stack FORWARDED (UDP)\\nMar 18 17:24:57.794: default/netshoot-pod-7757d5dd99-k4pf7:42920 (ID:22269) <- 169.254.20.10:53 (world) to-endpoint FORWARDED (UDP)\\nMar 18 17:24:58.050: default/netshoot-pod-7757d5dd99-k4pf7:40550 (ID:22269) -> 5.9.243.187:80 (world) to-stack FORWARDED (TCP Flags: SYN)\\nMar 18 17:24:58.528: default/netshoot-pod-7757d5dd99-k4pf7:40550 (ID:22269) -> 5.9.243.187:80 (world) to-stack FORWARDED (TCP Flags: ACK, FIN)\\nMar 18 17:24:58.766: default/netshoot-pod-7757d5dd99-k4pf7:40550 (ID:22269) <- 5.9.243.187:80 (world) to-endpoint FORWARDED (TCP Flags: ACK, FIN)\\nMar 18 17:24:58.766: default/netshoot-pod-7757d5dd99-k4pf7:40550 (ID:22269) -> 5.9.243.187:80 (world) to-stack FORWARDED (TCP Flags: ACK)\\n```\\n\\n\uc774\ubc88\uc5d0\ub294 \ucd5c\ub300 \ud30c\ub4dc \uac1c\uc218\ub97c \uccb4\ud06c\ud558\uae30 \uc704\ud574 replica\ub97c 20\uac1c\ub85c \uc99d\uac00\uc2dc\ud0a8\ub2e4. \ud558\uc9c0\ub9cc \uc544\ub798\uc640 \uac19\uc774 \uba87\uac1c\uc758 \ud30c\ub4dc\uac00 `ContainerCreating` \uc0c1\ud0dc\uc778 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```sh\\n$ kubectl scale deployment/netshoot-pod --replicas=20\\ndeployment.apps/netshoot-pod scaled\\n$ kubectl get pod\\nNAME                            READY   STATUS              RESTARTS   AGE\\nnetshoot-pod-7757d5dd99-2x29s   0/1     c   0          9s\\nnetshoot-pod-7757d5dd99-5j9qc   1/1     Running             0          34m\\nnetshoot-pod-7757d5dd99-9996z   1/1     Running             0          26m\\nnetshoot-pod-7757d5dd99-9dnkg   1/1     Running             0          34m\\nnetshoot-pod-7757d5dd99-9k92w   0/1     ContainerCreating   0          23s\\nnetshoot-pod-7757d5dd99-9mb7s   1/1     Running             0          43m\\nnetshoot-pod-7757d5dd99-c2292   1/1     Running             0          35m\\nnetshoot-pod-7757d5dd99-cf7dv   1/1     Running             0          34m\\nnetshoot-pod-7757d5dd99-df68s   1/1     Running             0          43m\\nnetshoot-pod-7757d5dd99-h9fjm   0/1     ContainerCreating   0          23s\\nnetshoot-pod-7757d5dd99-hrkcs   0/1     ContainerCreating   0          23s\\nnetshoot-pod-7757d5dd99-jkc6v   1/1     Running             0          34m\\nnetshoot-pod-7757d5dd99-jkx7j   1/1     Running             0          23s\\nnetshoot-pod-7757d5dd99-k4pf7   1/1     Running             0          26m\\nnetshoot-pod-7757d5dd99-lbzvs   1/1     Running             0          35m\\nnetshoot-pod-7757d5dd99-nb4pf   1/1     Running             0          34m\\nnetshoot-pod-7757d5dd99-r4bhf   1/1     Running             0          26m\\nnetshoot-pod-7757d5dd99-t8rt6   1/1     Running             0          26m\\nnetshoot-pod-7757d5dd99-x2d62   1/1     Running             0          26m\\nnetshoot-pod-7757d5dd99-zm7vc   1/1     Running             0          35m\\n```\\n\\n\ud30c\ub4dc\uc758 \uc0c1\ud0dc\ub97c `describe` \uba85\ub839\uc73c\ub85c \uc0b4\ud3b4\ubcf4\uba74 cilium agent\uac00 AWS IPAM \uacfc \uc5f0\ub3d9\ub418\uc5b4 IP \ubd80\uc871\uc73c\ub85c \uc778\ud574 \ud560\ub2f9\uc774 \ub418\uc9c0 \uc54a\uc74c\uc744 \uc54c \uc218 \uc788\ub2e4.\\n\\n```sh\\n$ kubectl describe pod netshoot-pod-7757d5dd99-9k92w\\n...\\n  Warning  FailedCreatePodSandBox  3m43s (x85 over 21m)  kubelet            (combined from similar events): Failed to create pod sandbox: rpc error: code = Unknown desc = failed to setup network for sandbox \\"eaced767b8747e09656744a3249a5e1c092fea7ba45302abdbf8086e3297c07d\\": plugin type=\\"cilium-cni\\" name=\\"cilium\\" failed (add): unable to allocate IP via local cilium agent: [POST /ipam][502] postIpamFailure  No more IPs availabl\\n```\\n\\nAWS VPC CNI \ud658\uacbd\uc5d0\uc11c \ucd5c\ub300 \ud30c\ub4dc \uc0ac\uc6a9 \uac00\ub2a5 \uacc4\uc0b0\uc2dd\uc740 ENI \uc790\uccb4 IP\ub97c \uc81c\uc678\ud558\uace0 `aws-node` \uc640 `kube-proxy` \ud30c\ub4dc\ub97c \uace0\ub824\ud558\uc5ec \ub2e4\uc74c\uacfc \uac19\uc740 \uacf5\uc2dd\uc73c\ub85c \uacc4\uc0b0\uc744 \ud558\uac8c \ub41c\ub2e4.  \\nhttps://github.com/awslabs/amazon-eks-ami/blob/master/files/eni-max-pods.txt\\n\\n```\\n((MaxENI * (IPv4addr - 1)) + 2)\\nt3.medium \uacbd\uc6b0 : ((3 * (6 - 1) + 2 ) = 17\uac1c >> aws-node \uc640 kube-proxy 2\uac1c \uc81c\uc678\ud558\uba74 15\uac1c\\n```\\n\\nIPAM\uc744 \uc124\uc815\ud55c Cilium\uc740 [AWS ENI](https://docs.cilium.io/en/stable/network/concepts/ipam/eni/) \uae30\uc900\uc744 \ub530\ub77c\uac04\ub2e4. \uacf5\uc2dd \ubb38\uc11c\uc5d0\uc11c\ub294 \uc544\uc9c1 \ud655\uc778\ud560 \uc218 \uc5c6\uc9c0\ub9cc [GitHub issue](https://github.com/cilium/cilium/issues/10426)\ub85c \ucd94\uc815\ud574\ubcf4\uba74 `health`, `router` `CiliumInternalIP` 3\uac1c\uc758 IP\ub97c \uc81c\uc678\ud558\uae30 \ub54c\ubb38\uc5d0 t3.medium\uc758 \uacbd\uc6b0\ub77c\uba74 3\uac1c\uc758 ENI \ub2f9 6\uac1c\uc758 \uc544\uc774\ud53c\ub97c \ud560\ub2f9\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc2e4\uc81c \uad6c\uc131 \uac00\ub2a5\ud55c \uac1c\uc218\ub294 12\uac1c \uc0dd\uc131\uc774 \uac00\ub2a5\ud558\ub2e4.\\n\\n```\\n(MaxENI * (IPv4addr - 1))\\nt3.medium \uacbd\uc6b0 : ((3 * (6 - 1)) = 15\uac1c >> health, router, CiliumInternalIP 3\uac1c \uc81c\uc678\ud558\uba74 12\uac1c \ud30c\ub4dc\uac00 \uc0dd\uc131\uc774 \uac00\ub2a5\ud558\ub2e4. \\n```\\n\\n\uc774\ub97c ciliumnode CRD\ub97c \ud1b5\ud574\uc11c\ub3c4 \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4. \\n\\n\uccab\ubc88\uc9f8 \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \ud560\ub2f9\ub41c `InternalIP`, `ExternalIP` \uc640 \ub0b4\ubd80\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\ub294 `CiliumInternalIP` \ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```yaml\\nkubectl get ciliumnode i-00b3ebc1b78f19739 -o yaml\\n\\napiVersion: v1\\nitems:\\n- apiVersion: cilium.io/v2\\n  kind: CiliumNode\\n  metadata:\\n    ...\\n  spec:\\n    addresses:\\n    - ip: 172.30.60.14\\n      type: InternalIP\\n    - ip: 13.124.209.231\\n      type: ExternalIP\\n    - ip: 172.30.44.153\\n      type: CiliumInternalIP\\n\\n```\\n\\n`spec.ipam`\uc5d0\uc11c\ub294 \uc704\uc5d0\uc11c \uc5b8\uae09\ud55c \ub300\ub85c 15\uac1c\uc758 \ud560\ub2f9\uac00\ub2a5\ud55c IP\ub97c \ubcf4\uc5ec\uc900\ub2e4.\\n\\n\\n```yaml\\n    ...\\n    ipam:\\n      podCIDRs:\\n      - 100.96.2.0/24\\n      pool:\\n        172.30.32.43:\\n          resource: eni-0717341e6470f76ce\\n        172.30.32.217:\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.36.179:\\n          resource: eni-0717341e6470f76ce\\n        172.30.38.188:\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.38.221:\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.42.57:\\n          resource: eni-03b280d75b6d6cb09\\n        172.30.44.103:\\n          resource: eni-0717341e6470f76ce\\n        172.30.44.153:\\n          resource: eni-03b280d75b6d6cb09\\n        172.30.44.201:\\n          resource: eni-0717341e6470f76ce\\n        172.30.47.42:\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.47.95:\\n          resource: eni-03b280d75b6d6cb09\\n        172.30.53.208:\\n          resource: eni-03b280d75b6d6cb09\\n        172.30.55.231:\\n          resource: eni-0717341e6470f76ce\\n        172.30.61.93:\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.63.46:\\n          resource: eni-03b280d75b6d6cb09\\n      pre-allocate: 8\\n    ...\\n```\\n\\n`status.ipam`\uc5d0\uc11c\ub294 \ud604\uc7ac \ud560\ub2f9\ub418\uc5b4 \uc788\ub294 12\uac1c\uc758 IP\ud604\ud669\uc744 \ubcfc\uc218 \uc788\ub2e4.\\n\\n```yaml\\n    ipam:\\n      operator-status: {}\\n      used:\\n        172.30.32.43:\\n          owner: default/netshoot-pod-7757d5dd99-x2d62\\n          resource: eni-0717341e6470f76ce\\n        172.30.32.217:\\n          owner: kube-system/metrics-server-5f65d889cd-kg8sb\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.36.179:\\n          owner: default/netshoot-pod-7757d5dd99-9996z\\n          resource: eni-0717341e6470f76ce\\n        172.30.38.188:\\n          owner: default/netshoot-pod-7757d5dd99-9dnkg\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.38.221:\\n          owner: kube-system/coredns-68cd66b8cc-2bmzj\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.42.57:\\n          owner: kube-system/ebs-csi-node-t9dk5\\n          resource: eni-03b280d75b6d6cb09\\n        172.30.44.103:\\n          owner: default/netshoot-pod-7757d5dd99-5j9qc\\n          resource: eni-0717341e6470f76ce\\n        172.30.44.153:\\n          owner: router\\n          resource: eni-03b280d75b6d6cb09\\n        172.30.44.201:\\n          owner: default/netshoot-pod-7757d5dd99-c2292\\n          resource: eni-0717341e6470f76ce\\n        172.30.47.42:\\n          owner: default/netshoot-pod-7757d5dd99-9mb7s\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.53.208:\\n          owner: default/netshoot-pod-7757d5dd99-zm7vc\\n          resource: eni-03b280d75b6d6cb09\\n        172.30.55.231:\\n          owner: kube-system/hubble-relay-85df7fbcbf-79n52\\n          resource: eni-0717341e6470f76ce\\n        172.30.61.93:\\n          owner: default/netshoot-pod-7757d5dd99-jkc6v\\n          resource: eni-0483a896a7c0b49f3\\n        172.30.63.46:\\n          owner: health\\n          resource: eni-03b280d75b6d6cb09\\n```\\n\\n## \uc815\ub9ac\\n\\n\uc774\ubc88\uc5d0\ub294 kOps \uad6c\uc131\uc744 Cilium CNI \uae30\ubc18\uc73c\ub85c \uad6c\uc131\ud558\uace0 hubble\uc744 \ud1b5\ud574 flow\ub97c \ud655\uc778\ud558\uace0 AWS IPAM API \uc5f0\ub3d9\uc744 \ud1b5\ud55c \ud30c\ub4dc IP\ud560\ub2f9 \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud574\ubd24\ub2e4.\\n\\n\\n> \ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4."},{"id":"kubernetes/kops-cloud9/","metadata":{"permalink":"/kubernetes/kops-cloud9/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2023-03-08-kops-cloud9.md","source":"@site/blog/2023-03-08-kops-cloud9.md","title":"kOps with Cloud9","description":"Cloud9 \uae30\ubc18 kOps \ud658\uacbd \uad6c\uc131","date":"2023-03-08T00:00:00.000Z","formattedDate":"March 8, 2023","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"kOps","permalink":"/tags/k-ops"},{"label":"Cloud9","permalink":"/tags/cloud-9"},{"label":"CloudFormation","permalink":"/tags/cloud-formation"},{"label":"HPA","permalink":"/tags/hpa"}],"readingTime":9.935,"truncated":true,"authors":[{"name":"Jinwoong Kim","title":"Technologist and Cloud Consultant","url":"https://www.linkedin.com/in/ddiiwoong/","imageURL":"https://s.gravatar.com/avatar/e8bfebcbeacb5b9a0c90614e792febf2?s=80","key":"jinwoong"}],"frontMatter":{"layout":"single","title":"kOps with Cloud9","comments":true,"classes":"wide","description":"Cloud9 \uae30\ubc18 kOps \ud658\uacbd \uad6c\uc131","authors":"jinwoong","toc":true,"toc_label":"Table of Contents","slug":"kubernetes/kops-cloud9/","date":"2023-03-08T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","kOps","Cloud9","CloudFormation","HPA"]},"prevItem":{"title":"kOps with Cilium","permalink":"/kubernetes/kops-cilium/"},"nextItem":{"title":"EKS CNI Custom Networking","permalink":"/kubernetes/eks-cni-custom/"}},"content":"## PKOS Study\\n\\n\uac00\uc2dc\ub2e4\ub2d8\uc758 Production Kubernetes Online Study (=PKOS) 2\uae30 \uba64\ubc84\uac00 \ub418\uc11c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ud130\ub514\ub97c \uc9c4\ud589\ud558\uace0 \uc788\ub2e4. \uc774\uc815\ud6c8\ub2d8\uc758 \uc9d1\ud544\ud558\uc2e0 \\"24\ub2e8\uacc4 \uc2e4\uc2b5\uc73c\ub85c \uc815\ubcf5\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\\" \ucc45\uc744 \uae30\ubc18\uc73c\ub85c \ud558\ub294 \uc2a4\ud130\ub514\uc774\uba70 \ucd1d 4\uc8fc\uac04 \uc9c4\ud589\uc774 \ub418\uace0 \uc788\uace0 \uccab\ubc88\uc9f8 \uc2a4\ud130\ub514 \uc77c\uc815\uc774 \ub9c8\ubb34\ub9ac \ub418\uc5c8\ub2e4. \uc2e4\uc81c\ub85c kubeadm, kubespray\ub85c\ub294 \uacbd\ud5d8\uc774 \uc788\uc9c0\ub9cc \uc774\ubc88 \uc2a4\ud130\ub514\uc5d0\uc11c \ub300\ubd80\ubd84\uc758 \uc2e4\uc2b5\uc740 kOps\ub85c \uad6c\uc131\uc774 \ub418\uc5b4 \uc0c8\ub85c\uc6b4 \ubc29\uc2dd\uc73c\ub85c \uc124\uce58\ub97c \uc9c4\ud589\ud588\ub2e4.\\n\\n## kOps\\n\\n-   **K**ubernetes **Op**eration**s** (kOps) - Production Grade k8s Installation, Upgrades and Management\\n\\nhttps://kops.sigs.k8s.io/\\nhttps://github.com/kubernetes/kops\\n\\nkOps\ub294 \ud074\ub77c\uc6b0\ub4dc \ud50c\ub7ab\ud3fc(aws, gcp, azure \ub4f1)\uc5d0\uc11c \uc27d\uac8c k8s \ub97c \uc124\uce58\ud560 \uc218 \uc788\ub3c4\ub85d \ub3c4\uc640\uc8fc\ub294 \ub3c4\uad6c\ub85c \uc11c\ubc84 \uc778\uc2a4\ud134\uc2a4\uc640 \ub124\ud2b8\uc6cc\ud06c \ub9ac\uc18c\uc2a4 \ub4f1\uc744 \ud074\ub77c\uc6b0\ub4dc\uc5d0\uc11c \uc790\ub3d9\uc73c\ub85c \uc0dd\uc131\ud574 k8s \ub97c \uc124\uce58\ud558\ub294 \ub3c4\uad6c\uc774\uace0 kOps\ub294 AWS \uc758 \ub2e4\uc591\ud55c \uc11c\ube44\uc2a4\uc640 \uc720\uc5f0\ud558\uac8c \uc5f0\ub3d9\ub418\uc5b4 \uc0ac\uc6a9 \uac00\ub2a5\ud55c\uac8c \uc7a5\uc810\uc774\ub2e4. \\n\\n\uae00\uc744 \uc791\uc131\ud558\ub294 \ub0a0\uc9dc \uae30\uc900(23\ub144 3\uc6d4 5\uc77c), \ubc84\uc804\uc740 1.25.3 \uc73c\ub85c \uc9c4\ud589\uc744 \ud55c\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n## Bastion \ud658\uacbd \uad6c\uc131\\n\\nBasition\uc740 Cloud9\uc73c\ub85c \uad6c\uc131\uc744 \ud588\ub2e4. https://github.com/aws-samples/aws-cloud9-bootstrapping-example \ub97c \ucc38\uace0\ud558\uc5ec \uad6c\uc131\ud588\uace0 \uc5ec\ub7ec \ud234\uc744 bootstrap \ud615\ud0dc\ub85c \uad6c\uc131\ud558\uae30 \uc704\ud574 \ucd94\uac00\uc801\uc73c\ub85c \uc5ec\ub7ec \ub3c4\uad6c\ub4e4\uc744 \uc124\uce58\ud55c\ub2e4.\\n\\n- kubectl\\n- kops\\n- awscli v2\\n- k9s\\n- helm\\n- jq, git, htop, tree, gettext, bash-completion \ub4f1\\n\\n\uc790\uc138\ud55c \ub0b4\uc6a9\uc740 https://github.com/jinwoongk/aws-cloud9-bootstrapping-example/blob/main/example_instancestack.yaml \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \ud574\ub2f9 yaml \uc5d0\uc11c \ubcf8\uc778\uc774 \uc8fc\ub85c \uc811\uc18d\ud558\ub294 Console \uc811\uc18d \uc815\ubcf4(ARN)\uc744 \uc544\ub798 `OwnerArn` \uad6c\ubb38\uacfc \uac19\uc774 \uc5c5\ub370\uc774\ud2b8\ub97c \uc9c4\ud589\ud55c\ub2e4. \\n\\n```yaml\\n################## INSTANCE #####################\\n  ExampleC9InstanceProfile:\\n    Type: AWS::IAM::InstanceProfile\\n    Properties:\\n      Path: \\"/\\"\\n      Roles:\\n      - Ref: ExampleC9Role\\n\\n  ExampleC9Instance:\\n    Description: \\"-\\"\\n    DependsOn: ExampleC9BootstrapAssociation\\n    Type: AWS::Cloud9::EnvironmentEC2\\n    Properties:\\n      Description: AWS Cloud9 instance for Examples\\n      AutomaticStopTimeMinutes: 3600\\n      InstanceType:\\n        Ref: ExampleC9InstanceType\\n      Name:\\n        Ref: AWS::StackName\\n      # OwnerArn: !If [Create3rdPartyResources, !Ref ExampleOwnerArn, !Ref \\"AWS::NoValue\\" ]\\n      OwnerArn: \\"arn:aws:sts::265664683898:assumed-role/AWSReservedSSO_AWSAdministratorAccess_574b6756fcc31821/jinwoong\\"\\n```\\n\\n\ud574\ub2f9 yaml \uc744 \uac00\uc9c0\uace0 \uc544\ub798 \uba85\ub839\uc73c\ub85c Cloudformation\uc744 \uc2e4\ud589\ud558\uac8c \ub418\uba74 \uc5ec\ub7ec\uac00\uc9c0 \uc720\ud2f8\uc774 \uc124\uce58\ub41c \uc0c1\ud0dc\uc758 Cloud9 \uc778\uc2a4\ud134\uc2a4\uac00 \uc0dd\uc131\ub418\uac8c \ub41c\ub2e4. \\n\\n```sh\\naws cloudformation deploy  --stack-name kops-test --template ./example_instancestack.yaml\\n```\\n\\nCloud9\uc744 \uc704\ud574 \uc0dd\uc131\ub41c \uad8c\ud55c\uc744 \ud65c\uc6a9\ud558\uae30 \uc704\ud574 Cloud9 \uc124\uc815\uc5d0\uc11c AWS managed temporary credentials \uae30\ub2a5\uc744 \ube44\ud65c\uc131\ud654 \ud558\uc790.\\n\\n![cloud9](/img/cloud9_credential.png)\\n\\n\\n## kOps \ubc30\ud3ec\\n\\nAWS \ud658\uacbd\uc5d0 kOps\ub97c \ubc30\ud3ec\ud558\uae30 \uc704\ud574\uc11c\ub294 \uc544\ub798\uc640 \uac19\uc740 IAM \uad8c\ud55c\uc774 \ud544\uc694\ud558\ub2e4. \\n\\n- AmazonEC2FullAccess\\n- AmazonRoute53FullAccess \\n- AmazonS3FullAccess \\n- IAMFullAccess \\n- AmazonVPCFullAccess \\n- AmazonSQSFullAccess \\n- AmazonEventBridgeFullAccess\\n\\nkOps\ub294 Cluster State \uc800\uc7a5\uc744 \uc704\ud55c S3 \ubc84\ud0b7\uacfc DNS \ub808\ucf54\ub4dc\ub97c \ud65c\uc6a9\ud574\uc11c \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\uc744 \ud558\uac8c \ub418\ub294\ub370 \ud3b8\uc758\ub97c \uc704\ud574 \uac1c\uc778 \uc0ac\uc6a9\uc911\uc778 \ub3c4\uba54\uc778\uc758 NS\uc11c\ubc84\ub97c Route53\uc5d0 \uc5f0\uacb0\ud558\uace0 \uc774\ubbf8 \uc0dd\uc131\ud574\ub193\uc740 \ubc84\ud0b7\uc744 \uac00\uc9c0\uace0 \ubc30\ud3ec\ub97c \uc9c4\ud589\ud55c\ub2e4.\\n\\n```sh\\n# \ubc30\ud3ec \uc2dc \ucc38\uace0\ud560 \uc815\ubcf4\ub97c \ud658\uacbd \ubcc0\uc218\uc5d0 \uc800\uc7a5\\n## export NAME=<\uc790\uc2e0\uc758 \ud37c\ube14\ub9ad \ud638\uc2a4\ud305 \uba54\uc778 \uc8fc\uc18c>\\n## export KOPS_STATE_STORE=s3://(\ubc84\ud0b7 \uc774\ub984)\\nexport KOPS_CLUSTER_NAME=prosv.kr\\nexport KOPS_STATE_STORE=s3://jinwoong-k8s-s3\\nexport AWS_PAGER=\\"\\"\\nexport REGION=ap-northeast-2\\n```\\n\\nCloud9 \ud658\uacbd\uc5d0\uc11c `kops` \uba85\ub839\uc744 \ud1b5\ud574 \ud074\ub7ec\uc2a4\ud130\ub97c \uad6c\uc131\ud558\uac8c \ub418\ub294\ub370 `VPC CNI`\ub97c \uc0ac\uc6a9\ud558\uae30 \uc704\ud574 `amazonvpc`\ub85c \uad6c\uc131\ud558\uace0 `1.24` \ubc84\uc804\uc758 master \ub178\ub4dc 1\ub300, work \ub178\ub4dc 3\ub300\ub97c \uc0dd\uc131\ud55c\ub2e4. \\n\\n```sh\\n$ kops create cluster --zones=\\"$REGION\\"a,\\"$REGION\\"c \\\\\\n--networking amazonvpc --cloud aws \\\\\\n--master-size t3.medium --node-size t3.medium --node-count=3 \\\\\\n--network-cidr 172.30.0.0/16 --ssh-public-key ~/.ssh/id_rsa.pub \\\\\\n--name=$KOPS_CLUSTER_NAME --discovery-store=s3://jinwoong-k8s-s3 \\\\\\n--kubernetes-version \\"1.24.10\\" -y\\n```\\n\\n\ud074\ub7ec\uc2a4\ud130\uac00 \uc0dd\uc131\ub418\ub294 \ub3d9\uc548 \uc720\ud6a8\uc131\uc744 \uccb4\ud06c\ud558\uae30 \uc704\ud574 10\ubd84\uac04 \ub300\uae30\ud558\uace0 \uad6c\uc131\uc774 \uc644\ub8cc\ub418\uba74 \uc544\ub798\uc640 \uac19\uc774 \ucd08\uae30 \uad6c\uc131\ud55c \ud074\ub7ec\uc2a4\ud130\uac00 ready \uc0c1\ud0dc\uc778\uc9c0 \uc54c \uc218 \uc788\ub2e4. `kops get` \uba85\ub839\uc744 \ud1b5\ud574 \ub2e4\ub978 \uc815\ubcf4\ub4e4\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```sh\\n$ kops validate cluster --wait 10m\\n\\nValidating cluster prosv.kr\\n\\nINSTANCE GROUPS\\nNAME                    ROLE    MACHINETYPE     MIN     MAX     SUBNETS\\nmaster-ap-northeast-2a  Master  t3.medium       1       1       ap-northeast-2a\\nnodes-ap-northeast-2a   Node    t3.medium       2       2       ap-northeast-2a\\nnodes-ap-northeast-2c   Node    t3.medium       1       1       ap-northeast-2c\\n\\nNODE STATUS\\nNAME                    ROLE    READY\\ni-053ca67a20cd7bf7f     node    True\\ni-0a7dfc0939b58c2fc     node    True\\ni-0aa3db1bfe96bf280     master  True\\ni-0b665798ce9dd857f     node    True\\n\\nYour cluster prosv.kr is ready\\n\\n$ kops get cluster\\nNAME            CLOUD   ZONES\\nprosv.kr        aws     ap-northeast-2a,ap-northeast-2c\\n\\n$ kops get instances\\n\\nID                      NODE-NAME               STATUS          ROLES   STATE   INTERNAL-IP     INSTANCE-GROUP                          MACHINE-TYPE\\ni-053ca67a20cd7bf7f     i-053ca67a20cd7bf7f     UpToDate        node            172.30.49.113   nodes-ap-northeast-2a.prosv.kr          t3.medium\\ni-0a7dfc0939b58c2fc     i-0a7dfc0939b58c2fc     UpToDate        node            172.30.77.157   nodes-ap-northeast-2c.prosv.kr          t3.medium\\ni-0aa3db1bfe96bf280     i-0aa3db1bfe96bf280     UpToDate        master          172.30.63.194   master-ap-northeast-2a.masters.prosv.kr t3.medium\\ni-0b665798ce9dd857f     i-0b665798ce9dd857f     UpToDate        node            172.30.54.137   nodes-ap-northeast-2a.prosv.kr          t3.medium\\n```\\n\\n\uae30\ubcf8 CRI \ucee8\ud14c\uc774\ub108 \ub7f0\ud0c0\uc784\uc774 containerd \uc778 \uac83\ub3c4 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \uac01 \ub178\ub4dc\uac00 External-IP\ub97c \ud560\ub2f9\ubc1b\uc740 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```sh\\n$ kubectl get nodes -o wide\\nNAME                  STATUS   ROLES           AGE   VERSION    INTERNAL-IP     EXTERNAL-IP      OS-IMAGE             KERNEL-VERSION    CONTAINER-RUNTIME\\ni-053ca67a20cd7bf7f   Ready    node            42m   v1.24.10   172.30.49.113   43.201.14.97     Ubuntu 20.04.5 LTS   5.15.0-1028-aws   containerd://1.6.10\\ni-0a7dfc0939b58c2fc   Ready    node            42m   v1.24.10   172.30.77.157   43.201.77.155    Ubuntu 20.04.5 LTS   5.15.0-1028-aws   containerd://1.6.10\\ni-0aa3db1bfe96bf280   Ready    control-plane   44m   v1.24.10   172.30.63.194   43.200.6.4       Ubuntu 20.04.5 LTS   5.15.0-1028-aws   containerd://1.6.10\\ni-0b665798ce9dd857f   Ready    node            42m   v1.24.10   172.30.54.137   13.125.115.198   Ubuntu 20.04.5 LTS   5.15.0-1028-aws   containerd://1.6.10\\n```\\n\\nkubectl cli \ud50c\ub7ec\uadf8\uc778 \ub9e4\ub2c8\uc800\uc778 \ucfe0\ubc84\ub124\ud2f0\uc2a4 `krew`\ub97c \uc124\uce58\ud558\uace0 \uc5ec\ub7ec\uac00\uc9c0 \ub3c4\uad6c\ub97c \uc124\uce58\ud55c\ub2e4. \uc124\uce58\ub418\ub294 \ud50c\ub7ec\uadf8\uc778 \ub9d0\uace0\ub3c4 \ub2e4\uc591\ud55c \ud50c\ub7ec\uadf8\uc778\ub4e4\uc740 \uc544\ub798 \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4.\\n- https://krew.sigs.k8s.io/plugins/\\n\\n```sh\\n$ kubectl krew install ctx ns df-pv get-all ktop neat oomd view-secret\\n```\\n\\n\\n## Add-on \uad6c\uc131\\n\\nExternalDNS\uc640 \uac19\uc740 add-on\uc744 \uad6c\uc131\ud558\uace0 Kubernetes \uc11c\ube44\uc2a4 \ub610\ub294 \uc778\uadf8\ub808\uc2a4 \uc0dd\uc131 \uc2dc \ub3c4\uba54\uc778\uc744 \uc124\uc815\ud558\uba74, AWS(Route 53)\uc640 \uac19\uc740 \ud074\ub77c\uc6b0\ub4dc DNS \uc11c\ube44\uc2a4\uc5d0\uc11c A \ub808\ucf54\ub4dc(TXT \ub808\ucf54\ub4dc)\ub97c \uc790\ub3d9 \uc0dd\uc131/\uc0ad\uc81c\ud560 \uc218 \uc788\ub2e4. Route53\uc5d0\uc11c \ub3d9\uc791\uc744 \uc704\ud574 \ub2e4\uc74c\uacfc \uac19\uc740 IAM Policy\uac00 \ud544\uc694\ud558\ub2e4.  \\n\\n```json\\n{\\n  \\"Version\\": \\"2012-10-17\\",\\n  \\"Statement\\": [\\n    {\\n      \\"Effect\\": \\"Allow\\",\\n      \\"Action\\": [\\n        \\"route53:ChangeResourceRecordSets\\"\\n      ],\\n      \\"Resource\\": [\\n        \\"arn:aws:route53:::hostedzone/*\\"\\n      ]\\n    },\\n    {\\n      \\"Effect\\": \\"Allow\\",\\n      \\"Action\\": [\\n        \\"route53:ListHostedZones\\",\\n        \\"route53:ListResourceRecordSets\\"\\n      ],\\n      \\"Resource\\": [\\n        \\"*\\"\\n      ]\\n    }\\n  ]\\n}\\n```\\n\\n\ud574\ub2f9 json\uc73c\ub85c IAM Policy\ub97c \uc0dd\uc131\ud558\uace0 master, worker \ub178\ub4dc instance profile\uc5d0 \ucd94\uac00\ud55c\ub2e4.\\n\\n```sh\\naws iam create-policy --policy-name AllowExternalDNSUpdates --policy-document file://externaldns-aws-r53-policy.json\\n\\nexport ACCOUNT_ID=$(aws sts get-caller-identity --query \'Account\' --output text)\\n\\naws iam attach-role-policy --policy-arn arn:aws:iam::$ACCOUNT_ID:policy/AllowExternalDNSUpdates --role-name masters.$KOPS_CLUSTER_NAME\\n\\naws iam attach-role-policy --policy-arn arn:aws:iam::$ACCOUNT_ID:policy/AllowExternalDNSUpdates --role-name nodes.$KOPS_CLUSTER_NAME\\n```\\n\\n\uc774 \uc0c1\ud0dc\uc5d0\uc11c `externalDNS`\ub97c \uad6c\uc131\ud55c\ub2e4.  `externalDNS` \uc640 \uac19\uc740 \uc5ec\ub7ec \uc560\ub4dc\uc628\ub4e4\uc740 kOps\uc640 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub77c\uc774\ud504\uc0ac\uc774\ud074\uc5d0 \ub530\ub77c \uad6c\uc131, \uad00\ub9ac\ub41c\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c API \uc11c\ubc84\ub294 \uba54\ud2b8\ub9ad \uc11c\ubc84 TLS \uc778\uc99d\uc11c\ub97c \ud655\uc778\ud558\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 TLS\ub97c \uc0ac\uc6a9\ud558\ub824\uba74 \ud074\ub7ec\uc2a4\ud130 spec\uc5d0\uc11c `certManager`\ub3c4 \uac19\uc774 \ucd94\uac00\ud55c\ub2e4. \ub610\ud55c HPA \uad6c\uc131\uc744 \uc704\ud574 `metricServer` \ub3c4 \uad6c\uc131\uc744 \uc9c4\ud589\ud55c\ub2e4.\\n\\n\\n```yaml\\n$ kops edit cluster\\n...\\nspec:\\n  certManager:\\n    enabled: true\\n  externalDns:\\n    provider: external-dns\\n  metricsServer:\\n    enabled: true\\n    insecure: false\\n...\\n\\n$ kops update cluster --yes && echo && sleep 3 && kops rolling-update cluster --yes\\n```\\n\\n\uc77c\ub2e8 php-apache deployment\ub97c \uc2dc\uc791\ud55c\ub2e4. \\n\\n```yaml\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: php-apache\\nspec:\\n  selector:\\n    matchLabels:\\n      run: php-apache\\n  replicas: 1\\n  template:\\n    metadata:\\n      labels:\\n        run: php-apache\\n    spec:\\n      containers:\\n      - name: php-apache\\n        image: registry.k8s.io/hpa-example\\n        ports:\\n        - containerPort: 80\\n        resources:\\n          limits:\\n            cpu: 500m\\n          requests:\\n            cpu: 200m\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: php-apache\\n  labels:\\n    run: php-apache\\nspec:\\n  ports:\\n  - port: 80\\n  selector:\\n    run: php-apache\\n  type: LoadBalancer\\n```\\n\\n\ubc14\ub85c HPA \ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 \uac04\ub2e8\ud558\uac8c \uc0ac\uc6a9\ub960\uc744 \uae30\ubc18\uc73c\ub85c \uc2a4\ucf00\uc77c\ub9c1\uc774 \ub3d9\uc791\ud558\ub3c4\ub85d \uad6c\uc131\ud558\uace0 CPU \ub85c\ub4dc\ub97c \uc8fc\uc785\ud55c\ub2e4. `load-generator`\uc5d0\uc11c\ub294 0.01\ucd08 \ub2e8\uc704\ub85c \ub9ac\ud018\uc2a4\ud2b8\ub97c \ubcf4\ub0b4\uac8c \ub41c\ub2e4. \\n\\nhttps://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/\\n\\n```sh\\n$ kubectl autoscale deployment php-apache --cpu-percent=10 --min=1 --max=4\\n\\n$ kubectl run -i --tty load-generator --rm --image=busybox:1.28 --restart=Never -- /bin/sh -c \\"while sleep 0.01; do wget -q -O- http://php-apache; done\\"\\nIf you don\'t see a command prompt, try pressing enter.\\nOK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!OK!\\n```\\n\\n\ub2e4\uc74c\uc73c\ub85c, HPA\uac00 \ubd80\ud558 \uc99d\uac00\uc5d0 \uc5b4\ub5bb\uac8c \ubc18\uc751\ud558\ub294\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```sh\\n$ kubectl get hpa php-apache --watch\\nNAME         REFERENCE               TARGETS   MINPODS   MAXPODS   REPLICAS   AGE\\nphp-apache   Deployment/php-apache   93%/10%   1         4         4          1m\\n```\\n\\n\ub9c8\uc9c0\ub9c9\uc73c\ub85c CLB\uc5d0 ExternalDNS\ub85c \ub3c4\uba54\uc778 \uc5f0\uacb0\uc744 \ud558\uae30 \uc704\ud574\uc11c\ub294 expose\ub97c \uc6d0\ud558\ub294 Service\uc5d0 \ub2e4\uc74c\uacfc \uac19\uc774 annotation\uc744 \ucd94\uac00\ud558\ub294 \ubc29\ubc95\uc73c\ub85c \uc678\ubd80 \ub3c4\uba54\uc778\uc744 \uc27d\uac8c \uc5f0\uacb0\ud560 \uc218 \uc788\ub2e4.\\n\\n```sh\\n$ kubectl annotate service nginx \\"external-dns.alpha.kubernetes.io/hostname=nginx.$KOPS_CLUSTER_NAME\\"\\n```\\n\\n\\n## \uc815\ub9ac\\n\\n\ud56d\uc0c1 EKS\ub9cc \ud65c\uc6a9\ud558\ub294 \ud504\ub85c\uc81d\ud2b8\ub97c \uc9c4\ud589\ud558\ub2e4\ubcf4\ub2c8 \uc2a4\ud130\ub514 \ud6c4\uc5d0 \uc624\ub79c\ub9cc\uc5d0 \uc9c1\uc811 \uad6c\uc131\ud558\ub294 \uacbd\ud5d8\uc744 \ud574\ubcf4\ub2c8 \ud2b8\ub7ec\ube14\uc288\ud305\ud558\ub294 \uc7ac\ubbf8\uac00 \uc788\uc5b4\uc11c \uc88b\uc740\uac83 \uac19\ub2e4. \uc774\ub7f0\uc800\ub7f0 add-on\uc744 \ucd94\uac00\uc801\uc73c\ub85c \uad6c\uc131\ud574\uc11c \ub354 \ud574\ubcf4\uace0 \uc2f6\uc9c0\ub9cc \uc5ed\uc2dc\ub098 \uc2dc\uac04\uc774 \uc5c6\ub294 \uad00\uacc4\ub85c \uc77c\ub2e8 \uc5ec\uae30 \uae4c\uc9c0 \uad6c\uc131\uc744 \ud558\uace0 \uc774\ubc88\uc5d0 \uc124\uce58\ud55c Cloud9\uc73c\ub85c \ubc30\ud3ec\ub418\ub294 \ud074\ub7ec\uc2a4\ud130 \uad6c\uc131\uc740 CKS\ub97c \uc900\ube44\ud558\uace0 \ud300 \ub0b4\ubd80 \uc138\uc158\uc744 \uc9c4\ud589\ud558\ub294 \ub3c4\uad6c\ub85c \ud65c\uc6a9\uc744 \ud574\ubcfc \uc608\uc815\uc774\ub2e4.\\n\\n> \ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4."},{"id":"kubernetes/eks-cni-custom/","metadata":{"permalink":"/kubernetes/eks-cni-custom/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2022-12-16-eks-cni-custom.md","source":"@site/blog/2022-12-16-eks-cni-custom.md","title":"EKS CNI Custom Networking","description":"Terraform null_resource\ub97c \ud65c\uc6a9\ud558\uc5ec EKS CNI network\ub97c \uad6c\uc131\ud558\ub294 \ubc29\ubc95","date":"2022-12-16T00:00:00.000Z","formattedDate":"December 16, 2022","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"EKS","permalink":"/tags/eks"},{"label":"CNI","permalink":"/tags/cni"},{"label":"Terraform","permalink":"/tags/terraform"}],"readingTime":10.79,"truncated":true,"authors":[{"name":"Jinwoong Kim","title":"Technologist and Cloud Consultant","url":"https://www.linkedin.com/in/ddiiwoong/","imageURL":"https://s.gravatar.com/avatar/e8bfebcbeacb5b9a0c90614e792febf2?s=80","key":"jinwoong"}],"frontMatter":{"layout":"single","title":"EKS CNI Custom Networking","comments":true,"classes":"wide","description":"Terraform null_resource\ub97c \ud65c\uc6a9\ud558\uc5ec EKS CNI network\ub97c \uad6c\uc131\ud558\ub294 \ubc29\ubc95","authors":"jinwoong","toc":true,"toc_label":"Table of Contents","slug":"kubernetes/eks-cni-custom/","date":"2022-12-16T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","EKS","CNI","Terraform"]},"prevItem":{"title":"kOps with Cloud9","permalink":"/kubernetes/kops-cloud9/"},"nextItem":{"title":"EKS Anywhere Advanced Usages","permalink":"/kubernetes/eks-anywhere-adv/"}},"content":"## EKS CNI Networking \uc81c\uc57d\uc0ac\ud56d\\n\\n[https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/cni-custom-network.html#custom-networking-automatically-apply-eniconfig](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/cni-custom-network.html#custom-networking-automatically-apply-eniconfig)  \\n  \\nAWS\uc5d0\ub294 \uae30\ubcf8 ENI\uac00 \ud3ec\ud568\ub41c \uc11c\ube0c\ub137\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 IP\uac1c\uc218\ub294 \uc81c\ud55c\ub418\uc5b4 \uc788\ub2e4. \ud30c\ub4dc\uc758 \uc218 \uc81c\ud55c\uc774 \ubc1c\uc0dd\ud560 \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 secondary ENI\uc5d0 \ub2e4\ub978 \uc11c\ube0c\ub137\uc744 \uc0ac\uc6a9\ud558\uc5ec \uac00\uc6a9 IP\uac1c\uc218\ub97c \ub298\ub9b4\uc218 \uc788\ub2e4. \ub610\ud55c \ubcf4\uc548\uc0c1\uc758 \uc774\uc720\ub85c \ud30c\ub4dc\ub294 \ub178\ub4dc\uc758 \uae30\ubcf8 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc640 \ub2e4\ub978 \uc11c\ube0c\ub137 \ub610\ub294 \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud574\uc57c \ud560 \uc218 \uc788\ub2e4.   \\n  \\nCNI Custom Networking\uc774 \ud65c\uc131\ud654\uac00 \ub418\uba74 \ud30c\ub4dc\ub294 \ub2e4\ub978 \uc11c\ube0c\ub137\uc5d0 \uc0dd\uc131\uc774 \ub418\uace0, \ub178\ub4dc \uc11c\ube0c\ub137\uc758 \uc544\uc774\ud53c\ub97c \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294\ub2e4.\\n\\nEKS\uc5d0\uc11c \ud30c\ub4dc \ub300\uc5ed\uc744 \ubd84\ub9ac \ud558\uae30 \uc704\ud574\uc11c CNI Custom Networking \uc124\uc815\uc744 \uc9c4\ud589\ud55c\ub2e4. \ud574\ub2f9 env \uac12\uc744 \ubcc0\uacbd\ud558\uba74 \uc989\uc2dc aws-node \uac00 \uad50\uccb4\ub41c\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n  \\n```\\nkubectl set env daemonset aws-node -n kube-system AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true\\n```\\n\\n\ud30c\ub4dc\ub97c \ubc30\ud3ec\ud558\ub824\ub294 \uac01 \uc11c\ube0c\ub137\uc5d0 \ub300\ud574\uc11c \uc544\ub798\uc640 \uac19\uc740 \ud615\uc2dd\uc73c\ub85c ENIConfig \ub9ac\uc18c\uc2a4\ub97c \uc0dd\uc131\ud574\uc57c \ud55c\ub2e4. \uc0ac\uc6a9\ud558\ub824\ub294 \uc11c\ube0c\ub137\uacfc SG\uc744 \uc120\uc5b8\ud574\uc57c \uae30\ubcf8\uc801\uc778 \uad6c\uc131\uc774 \uac00\ub2a5\ud558\ub2e4. \\n\\n```\\napiVersion: crd.k8s.amazonaws.com/v1alpha1  \\nkind: ENIConfig  \\nmetadata:  \\nname: \\"ap-northeast-2a\\"  \\nspec:  \\nsubnet: \\"${subnet_a}\\"  \\nsecurityGroups:  \\n- ${NODE_SG}  \\n  \\napiVersion: crd.k8s.amazonaws.com/v1alpha1  \\nkind: ENIConfig  \\nmetadata:  \\nname: \\"ap-northeast-2b\\"  \\nspec:  \\nsubnet: \\"${subnet_c}\\"  \\nsecurityGroups:  \\n- ${NODE_SG}  \\n  \\napiVersion: crd.k8s.amazonaws.com/v1alpha1  \\nkind: ENIConfig  \\nmetadata:  \\nname: \\"ap-northeast-2c\\"  \\nspec:  \\nsubnet: \\"${subnet_d}\\"  \\nsecurityGroups:  \\n- ${NODE_SG}\\n```\\n\\n`aws-node` `DaemonSet`\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc0dd\uc131\ub41c \ubaa8\ub4e0 \ub178\ub4dc\uc5d0 \uac00\uc6a9 \uc601\uc5ed\uc758 `ENIConfig`\ub97c \uc790\ub3d9\uc73c\ub85c \uc801\uc6a9\ud560 \uc218 \uc788\ub2e4.\\n\\n```\\nkubectl set env daemonset aws-node -n kube-system ENI_CONFIG_LABEL_DEF=topology.kubernetes.io/zone\\n```\\n\\n\uc774\ub54c \uba87\uac00\uc9c0 \uc81c\uc57d\uc0ac\ud56d\uc774 \uc0dd\uae30\uac8c \ub41c\ub2e4.\\n\\n- \ud574\ub2f9 \uc124\uc815\uc744 \ubc30\ud3ec\ud558\uace0 \ub09c \uc774\ud6c4 \ucd94\uac00\ub41c \ub178\ub4dc\uc5d0 \ub300\ud574\uc11c\ub9cc \uc0c8\ub85c\uc6b4 \uc11c\ube0c\ub137 IP\ub85c \ud560\ub2f9\uc774 \ub418\uae30 \ub54c\ubb38\uc5d0, \uae30\uc874 \ub178\ub4dc\ub97c \uc7ac\uc2dc\uc791\ud558\uac70\ub098 \uc0ad\uc81c\ub97c \ud574\uc57c \ud30c\ub4dc\uc5d0 \uc0c8\ub85c\uc6b4 IP\uac00 \ud560\ub2f9\uc774 \ub41c\ub2e4.\\n\\n- CNI Custom Networking \uc124\uc815\uc5d0\uc11c\ub294 \ub2e4\uc911 \uc11c\ube0c\ub137\uc744 \ud560\ub2f9\ud560 \uc218 \uc5c6\uace0 \uc11c\ube0c\ub137 \ubcc4\ub85c custom name\uc73c\ub85c \uc124\uc815\ud558\uace0 \ubaa8\ub4e0 node \uac01\uac01\uc5d0 \uc785\ub825\ud55c \ubcc4\ub3c4\uc758 annotation\uc744 \ucd94\uac00\ud574\uc57c\ud55c\ub2e4. ([https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/cni-custom-network.html#custom-networking-deploy-nodes](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/cni-custom-network.html#custom-networking-deploy-nodes))\\n\\n- AWS\uc758 \uc778\uc2a4\ud134\uc2a4 \ud0c0\uc785\ubcc4 ENI \uac1c\uc218 \uc81c\ud55c\uc73c\ub85c Pod \uc0dd\uc131\uc774 \ubd88\uac00\ub2a5\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c Kubelet BootstrapArguments \ud30c\ub77c\ubbf8\ud130\ub97c launch template \uc5d0\uc11c \uc0ac\uc804\uc5d0 \uc815\uc758\ub41c \uac12\uc73c\ub85c \ubcc0\uacbd\ud558\uc5ec \ub178\ub4dc\uac00 \uc0dd\uc131\ub418\ub3c4\ub85d \ud55c\ub2e4.\\n\\n-   MAX PODS = (Number of network interfaces \xd7 [the number of IP addresses per network interface \u2013 1]) + 2\\n-   [https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#AvailableIpPerENI](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html#AvailableIpPerENI)\\n\\n```\\nMIME-Version: 1.0\\nContent-Type: multipart/mixed; boundary=\\"==MYBOUNDARY==\\"\\n\\n--==MYBOUNDARY==\\nContent-Type: text/x-shellscript; charset=\\"us-ascii\\"\\n#!/bin/bash\\n/etc/eks/bootstrap.sh {Cluster Name} --use-max-pods false --kubelet-extra-args \'--max-pods=110\'--==MYBOUNDARY==--\\\\\\n```\\n\\n\uc774\ub7ec\ud55c \uc81c\uc57d\uc0ac\ud56d\ub4e4\uc744 \ucc98\ub9ac\ud558\uae30 \uc704\ud574\uc11c CNI Custom Networking \uad6c\ud604\uc744 Terraform Pipeline\uc73c\ub85c \uad6c\ud604\uc744 \uc9c4\ud589\ud55c\ub2e4.\\n\\n## Terraform \uc73c\ub85c CNI \uad6c\uc131\ud558\ub294 \uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589\\n\\nEKS\ub97c \ud504\ub85c\ube44\uc800\ub2dd \ud558\ub294 Terraform \ucf54\ub4dc\ub294 \ub9ce\uc774 \uacf5\uac1c\ub418\uc5b4 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 \uc0dd\ub7b5\ud558\uae30\ub85c \ud558\uace0 VPC Custom CNI\ub97c \uad6c\uc131\ud558\ub294 \ubd80\ubd84\ub9cc \uc0b4\ud3b4\ubcf4\uc790.\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c VPC CNI\ub97c \ubc30\ud3ec\ud558\uac8c \ub418\uba74 aws-node \uc7ac\uc2dc\uc791\uc774 \ub418\uae30 \ub54c\ubb38\uc5d0 Workload NodeGroup\uc774 \uad6c\uc131\ub418\uae30 \uc774\uc804\uc5d0 \uc544\ub798 \uc2a4\ud06c\ub9bd\ud2b8\ub97c `null_resource` \ub9ac\uc18c\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub2e4\uc74c\uacfc \uac19\uc740 \uc21c\uc11c\ub85c Batch\ub97c \uc2e4\ud589\ud558\ub3c4\ub85d \ud588\ub2e4.\\n\\n-  kubectl \uc124\uce58\\n-  AWS Authentication (Assume role)\\n-  kubeconfig update\\n-  VPC CNI Custom manifest (\ubc84\uc804 v1.11.2) \uc801\uc6a9 - [https://github.com/aws/amazon-vpc-cni-k8s](https://github.com/aws/amazon-vpc-cni-k8s)\\n-  \uae30\ubcf8 \ud15c\ud50c\ub9bf : [https://raw.githubusercontent.com/aws/amazon-vpc-cni-k8s/v1.11.2/config/master/aws-k8s-cni.yaml](https://raw.githubusercontent.com/aws/amazon-vpc-cni-k8s/v1.11.2/config/master/aws-k8s-cni.yaml)\\n-  `ENABLE_POD_ENI=true` : Security Group for Pods\ub97c \uc704\ud55c \uad6c\uc131\uc73c\ub85c Node\uc5d0 trunk ENI \ucd94\uac00\ub97c \ud558\uae30 \uc704\ud55c `vpc.amazonaws.com/has-trunk-attached` \ub97c \ucd94\uac00\ud55c\ub2e4. \\n\\t-   Pod ENI\ub97c \ud65c\uc131\ud654\ud55c \uacbd\uc6b0 Branch ENI\ub97c \uc0dd\uc131\ud558\ub294 \ubd80\ubd84\uc5d0\uc11c ENI \uc0dd\uc131 [\uc81c\uc57d\uc0ac\ud56d](https://github.com/aws/amazon-vpc-resource-controller-k8s/blob/master/pkg/aws/vpc/limits.go)\uc774 \ubc1c\uc0dd\ud560\uc218 \uc788\ub2e4.\\n-  `DISABLE_TCP_EARLY_DEMUX=true` : `ENABLE_POD_ENI`\uac00 true\ub85c \uc124\uc815\ub41c \uacbd\uc6b0 kubelet\uc774 TCP\ub97c \ud1b5\ud574 \ud3ec\ub4dc \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud558\ub294 \ud3ec\ub4dc\uc5d0 \uc5f0\uacb0\ud558\ub824\uba74 `DISABLE_TCP_EARLY_DEMUX`\ub97c initcontainers \ucee8\ud14c\uc774\ub108(amazon-k8s-cni-init)\ub97c \ud1b5\ud574 true\ub85c \uc124\uc815\ud574\uc57c \ud55c\ub2e4.\\n-  `AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true` : worker \ub178\ub4dc\uc5d0\uc11c \ud30c\ub4dc\uac00 \ubcc4\ub3c4\uc758 \uc11c\ube0c\ub137 \ubc0f \ubcf4\uc548 \uadf8\ub8f9\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4\uace0 \uc9c0\uc815\ud55c\ub2e4. IPAMD\uac00 ENI \ud560\ub2f9\uc744 \uc704\ud574 worker \ub178\ub4dc\uc758 `ENIConfig`\uc5d0\uc11c \uc9c0\uc815\ud55c \ubcf4\uc548 \uadf8\ub8f9\uacfc VPC \uc11c\ube0c\ub137\uc744 \uc0ac\uc6a9\ud558\uac8c \ub41c\ub2e4. \\n-  `ENI_CONFIG_LABEL_DEF=topology.kubernetes.io/zone` - `ENIConfig`\uc640 \ub9e4\uce6d\ub418\ub3c4\ub85d \ub178\ub4dc\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uac00\uc6a9\uc601\uc5ed\uc744 zone \ubcc4\ub85c \uad6c\uc131\ud558\ub294 label\uc744 \ucd94\uac00\ud55c\ub2e4.\\n\\t-   `ENIConfig` \ub77c\ub294 \ucee4\uc2a4\ud140 \ub9ac\uc18c\uc2a4\ub97c \uc0dd\uc131\ud55c\ub2e4. \ud574\ub2f9 \uc124\uc815\uc740 \ud30c\ub4dc\uc6a9 IP\ub300\uc5ed\uc744 \uc704\ud55c secondary ENI\uc5d0 \uc801\uc6a9\ub420 \uac12\uc73c\ub85c subnet id\uc640 sg \uac12\uc744 spec\uc5d0 \uc9c0\uc815\ud574\uc57c \ud55c\ub2e4. \uc544\ub798 subnet\uacfc sg id\ub294 terraform\uc5d0\uc11c EKS\ud074\ub7ec\uc2a4\ud130\uac00 \ud504\ub85c\ube44\uc800\ub2dd \ub420\ub54c \uacb0\uacfc\ub97c env\ub85c \uc800\uc7a5\ub41c \uac12\uc744 \uac00\uc838\uc624\ub294 \ubc29\uc2dd\uc73c\ub85c \ucc98\ub9ac \ud560\uc218 \uc788\ub3c4\ub85d \ud558\uc600\ub2e4.\\n\\t-   `ENIConfig`\ub97c \uc0ac\uc6a9\ud560 \uac00\uc6a9 \uc601\uc5ed\uacfc \ub3d9\uc77c\ud558\uac8c `ENIConfig`\uc758 name\uc744 \uc9c0\uc815\ud558\ub294 \uac83\uc774 \uc88b\ub2e4. \ub9cc\uc57d custom name\uc73c\ub85c \uc124\uc815\ud558\uac8c \ub418\uba74 \ubaa8\ub4e0 node \uac01\uac01\uc5d0 \uc785\ub825\ud55c \ubcc4\ub3c4\uc758 annotation\uc744 \ucd94\uac00\ud574\uc57c \ud55c\ub2e4. ([https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/cni-custom-network.html#custom-networking-deploy-nodes](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/cni-custom-network.html#custom-networking-deploy-nodes))\\n-  `ENABLE_PREFIX_DELEGATION=true` \ud30c\ub77c\ubbf8\ud130\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\uc5d0 \uc811\ub450\uc0ac\ub97c \ud560\ub2f9\ud558\ub3c4\ub85d VPC CNI \ud50c\ub7ec\uadf8\uc778\uc744 \uad6c\uc131\ud55c\ub2e4. \\n-  `WARM_IP_TARGET=1`, `MINIMUM_IP_TARGET=30`\\n\\t-  AWS VPC CNI\uc5d0\ub294 \ub450 \uac00\uc9c0 \uad6c\uc131 \uc694\uc18c\uac00 \uc788\ub2e4. CNI \ud50c\ub7ec\uadf8\uc778 \ubc14\uc774\ub108\ub9ac (/opt/cni/bin/aws-cni)\ubc0f \ub85c\uceecIP \uc8fc\uc18c\ub97c \uad00\ub9ac\ud558\ub294 `ipamd`\ub294 aws-node\ub77c\ub294 kubernetes daemonset \uc73c\ub85c \uc2e4\ud589\ub418\uba70 \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc5f0\uacb0\ub41c \ubaa8\ub4e0 ENI \ubc0f IP\ub97c \ucd94\uc801\ud558\ub294 \ubaa8\ub4e0 \ub178\ub4dc\uc5d0 \ud30c\ub4dc\ub97c \ucd94\uac00\ud55c\ub2e4.\\n\\t-  CNI \ud50c\ub7ec\uadf8\uc778\uc740 \ud638\uc2a4\ud2b8 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0\uacfc \uc62c\ubc14\ub978 \ub124\ud2b8\uc6cc\ud06c \uc778\ud130\ud398\uc774\uc2a4\ub97c \ud30c\ub4dc\uc758 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \ucd94\uac00\ud558\ub294 \uc5ed\ud560\uc744 \ud55c\ub2e4. CNI \ud50c\ub7ec\uadf8\uc778\uc740 \uc6d0\uaca9 \ud504\ub85c\uc2dc\uc800 \ud638\ucd9c(gRPC)\uc744 \ud1b5\ud574 `IPAMD`\uc640 \ud1b5\uc2e0\ud55c\ub2e4.\\n\\t-  `WARM_IP_TARGET`\uc740 ENI \uc804\uccb4\ub97c Warm Pool\ub85c \uac00\uc838\uac00\uc9c0 \uc54a\uace0 \ud2b9\uc815 IP \uac1c\uc218\ub9cc\ud07c\ub9cc Warm Pool\uc744 \ud655\ubcf4\ud558\uaca0\ub2e4\ub77c\ub294 \uc124\uc815\uc774\ub2e4. `WARM_IP_TARGET=1`\ub85c \uc124\uc815\ub418\uba74 Pod\uc774 \uc0dd\uc131\ub420 \ub54c\ub9c8\ub2e4 Secondary IP\ub97c 1\uac1c\uc529 \ucd94\uac00\ub85c \ud560\ub2f9\ud55c\ub2e4.\\n\\t-  Pod\uc758 \uc0dd\uc131\uacfc \uc885\ub8cc\uac00 \ube48\ubc88\ud55c \uacbd\uc6b0, \uc778\uc2a4\ud134\uc2a4\uc5d0 IP\ub97c Attach/Detach \ud558\ub294 API call\uc758 \uc218\uac00 \ub298\uc5b4\ub098 ENI\ub97c \ucd94\uac00\ud558\uac70\ub098 IP\ub97c \ucd94\uac00\ud558\ub294 throttling\uc744 \ubc29\uc9c0\ud558\uae30 \uc704\ud574 `MINIMUM_IP_TARGET`\uc744 \ud568\uaed8 \uc124\uc815\ud55c\ub2e4. \ub178\ub4dc\uc5d0 \uc77c\ubc18\uc801\uc73c\ub85c \uc720\uc9c0\ub418\ub294 Pod\uc758 \uc218\ub97c `MINIMUM_IP_TARGET`\uc73c\ub85c \uc9c0\uc815\ud574 \ub193\uc73c\uba74 \ud574\ub2f9 \uc218\ub9cc\ud07c ENI\uc5d0 \ubbf8\ub9ac IP\uac00 \ud560\ub2f9\ub41c\ub2e4. \\n\\t-  `WARM_PREFIX_TARGET=1` \ub294 \uc704 \uc124\uc815\uc744 \uc801\uc6a9\ud558\uba74 \uc7ac\uc815\uc758 \ub41c\ub2e4.\\n\\n-  `AWS_VPC_K8S_CNI_EXTERNALSNAT=true` : \ud30c\ub4dc\ubcc4 ENI\uc5d0 \ud560\ub2f9\ub41c IP\uc8fc\uc18c\ub97c \uc81c\uc5b4\ud560\uc218 \uc788\ub3c4\ub85d Node IP\ub85c SNAT \ub418\uc9c0\uc54a\ub3c4\ub85d \uc124\uc815\ud558\ub294 \uad6c\uc131\uc774\ub2e4.\\n-  `ENIConfig` \uad6c\uc131\uc744 \uc704\ud574 Pod\uac00 \uc0ac\uc6a9\ud560 \ub300\uc5ed\uc744 \ubcc0\uc218(`subnet_a`,`subnet_b`,`subnet_c`)\ub85c \ubc1b\uc544 kubectl\ub85c \uc124\uc815\ud55c\ub2e4.\\n\\n```sh\\n#!/bin/bash  \\n \\nKUBE_CONFIG=\\"$(mktemp)\\"  \\naws eks update-kubeconfig --name \\"${CLUSTER_NAME}\\" --kubeconfig \\"${KUBE_CONFIG}\\"  \\n  \\n## Apply VPC CNI manifests (origin: https://raw.githubusercontent.com/aws/amazon-vpc-cni-k8s/v1.11.2/config/master/aws-k8s-cni.yaml)  \\n# Security group for pod env configurations ; ENABLE_POD_ENI=true  \\n# https://github.com/aws/amazon-vpc-cni-k8s#disable_tcp_early_demux-v173 ; DISABLE_TCP_EARLY_DEMUX=true  \\n# Custom networking ; AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true  \\n# Custom networking ; ENI_CONFIG_LABEL_DEF=topology.kubernetes.io/zone  \\n# Custom networking ; WARM_IP_TARGET=1  \\n# Custom networking ; MINIMUM_IP_TARGET=30  \\n# Custom networking ; WARM_PREFIX_TARGET=1  \\n# Fewer API calls required to EC2 control plane ; ENABLE_PREFIX_DELEGATION=true  \\n# Source NAT disabled ; AWS_VPC_K8S_CNI_EXTERNALSNAT=true  \\n  \\nKUBE_CONFIG=\\"$(mktemp)\\"\\naws eks update-kubeconfig --name \\"${CLUSTER_NAME}\\" --kubeconfig \\"${KUBE_CONFIG}\\"\\n\\n## Apply VPC CNI manifests (origin: https://raw.githubusercontent.com/aws/amazon-vpc-cni-k8s/v1.11.2/config/master/aws-k8s-cni.yaml)\\n# Security group for pod env configurations ; ENABLE_POD_ENI=true\\n# https://github.com/aws/amazon-vpc-cni-k8s#disable_tcp_early_demux-v173 ; DISABLE_TCP_EARLY_DEMUX=true\\n# Custom networking ; AWS_VPC_K8S_CNI_CUSTOM_NETWORK_CFG=true\\n# Custom networking ; ENI_CONFIG_LABEL_DEF=topology.kubernetes.io/zone\\n# Custom networking ; WARM_IP_TARGET=1\\n# Custom networking ; MINIMUM_IP_TARGET=30\\n# Custom networking ; WARM_PREFIX_TARGET=1\\n# Fewer API calls required to EC2 control plane ; ENABLE_PREFIX_DELEGATION=true\\n# Source NAT disabled ; AWS_VPC_K8S_CNI_EXTERNALSNAT=true\\n\\nkubectl --kubeconfig \\"${KUBE_CONFIG}\\" apply -f ./scripts/aws-k8s-cni.yaml\\n\\n# set up ENIConfig \\nsubnet_a=$(echo ${SUBNETS} |awk -F\\",\\" \'{print $1}\')\\nsubnet_b=$(echo ${SUBNETS} |awk -F\\",\\" \'{print $2}\')\\nsubnet_c=$(echo ${SUBNETS} |awk -F\\",\\" \'{print $3}\')\\n\\ncat <<EOF | kubectl --kubeconfig \\"${KUBE_CONFIG}\\" apply -f -\\napiVersion: crd.k8s.amazonaws.com/v1alpha1\\nkind: ENIConfig\\nmetadata:\\n  name: \\"ap-northeast-2a\\"\\nspec:\\n  subnet: \\"${subnet_a}\\"\\n  securityGroups:\\n  - ${CLUSTER_SG}\\nEOF\\n\\ncat <<EOF | kubectl --kubeconfig \\"${KUBE_CONFIG}\\" apply -f -\\napiVersion: crd.k8s.amazonaws.com/v1alpha1\\nkind: ENIConfig\\nmetadata:\\n  name: \\"ap-northeast-2b\\"\\nspec:\\n  subnet: \\"${subnet_b}\\"\\n  securityGroups:\\n  - ${CLUSTER_SG}\\nEOF\\n\\ncat <<EOF | kubectl --kubeconfig \\"${KUBE_CONFIG}\\" apply -f -\\napiVersion: crd.k8s.amazonaws.com/v1alpha1\\nkind: ENIConfig\\nmetadata:\\n  name: \\"ap-northeast-2c\\"\\nspec:\\n  subnet: \\"${subnet_c}\\"\\n  securityGroups:\\n  - ${CLUSTER_SG}\\nEOF\\n\\n# remobe creds\\nrm \\"${KUBE_CONFIG}\\"\\n```\\n\\n\ub2e4\uc74c\uc740 \uc704 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc2e4\ud589\ud558\ub294 \ud14c\ub77c\ud3fc \ucf54\ub4dc\uc758 \uc608\uc2dc\uc774\ub2e4.\\n\\n- \uae30\ubcf8\uc801\uc73c\ub85c null_resource\ub97c \uc0ac\uc6a9\ud55c\ub2e4. \\n\\t- https://registry.terraform.io/providers/hashicorp/null/latest/docs/resources/resource\\n- \uc704\uc5d0\uc11c \uc791\uc131\ud55c \uc2a4\ud06c\ub9bd\ud2b8\ub97c network.sh \uc5d0\uc11c \ud658\uacbd\ubcc0\uc218\ub97c \ubc1b\uc544\uc11c \uc2e4\ud589\ud560 \uc218 \uc788\ub3c4\ub85d \uad6c\uc131\ud55c\ub2e4. \\n- eks \ubaa8\ub4c8\uc758 \uc758\uc874\uc131\uc744 \uac78\uc5b4 eks \ud074\ub7ec\uc2a4\ud130 \ubc30\ud3ec\uac00 \uc644\ub8cc\ub41c \uc774\ud6c4\uc5d0 \ud574\ub2f9 \uc2a4\ud06c\ub9bd\ud2b8\uac00 \ub3d9\uc791\ud558\ub3c4\ub85d \ud55c\ub2e4. \\n\\n```terraform\\n# Configure CNI custom network\\nresource \\"null_resource\\" \\"cni_patch\\" {\\n  triggers = {\\n    cluster_name  = local.cluster_name\\n    cluster_sg    = module.eks.cluster_primary_security_group_id\\n    intra_subnets = join(\\",\\", module.vpc.intra_subnets)\\n    content       = file(\\"${path.module}/scripts/network.sh\\")\\n  }\\n  provisioner \\"local-exec\\" {\\n    environment = {\\n      CLUSTER_NAME = self.triggers.cluster_name\\n      CLUSTER_SG   = self.triggers.cluster_sg\\n      SUBNETS      = self.triggers.intra_subnets\\n    }\\n    command     = \\"${path.cwd}/scripts/network.sh\\"\\n    interpreter = [\\"bash\\"]\\n  }\\n  depends_on = [\\n    module.eks\\n  ]\\n}\\n```\\n\\n## \uc815\ub9ac\\n\\n\ucd08\ubc18\uc5d0 \uc5b8\uae09\ud55c EKS CNI Custom Networking \uc81c\uc57d\uc0ac\ud56d\uc744 \ucc98\ub9ac\ud558\uace0 null_resource\ub85c EKS CNI\ub97c \ubc30\ud3ec\ud560 \ub54c \uc6d0\ud558\ub294 \ud615\ud0dc\ub85c \uc218\uc815\ud558\uc5ec `aws_node` \uc7ac\uae30\ub3d9 \uc5c6\uc774 \ubc30\ud3ec\ud558\ub294 \ubc29\ubc95\uc744 \uc791\uc131\ud574\ubd24\ub2e4. \\n\\n\uc0d8\ud50c \ucf54\ub4dc\ub294 \uc544\ub798 \uc800\uc7a5\uc18c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\nhttps://github.com/jinwoongk/eks-cni-custom\\n\\n> \ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4."},{"id":"kubernetes/eks-anywhere-adv/","metadata":{"permalink":"/kubernetes/eks-anywhere-adv/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2022-03-18-eks-anywhere-adv.md","source":"@site/blog/2022-03-18-eks-anywhere-adv.md","title":"EKS Anywhere Advanced Usages","description":"EKS Anywhere \ub85c \uad6c\uc131\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ud65c\uc6a9 ","date":"2022-03-18T00:00:00.000Z","formattedDate":"March 18, 2022","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"vsphere","permalink":"/tags/vsphere"},{"label":"eks anywhere","permalink":"/tags/eks-anywhere"},{"label":"eks connector","permalink":"/tags/eks-connector"},{"label":"eks","permalink":"/tags/eks"},{"label":"opentelemetry","permalink":"/tags/opentelemetry"},{"label":"cilium","permalink":"/tags/cilium"},{"label":"observability","permalink":"/tags/observability"},{"label":"prometheus","permalink":"/tags/prometheus"},{"label":"grafana","permalink":"/tags/grafana"},{"label":"loki","permalink":"/tags/loki"},{"label":"microservice","permalink":"/tags/microservice"},{"label":"istio","permalink":"/tags/istio"}],"readingTime":17.06,"truncated":true,"authors":[{"name":"Jinwoong Kim","title":"Technologist and Cloud Consultant","url":"https://www.linkedin.com/in/ddiiwoong/","imageURL":"https://s.gravatar.com/avatar/e8bfebcbeacb5b9a0c90614e792febf2?s=80","key":"jinwoong"}],"frontMatter":{"layout":"single","title":"EKS Anywhere Advanced Usages","comments":true,"classes":"wide","description":"EKS Anywhere \ub85c \uad6c\uc131\ub41c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ud65c\uc6a9 ","authors":"jinwoong","toc":true,"toc_label":"Table of Contents","slug":"kubernetes/eks-anywhere-adv/","date":"2022-03-18T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","vsphere","eks anywhere","eks-anywhere","eks connector","eks","opentelemetry","cilium","observability","prometheus","grafana","loki","microservice","istio"]},"prevItem":{"title":"EKS CNI Custom Networking","permalink":"/kubernetes/eks-cni-custom/"},"nextItem":{"title":"EKS Anywhere on vSphere Homelab","permalink":"/kubernetes/eks-anywhere/"}},"content":"\uc9c0\ub09c\uae00\uc5d0 \uc774\uc5b4 \uc774\ubc88\uc5d0\ub294 \ud648\ub7a9\uc73c\ub85c \uad6c\uc131\ud55c EKS Anywhere \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc6b4\uc601, \uac1c\ubc1c\ud658\uacbd \uad6c\uc131\uc744 \uc704\ud55c \uc5ec\ub7ec\uac00\uc9c0 \ub3c4\uad6c\ub97c \uc124\uce58\ud574\ubcf4\ub294 \uacfc\uc815\uc744 \uc815\ub9ac\ud558\uace0\uc790 \ud55c\ub2e4. \\n\\n\uc9c0\ub09c \ud3ec\uc2a4\ud305\uc740 \ub2e4\uc74c \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n> \uc774\uc804\uae00 - [vSphere homelab \ud658\uacbd\uc5d0\uc11c EKS Anywhere \uad6c\uc131\ud558\uae30](https://ddii.dev/kubernetes/eks-anywhere/)\\n\\n\x3c!--truncate--\x3e\\n\\n## EKS Connector\\n\\nEKS Connector\ub97c \ud1b5\ud574 EKS Anywhere\ub97c \ud3ec\ud568\ud55c \uc678\ubd80\uc758 \ubaa8\ub4e0 \ud074\ub7ec\uc2a4\ud130\ub97c AWS \ucf58\uc194\uc5d0 \uc5f0\uacb0\ud560 \uc218 \uc788\ub2e4. eks connector \ucee8\ud14c\uc774\ub108\ub97c \ud1b5\ud574 proxy \ud615\ud0dc\ub85c \uc678\ubd80 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 API\uc11c\ubc84\uc5d0\uc11c \uc815\ubcf4\ub97c \uac00\uc838\uc640 AWS System Manager\ub85c \uc804\ub2ec\ud558\ub294 \ube44\ub3d9\uae30 \ubc29\uc2dd\uc73c\ub85c \uc6cc\ud06c\ub85c\ub4dc \uad00\ub9ac\ub97c \uc9c4\ud589\ud55c\ub2e4.\\n\\n- \uc720\uc800\uac00\uc774\ub4dc - [https://docs.aws.amazon.com/eks/latest/userguide/eks-connector.html](https://docs.aws.amazon.com/eks/latest/userguide/eks-connector.html)  \\n- AWS \ube14\ub85c\uadf8 - [https://aws.amazon.com/blogs/containers/connect-any-kubernetes-cluster-to-amazon-eks/](https://aws.amazon.com/blogs/containers/connect-any-kubernetes-cluster-to-amazon-eks/)\\n\\n### \ud074\ub7ec\uc2a4\ud130 \ub4f1\ub85d\\n\\n![overview](https://d2908q01vomqb2.cloudfront.net/fe2ef495a1152561572949784c16bf23abb28057/2021/09/15/Screen-Shot-2021-09-03-at-4.28.27-PM.png)\\n\\nEKS Anywhere\ub97c \ud3ec\ud568\ud55c \uc678\ubd80 K8s \ud074\ub7ec\uc2a4\ud130\ub294 AWS CLI, eksctl, \ucf58\uc194\uc744 \uc0ac\uc6a9\ud574\uc11c \ub4f1\ub85d(register)\uc774 \uac00\ub2a5\ud558\ub2e4. eksctl\ub85c \ub4f1\ub85d\uc744 \uc9c4\ud589\ud558\uba74 \uba3c\uc800 \uad00\ub828\ub41c Role\uc744 \uc0dd\uc131\ud574\uc8fc\uace0 \ub610\ud55c ClusterRole, ClusterRoleBinding \ubc0f Connector StatefulSet\uc744 \ubc30\ud3ec\ud560 \uc218 \uc788\ub3c4\ub85d \uc790\ub3d9\uc73c\ub85c manifest\ub97c \uc0dd\uc131\ud574\uc8fc\uae30 \ub54c\ubb38\uc5d0 eksctl\ub85c \ud074\ub7ec\uc2a4\ud130 \ub4f1\ub85d\uc744 \uc9c4\ud589\ud558\ub294 \uac83\uc774 \ud3b8\ud558\ub2e4. AWS Managed IAM \uc5ed\ud560\uc778 `AWSServiceRoleForAmazonEKSConnector`\uc744 \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc744 \uc9c4\ud589\ud558\uae30 \ub54c\ubb38\uc5d0 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\uc744 \ud55c\ub2e4. \uc5d0\ub7ec\uac00 \ub09c \uc774\ud6c4\uc5d0 AWS \ucf58\uc194\uc774\ub098 CLI\ub97c \ud1b5\ud574 \ud655\uc778\ud558\uba74 \uc0c8\ub86d\uac8c \uc0dd\uc131\ub41c `AWSServiceRoleForAmazonEKSConnector` IAM \uc5ed\ud560\uacfc \ud574\ub2f9 \uc5ed\ud560\uc5d0 \uc5f0\uacb0\ub41c Policy\uc778 `AmazonEKSConnectorServiceRolePolicy`\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```sh\\n> eksctl register cluster --name homelab --provider eks_anywhere --profile jinwoong\\n\\n2022-03-09 18:50:44 [\u2139]  creating IAM role \\"eksctl-20220309185044427640\\"\\n2022-03-09 18:50:49 [\u2139]  deleting IAM role \\"eksctl-20220309185044427640\\"\\nError: error registering cluster: error calling RegisterCluster: ResourcePropagationDelayException: Service linked role \'arn:aws:iam::492935017096:role/aws-service-role/eks-connector.amazonaws.com/AWSServiceRoleForAmazonEKSConnector\' is propagating, please retry later.\\n```\\n\\n\uc2e4\ud328\ub97c \uc9c4\ud589\ud55c \ud6c4\uc5d0 \ub2e4\uc2dc \ub4f1\ub85d \uc2dc\ub3c4\ub97c \ud558\uba74 \uc544\ub798 \ucd9c\ub825\ub85c\uadf8\uc640 \uac19\uc774 \uba85\ub839\uc5b4\ub97c \uc2e4\ud589\ud55c \ub514\ub809\ud1a0\ub9ac\uc5d0 EKS Connector \uad00\ub828 \ub9ac\uc18c\uc2a4 manifests(eks-connector.yaml,eks-connector-clusterrole.yaml,eks-connector-console-dashboard-full-access-group.yaml)\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```\\n> eksctl register cluster --name homelab --provider eks_anywhere --profile jinwoong\\n2022-03-08 22:59:15 [\u2139\ufe0f]  creating IAM role \\"eksctl-20220308225915739385\\"\\n2022-03-08 22:59:29 [\u2139\ufe0f]  registered cluster \\"homelab\\" successfully\\n2022-03-08 22:59:29 [\u2139\ufe0f]  wrote file eks-connector.yaml to /Users/jinwoong/study/eks-anywhere-homelab\\n2022-03-08 22:59:29 [\u2139\ufe0f]  wrote file eks-connector-clusterrole.yaml to /Users/jinwoong/study/eks-anywhere-homelab\\n2022-03-08 22:59:29 [\u2139\ufe0f]  wrote file eks-connector-console-dashboard-full-access-group.yaml to /Users/jinwoong/study/eks-anywhere-homelab\\n2022-03-08 22:59:29 [!]  note: \\"eks-connector-clusterrole.yaml\\" and \\"eks-connector-console-dashboard-full-access-group.yaml\\" give full EKS Console access to IAM identity \\"arn:aws:iam::492935017096:user/jinwoong\\", edit if required; read https://docs.aws.amazon.com/eks/latest/userguide/connector-grant-access.html for more info\\n2022-03-08 22:59:29 [\u2139\ufe0f]  run kubectl apply -f eks-connector.yaml,eks-connector-clusterrole.yaml,eks-connector-console-dashboard-full-access-group.yaml before 11 Mar 22 13:59 UTC to connect the cluster\\n```\\n\\neks-connector.yaml \uc5d0\ub294 `Namespace`, `Secret`, `Role`, `ServiceAccount`, `RoleBinding`, `ConfigMap`\uacfc \ubc30\ud3ec\ub420 `StatefulSet` \uc774 \ub2f4\uaca8\uc788\uc5b4 \ud574\ub2f9 \ud30c\uc77c\uc740 \uadf8\ub300\ub85c \uc0ac\uc6a9\ud558\uba74 \ub41c\ub2e4.\\n\\n\ud558\uc9c0\ub9cc \uc2e4\uc81c \ucf58\uc194\uc5d0\uc11c \ub178\ub4dc\uc640 \uc6cc\ud06c\ub85c\ub4dc \uc815\ubcf4\ub97c \ubcf4\uae30 \uc704\ud574\uc11c eks-connector-console-dashboard-full-access-group.yaml\uc5d0 \ucf58\uc194 \uc811\uc18d\uc774 \ud544\uc694\ud55c IAM \uc0ac\uc6a9\uc790\uc640 \uc811\uadfc\uc744 \uc704\ud55c \ud2b9\uc815 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uc815\ubcf4\ub97c `ClusterRole` \ubc0f `ClusterRoleBinding`\uc5d0 \ucd94\uac00\ud574\uc57c \ud55c\ub2e4. \\n\\n\uc790\uc138\ud55c \ub0b4\uc6a9\uc740 [https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/connector-grant-access.html](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/connector-grant-access.html)\uc5d0\uc11c \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4. \\n\\n\uc704\uc5d0\uc11c \uc0dd\uc131\ub41c manifests\uac00 EKS Anywhere \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc801\uc6a9\ub418\uba74 StatefulSet \ud615\ud0dc\ub85c \ubc30\ud3ec\ub41c EKS Connect \uc5d0\uc774\uc804\ud2b8\ub294 Amazon EventBridge\ub97c \ud1b5\ud574 EKS\uc5d0 \uc54c\ub9bc\uc744 \ubcf4\ub0b4\ub294 System Manager \uc11c\ube44\uc2a4\uc5d0 \uc5f0\uacb0\ud55c\ub2e4. \uc774\ud6c4 EKS Connect\ub294 \uc5f0\uacb0\ub41c \ud074\ub7ec\uc2a4\ud130\uc758 kubernetes API \uc11c\ubc84\uc5d0 EKS \ucf58\uc194 \uc694\uccad\uc744 \uc804\ub2ec\ud558\ubbc0\ub85c \uc0dd\uc131\ud55c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub97c EKS Connect \uc5ed\ud560\uacfc \uc5f0\uacb0\ud558\uc5ec AWS IAM \uc5d4\ud2f0\ud2f0\ub97c \uac00\uc7a5(impersonate) \ud560 \uc218\uc788\ub294 \uad8c\ud55c\uc744 \ubd80\uc5ec\ud558\uac8c \ub41c\ub2e4. \\n\\nstatefulset\uc744 \uc880\ub354 \uc0b4\ud3b4\ubcf4\uba74 \uc704\uc5d0\uc11c \uc774\uc57c\uae30\ud558\ub294 \uc5d0\uc774\uc804\ud2b8 \uc5ed\ud560\uc744 \ud558\ub294 `connector-agent` \uc640 \ud504\ub85d\uc2dc \uc5ed\ud560\uc744 \ud558\ub294 `connector-proxy` \ucee8\ud14c\uc774\ub108 \ub450\uac1c\uac00 \ub5a0\uc788\ub294\uac78 \ubcfc \uc218 \uc788\ub2e4. \uc0ac\uc6a9\uc790\uac00 \ucf58\uc194\uc5d0\uc11c \ud574\ub2f9 \ud074\ub7ec\uc2a4\ud130\uc758 \ub178\ub4dc\ub098 \uc6cc\ud06c\ub85c\ub4dc \uc815\ubcf4\ub97c \uc870\ud68c\ud558\uac8c \ub418\uba74 EKS\ub294 System Manager \uc11c\ube44\uc2a4\uc5d0\uac8c \uc138\uc158\uc744 \uc694\uccad\ud558\uace0 \uc774\ud6c4 System Manager\uac00 \ube44\ub3d9\uae30 \ubc29\uc2dd\uc73c\ub85c `connector-agent` \ucee8\ud14c\uc774\ub108\ub97c invoke\ud558\uba74 `connector-proxy` \ucee8\ud14c\uc774\ub108 \uc704\uc5d0\uc11c \ub9c8\uc6b4\ud2b8\ub41c \uc11c\ube44\uc2a4 \uc5b4\uce74\uc6b4\ud2b8\ub85c \uc778\uc99d\uc744 \ud558\uace0 \uac00\uc7a5(impersonation)\ud55c \uc0c1\ud0dc\ub85c EKS Anywhere \ud074\ub7ec\uc2a4\ud2b8\uc758 API\ub97c \ud638\ucd9c\ud574\uc11c \uad00\ub828\ub41c \ub0b4\uc6a9\uc744 \uac00\uc838\uc640\uc11c \ubcf4\uc5ec\uc8fc\uac8c \ub41c\ub2e4.\\n\\n![connector](https://d2908q01vomqb2.cloudfront.net/fe2ef495a1152561572949784c16bf23abb28057/2021/09/15/Screen-Shot-2021-09-05-at-7.51.33-AM.png)\\n\\n\\n```sh\\n> kubectl describe statefulset eks-connector -n eks-connector\\nName:               eks-connector\\nNamespace:          eks-connector\\nCreationTimestamp:  Wed, 09 Mar 2022 22:53:23 +0900\\nSelector:           app=eks-connector\\nLabels:             app=eks-connector\\nAnnotations:        <none>\\nReplicas:           2 desired | 2 total\\nUpdate Strategy:    RollingUpdate\\n  Partition:        0\\nPods Status:        2 Running / 0 Waiting / 0 Succeeded / 0 Failed\\nPod Template:\\n  ...\\n  Containers:\\n   connector-agent:\\n    Image:      public.ecr.aws/amazon-ssm-agent/amazon-ssm-agent:3.1.90.0\\n    Port:       <none>\\n    Host Port:  <none>\\n    Environment:\\n      AWS_EC2_METADATA_DISABLED:  true\\n    Mounts:\\n      /etc/amazon/ssm/amazon-ssm-agent.json from eks-agent-config (rw,path=\\"amazon-ssm-agent.json\\")\\n      /etc/amazon/ssm/seelog.xml from eks-agent-config (rw,path=\\"seelog.xml\\")\\n      /var/eks/shared from eks-connector-shared (rw)\\n      /var/lib/amazon/ssm/Vault from eks-agent-vault (rw)\\n   connector-proxy:\\n    Image:      public.ecr.aws/eks-connector/eks-connector:0.0.3\\n    Port:       <none>\\n    Host Port:  <none>\\n    Args:\\n      server\\n    Environment:\\n      POD_NAME:   (v1:metadata.name)\\n    Mounts:\\n      /var/eks/shared from eks-connector-shared (rw)\\n      /var/lib/amazon/ssm/Vault from eks-agent-vault (rw)\\n      /var/run/secrets/kubernetes.io/serviceaccount from service-account-token (rw)\\n  ...\\n```\\n## Istio \ud658\uacbd \uad6c\uc131\\n\\nIstio \ud658\uacbd\uc5d0\uc11c \uc571\uc744 \ubc30\ud3ec\ud558\uace0 Tracing \uac00\uc2dc\uc131 \ud655\ubcf4\ub97c \ud558\ub294 \uc2e4\uc2b5\uc744 \uc9c4\ud589\ud558\uae30 \uc704\ud574 \uac04\ub2e8\ud558\uac8c \uad6c\uc131\uc5d0 \ub300\ud55c \uadf8\ub9bc\uc744 \uadf8\ub824\ubd24\ub2e4. \\n\\n![istio](/img/istio_o11y.png)\\n\\nIstio \ud658\uacbd\uc5d0\uc11c sidecar \ud615\ud0dc\ub85c envoy proxy\uac00 \uac01 Observability \uad6c\uc131\uc694\uc18c\ub85c \ub370\uc774\ud130\uac00 \uc804\ub2ec\ub418\ub3c4\ub85d \uad6c\uc131\ud55c\ub2e4. \uc774\ub54c \uc0ac\uc6a9\ub418\ub294 \uc624\ud508\uc18c\uc2a4 \uc2a4\ud0dd\uc740 \ub2e4\uc74c\uacfc \uac19\ub2e4.\\n\\n- Tracing \\n  - Collect : [OpenTelemetry Collector](https://github.com/open-telemetry/opentelemetry-collector)\\n  - Backend : [Tempo](https://github.com/grafana/tempo)\\n\\n- Logging\\n  - Collect : [Fluentbit](https://github.com/fluent/fluent-bit)\\n  - Backend : [Loki](https://github.com/grafana/loki)\\n\\n- Metrics\\n  - Collect : [Exporters](https://istio.io/latest/docs/ops/integrations/prometheus/)\\n  - Backend : [Prometheus](https://github.com/prometheus)\\n\\n- Visualization\\n  - [Grafana](https://github.com/grafana/grafana)\\n\\n### Istio \uc124\uce58\\n\\nIstioOperator\ub97c \ud1b5\ud574 Istio\ub97c \uc124\uce58\ud55c\ub2e4.\\n\\n```sh\\n> istioctl operator init\\n```\\n\\nIstioOperator\uac00 \uc124\uce58\ub418\uba74 \ub9ac\uc18c\uc2a4\ub97c \ubc30\ud3ec\ud558\uc5ec istio \uc11c\ube44\uc2a4\ub97c \uc0dd\uc131\ud560 \uc218 \uc788\ub2e4. envoy proxy\uc5d0\ub294 \ub2e4\uc591\ud55c \ud5e4\ub354\ub4e4\uc744 \ud1b5\ud574 trace \uc815\ubcf4\ub97c propagate \ud560 \uc218 \uc788\ub2e4. \ub2e4\uc74c\uacfc \uac19\uc774 `x-b3-traceid`\ub97c traceid\ub85c \ub85c\uadf8 \ud3ec\ub9f7\uc744 \uad6c\uc131\ud558\ub3c4\ub85d \ud558\uace0 trace \ud65c\uc131\ud654\ub97c \uc704\ud574 `enableTracing: true` \ub97c \uc124\uc815\ud558\uace0 Prometheus\uc5d0\uc11c \uc2a4\ud06c\ub7a9\uc744 \ud560 \uc218 \uc788\ub3c4\ub85d `enablePrometheusMerge: true`\ub85c \uc124\uc815\ud55c\ub2e4.\\n\\n\ub9c8\uc9c0\ub9c9\uc73c\ub85c zipkin \ud504\ub85c\ud1a0\ucf5c\ub85c OpenTelemetry Collector\ub85c \uc804\ub2ec\ud560\uac83\uc774\uae30 \uc5d4\ub4dc\ud3ec\uc778\ub4dc \uc815\ubcf4\ub3c4 \ubbf8\ub9ac \uc791\uc131\ud588\ub2e4.\\n\\n```yaml\\napiVersion: install.istio.io/v1alpha1\\nkind: IstioOperator\\nmetadata:\\n  name: istio-operator\\n  namespace: istio-system\\nspec:\\n  profile: default\\n  meshConfig:\\n    accessLogFile: /dev/stdout\\n    accessLogFormat: |\\n      [%START_TIME%] \\"%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\" %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\\" %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\"%REQ(X-FORWARDED-FOR)%\\" \\"%REQ(USER-AGENT)%\\" \\"%REQ(X-REQUEST-ID)%\\" \\"%REQ(:AUTHORITY)%\\" \\"%UPSTREAM_HOST%\\" %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME% traceID=%REQ(x-b3-traceid)%\\n    enableTracing: true\\n    enablePrometheusMerge: true\\n    defaultConfig:\\n      tracing:\\n        sampling: 100\\n        max_path_tag_length: 99999\\n        zipkin:\\n          address: otel-collector.tracing.svc:9411\\n```\\n\\nIstio\uc758 \ub300\ud45c\uc801\uc778 \uc0d8\ud50c\uc571\uc778 [bookinfo](https://istio.io/latest/docs/examples/bookinfo/)\ub97c `bookinfo` \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \uc124\uce58\ud55c\ub2e4.\\n\\n```\\n> kubectl create ns bookinfo\\n> kubectl label namespace bookinfo istio-injection=enabled --overwrite\\n> kubectl apply -n bookinfo -f https://raw.githubusercontent.com/istio/istio/release-1.10/samples/bookinfo/platform/kube/bookinfo.yaml\\n```\\n\\n\uc11c\ube44\uc2a4 \uc811\uadfc\uc744 \uc704\ud55c `Gateway`\uc640 `VirtualService` \ub3c4 \uad6c\uc131\ud55c\ub2e4. \\n\\n```yaml\\napiVersion: networking.istio.io/v1alpha3\\nkind: Gateway\\nmetadata:\\n  name: bookinfo-gateway\\n  namespace: bookinfo\\nspec:\\n  selector:\\n    istio: ingressgateway # use istio default controller\\n  servers:\\n  - port:\\n      number: 80\\n      name: http\\n      protocol: HTTP\\n    hosts:\\n    - \\"*\\" # Mind the hosts. This matches all\\n---\\napiVersion: networking.istio.io/v1alpha3\\nkind: VirtualService\\nmetadata:\\n  name: bookinfo\\n  namespace: bookinfo\\nspec:\\n  hosts:\\n  - \\"*\\"\\n  gateways:\\n  - tracing/bookinfo-gateway\\n  - bookinfo-gateway\\n  http:\\n  - match:\\n    - uri:\\n        prefix: \\"/\\"\\n    route:\\n    - destination:\\n        host: productpage.bookinfo.svc.cluster.local\\n        port:\\n          number: 9080\\n```\\n\\n\uc11c\ube44\uc2a4 \ud655\uc778\uc744 \uc704\ud574 `LoadBalancer`\ub85c \uad6c\uc131\ub41c istio-ingressgateway EXTERNAL-IP\uc778 [http://192.168.31.10/productpage](http://192.168.31.10/productpage)\ub85c \uc811\uc18d\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```\\n\u276f kubectl get svc -n istio-system\\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)                                      AGE\\nistio-ingressgateway   LoadBalancer   10.97.92.31      192.168.31.10   15021:30184/TCP,80:32738/TCP,443:31058/TCP   2d23h\\nistiod                 ClusterIP      10.107.186.201   <none>          15010/TCP,15012/TCP,443/TCP,15014/TCP        2d23h\\n```\\n\\n## metric-server \uc124\uce58\\n\\n[https://github.com/kubernetes-sigs/metrics-server](https://github.com/kubernetes-sigs/metrics-server)\\n\\nHPA \ub098 Kubernetes \ub300\uc2dc\ubcf4\ub4dc\ub97c \ud65c\uc6a9\ud558\uae30 \uc704\ud574\uc11c metric-server\ub97c \uc124\uce58\ud55c\ub2e4. kubelet tls \uc778\uc99d\uc11c \uc5d0\ub7ec\uac00 \ub0a0 \uacbd\uc6b0 \uc124\uce58 \ud30c\uc77c\uc744 \ubc1b\uc544\uc11c ARG\uc5d0 `--kubelet-insecure-tls` \ud50c\ub798\uadf8\ub97c \ucd94\uac00\ud574\uc11c \uc124\uce58\ud558\uba74 \ub41c\ub2e4.\\n\\n```\\n> kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml\\nserviceaccount/metrics-server created\\nclusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created\\nclusterrole.rbac.authorization.k8s.io/system:metrics-server created\\nrolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created\\nclusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created\\nclusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created\\nservice/metrics-server created\\ndeployment.apps/metrics-server created\\napiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created\\n\\n> kubectl top nodes\\nNAME             CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   \\n192.168.31.186   175m         9%     2228Mi          29%       \\n192.168.31.187   82m          4%     893Mi           11%       \\n192.168.31.188   64m          3%     795Mi           10%       \\n192.168.31.189   134m         6%     1817Mi          23%       \\n192.168.31.190   43m          2%     636Mi           8% \\n```\\n\\n## Observability Stack \uc124\uce58\\n\\n\ucc28\ud2b8\ub85c \uc77c\uad04\ubc30\ud3ec\ub97c \uc704\ud574 [Loki-stack](https://github.com/grafana/helm-charts/tree/main/charts/loki-stack)\ub97c \uc0ac\uc6a9\ud588\uace0, \ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c \uad6c\uc131\uc73c\ub85c \uad6c\uc131 \ubcc0\uacbd\uc744 \ud55c chart values\ub294 \ub2e4\uc74c\uacfc \uac19\ub2e4. \\n\\n- [Prometheus](https://github.com/prometheus) - \uc2dc\uacc4\uc5f4 \ub370\uc774\ud130(\uba54\ud2b8\ub9ad)\uc744 \uc218\uc9d1\ud558\uace0 \uc800\uc7a5\ud558\ub294 \ud504\ub85c\uc81d\ud2b8\uc774\uba70, \ud0a4-\ubc38\ub958 \ud615\ud0dc\ub85c \ucffc\ub9ac\uc640 \uc5f0\uc0b0\uc774 \uac00\ub2a5\ud55c \ubaa8\ub2c8\ud130\ub9c1 \uc2dc\uc2a4\ud15c\uc774\ub2e4. node-exporter, alertmanager, pushgateway \ub3c4 \ucc28\ud2b8\ub85c \uac19\uc774 \uc124\uce58\ud55c\ub2e4. \\n- [Grafana](https://github.com/grafana/grafana) - \ub370\uc774\ud130\ub97c \uc2dc\uac01\ud654\ud558\ub294 \ud50c\ub7ab\ud3fc\uc73c\ub85c \ub2e4\uc591\ud55c \ub85c\uadf8, \uba54\ud2b8\ub9ad, \ud2b8\ub808\uc774\uc2a4 \ub370\uc774\ud130\ub97c \uc2dc\uc791\ud654\ud558\uace0 \uc54c\ub9bc \uad00\ub9ac\ub97c \ud560 \uc218 \uc788\ub2e4.\\n- [Loki](https://github.com/grafana/loki) - \ub2e4\ub978 \ub85c\uae45 \uc2dc\uc2a4\ud15c\uacfc \ub2ec\ub9ac \ub85c\uadf8\ub97c \uc81c\uc678\ud55c \uba54\ud0c0\ub370\uc774\ud130 \uc778\ub371\uc2f1\ub9cc \ud558\uae30 \ub54c\ubb38\uc5d0 Prometheus\ucc98\ub7fc \ub808\uc774\ube14\uc744 \uc5fc\ub450\uc5d0 \ub450\uace0 \uc124\uacc4\ub41c \ub85c\uae45 \ub370\uc774\ud130\uc2a4\ud1a0\uc5b4 \uc2dc\uc2a4\ud15c\uc774\ub2e4.\\n- [Fluent Bit](https://github.com/fluent/fluent-bit) - \ub85c\uae45 \uceec\ub809\ud130(Collector)\ub85c fluentd \ubcf4\ub2e4 \uacbd\ub7c9\ud654\ub418\uace0 \ube60\ub978 \ub85c\uadf8 \ud504\ub85c\uc138\uc2a4\uc774\uc790 \uc804\ub2ec\uc790(Forwarder)\ub85c \ub2e4\ub978 \ub85c\uae45 \uceec\ub809\ud130\uc778 promtail, filebeat, logstash\ub294 false\ub85c \uc124\uc815\ud55c\ub2e4. \\n- [Tempo](https://github.com/grafana/tempo) - Tempo\ub294 \ubd84\uc0b0 \ucd94\uc801(Tracing)\uc744 \uc704\ud55c \ube44\uc6a9 \ud6a8\uc728\uc801\uc778 \ubc31\uc5d4\ub4dc \ub370\uc774\ud130\uc2a4\ud1a0\uc5b4 \ud504\ub85c\uc81d\ud2b8\ub85c \uc704\uc5d0\uc11c \uad6c\uc131\ud55c Prometheus, Grafana, Loki \ub4f1\uacfc \uac19\uc740 \ub2e4\ub978 Observability \ud504\ub85c\uc81d\ud2b8\uc640 \ud1b5\ud569\uc774 \uc26c\uc6b4\uac83\uc774 \ud2b9\uc9d5\uc774\ub2e4.\\n\\n### Prometheus, Loki \uc124\uce58\\n\\n`Prometheus`\uc640 `Loki`\ub294 Loki-Stack\uc73c\ub85c \uad6c\uc131\ud55c\ub2e4. fluent-bit\ub294 \ubcc4\ub3c4 \uad6c\uc131 \ud30c\uc77c\uc744 \ud544\uc694\ub85c \ud558\uae30 \ub54c\ubb38\uc5d0 \ub098\uc911\uc5d0 \uc124\uce58\ud560 \uc608\uc815\uc774\ub2e4. Prometheus\ub294 Persistent Volume\uc740 \ubcc4\ub3c4\ub85c \uad6c\uc131\ud558\uc9c0 \uc54a\uc740 \uc0c1\ud0dc\ub85c `persistentVolume`\uc744 `false`\ub85c \uc124\uc815\ud558\uc5ec \ubc30\ud3ec\ud55c\ub2e4.\\n\\n```sh\\n> kubectl create ns tracing\\n> helm repo add grafana https://grafana.github.io/helm-charts\\n> helm repo update\\n> helm install loki grafana/loki-stack --version 2.4.1 -n tracing -f - << \'EOF\'\\nfluent-bit:\\n  enabled: false\\npromtail:\\n  enabled: false\\nprometheus:\\n  enabled: true\\n  server:\\n    persistentVolume:\\n      enabled: false\\n  alertmanager:\\n    persistentVolume:\\n      enabled: false\\nEOF\\n```\\n\\n`Tempo`\ub294 \ub85c\uadf8 \uc815\ubcf4\uc640 tracing\uc744 \uc218\uc2e0\ud560 \ub9ac\uc2dc\ubc84 \ud504\ub85c\ud1a0\ucf5c \ub4e4(zipkin, otlp)\uc744 \uc815\uc758\ud55c \ucc44\ub85c Chart\ub85c \ubc30\ud3ec\ud55c\ub2e4. \\n\\n```sh\\nhelm install tempo grafana/tempo --version 0.7.4 -n tracing -f - << \'EOF\'\\ntempo:\\n  extraArgs:\\n    \\"distributor.log-received-traces\\": true\\n  receivers:\\n    zipkin:\\n    otlp:\\n      protocols:\\n        http:\\n        grpc:\\nEOF\\n```\\n\\n### OpenTelemetry Collector \uad6c\uc131\\n\\n\uc774\uc81c\uae4c\uc9c0 observability \uad00\ub828 \ub370\uc774\ud130 \uc800\uc7a5\uc18c\ub4e4\uc744 \uad6c\uc131\ud588\uc73c\ub2c8 \ub9c8\uc9c0\ub9c9\uc73c\ub85c \ud2b8\ub808\uc774\uc2f1\uc744 \uc704\ud55c \ub3c4\uad6c\uc778 [OpenTelemetry Collector](https://opentelemetry.io/docs/collector/getting-started/)\ub97c \uc124\uce58\ud55c\ub2e4. \\n\\n```yaml\\napiVersion: v1\\nkind: ConfigMap\\nmetadata:\\n name: otel-collector-conf\\n labels:\\n   app: opentelemetry\\n   component: otel-collector-conf\\ndata:\\n otel-collector-config: |\\n   receivers:   \\n     zipkin:\\n        endpoint: 0.0.0.0:9411\\n   exporters:\\n     otlp:\\n       endpoint: tempo.tracing.svc.cluster.local:55680\\n       insecure: true\\n   service:\\n     pipelines:\\n       traces:\\n         receivers: [zipkin]\\n         exporters: [otlp]\\n```\\n\\n\ucd08\uae30 Collect \uad6c\uc131 \ucee8\ud53c\uadf8\ub294 \ub2e4\ub984\uacfc \uac19\uc774 \uc124\uc815\ud588\ub2e4. \uc790\uc138\ud55c \uc124\uc815 \ubc29\ubc95\uc740 [https://opentelemetry.io/docs/collector/configuration/](https://opentelemetry.io/docs/collector/configuration/)\uc5d0\uc11c \ud655\uc778\uac00\ub2a5\ud558\ub2e4.\\n\\n- `spec.config.receivers.zipkin.endpoint`\ub294 trace\uc815\ubcf4\ub97c \ubc1b\uc744 \uc5d4\ub4dc\ud3ec\uc778\ud2b8 \uad6c\uc131\uc73c\ub85c zipkin \ud3ec\ub9f7\uc73c\ub85c \uc218\uc2e0\ud55c\ub2e4. \\n- `spec.config.exporters[]`\uc5d0\uc11c\ub294 Tempo\ub85c \ubcf4\ub0b4\uae30 \uc704\ud55c endpoint \uc124\uc815\uc744 \ud55c\ub2e4.\\n- `spec.config.service`\uc5d0\uc11c\ub294 \uc774\ud6c4 collector\uc5d0\uc11c \uc0ac\uc6a9\ud560 protocol\uc774\ub098 backend datasource \uc5d0 \ub300\ud55c \uc124\uc815\uc774\uba70 \ubc18\ub4dc\uc2dc \ud65c\uc131\ud654\uac00 \ub418\uc5b4\uc57c \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n\\n\\n```yaml\\napiVersion: v1\\nkind: Service\\nmetadata:\\n  name: otel-collector\\n  labels:\\n    app: opentelemetry\\n    component: otel-collector\\nspec:\\n  ports:\\n  - name: otlp # Default endpoint for OpenTelemetry receiver.\\n    port: 55680\\n    protocol: TCP\\n    targetPort: 55680\\n  - name: jaeger-grpc # Default endpoint for Jaeger gRPC receiver\\n    port: 14250\\n  - name: jaeger-thrift-http # Default endpoint for Jaeger HTTP receiver.\\n    port: 14268\\n  - name: zipkin # Default endpoint for Zipkin receiver.\\n    port: 9411\\n  - name: metrics # Default endpoint for querying metrics.\\n    port: 8888\\n  - name: prometheus # prometheus exporter\\n    port: 8889\\n  selector:\\n    component: otel-collector\\n```\\n\\nService\uc5d0\uc11c \uc8fc\ub8cc \uc0ac\uc6a9\ud558\uac8c\ub420 \ud3ec\ud2b8\ub294 `zipkin`\uc758 `9411`\uc774\ub2e4.\\n\\n\\n```yaml\\napiVersion: apps/v1\\nkind: Deployment\\nmetadata:\\n  name: otel-collector\\n  labels:\\n    app: opentelemetry\\n    component: otel-collector\\nspec:\\n  selector:\\n    matchLabels:\\n      app: opentelemetry\\n      component: otel-collector\\n  template:\\n    metadata:\\n      labels:\\n        app: opentelemetry\\n        component: otel-collector\\n    spec:\\n      containers:\\n      - command:\\n          - \\"/otelcontribcol\\"\\n          - \\"--config=/conf/otel-collector-config.yaml\\"\\n          - \\"--mem-ballast-size-mib=683\\"\\n          - \\"--log-level=DEBUG\\"\\n        image: otel/opentelemetry-collector-contrib:0.29.0\\n        name: otel-collector\\n        ports:\\n        - containerPort: 55679 # Default endpoint for ZPages.\\n        - containerPort: 55680 # Default endpoint for OpenTelemetry receiver.\\n        - containerPort: 14250 # Default endpoint for Jaeger HTTP receiver.\\n        - containerPort: 14268 # Default endpoint for Jaeger HTTP receiver.\\n        - containerPort: 9411 # Default endpoint for Zipkin receiver.\\n        - containerPort: 8888  # Default endpoint for querying metrics.\\n        - containerPort: 8889  # prometheus exporter       \\n        volumeMounts:\\n        - name: otel-collector-config-vol\\n          mountPath: /conf\\n      volumes:\\n        - configMap:\\n            name: otel-collector-conf\\n            items:\\n              - key: otel-collector-config\\n                path: otel-collector-config.yaml\\n          name: otel-collector-config-vol\\n```\\n\\n\\n### Fluentbit \uad6c\uc131\\n\\n\ud074\ub7ec\uc2a4\ud130 dataplane\uacfc controlplane\uc758 logging \ub370\uc774\ud130\ub97c `Loki` \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub85c \uc804\ub2ec\ud558\uae30 \uc704\ud55c config\ub85c \ud655\uc778\ud558\uace0 Chart\ub97c \ubc30\ud3ec\ud55c\ub2e4. \\n\\n```sh\\n> helm repo add fluent https://fluent.github.io/helm-charts\\n> helm repo update\\n> helm install fluent-bit fluent/fluent-bit --version 0.16.1 -n tracing -f - << \'EOF\'\\nlogLevel: trace\\nconfig:\\n  service: |\\n    [SERVICE]\\n        Flush 1\\n        Daemon Off\\n        Log_Level trace\\n        Parsers_File custom_parsers.conf\\n        HTTP_Server On\\n        HTTP_Listen 0.0.0.0\\n        HTTP_Port {{ .Values.service.port }}\\n  inputs: |\\n    [INPUT]\\n        Name tail\\n        Path /var/log/containers/*.log\\n        Parser cri\\n        Tag kube.*\\n        Mem_Buf_Limit 5MB\\n  outputs: |\\n    [OUTPUT]\\n        name loki\\n        match *\\n        host loki.tracing.svc\\n        port 3100\\n        tenant_id \\"\\"\\n        labels job=fluentbit\\n        label_keys $trace_id\\n        auto_kubernetes_labels on\\n  customParsers: |\\n    [PARSER]\\n        Name cri\\n        Format regex\\n        Regex ^(?<time>[^ ]+) (?<stream>stdout|stderr) (?<logtag>[^ ]*) (?<message>.*)$\\n        Time_Key    time\\n        Time_Format %Y-%m-%dT%H:%M:%S.%L%z\\nEOF\\n```\\n\\n\ub9c8\uc9c0\ub9c9\uc73c\ub85c \uc704 3\uac00\uc9c0 \ub370\uc774\ud130\uc18c\uc2a4(Prometheus, Loki, Tempo)\uac00 \ub4f1\ub85d\ub41c \uc0c1\ud0dc\uc758 `Grafana` Chart\ub97c \ubc30\ud3ec\ud55c\ub2e4. \\n\\n```sh\\n> helm install grafana grafana/grafana -n tracing --version 6.13.5\xa0 -f - << \'EOF\'\\ndatasources:\\n  datasources.yaml:\\n    apiVersion: 1\\n    datasources:\\n      - name: Tempo\\n        type: tempo\\n        access: browser\\n        orgId: 1\\n        uid: tempo\\n        url: http://tempo.tracing.svc:3100\\n        isDefault: true\\n        editable: true\\n      - name: Prometehus\\n        type: prometheus\\n        access: browser\\n        orgId: 1\\n        uid: prometheus\\n        url: http://loki-prometheus-server.tracing.svc\\n        isDefault: false\\n        editable: true\\n      - name: Loki\\n        type: loki\\n        access: browser\\n        orgId: 1\\n        uid: loki\\n        url: http://loki.tracing.svc:3100\\n        isDefault: false\\n        editable: true\\n        jsonData:\\n          derivedFields:\\n            - datasourceName: Tempo\\n              matcherRegex: \\"traceID=(\\\\\\\\w+)\\"\\n              name: TraceID\\n              url: \\"$${__value.raw}\\"\\n              datasourceUid: tempo\\nenv:\\n  JAEGER_AGENT_PORT: 6831\\nadminUser: admin\\nadminPassword: password\\nservice:\\n  type: LoadBalancer\\nEOF\\n```\\n\\n### bookinfo productpage \uc811\uc18d \ubc0f trace \ud655\uc778\\n\\n`LoadBalancer`\ub85c \uad6c\uc131\ub41c istio-ingressgateway EXTERNAL-IP\uc778 [http://192.168.31.10/productpage](http://192.168.31.10/productpage)\ub85c \uc811\uc18d\ud558\ub294 \uc0c1\ud0dc\uc5d0\uc11c trace\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```sh\\n> ISTIOINGRESSGW=$(kubectl get pod -n istio-system -l app=istio-ingressgateway -o jsonpath=\'{.items[0].status.hostIP}\')\\necho -e \\"PRODUCTPAGE UI URL = http://$ISTIOINGRESSGW/productpage\\"\\nPRODUCTPAGE UI URL = http://192.168.31.187/productpage\\n```\\n\\n```sh\\n> for i in {1..100};  do curl -s $ISTIOINGRESSGW/productpage | grep -o \\"<title>.*</title>\\" ; done\\n```\\n\\nGrafana Explorer \uba54\ub274\uc5d0\uc11c `Loki` \ub370\uc774\ud130\uc18c\uc2a4\ub97c \uc120\ud0dd\ud558\uace0 Log browser\uc5d0 `{app=\\"productpage\\"}`\ub97c \uc785\ub825\ud558\uac8c \ub418\uba74 \ud558\ub098\uc758 \ud2b8\ub79c\uc7ad\uc158\uc5d0 \ub300\ud55c \ud2b8\ub808\uc774\uc2a4 \uc815\ubcf4\ub97c \ub85c\uadf8\ub0b4\uc5d0\uc11c \ud655\uc778\ud558\uace0 \ud574\ub2f9 traceid \ubc84\ud2bc\uc744 \ud074\ub9ad\ud558\uac70\ub098 `Tempo` \uba54\ub274\uc5d0\uc11c \ud0d0\uc0c9\uc744 \ud558\uba74 \uad00\ub828\ub41c trace \uc815\ubcf4\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n![tempo](/img/tempo-grafana.png)\\n\\n## \uc815\ub9ac \\n\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 eks-anywhere \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc5ec\ub7ec\uac00\uc9c0 3rd party \uad6c\uc131\uc694\uc18c\ub4e4\uc744 \uc124\uce58\ud558\uace0 \uc2e4\uc81c \uc6b4\uc601\ud658\uacbd\uacfc \uc720\uc0ac\ud558\uac8c \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud574\ubd24\ub2e4. EKS\ub97c \uc0ac\uc6a9\ud558\ub294 \uad00\uc810\uc5d0\uc11c \uc720\uc0ac\ud55c \uacbd\ud5d8\uc744 \ubc14\ud0d5\uc73c\ub85c \uac1c\ubc1c\ud658\uacbd\uc744 \uac00\uc838\uac08\uc218 \uc788\uae30\uc5d0 vSphere\ub97c \uae30\ubc18\uc73c\ub85c \uc0ac\ub0b4 \uc11c\ube44\uc2a4\ub97c \uac1c\ubc1c\ud558\ub294 \ud300\uc5d0\uac8c\ub294 \uc88b\uc740 \ud558\ub098\uc758 \uc120\ud0dd\uc9c0\uac00 \ucd94\uac00\ub418\uc5c8\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4. Direct Connect\ub098 VPN\uacfc \uac19\uc774 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0\uc131\ub9cc \ud655\ubcf4\ub41c\ub2e4\uba74 \uc2e4\uc81c \uae30\uc5c5\ud658\uacbd\uc5d0\uc11c\ub294 AWS \ub124\uc774\ud2f0\ube0c \uc11c\ube44\uc2a4\uc640\uc758 \uc5f0\uacc4\uac00 \ub354 \uc6a9\uc774\ud574\uc9c0\uae30 \ub54c\ubb38\uc5d0 \uc88b\uc740 \uac1c\ubc1c, \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc73c\ub85c \ub2e4\uac00\uac08 \uc218 \uc788\uc744\uac70\ub77c \uc0dd\uac01\ud55c\ub2e4.  \\n\\n\uc7ac\ubbf8\uc788\ub294 \uacbd\ud5d8\uc774\uc5c8\uace0 \ub2f9\ubd84\uac04\uc740 \uac1c\uc778\ud504\ub85c\uc81d\ud2b8\ub97c \uc9c4\ud589\ud558\ub294 \ud648\ub7a9 \ud658\uacbd\uc740 EKS Anywhere\ub85c \uc815\ucc29\ud574\uc11c \ud14c\uc2a4\ud2b8\ub97c \uacc4\uc18d \uc9c4\ud589\ud558\ub824\uace0 \ud55c\ub2e4. \\n\\n> \ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4."},{"id":"kubernetes/eks-anywhere/","metadata":{"permalink":"/kubernetes/eks-anywhere/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2022-03-06-eks-anywhere.md","source":"@site/blog/2022-03-06-eks-anywhere.md","title":"EKS Anywhere on vSphere Homelab","description":"vSphere homelab \ud658\uacbd\uc5d0\uc11c EKS Anywhere \uad6c\uc131\ud558\uae30","date":"2022-03-06T00:00:00.000Z","formattedDate":"March 6, 2022","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"vsphere","permalink":"/tags/vsphere"},{"label":"eks anywhere","permalink":"/tags/eks-anywhere"},{"label":"eks","permalink":"/tags/eks"},{"label":"flux","permalink":"/tags/flux"},{"label":"gitops","permalink":"/tags/gitops"}],"readingTime":30.095,"truncated":true,"authors":[],"frontMatter":{"layout":"single","title":"EKS Anywhere on vSphere Homelab","comments":true,"classes":"wide","description":"vSphere homelab \ud658\uacbd\uc5d0\uc11c EKS Anywhere \uad6c\uc131\ud558\uae30","toc":true,"toc_label":"Table of Contents","slug":"kubernetes/eks-anywhere/","date":"2022-03-06T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","vsphere","eks anywhere","eks","flux","gitops","eks-anywhere"]},"prevItem":{"title":"EKS Anywhere Advanced Usages","permalink":"/kubernetes/eks-anywhere-adv/"},"nextItem":{"title":"What is Tailscale?","permalink":"/kubernetes/what-is-tailscale/"}},"content":"## EKS Anywhere\\n\\n`EKS Anywhere`\ub294 eksctl\ub97c \uc0ac\uc6a9\ud558\ub294 \ud658\uacbd\uc5d0\uc11c [Kubernetes Cluster API Provider vSphere](https://github.com/kubernetes-sigs/cluster-api-provider-vsphere) \uc778 CAPV\ub97c \ud1b5\ud574 vSphere \uae30\ubc18\uc73c\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\ub97c \uad6c\uc131\ud574\uc8fc\ub294 \uc624\ud508\uc18c\uc2a4\uc774\ub2e4. CAPV Spec\uc740 [Kubernetes Cluster API](https://cluster-api.sigs.k8s.io/) \uae30\ubc18\uc73c\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc2a4\ud0c0\uc77c API\ud615\ud0dc\uc758 \uc120\uc5b8\uc801(Declarative) \ubc29\uc2dd\uc73c\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 Lifecycle\uc744 \uad00\ub9ac\ud558\ub294 \ud504\ub85c\uc81d\ud2b8\uc774\ub2e4. \\n\\nUbuntu \ub610\ub294 Mac admin \ud658\uacbd\uc5d0\uc11c eksctl \uba85\ub839\uc5b4\ub85c \ub85c\uceec \ud074\ub7ec\uc2a4\ud130\ub4e4\uc744 \uad00\ub9ac\ud558\uace0 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131, \uc0ad\uc81c\ud560 \uc218 \uc788\ub2e4. \uc77c\ub2e8 \uae30\ubcf8\uc801\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\uace0 \uad00\ub9ac\ud558\ub294 \ubc29\uc2dd\uc774 eksctl\uacfc \uac70\uc758 \uc720\uc0ac\ud558\ub2e4. \ub610\ud55c EKS \uc11c\ube44\uc2a4\uc758 \ubc30\ud3ec \ubc84\uc804\uacfc \ub3d9\uc77c\ud55c \ubc84\uc804\uc744 \uc0ac\uc6a9\ud568\uc73c\ub85c\uc368 (\ud3ec\uc2a4\ud305 \ub2f9\uc2dc \ubc84\uc804 1.21) vSphere \uae30\ubc18 \ud558\uc774\ube0c\ub9ac\ub4dc \ud658\uacbd\uc5d0\uc11c\uc758 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130 \ubc0f \uc6cc\ud06c\ub85c\ub4dc \uad00\ub9ac\ub97c \ud3b8\ud558\uac8c \ud560 \uc218 \uc788\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n\ud06c\uac8c EKS native \uc11c\ube44\uc2a4\uc640 \ud06c\uac8c \ub2e4\ub978\uc810 \uba87\uac00\uc9c0\ub294 \ub2e4\uc74c\uacfc \uac19\ub2e4. \\n\\n- \ucef4\ud4e8\ud305 \ud658\uacbd : vSphere, Docker(\uac1c\ubc1c\ud658\uacbd \uad6c\uc131\uc2dc)\\n- \ub178\ub4dc \uc9c0\uc6d0 OS :  BottleRocket, Ubuntu\\n- CNI : Cilium\\n\\n\uc790\uc138\ud55c \ub0b4\uc6a9\uc740 [\ube44\uad50\ud45c](https://anywhere.eks.amazonaws.com/docs/concepts/eksafeatures/)\ub97c \ucc38\uace0\ud558\uc790.\\n\\n## \uc0ac\uc804 \uc900\ube44\uc0ac\ud56d \\n### \ub85c\uceec \uad00\ub9ac \ud658\uacbd\\n- Docker 20.x \uc774\uc0c1 \ubc84\uc804  \\n- Mac OS(10.15) / Ubuntu(20.04.2 LTS)\\n- CPU 4\ucf54\uc5b4\\n- \uba54\ubaa8\ub9ac 16GB\\n- \ub514\uc2a4\ud06c 30GB\\n\\n### vSphere\\n[https://anywhere.eks.amazonaws.com/docs/reference/vsphere/vsphere-prereq/](https://anywhere.eks.amazonaws.com/docs/reference/vsphere/vsphere-prereq/)\\n\\n- vCenter \ud658\uacbd\uc758 vSphere 7.0 \uc774\uc0c1\\n- \ucd5c\uc18c VM 4\ub300 (\uac01 2 vCPU, 8GB \uba54\ubaa8\ub9ac, 25GB \ub514\uc2a4\ud06c \uc774\uc0c1 \uad8c\uc7a5)\\n  - Control Plane 1\ub300\\n  - etcd \ub178\ub4dc 1\ub300\\n  - worker \ub178\ub4dc 2\ub300\\n- DHCP \ud658\uacbd\\n- API \uc11c\ubc84 \uc6a9 Static IP 1\uac1c\\n- \uc678\ubd80 \ubc14\uc774\ub108\ub9ac, \uc774\ubbf8\uc9c0 \ub2e4\uc6b4\ub85c\ub4dc\ub97c \uc704\ud55c \ub124\ud2b8\uc6cc\ud06c \ud658\uacbd\\n  - \ud074\ub7ec\uc2a4\ud130 \uc790\uccb4\uc5d0\uc11c \ubc29\ud654\ubcbd \ub4f1\uc73c\ub85c \uc778\ud55c \uc778\ud130\ub137\uc774 \uc548\ub418\ub294 \uacbd\uc6b0 [\ud504\ub85d\uc2dc \uad6c\uc131](https://anywhere.eks.amazonaws.com/docs/reference/clusterspec/proxy/)\uc744 \ud1b5\ud574 \uac00\ub2a5\ud568\\n\\n## Homelab \uad6c\uc131\ud658\uacbd\\n\\n\uae30\uc874\uc5d0 \uc6b4\uc601\ud558\ub358 ESXi \ud658\uacbd\uc744 \uadf8\ub300\ub85c \ud65c\uc6a9\ud558\ub3c4\ub85d \ud588\ub2e4. \ucd94\uac00\uc801\uc73c\ub85c \ud558\ub4dc\uc6e8\uc5b4\ub97c \uad6c\ube44\ud558\uae30 \uc704\ud574 \ube44\uc6a9\uc774 \ubc1c\uc0dd\ud55c\ubd80\ubd84\uc740 \uc5c6\ub2e4.   \\n\\n### Hardware\\n- Dell Precision Tower 3620\\n  - Intel(R) Xeon(R) CPU E3-1240L v5\\n  - TeamGroup DDR4-2666 16GB * 4ea\\n  - (VM \uc6a9) SAMSUNG NVMe SSD PM981 - 1TB\\n  - (ESXi \uc6a9) Sandisk SSD Z410- 240GB\\n\\n### Software\\n- vSphere 7.0 Update 3\\n- vCenter 7.0.3 (VSCA)\\n- Docker Desktop [4.2.0](https://docs.docker.com/desktop/mac/release-notes/#docker-desktop-420)\ubc84\uc804\uc744 \uc0ac\uc6a9 \\n  - 4.3.0 \ubc84\uc804 \ud558\uc704 \ud638\ud658 \ubb38\uc81c\uac00\uc788\uc5b4 \uae08\ubc88 \ud14c\uc2a4\ud2b8 \ud658\uacbd\uc5d0\uc11c\ub294 4.2.0 \uc0ac\uc6a9\\n  - \ub3c4\ucee4 \ub9ac\uc18c\uc2a4\ub97c \ucd5c\uc18c `8vCPU`, `16GB`\ub85c \uc124\uc815\\n- [kubectl](https://kubernetes.io/ko/docs/tasks/tools/) v1.23.4\\n- [eksctl](https://eksctl.io/introduction/#installation) v0.85.0\\n- [eksctl-anywhere](https://anywhere.eks.amazonaws.com/docs/getting-started/install/) v0.7.0\\n- [aws-iam-authenticator](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-aws-iam-authenticator.html) v0.5.5\\n- [bottlerocket OVA](https://anywhere.eks.amazonaws.com/docs/reference/artifacts/) v1.21 (\uc790\ub3d9 \uc0dd\uc131\ub418\ub294 OVA\ub85c \ubcc4\ub3c4 \uad6c\uc131\uc774 \ud544\uc694\uc5c6\ub2e4)  \\n\\n## \ud074\ub7ec\uc2a4\ud130 \ud658\uacbd\uad6c\uc131\\n\\n[\uacf5\uc2dd \ud648\ud398\uc774\uc9c0\uc758 \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131, \uc0ad\uc81c \uc6cc\ud06c\ud50c\ub85c\uc6b0](https://anywhere.eks.amazonaws.com/docs/concepts/clusterworkflow/)\ub97c \ucc38\uace0\ud558\uc5ec \uc0ac\uc804 \uad6c\uc131\ub41c Homelab\uc5d0 \uc801\uc6a9\ud55c\ub2e4. \\n\\n![workflow](https://anywhere.eks.amazonaws.com/images/eks-a_create_cluster.png)\\n\\n\ucc98\uc74c\uc5d0\ub294 eksctl \uba85\ub839\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc73c\ub85c \uc0ac\uc804\uc5d0 \uc0dd\uc131\ud55c cluster config yaml\uc744 \ud1b5\ud574 \ub85c\uceec \ub3c4\ucee4 \uc5d4\uc9c4\uc5d0 bootstrap\uc744 \ud558\ub294 \uba85\ub839\uc744 \ub0b4\ub9b0\ub2e4. \uc774\ub54c \ub85c\uceec \ub3c4\ucee4 \uc5d4\uc9c4\uc5d0\uc11c\ub294 Docker in Docker \uc5d4\uc9c4\uc778 [kind](https://kind.sigs.k8s.io/)\ub97c \ud1b5\ud574 \ud074\ub7ec\uc2a4\ud130 \ubc88\ub4e4 \ucee8\ud53c\uadf8\ub97c \uc0dd\uc131\ud55c\ub2e4. \\n\\n[clusterctl](https://github.com/kubernetes-sigs/cluster-api/tree/main/cmd/clusterctl)\ub97c \ud1b5\ud574 [Cluster API Provider Docker](https://github.com/kubernetes-sigs/cluster-api/tree/main/test/infrastructure/docker)\ud615\ud0dc\ub85c \ubd80\ubaa8(bootstrap) \ud074\ub7ec\uc2a4\ud130\ub97c \ub9cc\ub4dc\ub294 \uacfc\uc815\uc774 `eksctl anywhere` \uba85\ub839\uc73c\ub85c \ucd94\uc0c1\ud654 \ub418\ub294\uac83\uc774\ub77c \ubcfc \uc218 \uc788\ub2e4. \\n\\n\ud574\ub2f9 \ub2e8\uacc4\uc5d0\uc11c \uba3c\uc800 Bastion Host\ub098 \uad00\ub9ac \uba38\uc2e0\uc5d0 `kubectl`, `eksctl`, `eksctl-anywhere`, `aws-iam-authenticator` \ub4f1\uc774 \uc124\uce58\ub418\uc5b4 \uc788\ub294\uc9c0 \ud655\uc778\ud55c\ub2e4.\\n\\nhttps://anywhere.eks.amazonaws.com/docs/getting-started/install/\\n\\n`homelab` \uc774\ub984\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130 \ucee8\ud53c\uadf8\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```sh\\nCLUSTER_NAME=homelab\\neksctl anywhere generate clusterconfig $CLUSTER_NAME \\\\\\n   --provider vsphere > $CLUSTER_NAME.yaml\\n```\\n\\n\ubaa8\ub4e0 \ucee8\ud53c\uadf8\uc5d0 \ub300\ud55c \uc0c1\uc138 \uc124\uc815\uc740 [vSphere configuration](https://anywhere.eks.amazonaws.com/docs/reference/clusterspec/vsphere/) \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n\uc0dd\uc131\ub41c \ucee8\ud53c\uadf8\ub97c \ud558\ub098\uc529 \uc0b4\ud3b4\ubcf4\uc790. \\n\\n```yaml\\napiVersion: anywhere.eks.amazonaws.com/v1alpha1\\nkind: Cluster\\nmetadata:\\n  name: homelab\\n  namespace: default\\nspec:\\n  clusterNetwork:\\n    cni: cilium\\n    pods:\\n      cidrBlocks:\\n      - 192.168.0.0/20\\n    services:\\n      cidrBlocks:\\n      - 10.96.0.0/12\\n  controlPlaneConfiguration:\\n    count: 2\\n    endpoint:\\n      host: 192.168.31.3\\n    machineGroupRef:\\n      kind: VSphereMachineConfig\\n      name: homelab-cp\\n  datacenterRef:\\n    kind: VSphereDatacenterConfig\\n    name: homelab\\n  externalEtcdConfiguration:\\n    count: 1\\n    machineGroupRef:\\n      kind: VSphereMachineConfig\\n      name: homelab-etcd\\n  gitOpsRef:\\n    kind: GitOpsConfig\\n    name: cluster-gitops\\n  kubernetesVersion: \\"1.21\\"\\n  managementCluster:\\n    name: homelab\\n  workerNodeGroupConfigurations:\\n  - count: 2\\n    machineGroupRef:\\n      kind: VSphereMachineConfig\\n      name: homelab\\n    name: md-0\\n```\\n\\n\uccab\ubc88\uc9f8\ub294 `Cluster` \ub9ac\uc18c\uc2a4\ub85c Cluster\uc758 \uc774\ub984\uacfc \ud074\ub7ec\uc2a4\ud130 \uc804\ubc18 \uc124\uc815\uacfc Control Plane, Data Plane, etcd VM\uc758 \ubc84\uc804, \uac1c\uc218 \ub4f1\uc744 \uc815\ud560 \uc218 \uc788\ub2e4. \\n\\n\ud074\ub7ec\uc2a4\ud130 \uc774\ub984\uc740 `homelab`\uc73c\ub85c \uc124\uc815\ud55c\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c CNI\ub294 Cilium\uc744 \uc0ac\uc6a9\ud558\ub294 \uad6c\uc870\uc774\uae30 \ub54c\ubb38\uc5d0 \ud544\uc218\uc801\uc73c\ub85c `cilium`\ub85c \uc124\uc815\ud574\uc57c \ud55c\ub2e4. \uadf8\ub9ac\uace0 kubeadm \uad6c\uc131\uc2dc \ud544\uc694\ud55c `pods.cidrBlocks`\uacfc `services.cidrBlocks`\uc5d0\uc11c \ud30c\ub4dc\uc640 \uc11c\ube44\uc2a4\uac00 \uc0ac\uc6a9\ud560 \ub124\ud2b8\uc6cc\ud06c \ub300\uc5ed\uc744 \uc124\uc815\ud55c\ub2e4. \ub458\ub2e4 CNI\uc5d0\uc11c \ud1b5\uc2e0\ub418\ub294 \uac00\uc0c1 \ub124\ud2b8\uc6cc\ud06c \ub300\uc5ed\uc774\uae30 \ub54c\ubb38\uc5d0 \ud604\uc7ac \uc0ac\uc6a9\uc911\uc778 \uc0e4\uc624\ubbf8 \uacf5\uc720\uae30 \ub300\uc5ed(192.168.31.x)\uacfc \ucda9\ub3cc\ud558\uc9c0 \uc54a\uc73c\uba74\uc11c \ub77c\uc6b0\ud305\uc5d0 \ubb38\uc81c\ub418\uc9c0 \uc54a\uace0 \ud604\uc7ac \ub124\ud2b8\uc6cc\ud06c\uc5d0 \uc0ac\uc6a9\ub418\uc9c0 \uc54a\ub294 \ub300\uc5ed(192.168.0.0/20, 10.96.0.0/12) \uc73c\ub85c \uc124\uc815\ud588\ub2e4.  \\n\\n> DHCP \uc720\uc758\uc0ac\ud56d: \ubcf8\uc778\uc758 \uacbd\uc6b0 Xiaomi \uacf5\uc720\uae30\ub97c \uc0ac\uc6a9\uc911\uc778\ub370 \ubcc4\ub3c4\uc758 DHCP\uc11c\ubc84\ub97c \uad6c\uc131\ud558\uc9c0 \uc54a\uace0 \uc0ac\uc6a9\uc744 \ud558\uace0 \uc788\uc5b4\uc11c\uc778\uc9c0, \uc2e0\uaddc \ub178\ub4dc\ub97c \uc704\ud55c VM\uc774 \uc0dd\uc131\ub418\uace0 `bottlerocket` OS\uac00 \uae30\ub3d9\ub420\ub54c \ud638\uc2a4\ud2b8\uba85\uc774 `MiWifi-R3600-SRV` \uc774\ub7f0\uc2dd\uc73c\ub85c \ub300\uc18c\ubb38\uc790\ub97c \ud3ec\ud568\ud55c \ud615\ud0dc\ub85c \uc790\ub3d9 \uc0dd\uc131\ub418\ub2e4 \ubcf4\ub2c8 \ubd80\ud305\uc774 \ub418\uc9c0 \uc54a\ub294 \ud604\uc0c1\uc774 \ubc1c\uc0dd\ud588\ub2e4. \uc774\uc5d0 [\ubcc4\ub3c4\uc758 DHCP \uad6c\uc131](https://anywhere.eks.amazonaws.com/docs/reference/vsphere/vsphere-dhcp/)\uc744 \ud1b5\ud574 \uc9c4\ud589\uc744 \ud558\uba74 \ud574\ub2f9 \uc774\uc288\ub97c \ud53c\ud560\uc218 \uc788\ub2e4. \\n\\n`controlPlaneConfiguration` \ud544\ub4dc\uc5d0\uc11c\ub294 controlPlane \ub178\ub4dc\uc758 `count`\uc640 `endpoint`\ub97c \uc124\uc815\ud574\uc57c \ud55c\ub2e4. `count` \ucd08\uae30 \uac12\uc740 `2`\ub85c \ub418\uc5b4 \uc788\uc9c0\ub9cc \ud648\ub7a9\uc758 \uc790\uc6d0\uc774 \ubd80\uc871\ud558\uae30 \ub54c\ubb38\uc5d0 `1`\ub85c \uc124\uc815\ud588\ub2e4. \uc2e4\uc81c \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 2\uc774\uc0c1\uc744 \uad8c\uace0\ud55c\ub2e4. \uadf8\ub9ac\uace0 `endpoint.host`\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 API\uc11c\ubc84 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub85c \uc2e4\uc81c kubectl \uba85\ub839 \ubc0f \uc0ac\uc6a9\uc790\uc640 \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc704\ud55c \uc811\uadfc \uac00\ub2a5\ud55c DHCP \ud560\ub2f9\uc73c\ub85c \ucda9\ub3cc\ub418\uc9c0 \uc54a\ub294 \ub124\ud2b8\uc6cc\ud06c \ub300\uc5ed\uc758 \uace0\uc815 IP\ub85c \uc124\uc815\ud55c\ub2e4. `machineGroupRef`\ub294 \uc774\ud6c4 \uc0dd\uc131\ud560 VM spec\uc5d0 \ub9e4\uce6d\uc2dc\ud0ac label \uac12\uc73c\ub85c \uc790\ub3d9 \uc0dd\uc131\ub41c\ub2e4. \\n\\n`externalEtcdConfiguration`\ub294 etcd \uad6c\uc131\uc744 \uc704\ud55c \ud544\ub4dc\ub85c `count`\ub294 \uae30\ubcf8\uc124\uc815 \uac12\uc774 `3`\uc774\uc9c0\ub9cc \ud648\ub7a9 \ud658\uacbd\uc5d0\uc11c\ub294 `1`\ub85c \uad6c\uc131\ud558\uc600\ub2e4. \uc2e4\uc81c \ud504\ub85c\ub355\uc158\uc5d0\uc11c\ub294 Raft \uc54c\uace0\ub9ac\uc998 \uae30\ubc18 Redundancy \uad6c\uc131\uc744 \uc704\ud574 `3`\uc774\uc0c1\uc744 \uad8c\uace0\ud55c\ub2e4.\\n\\n`gitOpsRef`\ub294 GitOps \ud615\ud0dc\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \uad00\ub9ac\ud558\uae30 \uc704\ud574 \ucc38\uc870\ud558\ub294 \uac12\uc73c\ub85c \uc544\ub798 `GitOpsConfig` \uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc774\ub984 `cluster-gitops` \ub97c \uba85\uc2dc\ud55c\ub2e4. \\n\\n`kubernetesVersion`\uc740 EKS \ubc30\ud3ec \ubc84\uc804\uc640 \ub3d9\uc77c\ud55c `1.21`\ub85c \uc124\uc815\ud55c\ub2e4. \\n\\n`workerNodeGroupConfigurations`\uc740 \uc6cc\ucee4\ub178\ub4dc \uad6c\uc131\uc73c\ub85c `count`\ub97c `2`\ub85c \uc124\uc815\ud558\uc600\ub2e4. \\n\\n\ub2e4\uc74c\uc740 \ubc30\ud3ec\ub418\ub294 vSphere spec\uc744 \uc815\uc758\ud558\ub294 \ub9ac\uc18c\uc2a4\ub85c `VSphereDatacenterConfig`\uc774\ub2e4.\\n\\n```yaml\\napiVersion: anywhere.eks.amazonaws.com/v1alpha1\\nkind: VSphereDatacenterConfig\\nmetadata:\\n  name: homelab\\nspec:\\n  datacenter: \\"Datacenter\\"\\n  insecure: false\\n  network: \\"VM Network\\"\\n  server: \\"192.168.31.2\\"\\n  thumbprint: \\"**:89:91:5B:02:50:F6:41:D0:DE:6B:A0:B8:43:41:A4:81:03:**\\"\\n```\\n\\n`spec`\uc5d0\uc11c\ub294 \uc2e4\uc81c vCenter\uc758 \uc5d4\ub4dc\ud3ec\uc778\ud2b8, datacenter, network \uc815\ubcf4 \ub4f1\uc744 \uc785\ub825\ud55c\ub2e4. \\n> \uc720\uc758\uc0ac\ud56d : `insecure` \uc635\uc158\uc758 \uacbd\uc6b0 \uae30\ubcf8\uac12\uc774 false\ub85c \ub418\uc5b4 \uc788\ub2e4. \ud574\ub2f9 \uac12\uc774 `false`\uc758 \uacbd\uc6b0 \uc544\ub798 \uadf8\ub9bc\uc5d0 \uc788\ub294 \uac83 \ucc98\ub7fc \ubcf4\ud1b5 vCenter \uba54\ub274\uc5d0\uc11c `thumbprint` \uac12\uc744 \ud655\uc778\ud560 \uc218 \uc788\uace0 \ud574\ub2f9 \uac12\uc744 `**:89:91:5B:02:50:F6:41:D0:DE:6B:A0:B8:43:41:A4:81:03:**` \ud615\ud0dc\ub85c \ubcc0\uacbd\ud558\uc5ec \uc0ac\uc6a9\ud558\uac70\ub098 [govc](https://github.com/vmware/govmomi/tree/master/govc)\ub97c \uc0ac\uc6a9\ud558\uc5ec `govc about.cert -thumbprint -k` \uba85\ub839\uc5b4\ub85c \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4.\\n\\n![cert](/img/vsphere_cert.png)\\n\\n\ub9c8\uc9c0\ub9c9\uc740 \uac01 \ub178\ub4dc \uc5ed\ud560(control plane, etcd, worker)\ubcc4\ub85c \uc0ac\uc6a9\ud560 OS \ubc0f \ub9ac\uc18c\uc2a4 spec\uc744 \uc815\uc758\ud558\ub294 \ucee8\ud53c\uadf8\uc774\ub2e4. \uc704 `Cluster` \ub9ac\uc18c\uc2a4\uc5d0\uc11c \uc124\uc815\ub41c `machineGroupRef.name`\uc73c\ub85c \ub9e4\uce6d\ub418\ub294 \uac12\uc744 metadata\ub85c \uc790\ub3d9 \uc0dd\uc131 \ud574\uc8fc\uace0 \ubaa8\ub450 \uc720\uc0ac\ud558\uae30 \ub54c\ubb38\uc5d0 \uc774\uc911 `VSphereMachineConfig`\ub9cc \uc0b4\ud3b4\ubcf8\ub2e4. \\n\\n```yaml\\napiVersion: anywhere.eks.amazonaws.com/v1alpha1\\nkind: VSphereMachineConfig\\nmetadata:\\n  name: homelab-cp\\nspec:\\n  datastore: \\"datastore2\\"\\n  diskGiB: 25\\n  folder: \\"cp\\"\\n  memoryMiB: 8192\\n  numCPUs: 2\\n  osFamily: bottlerocket\\n  resourcePool: \\"*/Resources\\"\\n  users:\\n  - name: ec2-user\\n    sshAuthorizedKeys:\\n    - ssh-rsa AAAAB3******U= vsphere\\n\\n```\\n\\nDatacenter\uc5d0 \uad6c\uc131\ud55c `datastore`\uc911 \uc124\uce58\ub418\ub294 VM \uc601\uc5ed\uc774 \uc0ac\uc6a9\ud560 \ub300\uc0c1 datastore\ub97c \uc785\ub825\ud55c\ub2e4. VM\ub514\uc2a4\ud06c `diskGiB`, Datacenter `folder`, VM\uba54\ubaa8\ub9ac `memoryMiB`, vCPU `numCPUs`\ub97c \uc785\ub825\ud558\uace0, `resourcePool`\uc740 \uc9c0\uc815 \ub9ac\uc18c\uc2a4 \uadf8\ub8f9\uc744 \ubcc4\ub3c4\ub85c \uc124\uc815\ud558\uc9c0 \uc54a\uc558\uae30 \ub54c\ubb38\uc5d0 `\\"*/Resources\\"`\ub85c \uc124\uc815\ud55c\ub2e4. \uadf8\ub9ac\uace0 `osFamily`\ub294 ubuntu, bottlerocket\ub450\uac00\uc9c0\ub85c \uc81c\uacf5\uc774 \ub418\ub294\ub370 \uae30\ubcf8\uac12\uc740 bottlerocket\uc774\uace0, \ud574\ub2f9 \uc774\ubbf8\uc9c0\uc758 \uae30\ubcf8 user\ub294 `ec2-user`\ub85c \uc124\uc815\ud558\uace0 \ud574\ub2f9 VM\uc5d0 SSH\uc811\uadfc\uc744 \uc704\ud574\uc11c \ubcc4\ub3c4\ub85c \uc0dd\uc131\ud55c `sshAuthorizedKeys`\ub97c \uc785\ub825\ud55c\ub2e4. \\n\\n```yaml\\napiVersion: anywhere.eks.amazonaws.com/v1alpha1\\nkind: GitOpsConfig\\nmetadata:\\n  name: cluster-gitops\\n  namespace: default\\nspec:\\n  flux:\\n    github:\\n      branch: main\\n      clusterConfigPath: clusters/homelab\\n      fluxSystemNamespace: flux-system\\n      owner: ddiiwoong\\n      personal: true\\n      repository: eks-anywhere-homelab\\n```\\n\\n\ub9c8\uc9c0\ub9c9\uc740 \ud074\ub7ec\uc2a4\ud130\ub97c GitOps \uc2a4\ud0c0\uc77c\ub85c \uad00\ub9ac\ud558\uae30 \uc704\ud574 `GitOpsConfig`\ub97c \ucd94\uac00\ud55c\ub2e4. spec \uc5d0\uc11c \uc0ac\uc6a9\ud560 github\uc758 `branch`, github \ub808\ud3ec \uc544\ub798 \ucee8\ud53c\uadf8\uac00 \uc800\uc7a5\ub420 \uacbd\ub85c\uc778 `clusterConfigPath`, gitops \uc624\ud508\uc18c\uc2a4\uc778 [Flux](https://fluxcd.io/docs/get-started/)\uac00 \uad6c\uc131\ub420 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc778 `fluxSystemNamespace`, github account\uc778 `owner`, repo \uc774\ub984\uc774 \ub418\ub294 `repository` \uae4c\uc9c0 \uc124\uc815\ud55c\ub2e4. \ud574\ub2f9 \uad6c\uc131\uc744 \ud3ec\ud568\ud55c \ucc44\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \ubc30\ud3ec\ud558\uac8c \ub418\uba74 \ud074\ub7ec\uc2a4\ud130\uac00 \uc0dd\uc131\ub418\ub294 \uc911\uc5d0 \uc120\uc5b8\ud55c `repository`\ub85c \uc774\ud6c4 \uad00\ub9ac\ub420 \ud074\ub7ec\uc2a4\ud130 \ucee8\ud53c\uadf8 \ubc0f kustomize \ud30c\uc77c \ub4f1\uc744 `commit`\ud558\uac8c \ub41c\ub2e4. \\n\\n## \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\\n\\n\ub098\uba38\uc9c0 etcd, worker node \ub3c4 `VSphereMachineConfig`\ub97c \ub3d9\uc77c\ud55c \ud615\uc2dd\uc73c\ub85c \uc791\uc131\ud558\uace0, vSphere \uad00\ub828 \uc778\uc99d\uc815\ubcf4\uc640 gitops\ub85c \ud65c\uc6a9\ud560 \ub808\ud3ec\uc758 github token\uc744 \ud658\uacbd\ubcc0\uc218\ub85c \uc785\ub825\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\uc744 \uc9c4\ud589\ud55c\ub2e4. \ud648\ub7a9\uc73c\ub85c \uad6c\uc131\ud55c \uc0d8\ud50c \ucee8\ud53c\uadf8\ub294 [\ub9c1\ud06c](https://raw.githubusercontent.com/ddiiwoong/eks-anywhere-homelab/main/clusters/homelab/homelab/eksa-system/eksa-cluster.yaml)\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```sh\\n> export EKSA_VSPHERE_USERNAME=\'administrator@ddii.local\'\\n> export EKSA_VSPHERE_PASSWORD=\'***********\'\\n> export EKSA_GITHUB_TOKEN=ghp_************************\\n> eksctl anywhere create cluster -f homelab.yaml\\nWarning: The recommended size of an external etcd cluster is 3 or 5\\nChecking Github Access Token permissions\\n\u2705 Github personal access token has the required repo permissions\\nPerforming setup and validations\\n\u2705 Connected to server\\n\u2705 Authenticated to vSphere\\n\u2705 Datacenter validated\\n\u2705 Network validated\\n\u2705 Datastore validated\\n\u2705 Folder validated\\n\u2705 Resource pool validated\\n\u2705 Datastore validated\\n\u2705 Folder validated\\n\u2705 Resource pool validated\\n\u2705 Datastore validated\\n\u2705 Folder validated\\n\u2705 Resource pool validated\\n\u2705 Control plane and Workload templates validated\\n\u2705 Vsphere Provider setup is valid\\n\u2705 Flux path\\n\u2705 Create preflight validations pass\\nCreating new bootstrap cluster\\nInstalling cluster-api providers on bootstrap cluster\\nProvider specific setup\\nCreating new workload cluster\\nInstalling networking on workload cluster\\nInstalling storage class on workload cluster\\nInstalling cluster-api providers on workload cluster\\nInstalling EKS-A secrets on workload cluster\\nMoving cluster management from bootstrap to workload cluster\\nInstalling EKS-A custom components (CRD and controller) on workload cluster\\nCreating EKS-A CRDs instances on workload cluster\\nInstalling AddonManager and GitOps Toolkit on workload cluster\\nAdding cluster configuration files to Git\\nEnumerating objects: 20, done.\\nCounting objects: 100% (20/20), done.\\nCompressing objects: 100% (12/12), done.\\nTotal 20 (delta 1), reused 19 (delta 0), pack-reused 0\\nFinalized commit and committed to local repository\\t{\\"hash\\": \\"ea4293c849725e593704c2a8ff71a708ad8cf8f2\\"}\\nWriting cluster config file\\nDeleting bootstrap cluster\\n\ud83c\udf89 Cluster created!\\n```\\n\\n\uac01 \ub2e8\uacc4\ub97c \uc21c\uc11c\ub300\ub85c \uac04\ub2e8\ud788 \uc0b4\ud3b4\ubcf4\uba74 \ucc98\uc74c bootstrap cluster \uad6c\uc131 \ub2e8\uacc4\uc5d0\uc11c\ub294 \uc544\ub798\uc640 \uac19\uc740 \uc77c\uc744 \uc218\ud589\ud55c\ub2e4.\\n- Github Access Token \uad8c\ud55c \ud655\uc778\\n- vSphere \uc778\uc99d\\n- vSphere \ub9ac\uc18c\uc2a4(Datacenter, Network, Datastore, Folder \ub4f1) \uac80\uc99d\\n- Control Plane, Workload Plane \ud15c\ud50c\ub9bf \uac80\uc99d\\n- kind\ub85c bootstrap cluster \uc0dd\uc131\\n- cluster-api provider \uc5ed\ud560\uc744 \ud558\ub294 CAPI(Cluster API) \uc124\uce58\\n\\n\ub2e4\uc74c\uc740 \uc0dd\uc131\ub41c bootstrap cluster\uc758 CAPI \uad00\ub9ac\ub3c4\uad6c\uac00 vSphere \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc5f0\uacb0\ud6c4\uc5d0 \uc9c4\ud589\ud55c\ub2e4.\\n\\n- [govc](https://github.com/vmware/govmomi/tree/master/govc)\ub97c \uc0ac\uc6a9\ud574\uc11c \uc5f0\uacb0\ub41c vSphere \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc0c8\ub85c\uc6b4 etcd\ub97c \ud3ec\ud568\ud55c Control, Workload \ub178\ub4dc \uc0dd\uc131\\n- [Cilium](https://cilium.io/) CNI \ucd94\uac00\\n- Storage Class \ucd94\uac00\\n- \uad6c\uc131\ub41c Workload Cluster\uc5d0 CAPI \ucd94\uac00\\n  - provider \uc14b\uc5c5\\n  - \ucd94\uac00\uc801\uc778 CRD \ubc0f GitOps \ucef4\ud3ec\ub10c\ud2b8 \ucd94\uac00\\n- GitOps\ub97c \uc704\ud574 \ucd5c\ucd08 \uc0dd\uc131\ub41c cluster config\ub97c \uc9c0\uc815\ud55c repo\uc5d0 Commit \\n- \ub9c8\uc9c0\ub9c9\uc73c\ub85c \ub85c\uceec \uad00\ub9ac \uba38\uc2e0\uc5d0 cluster config\ub97c \uc800\uc7a5\\n\\n\\n\uac01\uac01\uc758 \ub2e8\uacc4\uc5d0 \ub300\ud55c \uc124\uba85\uc740 [\ub2e4\uc74c \ub9c1\ud06c](https://anywhere.eks.amazonaws.com/docs/concepts/clusterworkflow/#4-authenticate-and-create-bootstrap-cluster)\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n\ucc98\uc74c \uba87\ubc88 \uc2dc\ub3c4\ub97c \ud558\ub2e4\ubcf4\uba74 \uc5ec\ub7ec\uac00\uc9c0 \uc5d0\ub7ec\uc0ac\ud56d\uc744 \ub9cc\ub098\uac8c \ub41c\ub2e4. \ud574\ub2f9 \ub2e8\uacc4\uc758 \ub514\ubc84\uadf8 \ub808\ubca8 \ucd9c\ub825\uc744 \ubcf4\uae30 \uc704\ud574\uc11c\ub294 `-v 9` \ud50c\ub798\uadf8\ub97c \ucd94\uac00\ud574\uc11c \uc124\uce58\ub97c \uc9c4\ud589\ud558\uba74 \uc0c1\uc138 \ub0b4\uc5ed\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub294\ub370 debug \ub808\ubca8\ub85c \ub9c8\uc9c0\ub9c9 \uba87\uc904 \ub85c\uadf8\ub97c  \uc0b4\ud3b4\ubcf4\uba74 \ub3c4\ucee4\uc5d0\uc11c kind\ub85c \ub3c4\ucee4\ub0b4\uc5d0 \ud074\ub7ec\uc2a4\ud130\ub97c \uad6c\uc131\ud55c \uc774\ud6c4\uc5d0 docker\ub0b4 kind \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ad\uc81c\ud558\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```sh\\n2022-03-04T15:23:33.638+0900    V4      Deleting kind cluster   {\\"name\\": \\"homelab-eks-a-cluster\\"}\\n2022-03-04T15:23:33.638+0900    V6      Executing command       {\\"cmd\\": \\"/usr/local/bin/docker exec -i eksa_1646374542969789000 kind delete cluster --name homelab-eks-a-cluster\\"}\\nDeleting cluster \\"homelab-eks-a-cluster\\" ...\\n2022-03-04T15:23:36.244+0900    V0      \ud83c\udf89 Cluster upgraded!\\n2022-03-04T15:23:36.244+0900    V4      Task finished   {\\"task_name\\": \\"delete-kind-cluster\\", \\"duration\\": \\"4.560798797s\\"}\\n2022-03-04T15:23:36.244+0900    V4      ----------------------------------\\n2022-03-04T15:23:36.244+0900    V4      Tasks completed {\\"duration\\": \\"7m50.030420843s\\"}\\n2022-03-04T15:23:37.227+0900    V3      Cleaning up long running container      {\\"name\\": \\"eksa_1646374542969789000\\"}\\n2022-03-04T15:23:37.228+0900    V6      Executing command       {\\"cmd\\": \\"/usr/local/bin/docker rm -f -v eksa_1646374542969789000\\"}\\n```\\n\\n\uba87\uac00\uc9c0 \uacbd\ud5d8\ud55c \uc5d0\ub7ec \uc0ac\ud56d\uc744 \ub098\uc5f4\ud574 \ubcf4\uba74 \uc704\uc5d0\uc11c\ub3c4 \uc5b8\uae09\ud55c \ub0b4\uc6a9\uacfc \uac19\uc774 Cluster \ucee8\ud53c\uadf8 \ub0b4 `vSphere thumbprint`\ub97c \ubc18\ub4dc\uc2dc \ub123\uc5b4\uc8fc\ub294\uac83\uc774 \uc88b\ub2e4. \uacf5\uc2dd \uac00\uc774\ub4dc\uc5d0\ub294 `insecure` \ud544\ub4dc\ub97c true\ub85c \uc124\uc815\ud558\uace0 `thumbprint`\ub97c null\ub85c \uc9c4\ud589\ud560 \uacbd\uc6b0 \uc544\ub798\uc640 \uac19\uc774 kubeconfg secret\uc744 \uad6c\uc131\ub2e8\uacc4\uc5d0\uc11c \uc2e4\ud328\ud558\uac70\ub098 Workload \ub178\ub4dc\uac00 join\ud560 \ub54c \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud558\uac8c \ub41c\ub2e4.  \\n\\n```sh\\n$ eksctl anywhere create cluster -f eksa-mgmt-cluster.yaml\\n...\\ncollecting management cluster diagnostics\\n\u23f3 Collecting support bundle from cluster, this can take a while\\t{\\"cluster\\": \\"bootstrap-cluster\\", \\"bundle\\": \\"mgmt/generated/bootstrap-cluster-2022-03-02T23:25:32+09:00-bundle.yaml\\", \\"since\\": 1646227532274217000, \\"kubeconfig\\": \\"mgmt/generated/mgmt.kind.kubeconfig\\"}\\nSupport bundle archive created\\t{\\"path\\": \\"support-bundle-2022-03-02T14_25_34.tar.gz\\"}\\nAnalyzing support bundle\\t{\\"bundle\\": \\"mgmt/generated/bootstrap-cluster-2022-03-02T23:25:32+09:00-bundle.yaml\\", \\"archive\\": \\"support-bundle-2022-03-02T14_25_34.tar.gz\\"}\\nAnalysis output generated\\t{\\"path\\": \\"mgmt/generated/bootstrap-cluster-2022-03-02T23:27:23+09:00-analysis.yaml\\"}\\ncollecting workload cluster diagnostics\\nError: failed to create cluster: error checking availability of kubeconfig secret: kubeconfig secret does not exist\\n```\\n\\n\uc815\uc0c1\uc801\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130 \ubc30\ud3ec\uac00 \ub418\uc5c8\uc73c\uba74 eksctl config yaml\uc774 \ud3ec\ud568\ub41c \ub514\ub809\ud1a0\ub9ac \ud558\uc704\uc5d0 \ud074\ub7ec\uc2a4\ud130 \uc774\ub984\uc73c\ub85c \uc0c8\ub85c\uc6b4 \ub514\ub809\ud1a0\ub9ac\uc640 `kubeconfig`\uc640 \uc2e4\uc81c \ubc30\ud3ec\ub41c cluster config\ub97c \ud655\uc778 \ud560 \uc218 \uc788\ub2e4. \\n\\n```\\n> tree\\n.\\n\u251c\u2500\u2500 homelab\\n\u2502   \u251c\u2500\u2500 homelab-eks-a-cluster.kubeconfig\\n\u2502   \u2514\u2500\u2500 homelab-eks-a-cluster.yaml\\n\u251c\u2500\u2500 homelab.yaml\\n```\\n\\n\uae30\uc874 kubeconfig\uc640 merge\ub97c \uc704\ud574 [krew](https://github.com/kubernetes-sigs/krew)\ub97c \ud1b5\ud574 \uc124\uce58\ud55c  [konfig](https://github.com/corneliusweig/konfig) \ub3c4\uad6c\ub97c \uc0ac\uc6a9\ud574\uc11c \uae30\uc874 \ucee8\ud53c\uadf8\uc640 \ubcd1\ud569\ud55c\ub2e4. \\n\\n```sh\\n> kubectl konfig merge ~/.kube/config ./homelab/homelab-eks-a-cluster.kubeconfig > merged-and-flattened-config\\n> mv merged-and-flattened-config ~/.kube/config\\n```\\n\\n\uc0dd\uc131\ub41c \ub9ac\uc18c\uc2a4\ub97c \ud655\uc778\ud574\ubcf4\uba74 `Bottlerocket` OS \uc774\ubbf8\uc9c0\uc640 `containerd://1.5.8+bottlerocket` CRI\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \ub178\ub4dc \uc774\ub984\uc774 IP\ub85c \ubcf4\uc774\ub294 \uc774\uc720\ub294 DHCP\uc11c\ubc84\ub97c \ubcc4\ub3c4\ub85c \ub450\uc9c0 \uc54a\uc544 Prefix \ud560\ub2f9\uc774 \ub418\uc9c0 \uc54a\ub294 \uac00\uc815\uc6a9 \uacf5\uc720\uae30 \ud658\uacbd\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 \ud604\uc0c1\uc774\ub2e4. \\n\\n```sh\\n> kubectl get node -o wide\\nNAME             STATUS   ROLES                  AGE     VERSION   INTERNAL-IP      EXTERNAL-IP      OS-IMAGE                                  KERNEL-VERSION   CONTAINER-RUNTIME\\n192.168.31.186   Ready    control-plane,master   9m     v1.21.6   192.168.31.186   192.168.31.186   Bottlerocket OS 1.5.3 (vmware-k8s-1.21)   5.10.93          containerd://1.5.8+bottlerocket\\n192.168.31.187   Ready    <none>                 8m     v1.21.6   192.168.31.187   192.168.31.187   Bottlerocket OS 1.5.3 (vmware-k8s-1.21)   5.10.93          containerd://1.5.8+bottlerocket\\n192.168.31.188   Ready    <none>                 7m     v1.21.6   192.168.31.188   192.168.31.188   Bottlerocket OS 1.5.3 (vmware-k8s-1.21)   5.10.93          containerd://1.5.8+bottlerocket\\n192.168.31.189   Ready    control-plane,master   7m     v1.21.6   192.168.31.189   192.168.31.189   Bottlerocket OS 1.5.3 (vmware-k8s-1.21)   5.10.93          containerd://1.5.8+bottlerocket\\n```\\n\\nCRD \ub9ac\uc2a4\ud2b8\ub97c \ud655\uc778\ud574\ubcf4\uc790. \ub9ce\uc740 CRD\uc911\uc5d0 `x-k8s.io`\ub85c \ud544\ud130\ub97c \ud558\uba74 `machine`, `vsphere`, `cluster` \uad00\ub828\ub41c \uc815\ubcf4\ub97c \ud655\uc778\ud560\uc218 \uc788\ub2e4.\\n\\n```sh\\n> kubectl get crd | grep \\"x-k8s.io\\"\\nclusterclasses.cluster.x-k8s.io                              2022-03-04T14:30:28Z\\nclusterresourcesetbindings.addons.cluster.x-k8s.io           2022-03-04T14:30:28Z\\nclusterresourcesets.addons.cluster.x-k8s.io                  2022-03-04T14:30:28Z\\nclusters.cluster.x-k8s.io                                    2022-03-04T14:30:28Z\\netcdadmclusters.etcdcluster.cluster.x-k8s.io                 2022-03-04T14:30:41Z\\netcdadmconfigs.bootstrap.cluster.x-k8s.io                    2022-03-04T14:30:38Z\\nkubeadmconfigs.bootstrap.cluster.x-k8s.io                    2022-03-04T14:30:34Z\\nkubeadmconfigtemplates.bootstrap.cluster.x-k8s.io            2022-03-04T14:30:34Z\\nkubeadmcontrolplanes.controlplane.cluster.x-k8s.io           2022-03-04T14:30:45Z\\nkubeadmcontrolplanetemplates.controlplane.cluster.x-k8s.io   2022-03-04T14:30:47Z\\nmachinedeployments.cluster.x-k8s.io                          2022-03-04T14:30:29Z\\nmachinehealthchecks.cluster.x-k8s.io                         2022-03-04T14:30:29Z\\nmachinepools.cluster.x-k8s.io                                2022-03-04T14:30:30Z\\nmachines.cluster.x-k8s.io                                    2022-03-04T14:30:30Z\\nmachinesets.cluster.x-k8s.io                                 2022-03-04T14:30:30Z\\nproviders.clusterctl.cluster.x-k8s.io                        2022-03-04T14:27:56Z\\nvsphereclusteridentities.infrastructure.cluster.x-k8s.io     2022-03-04T14:30:51Z\\nvsphereclusters.infrastructure.cluster.x-k8s.io              2022-03-04T14:30:52Z\\nvsphereclustertemplates.infrastructure.cluster.x-k8s.io      2022-03-04T14:30:52Z\\nvspheredeploymentzones.infrastructure.cluster.x-k8s.io       2022-03-04T14:30:52Z\\nvspherefailuredomains.infrastructure.cluster.x-k8s.io        2022-03-04T14:30:53Z\\nvspheremachines.infrastructure.cluster.x-k8s.io              2022-03-04T14:30:53Z\\nvspheremachinetemplates.infrastructure.cluster.x-k8s.io      2022-03-04T14:30:53Z\\nvspherevms.infrastructure.cluster.x-k8s.io                   2022-03-04T14:30:54Z\\n```\\n\\n\uc774\uc911 `machine` CRD\ub97c \ud655\uc778\ud574\ubcf4\uba74 etcd\ub97c \ubcfc \uc218 \uc788\ub294\ub370 \uc774\ub294 VM\uc778\uc2a4\ud134\uc2a4 \ud615\ud0dc\uc758 \uc678\ubd80 \ub9ac\uc18c\uc2a4 \ud615\ud0dc\ub85c \ubc30\ud3ec\ub418\uae30 \ub54c\ubb38\uc5d0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub178\ub4dc \uc815\ubcf4\uc5d0\uc11c\ub294 \ud655\uc778\ud560\uc218 \uc5c6\ub358 `etcd` \uba38\uc2e0\uc744 \ud655\uc778\uc744 \ud560 \uc218 \uc788\ub2e4. \\n\\n```\\n> kubectl get machine -A\\nNAMESPACE     NAME                            CLUSTER   NODENAME         PROVIDERID                                       PHASE     AGE     VERSION\\neksa-system   homelab-etcd-jrhvt              homelab                    vsphere://421b44b1-6017-8469-734b-01bcf68cb459   Running   11m     \\neksa-system   homelab-j5mql                   homelab   192.168.31.186   vsphere://421b4382-0727-3afc-5c47-b73455010d35   Running   11m     v1.21.5-eks-1-21-8\\neksa-system   homelab-md-0-76478bb486-jszj4   homelab   192.168.31.187   vsphere://421b4dc9-b7c6-f0a2-0b50-e5379748b9a9   Running   11m     v1.21.5-eks-1-21-8\\neksa-system   homelab-md-0-76478bb486-rpxlm   homelab   192.168.31.188   vsphere://421b20a4-9870-cd20-4cff-67bb4a9d8372   Running   11m     v1.21.5-eks-1-21-8\\neksa-system   homelab-w6bq8                   homelab   192.168.31.189   vsphere://421befe9-e26a-3f18-9ccf-3fe32dd57fd2   Running   11m     v1.21.5-eks-1-21-8\\n```\\n\\n\ucd08\uae30 \uad6c\uc131 \ud30c\ub4dc\ub4e4\uc744 \uc0b4\ud3b4\ubcf4\uba74 CAPI \uad00\ub828 \ub9ac\uc18c\uc2a4, cert-manager, eks-anywhere, Cilium CNI, vSphere \uad00\ub828 \ucee8\ud2b8\ub864\ub7ec \ub4f1\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```\\n> kubectl get pod -A\\nNAMESPACE                           NAME                                                             READY   STATUS    RESTARTS   AGE\\ncapi-kubeadm-bootstrap-system       capi-kubeadm-bootstrap-controller-manager-694cc79bb7-2h29c       1/1     Running   0          3h42m\\ncapi-kubeadm-control-plane-system   capi-kubeadm-control-plane-controller-manager-5b6b48dd8c-g6md4   1/1     Running   0          3h42m\\ncapi-system                         capi-controller-manager-689cd9b4fd-vxpc8                         1/1     Running   0          3h42m\\ncapv-system                         capv-controller-manager-6b467446b9-n865b                         1/1     Running   0          3h42m\\ncert-manager                        cert-manager-7988d4fb6c-72fw7                                    1/1     Running   0          3h44m\\ncert-manager                        cert-manager-cainjector-6bc8dcdb64-7d7qg                         1/1     Running   0          3h44m\\ncert-manager                        cert-manager-webhook-68979bfb95-hjq8m                            1/1     Running   0          3h44m\\neksa-system                         eksa-controller-manager-5c74596687-45v8t                         2/2     Running   0          3h41m\\netcdadm-bootstrap-provider-system   etcdadm-bootstrap-provider-controller-manager-74c86ffb56-cpw9k   1/1     Running   0          3h42m\\netcdadm-controller-system           etcdadm-controller-controller-manager-7894945688-js7z4           1/1     Running   0          3h42m\\nkube-system                         cilium-bq5gq                                                     1/1     Running   0          3h44m\\nkube-system                         cilium-fn2f7                                                     1/1     Running   0          3h44m\\nkube-system                         cilium-lgptt                                                     1/1     Running   0          3h44m\\nkube-system                         cilium-operator-86d59d5c88-76z2t                                 1/1     Running   1          3h44m\\nkube-system                         cilium-operator-86d59d5c88-9p4s9                                 1/1     Running   0          3h44m\\nkube-system                         cilium-w55nc                                                     1/1     Running   0          68m\\nkube-system                         cilium-wk89j                                                     1/1     Running   0          68m\\nkube-system                         coredns-745c7986c7-k729b                                         1/1     Running   0          3h46m\\nkube-system                         coredns-745c7986c7-thtbm                                         1/1     Running   0          3h46m\\nkube-system                         kube-apiserver-192.168.31.189                                    1/1     Running   0          3h46m\\nkube-system                         kube-controller-manager-192.168.31.189                           1/1     Running   0          3h46m\\nkube-system                         kube-proxy-6xcdk                                                 1/1     Running   0          3h44m\\nkube-system                         kube-proxy-d4qbv                                                 1/1     Running   0          68m\\nkube-system                         kube-proxy-mhzb4                                                 1/1     Running   0          3h46m\\nkube-system                         kube-proxy-vrw2p                                                 1/1     Running   0          68m\\nkube-system                         kube-proxy-xkfmh                                                 1/1     Running   0          3h44m\\nkube-system                         kube-scheduler-192.168.31.189                                    1/1     Running   0          3h46m\\nkube-system                         kube-vip-192.168.31.189                                          1/1     Running   0          3h46m\\nkube-system                         vsphere-cloud-controller-manager-bxp4t                           1/1     Running   2          68m\\nkube-system                         vsphere-cloud-controller-manager-jdncv                           1/1     Running   3          3h44m\\nkube-system                         vsphere-cloud-controller-manager-jhbbp                           1/1     Running   2          3h44m\\nkube-system                         vsphere-cloud-controller-manager-jpn89                           1/1     Running   2          68m\\nkube-system                         vsphere-cloud-controller-manager-qblld                           1/1     Running   1          3h46m\\nkube-system                         vsphere-csi-controller-576c9c8dc8-9k2lm                          5/5     Running   0          3h46m\\nkube-system                         vsphere-csi-node-9fbs2                                           3/3     Running   0          68m\\nkube-system                         vsphere-csi-node-ffjlv                                           3/3     Running   0          3h44m\\nkube-system                         vsphere-csi-node-lrkqk                                           3/3     Running   0          68m\\nkube-system                         vsphere-csi-node-s49x6                                           3/3     Running   0          3h46m\\nkube-system                         vsphere-csi-node-z5hdz                                           3/3     Running   0          3h44m\\n```\\n\\n\\n## \ub85c\ub4dc\ubc38\ub7f0\uc11c \uad6c\uc131\\n\\n\ucfe0\ubc84\ub124\ud2f0\uc2a4 v1.14.2 \uc774\ud6c4 \ubc84\uc804\ubd80\ud130\ub294 `IPVS`\ubaa8\ub4dc\uc5d0\uc11c kube-proxy \uc0ac\uc6a9\uc744 \uc704\ud574 MetalLB \uad6c\uc131\uc804\uc5d0 [strict ARP \ubaa8\ub4dc\ub97c \ud65c\uc131\ud654](https://metallb.universe.tf/installation/#preparation)\ud574\uc57c\ud55c\ub2e4. \\n\\n```sh\\n> kubectl get configmap kube-proxy -n kube-system -o yaml | \\\\\\nsed -e \\"s/strictARP: false/strictARP: true/\\" | \\\\\\nkubectl apply -f - -n kube-system\\n\\n> kubectl describe configmap -n kube-system kube-proxy | grep ARP\\n  strictARP: true\\n```\\n\\n\ubbf8\ub9ac \uc11c\ube44\uc2a4\uc5d0\uc11c \uc0ac\uc6a9\ud560 IP \ub300\uc5ed\uc744 \uc9c0\uc815\ud558\uae30 \uc704\ud574 helm chart configmap value\ub97c \ubbf8\ub9ac \uc0dd\uc131\ud55c\ub2e4. \\n\\n```\\ncat << \'EOF\' >> values.yaml\\nconfigInline:\\n  address-pools:\\n    - name: default\\n      protocol: layer2\\n      addresses:\\n      - 192.168.31.10-192.168.31.19\\nEOF\\n```\\n\\nmetallb\uac00 \uc0ac\uc6a9\ud560 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 `metallb-system`\ub97c \ub9cc\ub4e4\uace0 \uc704 configmap value\ud30c\uc77c\ub85c metalLB\ub97c \uc124\uce58\ud55c\ub2e4.\\n\\n```\\n> helm repo add metallb https://metallb.github.io/metallb\\n> kubectl create ns metallb-system\\n> helm install metallb metallb/metallb -n metallb-system -f values.yaml\\n> kubectl get all -n metallb-system\\nNAME                                      READY   STATUS    RESTARTS   AGE\\npod/metallb-controller-69bbb4669c-2pdnk   1/1     Running   0          115s\\npod/metallb-speaker-2km46                 1/1     Running   0          115s\\npod/metallb-speaker-cm9xw                 1/1     Running   0          115s\\npod/metallb-speaker-dptbx                 1/1     Running   0          115s\\npod/metallb-speaker-jk7hn                 1/1     Running   0          115s\\npod/metallb-speaker-kgfkl                 1/1     Running   0          115s\\npod/metallb-speaker-t7qkw                 1/1     Running   0          115s\\n\\nNAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE\\ndaemonset.apps/metallb-speaker   6         6         6       6            6           kubernetes.io/os=linux   115s\\n\\nNAME                                 READY   UP-TO-DATE   AVAILABLE   AGE\\ndeployment.apps/metallb-controller   1/1     1            1           115s\\n\\nNAME                                            DESIRED   CURRENT   READY   AGE\\nreplicaset.apps/metallb-controller-69bbb4669c   1         1         1       115s\\n```\\n\\nmetallb \ub9ac\uc18c\uc2a4\uac00 \ubaa8\ub450 \uc815\uc0c1\uc73c\ub85c \uc62c\ub77c\uc624\uba74 \uc11c\ube44\uc2a4 \ud558\ub098\ub97c LoadBalancer \ud0c0\uc785\uc73c\ub85c \ubc30\ud3ec\ud558\uace0 \ud574\ub2f9 \uc11c\ube44\uc2a4\ub85c \uc811\uc18d\ud574\ubcf8\ub2e4.  \\n\\n```\\n> kubectl apply -f https://anywhere.eks.amazonaws.com/manifests/hello-eks-a.yaml\\n> kubectl expose deployment hello-eks-a --port=80 --type=LoadBalancer --name=hello-eks-a-lb\\n> SVC1EXIP=$(kubectl get svc hello-eks-a-lb -o jsonpath=\'{.status.loadBalancer.ingress[0].ip}\')\\n> curl $SVC1EXIP\\n\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\\n\\nThank you for using\\n\\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2557  \u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557                                             \\n\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255d\u2588\u2588\u2551 \u2588\u2588\u2554\u255d\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255d                                             \\n\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2554\u255d \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557                                             \\n\u2588\u2588\u2554\u2550\u2550\u255d  \u2588\u2588\u2554\u2550\u2588\u2588\u2557 \u255a\u2550\u2550\u2550\u2550\u2588\u2588\u2551                                             \\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2551  \u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551                                             \\n\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u255d\u255a\u2550\u255d  \u255a\u2550\u255d\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u255d                                             \\n                                                                     \\n \u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2557   \u2588\u2588\u2557\u2588\u2588\u2557   \u2588\u2588\u2557\u2588\u2588\u2557    \u2588\u2588\u2557\u2588\u2588\u2557  \u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2588\u2588\u2557 \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\\n\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2551\u255a\u2588\u2588\u2557 \u2588\u2588\u2554\u255d\u2588\u2588\u2551    \u2588\u2588\u2551\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255d\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u2550\u2550\u255d\\n\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2554\u2588\u2588\u2557 \u2588\u2588\u2551 \u255a\u2588\u2588\u2588\u2588\u2554\u255d \u2588\u2588\u2551 \u2588\u2557 \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2557  \u2588\u2588\u2588\u2588\u2588\u2588\u2554\u255d\u2588\u2588\u2588\u2588\u2588\u2557  \\n\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2551\u255a\u2588\u2588\u2557\u2588\u2588\u2551  \u255a\u2588\u2588\u2554\u255d  \u2588\u2588\u2551\u2588\u2588\u2588\u2557\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2551\u2588\u2588\u2554\u2550\u2550\u255d  \u2588\u2588\u2554\u2550\u2550\u2588\u2588\u2557\u2588\u2588\u2554\u2550\u2550\u255d  \\n\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2551 \u255a\u2588\u2588\u2588\u2588\u2551   \u2588\u2588\u2551   \u255a\u2588\u2588\u2588\u2554\u2588\u2588\u2588\u2554\u255d\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\u2588\u2588\u2551  \u2588\u2588\u2551\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2557\\n\u255a\u2550\u255d  \u255a\u2550\u255d\u255a\u2550\u255d  \u255a\u2550\u2550\u2550\u255d   \u255a\u2550\u255d    \u255a\u2550\u2550\u255d\u255a\u2550\u2550\u255d \u255a\u2550\u255d  \u255a\u2550\u255d\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u255d\u255a\u2550\u255d  \u255a\u2550\u255d\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u255d\\n                                                                     \\nYou have successfully deployed the hello-eks-a pod hello-eks-a-9644dd8dc-647bq\\n\\nFor more information check out\\nhttps://anywhere.eks.amazonaws.com\\n\\n\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\u2b21\u2b22\\n```\\n## \uc778\uadf8\ub808\uc2a4 \ucee8\ud2b8\ub864\ub7ec \uc124\uce58\\n\\nAPI Gateway \uc624\ud508\uc18c\uc2a4\uc778 [Gloo Edge](https://docs.solo.io/gloo-edge/latest/)\ub97c \uc778\uadf8\ub808\uc2a4 \ucee8\ud2b8\ub864\ub7ec\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4. `Envoy` \uae30\ubc18\uc758 \uacbd\ub7c9\ud654\ub41c \uc624\ud508\uc18c\uc2a4\ub85c \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\uc774\ud2f0\ube0c\ud55c \uc635\uc158\ub4e4\uc744 \uc81c\uacf5\ud558\uae30 \ub54c\ubb38\uc5d0 \uac1c\uc778\uc801\uc73c\ub85c \uc120\ud638\ud558\ub294\ud3b8\uc774\ub2e4. \uacf5\uc2dd \uc124\uce58 \ubb38\uc11c\ub294 \ub2e4\uc74c \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n[https://docs.solo.io/gloo-edge/latest/installation/ingress/](https://docs.solo.io/gloo-edge/latest/installation/ingress/)\\n\\n\uacf5\uc2dd CLI\uc778 [glooctl](https://docs.solo.io/gloo-edge/latest/installation/ingress/#installing-on-kubernetes-with-glooctl)\ub098 [Helm Chart](https://docs.solo.io/gloo-edge/latest/installation/ingress/#installing-on-kubernetes-with-helm)\ub85c \uc124\uce58\ub97c \uc9c4\ud589\ud560 \uc218 \uc788\ub2e4. ingress\ub97c \uad6c\uc131\ud558\uae30 \uc704\ud574 `gateway.enabled` value\uac12\uc744 `false`\ub85c `ingress.enabled` value\ub97c `true`\ub85c \ubcc0\uacbd\ud558\uc5ec inline \uad6c\uc131\uc73c\ub85c \ubc30\ud3ec\ub97c \uc9c4\ud589\ud55c\ub2e4.\\n\\n```sh\\nhelm repo add gloo https://storage.googleapis.com/solo-public-helm\\nhelm repo update\\nkubectl create namespace gloo-system\\nhelm install gloo gloo/gloo --namespace gloo-system \\\\\\n  --set gateway.enabled=false,ingress.enabled=true\\n```\\n\\n```sh\\n> kubectl get all -n gloo-system\\nNAME                                 READY   STATUS    RESTARTS   AGE\\npod/discovery-9694c78f6-zrf4l        1/1     Running   0          88s\\npod/gloo-7cd566cb69-bfghh            1/1     Running   0          88s\\npod/ingress-7fb5c9687d-qq98j         1/1     Running   0          88s\\npod/ingress-proxy-5cc555c45b-9mj9n   1/1     Running   0          88s\\n\\nNAME                    TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                               AGE\\nservice/gloo            ClusterIP      10.100.162.70   <none>          9977/TCP,9976/TCP,9988/TCP,9979/TCP   88s\\nservice/ingress-proxy   LoadBalancer   10.107.107.38   192.168.31.11   80:32207/TCP,443:32228/TCP            88s\\n\\nNAME                            READY   UP-TO-DATE   AVAILABLE   AGE\\ndeployment.apps/discovery       1/1     1            1           88s\\ndeployment.apps/gloo            1/1     1            1           88s\\ndeployment.apps/ingress         1/1     1            1           88s\\ndeployment.apps/ingress-proxy   1/1     1            1           88s\\n\\nNAME                                       DESIRED   CURRENT   READY   AGE\\nreplicaset.apps/discovery-9694c78f6        1         1         1       88s\\nreplicaset.apps/gloo-7cd566cb69            1         1         1       88s\\nreplicaset.apps/ingress-7fb5c9687d         1         1         1       88s\\nreplicaset.apps/ingress-proxy-5cc555c45b   1         1         1       88s\\n```\\n\\n\uc0d8\ud50c `petstore` \uc11c\ube44\uc2a4\ub97c \ubc30\ud3ec\ud558\uace0, \uc778\uadf8\ub808\uc2a4 \ud074\ub798\uc2a4 \uc5b4\ub178\ud14c\uc774\uc158\uc744 `kubernetes.io/ingress.class: gloo`\ub85c \uc120\uc5b8\ud558\uace0 `ddiiwoong.com` \ud638\uc2a4\ud2b8 \uc774\ub984\uc73c\ub85c \ubc30\ud3ec\ud55c\ub2e4.\\n\\n```sh\\nkubectl apply -f \\\\\\n  https://raw.githubusercontent.com/solo-io/gloo/v1.2.9/example/petstore/petstore.yaml\\n```\\n\\n```\\ncat <<EOF | kubectl apply -f -\\napiVersion: networking.k8s.io/v1\\nkind: Ingress\\nmetadata:\\n name: petstore-ingress\\n annotations:\\n    # note: this annotation is only required if you\'ve set \\n    # REQUIRE_INGRESS_CLASS=true in the environment for \\n    # the ingress deployment\\n    kubernetes.io/ingress.class: gloo\\nspec:\\n  rules:\\n  - host: ddiiwoong.com\\n    http:\\n      paths:\\n      - path: /.*\\n        pathType: ImplementationSpecific\\n        backend:\\n          service:\\n            name: petstore\\n            port:\\n              number: 8080\\nEOF\\n```\\n\\n```\\n> kubectl get ingress\\nNAME               CLASS    HOSTS           ADDRESS         PORTS   AGE\\npetstore-ingress   <none>   ddiiwoong.com   192.168.31.11   80      7m41s\\n```\\n\\n\ud574\ub2f9 \ud638\uc2a4\ud2b8\ub85c \uc815\uc0c1 \ub77c\uc6b0\ud305\ub418\uc5b4 \uc811\uc18d\ub418\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n```\\n> curl -H \\"Host: ddiiwoong.com\\" 192.168.31.11/api/pets\\n\\n[{\\"id\\":1,\\"name\\":\\"Dog\\",\\"status\\":\\"available\\"},{\\"id\\":2,\\"name\\":\\"Cat\\",\\"status\\":\\"pending\\"}]\\n```\\n\\n## GitOps \ucee8\ud2b8\ub864\ub7ec\ub85c \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\\n\\ngitops \uc624\ud508\uc18c\uc2a4\uc778 [Flux](https://fluxcd.io/docs/get-started/)\ub97c \uc0ac\uc6a9\ud574\uc11c \uc5ec\ub7ec\uac00\uc9c0 \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\ub97c \uc218\ud589\ud560 \uc218 \uc788\ub2e4. \uc704\uc5d0\uc11c \uc0dd\uc131\ud55c `desired state`\uc778 \ud074\ub7ec\uc2a4\ud130 \ucee8\ud53c\uadf8\ub97c github repo\uc5d0\uc11c Flux \ucee8\ud2b8\ub864\ub7ec\ub97c \ud1b5\ud574 \ud074\ub7ec\uc2a4\ud130 \uc6b4\uc601\uc744 \uc218\ud589\ud560 \uc218 \uc788\ub2e4. \\n\\n[https://anywhere.eks.amazonaws.com/docs/tasks/cluster/cluster-flux/](https://anywhere.eks.amazonaws.com/docs/tasks/cluster/cluster-flux/)\\n\\nWorker \ub178\ub4dc\uc640 Control Plan, Etcd\ub4f1\uc758 vSphere\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 datastore, \ub514\uc2a4\ud06c, \uba54\ubaa8\ub9ac, CPU, resourcepool \ub4f1\uc744 \uad00\ub9ac\ud560 \uc218 \uc788\ub2e4. \ub2e8, EKS\uc758 \uad00\ub9ac\ud615 \ub178\ub4dc\uadf8\ub8f9\uacfc \uc720\uc0ac\ud55c \ubc29\uc2dd\uc73c\ub85c \ub178\ub4dc\uadf8\ub8f9\uc758 VM\uc758 \uc22b\uc790\ub97c \ub298\ub9ac\uac70\ub098 \uc904\uc77c\uc218 \uc788\uc9c0\ub9cc \uc544\uc9c1\uae4c\uc9c0 \uc2e0\uaddc\ub85c worker \ub178\ub4dc\uadf8\ub8f9\uc744 \uc0dd\uc131\ud558\uac70\ub098 \uc0ad\uc81c\ud558\ub294 \uae30\ub2a5\uc740 \uc81c\uacf5\ud558\uc9c0 \uc54a\ub294\ub2e4.\\n\\n\ucd08\uae30 \ud074\ub7ec\uc2a4\ud130 \ucee8\ud53c\uadf8\uc5d0 \uc544\ub798\uc640 \uac19\uc774 \uae30\uc874 \ub178\ub4dc\uadf8\ub8f9 `md-0`\uc5d0 \uc2e0\uaddc VM 1\ub300\ub97c \ucd94\uac00\ud574\ubcf4\uc790. (2\ub300->3\ub300)\\n\\n- `clusters/$CLUSTER_NAME/eksa-system/eksa-cluster.yaml`\\n\\n```yaml\\napiVersion: anywhere.eks.amazonaws.com/v1alpha1\\nkind: Cluster\\nmetadata:\\n  name: homelab\\n  namespace: default\\nspec:\\n  ...\\n  workerNodeGroupConfigurations:\\n  - count: 3\\n    machineGroupRef:\\n      kind: VSphereMachineConfig\\n      name: homelab\\n    name: md-0\\n```\\n\\n\ucd08\uae30 \ud658\uacbd\uc5d0\uc11c \uad6c\uc131\ub41c gitops repo\uc5d0 \uc218\uc815\ub41c \ud30c\uc77c\uc744 \ucee4\ubc0b\ud55c\ub2e4.\\n\\n```sh\\ngit add clusters/homelab/eksa-system/eksa-cluster.yaml\\ngit commit -m \'Scale from 2 to 3 at WorkerNodeGroup md-0 \'\\ngit push origin main\\n```\\n\\n`md-0` \ub178\ub4dc\uadf8\ub8f9\uc5d0 VM\uc774 \uc0c8\ub86d\uac8c \ucd94\uac00\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```sh\\n> kubectl get machine -n eksa-system\\nNAME                            CLUSTER   NODENAME         PROVIDERID                                       PHASE     AGE   VERSION\\nhomelab-etcd-jrhvt              homelab                    vsphere://421b44b1-6017-8469-734b-01bcf68cb459   Running   75m   \\nhomelab-j5mql                   homelab   192.168.31.186   vsphere://421b4382-0727-3afc-5c47-b73455010d35   Running   75m   v1.21.5-eks-1-21-8\\nhomelab-md-0-76478bb486-j68fd   homelab   192.168.31.190   vsphere://421bc1ee-eac7-f1db-b351-5fac25b45fc0   Running   11m   v1.21.5-eks-1-21-8\\nhomelab-md-0-76478bb486-jszj4   homelab   192.168.31.187   vsphere://421b4dc9-b7c6-f0a2-0b50-e5379748b9a9   Running   75m   v1.21.5-eks-1-21-8\\nhomelab-md-0-76478bb486-rpxlm   homelab   192.168.31.188   vsphere://421b20a4-9870-cd20-4cff-67bb4a9d8372   Running   75m   v1.21.5-eks-1-21-8\\nhomelab-w6bq8                   homelab   192.168.31.189   vsphere://421befe9-e26a-3f18-9ccf-3fe32dd57fd2   Running   75m   v1.21.5-eks-1-21-8\\n```\\n\\n## \uc815\ub9ac \\n\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 eks-anywhere \uc624\ud508\uc18c\uc2a4\ub97c vSphere \ud648\uc11c\ubc84\uc5d0\uc11c \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud55c \uacbd\ud5d8\uc744 \uc815\ub9ac\ud588\ub2e4. \\n\\n\uc124\uce58\ub97c \uc9c4\ud589\ud558\uba74\uc11c \uc5d0\ub7ec\uac00 \ub098\uba74 \ud558\ub098\ud558\ub098 \uacf5\uc2dd \ubb38\uc11c\ub97c \ud655\uc778\ud558\uace0, \ud68c\uc0ac \uc2ac\ub799 \ucc2c\uc2a4\ub3c4 \uc0ac\uc6a9\ud558\uba74\uc11c \ud798\ub4e4\uac8c \uc124\uce58\ub97c \uc644\ub8cc\ud588\ub2e4. \uc0dd\uac01\ubcf4\ub2e4 \ub514\ubc84\uae45\uc744 \ud558\ub294\ub370 \ub9ce\uc740 \uc2dc\uac04\uc744 \ud5c8\ube44\ud588\ub294\ub370 \uc2e4\uc81c\ub85c 2\uc77c \uc774\uc0c1 \uace0\uc0dd\uc744 \ud588\ub2e4. \ub300\ubd80\ubd84\uc758 \uacbd\uc6b0 \ub514\ubc84\uadf8 \ub808\ubca8\uc758 \ub85c\uadf8\ub97c \ubcf4\uba74\uc11c \ud2b8\ub7ec\ube14\uc288\ud305\uc744 \ud1b5\ud574 \ubb38\uc81c \ud574\uacb0\uc774 \uac00\ub2a5\ud588\uace0 \uadf8 \uacfc\uc815\uc5d0\uc11c EKS Anywhere\uc758 \ub0b4\ubd80 \uad6c\uc131\uc694\uc18c\ub4e4\uacfc \uc2e4\uc81c Cluster API \uc6cc\ud06c\ud50c\ub85c\uc6b0\ub97c \uc774\ud574\ud560 \uc218 \uc788\uc5c8\ub2e4. \\n\\n\ub2e4\ub9cc \uc544\uc9c1\uae4c\uc9c0 \ubb38\uc11c\ud654\ub098 \ucee4\ubba4\ub2c8\ud2f0\uc5d0 \ub9ce\uc740 \uc720\uc2a4\ucf00\uc774\uc2a4\uac00 \uc5c6\ub2e4\ub294 \uc810\uacfc Cilium\uc744 \uba54\uc778 CNI\ub85c \ud65c\uc6a9\ud568\uc5d0\ub3c4 \ubd88\uad6c\ud558\uace0 `CiliumNetworkPolicy` API\ub97c \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud558\ub294 \uc810\uc774\ub098 Cilium \uc720\uc800 \uc778\ud130\ud398\uc774\uc2a4\uc778 [Hubble UI](https://github.com/cilium/hubble-ui)\ub97c \ud65c\uc131\ud654\ud574\uc11c \uc0ac\uc6a9\ud560 \uc218\uac00 \uc5c6\ub294 [\uc81c\uc57d\uc0ac\ud56d](https://anywhere.eks.amazonaws.com/docs/tasks/workload/networking-and-security/#additional-cilium-features)\ub4f1\uc774 \uc788\uc5c8\uace0, \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uad00\ub828\ud574\uc11c\ub294 `Persistent Volume` \uad00\ub828\ud558\uc5ec vSAN\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uc740 \ud658\uacbd\uc5d0\uc11c\ub294 VMDK\ub97c \uc218\ub3d9\uc73c\ub85c \uc0dd\uc131\ud558\uace0 \ud574\ub2f9 \ubcfc\ub968\uc744 \ub9e4\ud551\uc2dc\ucf1c\uc57c \ud65c\uc6a9\uc774 \uac00\ub2a5\ud55c \uc81c\uc57d\uc0ac\ud56d\uc774 \uc874\uc7ac\ud558\ub294 \uac83\uc774 \uc870\uae08 \uc544\uc26c\uc6b4 \ubd80\ubd84\uc774\ub2e4.\\n\\n\uc2e4\uc81c \ud504\ub85c\ub355\uc158 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc815\ub3c4\ub77c\uae30 \ubcf4\ub2e8 EKS\ub97c \uc0ac\uc6a9\ud558\ub294 \uad00\uc810\uc5d0\uc11c \uc720\uc0ac\ud55c \uacbd\ud5d8\uc744 \ubc14\ud0d5\uc73c\ub85c \uac1c\ubc1c\ud658\uacbd\uc744 \uac00\uc838\uac08\uc218 \uc788\uace0 tanzu\ub098 \ub2e4\ub978 cluster-api\ub97c \ud65c\uc6a9\ud55c \ub3c4\uad6c\ub4e4 \ubcf4\ub2e4 \uc880\ub354 \uc720\uc5f0\ud558\uace0 \uc624\ud508\uc18c\uc2a4\uc5d0 \uac00\uae4c\uc6b4 \uacbd\ud5d8\uc131\uc744 \uc81c\uacf5\ud55c\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4. \uac8c\ub2e4\uac00 Flux\uc758 `Server-side reconciliation` \uae30\ubc18 [\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub9ac\uc18c\uc2a4 \uad00\ub9ac \ubc29\uc2dd](https://kubernetes.io/docs/reference/using-api/server-side-apply/)\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \ub9e4\uc6b0 \uc720\uc5f0\ud558\uac8c \uad00\ub9ac\ud560 \uc218 \uc788\ub2e4\ub294 \uac83\ub3c4 \uc8fc\ubaa9\ud574\ubcfc\ub9cc\ud55c \ub0b4\uc6a9\uc774\ub77c \uc0dd\uac01\ud55c\ub2e4. \ud074\ub7ec\uc2a4\ud130 \uc790\uccb4\ub3c4 \uc778\ud504\ub77c \ub9ac\uc18c\uc2a4\ub77c \uac00\uc815\ud558\uace0 \ucd5c\ucd08\uc5d0 \uc6d0\ud558\ub294 \ud615\ud0dc\ub85c \uc120\uc5b8\ud558\uace0 \uad6c\uc131\uc774\ud6c4\uc5d0\ub3c4 \ucfe0\ubc84\ub124\ud2f0\uc2a4 CRD \ud615\uc2dd\uc73c\ub85c \ub178\ub4dc\uadf8\ub8f9\uacfc \uc778\uc2a4\ud134\uc2a4 \ub4f1\uc758 \uc5ec\ub7ec \ub9ac\uc18c\uc2a4\ub97c GitOps \ubc29\uc2dd\uc73c\ub85c \uad00\ub9ac\ud558\ub294 \ubc29\uc2dd\uc744 \ucc44\ud0dd\ud558\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \uc2e4\uc81c \uc778\ud504\ub77c \uad00\ub9ac\ub97c \ud558\ub294 \uc6b4\uc601\uc790\ub97c \uc704\ud55c \uac00\uc7a5 \ud6a8\uacfc\uc801\uc778 \ubc29\ubc95\uc744 \ucc44\ud0dd\ud588\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4.\\n\\n\uadf8\ub9ac\uace0 \ud45c\uc900\uaddc\uaca9\uc758 Managed \ud558\ub4dc\uc6e8\uc5b4\ub97c \uc0ac\uc6a9\ud558\ub294 Outpost\uc640 \ube44\uad50\ud558\ub294 \uc790\ub8cc\ub4e4\uc774 \ucd5c\uadfc \ub9ce\uc774 \uc62c\ub77c\uc624\uace0 \uc788\ub294\ub370 EKS Anywhere\uc758 \uac00\uc7a5 \ud070 \uc7a5\uc810\uc740 \ub0b4\uac00 \uac00\uc9c4 \ud558\ub4dc\uc6e8\uc5b4\ub97c EKS Distro\uae30\ubc18\uc758 \uc624\ud508\uc18c\uc2a4\ub97c \ud1b5\ud574 \uc0ac\uc6a9\ud560 \uc218 \uc788\uace0 AWS \ud658\uacbd\uacfc\uc758 \uc9c1\uc811\uc801\uc778 \ud1b5\uc2e0\uc774 \uc5c6\uc774\ub3c4 \uc790\uccb4\uc801\uc778 \uc6cc\ud06c\ub85c\ub4dc \uc6b4\uc601\uc774 \uac00\ub2a5\ud55c\uac8c \uac00\uc7a5 \ud070 \uc7a5\uc810\uc774\ub77c\uace0 \uc0dd\uac01\ud55c\ub2e4. \\n\\n\ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc758 \uc81c\ud488\uacfc \uad00\ub828\ud574\uc11c \ub85c\ub4dc\ub9f5\uc744 \uc790\uc138\ud788 \uc5b8\uae09\ud558\uc9c0\ub294 \ubabb\ud558\uc9c0\ub9cc \uc5d4\ud130\ud504\ub77c\uc774\uc988 vSphere \ud658\uacbd\uacfc \ub3d9\uc2dc\uc5d0 EKS\ub97c \uc0ac\uc6a9\ud558\ub294 \uc870\uc9c1\uc5d0\uc11c\ub294 \uc911\uc694\ud55c \ud558\ub098\uc758 \uc120\ud0dd\uc9c0\uac00 \ub420 \uc218 \uc788\ub2e4\ub294 \uc810\uc5d0\uc11c\ub3c4 \uc9c0\ucf1c\ubcfc\ub9cc\ud558\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4. \\n\\n\ub2e4\uc74c \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 \ud574\ub2f9 \ud074\ub7ec\uc2a4\ud130\uc5d0 OpenTelemetry collector, Loki, Prometheus \uad6c\uc131\uc744 \ud1b5\ud55c observability \ud658\uacbd \uad6c\uc131\uc744 \uc9c4\ud589\ud574\ubcfc \uc608\uc815\uc774\ub2e4.\\n\\n> \ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4."},{"id":"kubernetes/what-is-tailscale/","metadata":{"permalink":"/kubernetes/what-is-tailscale/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2022-02-05-what-is-tailscale.md","source":"@site/blog/2022-02-05-what-is-tailscale.md","title":"What is Tailscale?","description":"wireguard\uc640 tailscale\uc744 \ube44\uad50\ud558\uace0 kubernetes \ud658\uacbd\uc5d0\uc11c \ud65c\uc6a9\ubc29\uc548 \uac80\ud1a0","date":"2022-02-05T00:00:00.000Z","formattedDate":"February 5, 2022","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"wireguard","permalink":"/tags/wireguard"},{"label":"tailscale","permalink":"/tags/tailscale"},{"label":"vpn","permalink":"/tags/vpn"},{"label":"network","permalink":"/tags/network"}],"readingTime":28.07,"truncated":true,"authors":[],"frontMatter":{"layout":"single","title":"What is Tailscale?","comments":true,"classes":"wide","description":"wireguard\uc640 tailscale\uc744 \ube44\uad50\ud558\uace0 kubernetes \ud658\uacbd\uc5d0\uc11c \ud65c\uc6a9\ubc29\uc548 \uac80\ud1a0","slug":"kubernetes/what-is-tailscale/","date":"2022-02-05T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","wireguard","tailscale","vpn","network"]},"prevItem":{"title":"EKS Anywhere on vSphere Homelab","permalink":"/kubernetes/eks-anywhere/"},"nextItem":{"title":"Synology monitoring with Prometheus and snmp exporter","permalink":"/prometheus/synology-prometheus/"}},"content":"> \ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4.\\n\\n\uc774\uc9c1\uc744 \ud558\uace0 \ube14\ub85c\uadf8\uc5d0 \uc190\uc744 \ub193\uace0 \uc788\ub2e4\uac00 \ud398\uc774\uc2a4\ubd81 [Kubernetes Korea Group](https://ko-kr.facebook.com/groups/)\uc5d0 \uc62c\ub77c\uc628 [\ucfe0\ubc84\ub124\ud2f0\uc2a4 \ub124\ud2b8\uc6cc\ud0b9 \uc2a4\ud130\ub514 \ubaa8\uc9d1 \uacf5\uace0](https://gasidaseo.notion.site/c9cd413265ea4ea1b1ae38eb36dfda94)\ub97c \ubcf4\uac8c\ub418\uc5c8\ub2e4. \uc774\uc9c1\ud6c4\uc5d0 \ub300\ubd80\ubd84\uc758 \ud504\ub85c\uc81d\ud2b8\uac00 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uae30\ubc18\uc73c\ub85c \uc9c4\ud589\ub418\ub2e4 \ubcf4\ub2c8 \ub124\ud2b8\uc6cc\ud06c \uc804\ubb38\uac00 \uc774\uc2e0 [\uac00\uc2dc\ub2e4](https://www.facebook.com/jongho.seo.5811)\ub2d8\uc758 [\ud300 \ube14\ub85c\uadf8](https://cloudneta.github.io/)\ub098 \uc774\ub098 \uc5ec\ub7ec \uc591\uc9c8\uc758 \uac8c\uc2dc\uae00\ub4e4\uc744 \ucc38\uace0\ub9cc \ud558\ub2e4\uac00 \uc870\uae08\ub354 \uae4a\uc774 \ud559\uc2b5\uc744 \ud558\uace0 \uc2f6\uc5b4 \uc2a4\ud130\ub514\ub97c \uc2e0\uccad\ud588\uace0, \uac04\ub2e8\ud55c \uba74\uc811(??)\ud6c4\uc5d0 \uc815\uc2dd\uc73c\ub85c \uc2a4\ud130\ub514\uc5d0 \ucc38\uc5ec\ud558\uac8c \ub418\uc5c8\ub2e4.  \\n\\n\ubcf8\ub860\uc73c\ub85c \ub3cc\uc544\uac00\uc11c calico \uc2a4\ud130\ub514\ub97c \uc9c4\ud589\ud558\ub2e4\uac00 [wireguard](https://www.wireguard.com/)\ub77c\ub294 opensource vpn\uc744 \uc54c\uac8c \ub418\uc5c8\uace0 \ud574\ub2f9 \ud328\ud0a4\uc9c0\ub97c \uc774\uac83\uc800\uac83 \ud14c\uc2a4\ud2b8\ud558\ub2e4\uac00 \uae30\uc874\uc5d0 \uc0ac\uc6a9\uc911\uc778 [tailscale](https://tailscale.com/) \uacfc \uc720\uc0ac\ud558\ub2e4\ub294 \uac83\uc744 \uc778\uc9c0\ud558\uace0 \ub0b4\ubd80 \uad6c\uc131\uc744 \uc870\uae08 \ucc3e\uc544\ubcf4\uae30\ub85c \ud588\ub2e4.  \\n\\n\ud655\uc778\ud574\ubcf4\ub2c8 tailscale\uc740 wireguard \uae30\ubc18\uc73c\ub85c \ud558\ub294 \ub3d9\uc77c \uae30\uc220\uc758 \uc0c1\uc6a9 \uc194\ub8e8\uc158\uc774\uc600\uace0, \uc774\uc5d0 \uba87\uac00\uc9c0 \uacf5\ubd80\ucc28 \uc815\ub9ac\ub97c \uc704\ud574 \ud574\ub2f9 \ud3ec\uc2a4\ud2b8\ub97c \uc791\uc131\ud558\uac8c \ub418\uc5c8\ub2e4. \\n\\n\x3c!--truncate--\x3e\\n\\n## Wireguard\\n\\n- [https://www.wireguard.com/](https://www.wireguard.com/)\\n\\n\uba3c\uc800 WireGuard\ub97c \uac04\ub2e8\ud558\uac8c \uc815\uc758\ud558\uba74 \ubcf4\uc548\uc5d0 \ucd08\uc810\uc744 \ub450\uace0 \ub2e8\uc21c\ud568\uacfc \uc26c\uc6b4 \uc0ac\uc6a9\uc744 \ub300\ud45c\uc801\uc778 \ud2b9\uc9d5\uc73c\ub85c \ub0b4\uc138\uc6b0\ub294 \uc624\ud508\uc18c\uc2a4 \uae30\ubc18 VPN \uc18c\ud504\ud2b8\uc6e8\uc5b4\ub85c IPsec\uacfc OpenVPN\ubcf4\ub2e4 \uc0ac\uc6a9\ud558\uae30 \uc6a9\uc774\ud558\uace0 \uac00\ubcbc\uc6b4 \uac83\uc744 \uac15\uc810\uc73c\ub85c [Linux 5.6 \ucee4\ub110 \uc774\ud6c4\ubd80\ud130 \uae30\ubcf8 \ud328\ud0a4\uc9c0](https://lore.kernel.org/wireguard/CAHmME9qOpDeraWo5rM31EWQW574KEduRBTL-+0A2ZyqBNDeYkg@mail.gmail.com/T/#u)\ub85c \ud0d1\uc7ac\uac00 \ub418\uc5c8\ub2e4. \uc81c\uc774\uc2a8 \ub3c4\ub128\ud544\ub4dc(Jason Donenfeld, [@zx2c4](https://twitter.com/zx2c4))\uac00 \uc124\uacc4\ud55c WireGuard\ub294 \uc554\ud638\ud654 \ubbfc\ucca9\uc131, \uc989 \ub2e4\uc591\ud55c \uc554\ud638\ud654, \ud0a4 \uad50\ud658, \ud574\uc2f1 \uc54c\uace0\ub9ac\uc998\uc5d0 \ub300\ud55c \uc120\ud0dd\uad8c\uc744 \uc81c\uacf5\ud55c\ub2e4\ub294 \uac1c\ub150\uc744 \ubc84\ub9ac\uace0 \uc544\uc8fc \uac04\uacb0\ud55c \ucf54\ub4dc \uad6c\uc870\ub97c \ud1b5\ud574 \ucee4\ub110\uc5d0\uc11c \uc9c1\uc811 \ub3d9\uc791\ud558\uace0 \uc8fc\uc694 \uc554\ud638 \uc54c\uace0\ub9ac\uc998\uc5d0 \ub300\ud574\uc11c \ubcd1\ub82c\ucc98\ub9ac\ud558\ubbc0\ub85c \ube60\ub978 \uc18d\ub3c4\ub97c \uc790\ub791\ud55c\ub2e4.  \\n\\n\ud648\ud398\uc774\uc9c0\uc5d0 \uac8c\uc2dc\ub41c \uba87\uac00\uc9c0 \ud2b9\uc9d5\uc744 \uc815\ub9ac\ud558\uba74 \\n- Simple & Easy-to-use : SSH \ucc98\ub7fc \ud0a4\uad50\ud658 \ubc29\uc2dd\uc73c\ub85c \uc9c4\ud589\ub418\uace0 WireGuard\uc5d0 \uc758\ud574 \uad00\ub9ac\ub418\uae30 \ub54c\ubb38\uc5d0 \uc27d\uac8c \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\uace0, IP\uac00 \ubcc0\uacbd\ub418\ub294 \ubaa8\ubc14\uc77c \ub85c\ubc0d\uc911\uc5d0\uc11c \uc5f0\uacb0\uc774 \ubcf4\uc7a5\ub418\ub294 \uac83\uc774 \ud2b9\uc9d5\uc774\ub2e4. \\n- Cryptographically Sound : [Noise protocol framework](http://www.noiseprotocol.org/), [Curve25519](http://cr.yp.to/ecdh.html), [ChaCha20](http://cr.yp.to/chacha.html), [Poly1305](http://cr.yp.to/mac.html), [BLAKE2](https://blake2.net/), [SipHash24](https://131002.net/siphash/), [HKDF](https://eprint.iacr.org/2010/264) \uc640 \uac19\uc740 \uac00\uc7a5 \ube60\ub974\uace0 \ucd5c\uc2e0\uc758 \uc554\ud638, \ud574\uc2dc \uc54c\uace0\ub9ac\uc998\uc744 \uc0ac\uc6a9\ud55c\ub2e4.  \\n- Minimal Attack Surface : WireGuard\ub294 \uad6c\ud604 \uc6a9\uc774\uc131\uacfc \ub2e8\uc21c\uc131\uc744 \uc5fc\ub450\uc5d0 \ub450\uace0 \uc124\uacc4\ub418\uc5c8\ub2e4. \ub9e4\uc6b0 \uc801\uc740 \ucf54\ub4dc \ub77c\uc778\uc73c\ub85c \uad6c\ud604\ub418\uc11c \ubcf4\uc548 \ucde8\uc57d\uc810\uc5d0 \ub300\ud574 \uc27d\uac8c \uac10\uc0ac\ud560 \uc218 \uc788\ub2e4. \uadf8\ub9cc\ud07c \ucca0\uc800\ud788 \uac80\uc99d\ub420 \uac00\ub2a5\uc131\uc774 \ub192\uace0, \uc608\uc0c1\uce58 \ubabb\ud55c \uacf3\uc5d0\uc11c\uc758 \ubc84\uadf8\ub85c \uc778\ud55c \ucde8\uc57d\uc810\uc774 \ubc1c\uc0dd\ud560 \uac00\ub2a5\uc131\uc774 \uc0c1\ub300\uc801\uc73c\ub85c \uc801\ub2e4\ub294 \uc598\uae30\uac00 \ub41c\ub2e4.  \\n- High Performance : \ubaa8\ub4e0 \uac83\uc774 kernel\uc5d0\uc11c \ub3d9\uc791\ud558\uace0 \uc548\uc804\ud55c \ub124\ud2b8\uc6cc\ud0b9\uc774 \ub9e4\uc6b0 \ube60\ub978 \uc18d\ub3c4 \ub85c \ub3d9\uc791\ud558\uae30 \ub54c\ubb38\uc5d0 \uc2a4\ub9c8\ud2b8\ud3f0\uacfc \ubc31\ubcf8 \ub77c\uc6b0\ud130\uc640 \uac19\uc740 \uc791\uc740 \uc784\ubca0\ub514\ub4dc \uc7a5\uce58 \ub4f1 \ubaa8\ub450\uc5d0 \uc801\ud569\ud558\ub2e4.  \\n- Well Defined & Thoroughly Considered : Wireguard\ub294 [\ubc31\uc11c](https://www.wireguard.com/papers/wireguard.pdf)\uac00 \ubc1c\ud589\ub420 \uc815\ub3c4\ub85c \uae30\uc220\uc801\uc73c\ub85c \uc5ec\ub7ec\uac00\uc9c0 \uace0\ub824\uc0ac\ud56d\ub4e4\uc744 \uba85\ud655\ud558\uac8c \uc815\uc758\ud574\ub1a8\ub2e4.\\n\\n\uad00\ub828\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 [\ubc31\uc11c](https://www.wireguard.com/papers/wireguard.pdf) \ub97c \ucc38\uace0\ud55c\ub2e4.\\n\\n### Wireguard in Calico CNI\\n\\n\uc2a4\ud130\ub514\ub97c \uc9c4\ud589\ud560\ub54c\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud30c\ub4dc\uc640 \ud30c\ub4dc \uc0ac\uc774\uc758 \ud328\ud0b7\uc744 \ub124\ud2b8\uc6cc\ud06c \ub808\ubca8\ub85c \uc554\ud638\ud654 \ud558\ub294 \ub3c4\uad6c\ub85c Calico\uc5d0 \ub0b4\uc7a5\ub41c WireGuard \ud50c\ub7ec\uadf8\uc778\uc744 \uc0ac\uc6a9\ud574\uc11c \ud30c\ub4dc\uac04 \ud130\ub110\uc744 \uc124\uc815\ud558\uace0 \ud2b8\ub798\ud53d\uc744 \uc554\ud638\ud654 \ud558\ub294 \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud558\uac8c \ub418\uc5c8\ub2e4. Calico CNI\uc5d0\uc11c \uad6c\uc131\ud558\ub294 \ubc29\ubc95\uc740 `calicoctl`\ub97c \uc0ac\uc6a9\ud574\uc11c \uc124\uc815\ud558\uae30 \ub54c\ubb38\uc5d0 \uac04\ub2e8\ud558\ub2e4. \\n\\n```\\n$ calicoctl patch felixconfiguration default --type=\'merge\' -p \'{\\"spec\\":{\\"wireguardEnabled\\":true}}\'\\n\\n$ calicoctl get felixconfiguration default -o yaml | grep wireguardEnabled\\n  wireguardEnabled: true\\n```\\n\\n\ud30c\ub4dc\uac04\uc758 ping test\ub97c \uc9c4\ud589\ud558\uace0 \ub09c \uc774\ud6c4 \ud30c\ub4dc \ub808\ubca8\uc5d0\uc11c \ud328\ud0b7 \ub364\ud504\ud55c \ub0b4\uc6a9\uc744 wireshark\ub85c \ud655\uc778\ud55c \ub0b4\uc6a9\uc774\ub2e4. \uadf8\ub9bc\uc5d0\uc11c\ucc98\ub7fc icmp \ud328\ud0b7\uc740 \ud655\uc778\uc774 \uc548\ub418\uace0 udp\uc640 wireguard \ud504\ub85c\ud1a0\ucf5c\uc744 \ud1b5\ud574 \ub370\uc774\ud130\uac00 \uc554\ud638\ud654 \ub41c\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n![wg](/img/wg.png)\\n\\n\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 tailscale \ud65c\uc6a9\ubc29\uc548\uc744 \uc18c\uac1c\ud558\ub294 \uac83\uc73c\ub85c \uac04\ub2e8\ud558\uac8c calico\ub97c \ud1b5\ud574 wireguard \uc124\uc815\ud558\ub294 \uac83\uc740 \ub118\uc5b4\uac04\ub2e4. \ub2e4\ub978 \uc88b\uc740 \ub0b4\uc6a9\ub4e4\uc740 \ub2e4\uc74c \ub9c1\ud06c\ub4e4\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n### \ucc38\uace0\uc790\ub8cc\\n- [WireGuard\ub85c \uba4b\uc9c4 VPN \uc11c\ubc84 \uad6c\ucd95\ud558\uae30 - devsisters](https://tech.devsisters.com/posts/wireguard-vpn-1/)\\n- [WireGuard VPN \ud574\ubd80 - Slowboot](https://slowbootkernelhacks.blogspot.com/2020/09/wireguard-vpn.html)\\n- [Kilo - multi-cloud k8s network overlay built on WireGuard](https://github.com/squat/kilo)\\n- [Go implementation of WireGuard](https://git.zx2c4.com/wireguard-go/about/)\\n\\n## Tailscale\\n\\n- [https://tailscale.com/](https://tailscale.com/)\\n\\nTailScale\uc740 \uc11c\ubc84, \ucef4\ud4e8\ud130 \ubc0f \ud074\ub77c\uc6b0\ub4dc \uc778\uc2a4\ud134\uc2a4\uac04\uc5d0 \ubcf4\uc548 \ub124\ud2b8\uc6cc\ud06c\ub97c \ub9cc\ub4dc\ub294 VPN\uc73c\ub85c Wireguard \ud504\ub85c\ud1a0\ucf5c\uc744 \uc0ac\uc6a9\ud574\uc11c \ub9cc\ub4e0 \ud074\ub77c\uc6b0\ub4dc \uc11c\ube44\uc2a4\uc774\ub2e4. Tailscale\uc774 \uc5b4\ub5bb\uac8c \ub3d9\uc791\ud558\ub294\uc9c0\ub294 [\uacf5\uc2dd \ube14\ub85c\uadf8](https://tailscale.com/blog/how-tailscale-works/)\uc5d0\uc11c \uac04\ub2e8\ud788 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n\uac04\ub2e8\ud558\uac8c \ube14\ub85c\uadf8 \ub0b4\uc6a9\uc744 \uc815\ub9ac\ud574\ubcf4\uba74 \uae30\uc874\uc758 VPN \ubc29\uc2dd\uc740 Hub-and-spoke \ubc29\uc2dd\uc73c\ub85c \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 Gateway \ubc29\uc2dd\uc73c\ub85c \ubaa8\ub4e0 \ud074\ub77c\uc774\uc5b8\ud2b8\uc640 \uc11c\ubc84\ub97c \uc5f0\uacb0\ud558\ub294\uac8c \uae30\uc874\uc758 \ubc29\uc2dd\uc774\ub2e4. \uc0c8\ub85c\uc6b4 \ud074\ub77c\uc774\uc5b8\ud2b8\ub098 \uc11c\ubc84\uac00 \ucd94\uac00\ub420 \uacbd\uc6b0 \uc0c8\ub85c\uc6b4 \ud0a4\ub97c \ubaa8\ub4e0 \uc0ac\uc6a9\uc790\uc5d0\uac8c \ubc30\ud3ec\ud558\uac8c \ub418\uace0 \uc774\ub294 \uc7a5\ube44\uac00 \uc99d\uac00\ud568\uc5d0 \ub530\ub77c \ub9ce\uc740 \uc791\uc5c5\uc774 \ud544\uc694\ub85c \ud558\uac8c \ub41c\ub2e4.\\n\\n![hub](https://tailscale.com/blog/how-tailscale-works/hub-and-spoke-single.svg)\\n\\nWireguard \ud130\ub110\uc744 \uc774\uc6a9\ud558\uba74 \ub178\ub4dc\uac04\uc758 \uc5f0\uacb0\uc774 \uc9c1\uc811 \uc774\ub904\uc9c0\uac8c \ub418\uace0 \uc774\ub294 \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 \uba54\uc26c \ud615\ud0dc\ub85c \uad6c\uc131\ub418\uac8c \ub41c\ub2e4. \\n\\n![mesh](https://tailscale.com/blog/how-tailscale-works/mesh-network.svg)\\n\\n\uc774\ub7f0 \uba54\uc26c\ubc29\uc2dd\uc758 \uac00\uc7a5 \ud070 \ub2e8\uc810\uc740 \ud53c\uc5b4\ub07c\ub9ac \uc5f0\uacb0\ud558\ub294 \ub178\ub4dc \ub124\ud2b8\uc6cc\ud06c\uc758 \uacbd\uc6b0 \uc5f0\uacb0\ub418\ub294 \uacbd\uc6b0\uc758 \uc218\uac00 `n(n-1)`\uc73c\ub85c \uadf8\ub9bc\uc758 \uc608\uc2dc\uc5d0\uc11c\ub3c4 10*9 = 90\uac1c\uc758 \uc5f0\uacb0 \uad6c\uc131\uc774 \ud544\uc694\ud558\uac8c \ub41c\ub2e4. \ubaa8\ub4e0 \ub178\ub4dc\uac00 \ud574\ub2f9 \uc0ac\ud56d\uc73c\ub85c Wireguard\uc758 key\ub97c \ub85c\ud14c\uc774\ud2b8\ud558\uac70\ub098 \uc0ac\uc6a9\uc790\ub97c \ucd94\uac00, \uc81c\uac70\ud560\ub54c\ub9c8\ub2e4 \uac01 \ub178\ub4dc\uc5d0 \uc5c5\ub370\uc774\ud2b8\uac00 \ub418\uc5b4\uc57c \ud55c\ub2e4. \ub9cc\uc57d\uc5d0\ub77c\ub3c4 \uac01 \ub178\ub4dc\uc5d0 static ip\uac00 \uc5c6\uc744 \uacbd\uc6b0 \ub178\ub4dc\ub07c\ub9ac \ucc3e\ub294\uc77c\uc774 \uacb0\uace0 \uc27d\uc9c0\ub294 \uc54a\uc744 \uac83\uc774\ub2e4. \ud2b9\ud788 \ubc29\ud654\ubcbd\uc744 \uc6b4\uc601\ud558\ub294 \uc5d4\ud130\ud504\ub77c\uc774\uc988 \uc870\uc9c1\uc758 \uacbd\uc6b0\uc5d0 \ub354\uc6b1\ub354 \uae4c\ub2e4\ub85c\uc6b4 \uc77c\uc774 \ub41c\ub2e4\uace0 \ub9d0\ud55c\ub2e4.\\n\\n\uadf8\ub798\uc11c Tailscale\uc5d0\uc11c \uc774\uc57c\uae30\ud558\ub294 \uac00\uc7a5 \ud575\uc2ec\uc740 \ub178\ub4dc \uac04\uc758 \ud2b8\ub798\ud53d\uc744 \uac10\uc0ac, \ud1b5\uc81c\ud560 \uc218 \uc788\ub294 \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uc744 \ub450\ub294\uac83\uc774\ub2e4. \ubc29\ud654\ubcbd\uc774\ub098 static ip\uac00 \uc5c6\ub294 \ud658\uacbd\uc5d0\uc11c\ub3c4 \ub178\ub4dc, \ud53c\uc5b4\uac04\uc758 \ud1b5\uc81c\uac00 \uac00\ub2a5\ud55c \ud658\uacbd\uc744 \uc81c\uacf5\ud558\ub294 \uac83\uc774 \uae30\ubcf8 \uc0ac\uc0c1\uc774\ub2e4. \\n\\n![controlplane](https://tailscale.com/blog/how-tailscale-works/mesh-coordination-server.svg)\\n\\n### \uae30\ubcf8 \uc791\ub3d9\ubc29\uc2dd\\n\\n- \uac01 \ub178\ub4dc(\ud074\ub77c\uc774\uc5b8\ud2b8)\ub294 \ub79c\ub364 \uacf5\uac1c\ud0a4\uc640 \uac1c\uc778\ud0a4\ub97c \uc0dd\uc131\ud558\uace0 \uacf5\uac1c\ud0a4\ub97c ID(tailscale account)\uc640 \uc5f0\uacb0\ud55c\ub2e4.\\n- \ub178\ub4dc\ub294 \uc911\uc559\uc758 tailscale\uc11c\ubc84\uc5d0 \uacf5\uac1c\ud0a4\uc640 \ud574\ub2f9 \ub178\ub4dc\uac00 \ud604\uc7ac \uc5f0\uacb0\uac00\ub2a5\ud55c\uc9c0\uc640 \ub3c4\uba54\uc778 \uc815\ubcf4(client name) \uc815\ubcf4\ub97c \uc804\ub2ec\ud55c\ub2e4. \\n- \ub178\ub4dc\ub294 tailscale\uc11c\ubc84 \uc5c5\ub370\uc774\ud2b8\ub41c \ub3c4\uba54\uc778\uc758 \uacf5\uac1c\ud0a4 \ubc0f \uc8fc\uc18c \ubaa9\ub85d\uc744 \ub2e4\uc6b4\ub85c\ub4dc \ud55c\ub2e4.\\n- \ub178\ub4dc\ub294 \ub0b4\ub824\ubc1b\uc740 \uacf5\uac1c \ud0a4 \uc138\ud2b8\ub85c Wireguard \uc778\uc2a4\ud134\uc2a4\ub97c \uad6c\uc131\ud55c\ub2e4.\\n\\n\uc774\ub294 \ub2e4\uc2dc hub-and-spoke \ubaa8\ub378\ub85c \ub3cc\uc544\uac04\uac83 \uac19\uc9c0\ub9cc \uc2e4\uc81c \ucee8\ud2b8\ub864 \ud50c\ub808\uc778\uacfc \ub370\uc774\ud130 \ud50c\ub808\uc778\uc744 \ubd84\ub9ac\ud574\uc11c \ucc98\ub9ac\ud558\uae30 \ub54c\ubb38\uc5d0 \uc2e4\uc81c \uc911\uc559 \uc11c\ubc84\uac00 \uad00\ub9ac\ud558\ub294 \uac83\uc740 \uacf5\uac1c\ud0a4 \uc138\ud2b8\uc640 \uc5f0\uacb0\uac00\ub2a5\ud55c \ub178\ub4dc \ub9ac\uc2a4\ud2b8 \uc815\ubcf4\ubfd0\uc774\ub2e4.\\n\\n## Tailscale \ud14c\uc2a4\ud2b8\\n\\n### talescale \uc124\uce58 (macOS \uae30\uc900)\\n\\n- [https://tailscale.com/download](https://tailscale.com/download)\\n\\nmacOS\uc6a9 CLI \uc124\uce58 \uc815\ubcf4\ub294 \uc544\ub798 \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n- [https://tailscale.com/kb/1065/macos-variants/](https://tailscale.com/kb/1065/macos-variants/)\\n\\nmacOS\uc6a9 GUI \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0 CLI\ub3c4 \ub0b4\uc7a5\ub418\uc5b4 \uc788\uae30 \ub54c\ubb38\uc5d0 `.zshrc`\uc5d0 alias\ub97c \ucd94\uac00\ud588\ub2e4. \\n\\n```\\nalias tailscale=\\"/Applications/Tailscale.app/Contents/MacOS/Tailscale\\"\\n```\\n\\n2022\ub144 2\uc6d4 5\uc77c\uc790 \uae30\uc900\uc73c\ub85c 1.20.2 \ubc84\uc804\uc744 \uc0ac\uc6a9\ud55c\ub2e4. \\n\\n```\\n$ tailscale version\\n1.20.2\\n  tailscale commit: 312750ddd288cf4073cfaef56a45102b9c1e8421\\n  other commit: 2c164d9c7443e2f3014fa54ea45e946b35152680\\n  go version: go1.17.6-tse44d304e54\\n```\\n\\nwindows\uc5d0\uc11c\ub3c4 \uc27d\uac8c \uc124\uce58\uac00 \uac00\ub2a5\ud558\uace0, \ubb3c\ub860 \uc560\uc815\ud558\ub294 Synology\uc5d0\ub3c4 \ud328\ud0a4\uc9c0\ub97c \uc124\uce58\ud560 \uc218 \uc788\ub2e4. \\n\\n[https://github.com/tailscale/tailscale-synology](https://github.com/tailscale/tailscale-synology)\\n\\n\uc124\uce58\ub41c \ud074\ub77c\uc774\uc5b8\ud2b8 \ubaa8\ub450\ub97c tailscale \uacc4\uc815\uc73c\ub85c \ub85c\uadf8\uc778\ud558\uba74 VPN\uc5f0\uacb0\uc774 \ub05d\ub09c\ub2e4. \\n\\n\uc5f0\uacb0\ub41c \uba38\uc2e0\ub9ac\uc2a4\ud2b8\ub294 \uc544\ub798\uc640 \uac19\uc774 [Machines](https://login.tailscale.com/admin/machines) \uba54\ub274 \uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\uace0 \uac01 \ub178\ub4dc\ub098 \ud074\ub77c\uc774\uc5b8\ud2b8\ub85c \ud560\ub2f9\ub41c `100.*` \ub300\uc5ed IP\ub85c \uc811\uc18d\uc774 \uac00\ub2a5\ud558\ub2e4. \\n\\n![machine](/img/tailscale-web.png)\\n\\n\uc5ec\uae30\uc11c machine name\uc73c\ub85c \uc9c1\uc811 \uc811\uc18d\uc774 \uac00\ub2a5\ud558\uae30 \uc704\ud574\uc11c\ub294 MagicDNS \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud574\uc57c \ud558\ub294\ub370 `beta` \uae30\ub2a5\uc73c\ub85c [\ud65c\uc131\ud654](https://login.tailscale.com/admin/dns)\ub97c \ud560 \uc218 \uc788\uace0 \ub124\ud2b8\uc6cc\ud06c\uc5d0 \uc788\ub294 \uc7a5\uce58\uc758 DNS \uc774\ub984\uc744 \uc790\ub3d9\uc73c\ub85c \ub4f1\ub85d\ud558\ub294 \uae30\ub2a5\uc774\ub2e4.\\n\\n- DNS \uc124\uc815\uac00\uc774\ub4dc : [https://tailscale.com/kb/1081/magicdns/](https://tailscale.com/kb/1081/magicdns/)\\n\\nCLI\ub85c \ud604\uc7ac \uc5f0\uacb0\ub41c client \uc815\ubcf4\ub098 publickey \ub4f1\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```\\n$ tailscale status\\n100.89.226.113  88665a4a51c4         ddiiwoong@   macOS   -\\n100.76.233.116  jinwoonuimbp141      ddiiwoong@   macOS   offline\\n100.95.209.95   proxy                ddiiwoong@   linux   -\\n100.106.65.5    win11                ddiiwoong@   windows -\\n\\n$ tailscale status --json | jq \'.Self.PublicKey\'\\n\\"nodekey:97c4dc44ecdf56******************adb3246d87fd9e270\\"\\n```\\n\\nDNS \ub4f1\ub85d \ubc29\uc2dd\uc740 \uc544\ub798\uc640 \uac19\uc774 \uad6c\uc131\ub418\uace0\\n\\n![magicdns](https://tailscale.com/kb/1081/magicdns/magic-dns-naming.png)\\n\\n\ub0b4\uac00 \ub4f1\ub85d\ud55c \uba38\uc2e0\ub9ac\uc2a4\ud2b8\uc5d0\uc11c win11 \uc740 \ub2e4\uc74c \uc815\ubcf4\ub85c \ub3c4\uba54\uc778\uc774 \ub4f1\ub85d\ub41c\ub2e4.\\n\\n```\\nwin11.ddiiwoong.gmail.com.beta.tailscale.net\\n```\\n\\n\ub450\uac00\uc9c0 \ubc29\uc2dd\uc73c\ub85c \ud574\ub2f9 \uba38\uc2e0\uc5d0 ping check\ub97c \ud560 \uc218 \uc788\ub2e4.\\n\\n```sh\\n$ ping win11\\nPING win11.ddiiwoong.gmail.com.beta.tailscale.net (100.106.65.5): 56 data bytes\\n64 bytes from 100.106.65.5: icmp_seq=0 ttl=128 time=124.031 ms\\n64 bytes from 100.106.65.5: icmp_seq=1 ttl=128 time=2.180 ms\\n64 bytes from 100.106.65.5: icmp_seq=2 ttl=128 time=2.776 ms\\n\\n$ ping win11.ddiiwoong.gmail.com.beta.tailscale.net\\nPING win11.ddiiwoong.gmail.com.beta.tailscale.net (100.106.65.5): 56 data bytes\\n64 bytes from 100.106.65.5: icmp_seq=0 ttl=128 time=5.086 ms\\n64 bytes from 100.106.65.5: icmp_seq=1 ttl=128 time=2.060 ms\\n64 bytes from 100.106.65.5: icmp_seq=2 ttl=128 time=2.213 ms\\n```\\n\\n### kubernetes \ud658\uacbd\uad6c\uc131\\n\\nkubernetes \ub9ac\uc18c\uc2a4\ub85c tailscale\uc744 \uad6c\uc131\uc744 \ud574\ubcf4\uc790. \uba3c\uc800 `1.16` \ubc84\uc804 \uc774\uc0c1\uc758 kubernetes \ud074\ub7ec\uc2a4\ud130\ub97c \uc900\ube44\ud55c\ub2e4. \uc544\ub798 \uad6c\uc131\ud658\uacbd\uc740 `1.21.5` \ubc84\uc804\uc73c\ub85c eksctl\ub85c \uc124\uce58\ud55c \uae30\ubcf8 EKS \ud074\ub7ec\uc2a4\ud130\uc774\ub2e4. \\n\\n```sh\\n$ kubectl get node\\nNAME                                                 STATUS   ROLES    AGE   VERSION\\nip-192-168-101-195.ap-northeast-2.compute.internal   Ready    <none>   19h   v1.21.5-eks-9017834\\nip-192-168-134-35.ap-northeast-2.compute.internal    Ready    <none>   19h   v1.21.5-eks-9017834\\nip-192-168-186-235.ap-northeast-2.compute.internal   Ready    <none>   19h   v1.21.5-eks-9017834\\n```\\n\\n### authKey \ubc1c\uae09 \ubc0f Secret \ub4f1\ub85d\\n\\nauthKey\ub294 tailscale \ub124\ud2b8\uc6cc\ud06c\uc5d0 \ub4f1\ub85d\ud558\uae30 \uc704\ud55c Key\ub85c \uc544\ub798\uc640 \uac19\uc774 \uad00\ub9ac\ub97c Web\uc5d0\uc11c \ud560 \uc218 \uc788\ub2e4.\\n\\n![key](/img/tailscale-key.png)\\n\\n[Keys](https://login.tailscale.com/admin/settings/keys) \uba54\ub274\ub85c \uc774\ub3d9\ud574\uc11c auth Key\ub97c \ubc1c\uae09\ubc1b\ub294\ub2e4. \ubc1c\uae09\uc744 \ud560\ub54c \uc5ec\ub7ec\uba38\uc2e0\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uacbd\uc6b0\ub294 `Reusable`, \uc784\uc2dc\ub85c \ud0a4\ub97c \uc0ac\uc6a9\ud560\ub54c\ub294 `Ephemeral` \uc635\uc158\uc744 \uc0ac\uc6a9\ud560 \uc218\ub3c4 \uc788\ub2e4. \uc544\ub798\uc640 \uac19\uc740 \ud615\uc2dd\uc73c\ub85c \ubc1c\uae09\ub418\uace0, \ud574\ub2f9 key\ub294 kubernetes `Secret` \ub9ac\uc18c\uc2a4\uc5d0 \ub4f1\ub85d\uc744 \ud574\uc11c \uc0ac\uc6a9\ud560 \uac83\uc774\ub2e4.\\n\\n```\\ntskey-kZAinb5CNTRL-********************\\n```\\n\\n\ud574\ub2f9 auth Key\ub97c Secret\uc73c\ub85c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```yaml\\napiVersion: v1\\nkind: Secret\\nmetadata:\\n  name: tailscale-auth\\nstringData:\\n  AUTH_KEY: tskey-kZAinb5CNTRL-********************\\n```\\n```sh\\n$ kubectl get secret -n tailscale\\nNAME                    TYPE                                  DATA   AGE\\ndefault-token-fww2j     kubernetes.io/service-account-token   3      18h\\ntailscale-auth          Opaque                                3      18h\\ntailscale-token-7cgsc   kubernetes.io/service-account-token   3      17h\\n```\\n\\n### image build & push\\n\\ntailscale image\ub97c \ube4c\ub4dc\ud55c\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc544\ub798 \ub9c1\ud06c\ub97c \ucc38\uace0\ud55c\ub2e4.  \\n- [https://github.com/tailscale/tailscale/tree/main/docs/k8s](https://github.com/tailscale/tailscale/tree/main/docs/k8s)\\n\\nDockerfile\uc740 \ub2e4\uc74c\uacfc \uac19\uc774 \uacf5\uc2dd \uc774\ubbf8\uc9c0\ub97c \uc0ac\uc6a9\ud55c\ub2e4. \\n```dockerfile\\nFROM ghcr.io/tailscale/tailscale:latest\\nCOPY run.sh /run.sh\\nCMD \\"/run.sh\\"\\n```\\n\\n[run.sh](https://github.com/tailscale/tailscale/blob/main/docs/k8s/run.sh)\uc744 \uc0b4\ud3b4\ubcf4\uba74 `tailscaled` \ub370\ubaac\uc744 \uc2e4\ud589\ud560\ub54c \uba87\uac00\uc9c0 \ud658\uacbd\ubcc0\uc218\ub97c \uc785\ub825\ubc1b\uc544 \ucc98\ub9ac\ud558\ub294 \uac83\uc744 \uc54c \uc218 \uc788\ub2e4. \\n\\n`AUTH_KEY`\uc640 `KUBE_SECRET`\uc740 \uc704 Secret\uc73c\ub85c \ucc98\ub9ac\ub97c \ud558\uace0 \uc5ec\ub7ec \uc0ac\uc6a9 \ubaa8\ub4dc(router, userspace)\ub3c4 \ucee8\ud14c\uc774\ub108 \uc2e4\ud589\uc2dc \uc785\ub825\ubc1b\uc544 \ucc98\ub9ac\ud55c\ub2e4. \ub610\ud55c, \ub9c8\uc9c0\ub9c9 \uad6c\ubb38\uc744 \ubcf4\uba74 \ubaa9\uc801\uc9c0 IP DNAT \ucc98\ub9ac\ub97c \uc704\ud55c iptables \ub4f1\ub85d \uc635\uc158\ub3c4 \uc788\ub2e4.\\n\\n```sh\\n#! /bin/sh\\n\\nexport PATH=$PATH:/tailscale/bin\\n\\nAUTH_KEY=\\"${AUTH_KEY:-}\\"\\nROUTES=\\"${ROUTES:-}\\"\\nDEST_IP=\\"${DEST_IP:-}\\"\\nEXTRA_ARGS=\\"${EXTRA_ARGS:-}\\"\\nUSERSPACE=\\"${USERSPACE:-true}\\"\\nKUBE_SECRET=\\"${KUBE_SECRET:-tailscale}\\"\\n\\nset -e\\n\\nTAILSCALED_ARGS=\\"--state=kube:${KUBE_SECRET} --socket=/tmp/tailscaled.sock\\"\\n\\nif [[ \\"${USERSPACE}\\" == \\"true\\" ]]; then\\n  if [[ ! -z \\"${DEST_IP}\\" ]]; then\\n    echo \\"IP forwarding is not supported in userspace mode\\"\\n    exit 1\\n  fi\\n  TAILSCALED_ARGS=\\"${TAILSCALED_ARGS} --tun=userspace-networking\\"\\nelse\\n  if [[ ! -d /dev/net ]]; then\\n    mkdir -p /dev/net\\n  fi\\n\\n  if [[ ! -c /dev/net/tun ]]; then\\n    mknod /dev/net/tun c 10 200\\n  fi\\nfi\\n\\necho \\"Starting tailscaled\\"\\ntailscaled ${TAILSCALED_ARGS} &\\nPID=$!\\n\\nUP_ARGS=\\"--accept-dns=false\\"\\nif [[ ! -z \\"${ROUTES}\\" ]]; then\\n  UP_ARGS=\\"--advertise-routes=${ROUTES} ${UP_ARGS}\\"\\nfi\\nif [[ ! -z \\"${AUTH_KEY}\\" ]]; then\\n  UP_ARGS=\\"--authkey=${AUTH_KEY} ${UP_ARGS}\\"\\nfi\\nif [[ ! -z \\"${EXTRA_ARGS}\\" ]]; then\\n  UP_ARGS=\\"${UP_ARGS} ${EXTRA_ARGS:-}\\"\\nfi\\n\\necho \\"Running tailscale up\\"\\ntailscale --socket=/tmp/tailscaled.sock up ${UP_ARGS}\\n\\nif [[ ! -z \\"${DEST_IP}\\" ]]; then\\n  echo \\"Adding iptables rule for DNAT\\"\\n  iptables -t nat -I PREROUTING -d \\"$(tailscale --socket=/tmp/tailscaled.sock ip -4)\\" -j DNAT --to-destination \\"${DEST_IP}\\"\\nfi\\n\\nwait ${PID}\\n```\\n\\nbuild\ud558\uace0 \ub808\uc9c0\uc2a4\ud2b8\ub9ac\ub85c push \ud558\uc790.\\n```sh\\n$ export IMAGE_TAG=ddiiwoong/tailscale-k8s:latest\\n$ docker build . -t $(IMAGE_TAG)\\n$ docker push $(IMAGE_TAG)\\n$ docker images ddiiwoong/tailscale-k8s:latest\\nREPOSITORY            TAG       IMAGE ID       CREATED        SIZE\\nddiiwoong/tailscale-k8s   latest    9dc489da64c4   18 hours ago   44.1MB\\n```\\n\\n### RBAC \ub9ac\uc18c\uc2a4 \uc0dd\uc131\\n\\nrbac \uc124\uc815\uc744 \uc704\ud574\uc11c `role`, `rolebinding`, `serviceaccount`\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```sh\\nexport SA_NAME=tailscale\\nexport KUBE_SECRET=tailscale-auth\\n```\\n\\n\uc704 ENV\uac12\uc744 \uce58\ud658\ud574\uc11c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```yaml\\n---\\napiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  name: tailscale\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: Role\\nmetadata:\\n  name: tailscale\\nrules:\\n- apiGroups: [\\"\\"] # \\"\\" indicates the core API group\\n  resources: [\\"secrets\\"]\\n  # Create can not be restricted to a resource name.\\n  verbs: [\\"create\\"]\\n- apiGroups: [\\"\\"] # \\"\\" indicates the core API group\\n  resourceNames: [\\"tailscale-auth\\"]\\n  resources: [\\"secrets\\"]\\n  verbs: [\\"get\\", \\"update\\"]\\n---\\napiVersion: rbac.authorization.k8s.io/v1\\nkind: RoleBinding\\nmetadata:\\n  name: tailscale\\nsubjects:\\n- kind: ServiceAccount\\n  name: tailscale\\nroleRef:\\n  kind: Role\\n  name: tailscale\\n  apiGroup: rbac.authorization.k8s.io\\n```\\n\\n### sidecar \ubc30\ud3ec\\n\\nsidecar \uc0dd\uc131\uc744 \uc704\ud574 manifest\ub97c \ud655\uc778\ud55c\ub2e4. \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf4\uba74 `ts-sidecar` \ucee8\ud14c\uc774\ub108 securityContext\uc5d0 `NET_ADMIN` \uad8c\ud55c\uc774 \ucd94\uac00\ub41c\uac83\uc744 \ubcfc\uc218 \uc788\ub2e4. \uc774\ub294 sidecar \ud30c\ub4dc\uac00 \ud130\ub110 \uc778\ud130\ud398\uc774\uc2a4\ub97c \uad6c\uc131\ud558\uae30 \uc704\ud574 \uc0c1\uc704 \ub178\ub4dc `CAP_NET_ADMIN` \uad8c\ud55c\uc744 \ucde8\ub4dd\ud558\uae30 \uc704\ud568\uc774\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 [Set capabilities for a Container](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-capabilities-for-a-container) \ubb38\uc11c\ub97c \ud655\uc778\ud558\uc790. \\n\\n\uadf8\ub9ac\uace0 \ucd94\uac00 sidecar\ub85c `nicolaka/netshoot`\ub97c \ucd94\uac00\ud588\ub294\ub370 \uc774\ub294 [\ub124\ud2b8\uc6cc\ud06c \uc7a5\uc560 \ucc98\ub9ac\uc5d0 \uc720\uc6a9\ud55c \ud504\ub85c\uc81d\ud2b8](https://github.com/nicolaka/netshoot)\ub85c \uc5ec\ub7ec\uac00\uc9c0 \ub124\ud2b8\uc6cc\ud06c \uc815\ubcf4\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```yaml\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n  name: nginx\\nspec:\\n  serviceAccountName: tailscale\\n  containers:\\n  - name: nginx\\n    image: nginx\\n  - name: netshoot\\n    image: nicolaka/netshoot \\n    command: [\\"tail\\"]\\n    args: [\\"-f\\", \\"/dev/null\\"]\\n  - name: ts-sidecar\\n    imagePullPolicy: Always\\n    image: ddiiwoong/tailscale-k8s:latest\\n    env:\\n      # Store the state in a k8s secret\\n    - name: KUBE_SECRET\\n      value: tailscale-auth\\n    - name: USERSPACE\\n      value: \\"false\\"\\n    - name: AUTH_KEY\\n      valueFrom:\\n        secretKeyRef:\\n          name: tailscale-auth\\n          key: AUTH_KEY\\n          optional: true\\n    securityContext:\\n      capabilities:\\n        add:\\n        - NET_ADMIN\\n```\\n\\n\uc0dd\uc131\uc744 \ud558\uace0 \uc0b4\ud3b4\ubcf4\uba74 sidecar nginx \ud30c\ub4dc\uac00 \uc0dd\uc131\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```sh\\n$ kubectl get pod nginx -n tailscale\\nNAME    READY   STATUS    RESTARTS   AGE\\nnginx   3/3     Running   0          25s\\n```\\n\\ntailscale sidecar \ub85c\uadf8\ub97c \uc7a0\uae50 \uc0b4\ud3b4\ubcf4\uc790. \uc0c8\ub85c\uc6b4 `tailscale0` tun \uc778\ud130\ud398\uc774\uc2a4\uac00 \ucd94\uac00\ub418\uace0 \uc6d0\ub798 pod eth0 \uc778\ud130\ud398\uc774\uc2a4 ip\ub3c4 \ud655\uc778\uc774 \ub41c\ub2e4. \ub610\ud55c `wireguard` device\ub3c4 \uc62c\ub77c\uc624\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```sh\\n$ kubectl logs nginx ts-sidecar -n tailscale\\nStarting tailscaled\\nRunning tailscale up\\n2022/02/05 12:20:26 logtail started\\n2022/02/05 12:20:26 Program starting: v1.20.2-t8e643357d, Go 1.17.6-tse44d304e54: []string{\\"tailscaled\\", \\"--state=kube:tailscale-auth\\", \\"--socket=/tmp/tailscaled.sock\\"}\\n2022/02/05 12:20:26 LogID: 31416c9a454e3667661bf0f21ccde8ebf72604d7434660b0db55e838be372bc4\\n2022/02/05 12:20:26 logpolicy: using system state directory \\"/var/lib/tailscale\\"\\nlogpolicy.Read /var/lib/tailscale/tailscaled.log.conf: open /var/lib/tailscale/tailscaled.log.conf: no such file or directory\\n2022/02/05 12:20:26 wgengine.NewUserspaceEngine(tun \\"tailscale0\\") ...\\n2022/02/05 12:20:26 router: disabling tunneled IPv6 due to system IPv6 config: disable_ipv6 is set\\n2022/02/05 12:20:26 dns: [rc=unknown ret=direct]\\n2022/02/05 12:20:26 dns: using *dns.directManager\\n2022/02/05 12:20:26 link state: interfaces.State{defaultRoute=eth0 ifs={eth0:[192.168.118.89/32]} v4=true v6=false}\\n2022/02/05 12:20:26 magicsock: disco key = d:1b04c57ebf000fe0\\n2022/02/05 12:20:26 Creating wireguard device...\\n2022/02/05 12:20:26 Bringing wireguard device up...\\n2022/02/05 12:20:26 Bringing router up...\\n2022/02/05 12:20:26 external route: up\\n2022/02/05 12:20:26 Clearing router settings...\\n2022/02/05 12:20:26 Starting link monitor...\\n2022/02/05 12:20:26 Engine created.\\n2022/02/05 12:20:26 netmap packet filter: (not ready yet)\\n2022/02/05 12:20:26 Start\\n2022/02/05 12:20:26 using backend prefs\\n...\\n2022/02/05 12:20:28 active login: ddiiwoong@gmail.com\\n2022/02/05 12:20:28 netmap packet filter: 1 filters\\n...\\n2022/02/05 12:20:28 dns: Set: {DefaultResolvers:[] Routes:{} SearchDomains:[] Hosts:4}\\n2022/02/05 12:20:28 dns: Resolvercfg: {Routes:{} Hosts:4 LocalDomains:[]}\\n2022/02/05 12:20:28 dns: OScfg: {Nameservers:[] SearchDomains:[] MatchDomains:[]}\\n2022/02/05 12:20:28 Taildrop disabled; no state directory\\n2022/02/05 12:20:28 peerapi starting without Taildrop directory configured\\n2022/02/05 12:20:28 peerapi: serving on http://100.95.209.95:34980\\n...\\n```\\n\\nnetshoot \ud30c\ub4dc\ub0b4\uc5d0\uc11c\ub3c4 `tailscale0` \uc778\ud130\ud398\uc774\uc2a4\uac00 \ucd94\uac00\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n```sh\\n$ kubectl exec -it nginx -c netshoot -- ip -c addr\\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\\n    inet 127.0.0.1/8 scope host lo\\n       valid_lft forever preferred_lft forever\\n3: eth0@if8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default\\n    link/ether 6e:f8:f5:f3:47:11 brd ff:ff:ff:ff:ff:ff link-netnsid 0\\n    inet 192.168.118.89/32 scope global eth0\\n       valid_lft forever preferred_lft forever\\n4: tailscale0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1280 qdisc pfifo_fast state UNKNOWN group default qlen 500\\n    link/none\\n    inet 100.95.209.95/32 scope global tailscale0\\n       valid_lft forever preferred_lft forever\\n```\\n\\n\ub85c\uceec\uc5d0\uc11c `tailscale` CLI\ub97c \ud1b5\ud574 IP\uc815\ubcf4\ub3c4 \ub3d9\uc77c\ud55c \uac83\uc744 \ud655\uc778 \ud560 \uc218 \uc788\ub2e4.\\n\\n```sh\\n$ tailscale status\\n100.89.226.113  88665a4a51c4         ddiiwoong@   macOS   -\\n100.76.233.116  jinwoonuimbp141      ddiiwoong@   macOS   offline\\n100.95.209.95   nginx                ddiiwoong@   linux   -\\n100.106.65.5    win11                ddiiwoong@   windows -\\n```\\n\\n\uba3c\uc800 \uc5b4\ub5a0\ud55c kubernetes \uc11c\ube44\uc2a4\ub3c4 \uc5c6\ub294 \uac83\uc744 \ud655\uc778\ud558\uace0, \ubbf8\ub9ac magicdns\ub97c \uad6c\uc131\ud574\ub1a8\uae30 \ub54c\ubb38\uc5d0 `nginx` \uc8fc\uc18c\ub85c \uc9c1\uc811 \ud1b5\uc2e0\uc744 \uc2dc\ub3c4\ud574\ubcf4\uc790. \\n\\n```\\n$ kubectl get svc -n A\\nNo resources found in A namespace.\\n\\n$ ping nginx\\nPING nginx.ddiiwoong.gmail.com.beta.tailscale.net (100.95.209.95): 56 data bytes\\n64 bytes from 100.95.209.95: icmp_seq=0 ttl=255 time=193.606 ms\\n64 bytes from 100.95.209.95: icmp_seq=1 ttl=255 time=95.747 ms\\n64 bytes from 100.95.209.95: icmp_seq=2 ttl=255 time=94.441 ms\\n\\n$ curl http://nginx\\n<!DOCTYPE html>\\n<html>\\n<head>\\n<title>Welcome to nginx!</title>\\n...\\n```\\n\\n### Userspace Sidecar \ud14c\uc2a4\ud2b8\\n\\nuserspace \ubaa8\ub4dc\ub85c \uc2e4\ud589\ud574\ubcf4\uc790. \uc704\uc640 \ucc28\uc774\uc810\uc740 `NET_ADMIN` \uad8c\ud55c\uc744 \ube7c\uace0, `runAsUser: 1000`\uc640 `runAsGroup: 1000`\uc744 \ucd94\uac00\ud588\ub2e4. \ud574\ub2f9 \ud074\ub77c\uc774\uc5b8\ud2b8\ub098 \ub178\ub4dc\uac00 \uc678\ubd80\ub85c \ud1b5\uc2e0\uc744 \uc704\ud574\uc11c\ub294 [SOCKS5 \uc774\ub098 HTTP proxy \ubaa8\ub4dc](https://tailscale.com/kb/1112/userspace-networking/)\ub85c \uc2e4\ud589\ub418\uc5b4\uc57c \ud55c\ub2e4. \uc774\ubc88 \ub370\ubaa8\uc5d0\uc11c\ub294 \uad6c\uc131\ud558\uc9c0 \uc54a\ub294\ub2e4.\\n\\nuserspace \ubaa8\ub4dc\ub294 \uc8fc\ub85c \uc11c\ubc84\ub9ac\uc2a4 \uc6cc\ud06c\ub85c\ub4dc(Heroku, Google Cloud Run, AWS Lambda, Github Action)\uc5d0\uc11c \ud65c\uc6a9\uc744 \ud560 \ub54c \uc88b\ub2e4. \ub2e8 \ubcf4\uc548\uc744 \uc704\ud574 authKey\ub97c `ephemeral` \ud615\ud0dc\ub85c \uad6c\uc131\ud558\ub294\uac8c \uc88b\ub2e4.\\n\\n```\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n  name: nginx\\nspec:\\n  serviceAccountName: tailscale\\n  containers:\\n  - name: nginx\\n    image: nginx\\n  - name: netshoot\\n    image: nicolaka/netshoot \\n    command: [\\"tail\\"]\\n    args: [\\"-f\\", \\"/dev/null\\"]\\n  - name: ts-sidecar\\n    imagePullPolicy: Always\\n    image: ddiiwoong/tailscale-k8s:latest\\n    securityContext:\\n      runAsUser: 1000\\n      runAsGroup: 1000\\n    env:\\n    - name: KUBE_SECRET\\n      value: tailscale-auth\\n    - name: USERSPACE\\n      value: \\"true\\"\\n    - name: AUTH_KEY\\n      valueFrom:\\n        secretKeyRef:\\n          name: tailscale-auth\\n          key: AUTH_KEY\\n          optional: true\\n```\\n\\n\ub3d9\uc77c\ud558\uac8c \uc811\uc18d\uc774 \uac00\ub2a5\ud55c\ub370, userspace \ubaa8\ub4dc \uc774\uae30 \ub54c\ubb38\uc5d0 netshoot \ucee8\ud14c\uc774\ub108\ub85c \uc778\ud130\ud398\uc774\uc2a4\ub97c \ud655\uc778\ud558\uba74 \uad8c\ud55c\uc774 \uc5c6\uae30 \ub54c\ubb38\uc5d0 eth0 \ub9cc \ud655\uc778 \uac00\ub2a5\ud558\ub2e4. \\n\\n```sh\\n$ kubectl exec -it nginx -c netshoot -- ip -c addr\\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\\n    inet 127.0.0.1/8 scope host lo\\n       valid_lft forever preferred_lft forever\\n3: eth0@if10: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default\\n    link/ether 3a:c5:b6:cf:d1:bd brd ff:ff:ff:ff:ff:ff link-netnsid 0\\n    inet 192.168.117.251/32 scope global eth0\\n       valid_lft forever preferred_lft forever\\n```\\n\\n### Proxy \ubaa8\ub4dc \ud14c\uc2a4\ud2b8\\n\\n\uae30\uc874\uc758 \ubc30\ud3ec\ub41c Service \ub9ac\uc18c\uc2a4\uc5d0 \uc5f0\uacb0\ud558\ub294 \ubc29\uc2dd\uc774\ub2e4. \ubbf8\ub9ac nginx\ub97c \ub744\uc6cc \ub193\uace0 ClusterIP\ub97c \ud655\uc778\ud55c\ub2e4.\\n\\n```\\n$ kubectl create deployment nginx --image nginx\\n$ kubectl expose deployment nginx --port 80\\n$ kubectl get svc nginx -o=jsonpath=\'{.spec.clusterIP}\'\\ndeployment.apps/nginx created\\nservice/nginx exposed\\n10.100.213.92%\\n```\\n\\nProxy \ud30c\ub4dc\ub97c \ubc30\ud3ec\ud55c\ub2e4. \ucc38\uace0\ud560 \uc0ac\ud56d\uc740 `sysctler` \ucee8\ud14c\uc774\ub108\uc778\ub370, \uae30\ubcf8\uc801\uc73c\ub85c `net.ipv4.ip_forward` \ud50c\ub798\uadf8\ub294 `Kubelet`\uc5d0\uc11c \ud654\uc774\ud2b8\ub9ac\uc2a4\ud2b8 \ucc98\ub9ac\uac00 \ub418\uc5b4 \uc788\uc9c0 \uc54a\uc73c\ubbc0\ub85c \ub0b4\ubd80\uc5d0\uc11c IP Forwarding\uc744 \uc704\ud574\uc11c \ucd94\uac00 \uc124\uc815\uc774 \ud544\uc694\ud558\ub2e4. \\n\\n```\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n  name: proxy\\nspec:\\n  serviceAccountName: tailscale\\n  initContainers:\\n  - name: sysctler\\n    image: busybox\\n    securityContext:\\n      privileged: true\\n    command: [\\"/bin/sh\\"]\\n    args:\\n      - -c\\n      - sysctl -w net.ipv4.ip_forward=1\\n    resources:\\n      requests:\\n        cpu: 1m\\n        memory: 1Mi\\n  containers:\\n  - name: tailscale\\n    imagePullPolicy: Always\\n    image: ddiiwoong/tailscale-k8s:latest\\n    env:\\n    - name: KUBE_SECRET\\n      value: tailscale-auth\\n    - name: USERSPACE\\n      value: \\"false\\"\\n    - name: AUTH_KEY\\n      valueFrom:\\n        secretKeyRef:\\n          name: tailscale-auth\\n          key: AUTH_KEY\\n          optional: true\\n    - name: DEST_IP\\n      value: 10.100.213.92\\n    securityContext:\\n      capabilities:\\n        add:\\n        - NET_ADMIN\\n```\\n\\n```\\nkubectl get pod -n tailscale\\nNAME                     READY   STATUS    RESTARTS   AGE\\nnginx-6799fc88d8-5g49v   1/1     Running   0          5m59s\\nproxy                    1/1     Running   0          22s\\n```\\n\\n\uc815\uc0c1\uc801\uc73c\ub85c \ubc30\ud3ec\ub41c proxy \ucee8\ud14c\uc774\ub108\ub85c \uc811\uc18d\ud574\ubcf4\uba74 \ub3d9\uc77c\ud558\uac8c \uc811\uadfc\uc774 \ub418\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n\\n```sh\\n$ tailscale status\\n100.89.226.113  88665a4a51c4         ddiiwoong@   macOS   -\\n100.76.233.116  jinwoonuimbp141      ddiiwoong@   macOS   offline\\n100.95.209.95   proxy                ddiiwoong@   linux   idle, tx 788 rx 1452\\n100.106.65.5    win11                ddiiwoong@   windows -\\n\\n$ curl https://proxy\\n<!DOCTYPE html>\\n<html>\\n<head>\\n<title>Welcome to nginx!</title>\\n...\\n```\\n\\n### Subnet Router \ubaa8\ub4dc \ud14c\uc2a4\ud2b8\\n\\nTailscale\uc5d0\uc11c Subnet Router \ubaa8\ub4dc\ub97c \uc0ac\uc6a9\ud558\uba74 \uc804\uccb4 \ud074\ub7ec\uc2a4\ud130\uc758 subnet \ub300\uc5ed\uc73c\ub85c \uc811\uadfc\uc774 \uac00\ub2a5\ud558\ub2e4. \\n\\n\uae30\ubcf8\uc801\uc73c\ub85c EKS API\ub294 \uc11c\ube44\uc2a4 subnet\uc73c\ub85c `10.100.0.0/16` \ub610\ub294 `172.20.0.0/16` \uc744 \uc0ac\uc6a9\ud55c\ub2e4. \ubc30\ud3ec\ud55c eksctl\ub85c \uad6c\uc131\ud55c EKS \ud074\ub7ec\uc2a4\ud130 subnet\uc740 3\uac1c AZ\uc5d0 19bit\ub85c \ub098\ub258\uc5b4 \ubc30\ud3ec\ub418\uc5c8\uace0 `192.168.96.0/19`, `192.168.128.0/19`, `192.168.160.0/19`\uc73c\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\ub2e4. \\n\\n```\\n$ kubectl get node -o wide\\nNAME                                                 STATUS   ROLES    AGE   VERSION               INTERNAL-IP       EXTERNAL-IP   OS-IMAGE         KERNEL-VERSION                CONTAINER-RUNTIME\\nip-192-168-101-195.ap-northeast-2.compute.internal   Ready    <none>   23h   v1.21.5-eks-9017834   192.168.101.195   <none>        Amazon Linux 2   5.4.172-90.336.amzn2.x86_64   docker://20.10.7\\nip-192-168-134-35.ap-northeast-2.compute.internal    Ready    <none>   23h   v1.21.5-eks-9017834   192.168.134.35    <none>        Amazon Linux 2   5.4.172-90.336.amzn2.x86_64   docker://20.10.7\\nip-192-168-186-235.ap-northeast-2.compute.internal   Ready    <none>   23h   v1.21.5-eks-9017834   192.168.186.235   <none>        Amazon Linux 2   5.4.172-90.336.amzn2.x86_64   docker://20.10.7\\n\\n$ kubectl get pod -o wide\\nNAME                     READY   STATUS    RESTARTS   AGE     IP                NODE                                                 NOMINATED NODE   READINESS GATES\\nnginx-6799fc88d8-5g49v   1/1     Running   0          11m     192.168.112.183   ip-192-168-101-195.ap-northeast-2.compute.internal   <none>           <none>\\nproxy                    1/1     Running   0          5m39s   192.168.155.196   ip-192-168-134-35.ap-northeast-2.compute.internal    <none>           <none>\\n\\n$ kubectl get svc -o wide\\nNAME    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE   SELECTOR\\nnginx   ClusterIP   10.100.213.92   <none>        80/TCP    11m   app=nginx\\n```\\n\\n\ud574\ub2f9 subnet \ub300\uc5ed\uc744 \uc811\uc18d\ud558\uae30 \uc704\ud574\uc11c \uc11c\ube44\uc2a4 \ub300\uc5ed\uc778 `10.100.0.0/16`\uc640 \ud30c\ub4dc \ub300\uc5ed\uc778 `192.168.96.0/19`, `192.168.128.0/19`, `192.168.160.0/19`\ub97c \uc124\uc815\ud574\uc11c router \ubaa8\ub4dc\ub85c tailscale\uc744 \uc2e4\ud589\ud558\uc790.\\n\\n```yaml\\napiVersion: v1\\nkind: Pod\\nmetadata:\\n  name: subnet-router\\n  labels:\\n    app: tailscale\\nspec:\\n  serviceAccountName: tailscale\\n  containers:\\n  - name: tailscale\\n    imagePullPolicy: Always\\n    image: ddiiwoong/tailscale-k8s:latest\\n    env:\\n    - name: KUBE_SECRET\\n      value: tailscale-auth\\n    - name: USERSPACE\\n      value: \\"true\\"\\n    - name: AUTH_KEY\\n      valueFrom:\\n        secretKeyRef:\\n          name: tailscale-auth\\n          key: AUTH_KEY\\n          optional: true\\n    - name: ROUTES\\n      value: 10.100.0.0/16,192.168.96.0/19,192.168.128.0/19,192.168.160.0/19\\n    securityContext:\\n      runAsUser: 1000\\n      runAsGroup: 1000\\n```\\n\\n\ubc30\ud3ec\ub41c router \ub514\ubc14\uc774\uc2a4\uc640, \ub0b4\ubd80\uc758 \uc11c\ube44\uc2a4\uc5d0 \uc811\uadfc\ud558\uae30 \uc704\ud574 \ud30c\ub4dc\uc640 \uc11c\ube44\uc2a4 IP\ub97c \ud655\uc778\ud55c\ub2e4.\\n\\n```sh\\n$ tailscale status\\n100.89.226.113  88665a4a51c4         ddiiwoong@   macOS   -\\n100.76.233.116  jinwoonuimbp141      ddiiwoong@   macOS   offline\\n100.95.209.95   subnet-router        ddiiwoong@   linux   idle, tx 1556 rx 2908\\n100.106.65.5    win11                ddiiwoong@   windows -\\n\\n$ kubectl get pod -n tailscale\\nNAME                     READY   STATUS    RESTARTS   AGE\\nnginx-6799fc88d8-5g49v   1/1     Running   0          39m\\nsubnet-router            1/1     Running   0          9m47s\\n\\n$ kubectl get pod -n tailscale -o wide\\nNAME                     READY   STATUS    RESTARTS   AGE   IP                NODE                                                 NOMINATED NODE   READINESS GATES\\nnginx-6799fc88d8-5g49v   1/1     Running   0          39m   192.168.112.183   ip-192-168-101-195.ap-northeast-2.compute.internal   <none>           <none>\\nsubnet-router            1/1     Running   0          10m   192.168.137.188   ip-192-168-134-35.ap-northeast-2.compute.internal    <none>           <none>\\n\\n$ kubectl get svc -n tailscale\\nNAME    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\\nnginx   ClusterIP   10.100.213.92   <none>        80/TCP    40m\\n```\\n\\n\ubc14\ub85c \uc811\uc18d\uc744 \ud574\ubcf4\uba74 \uc811\uc18d\uc774 \uc548\ub41c\ub2e4\ub294\uac78 \uc54c\uc218 \uc788\ub2e4. [tailscale \uc11c\ube44\uc2a4](https://login.tailscale.com/admin/machines)\ub85c \uc774\ub3d9\ud574 route \uc124\uc815\uc5d0\uc11c \uc811\uadfc\ud560 \ub300\uc5ed\uc744 \uc544\ub798\uc640 \uac19\uc774 \ud65c\uc131\ud654\ud558\uace0 curl\ub85c \uc811\uc18d\ud574\ubcf4\uba74 \uc815\uc0c1\uc801\uc73c\ub85c \uc811\uadfc\uc774 \ub41c\ub2e4\ub294\uac78 \uc54c\uc218 \uc788\ub2e4. \uc774\uac78\ub85c \uc0dd\uac01\ud574\ubd24\uc744 \ub54c `NetworkPolicy` \ub4f1\uacfc \ud568\uaed8 \uc124\uc815\uc744 \ud558\uba74 \ub0b4\ubd80 \ub9ac\uc18c\uc2a4 \uc811\uadfc \ud1b5\uc81c\ub3c4 \uac00\ub2a5\ud560 \uac83\uc73c\ub85c \uc0dd\uac01\ub41c\ub2e4. \\n\\n![router](/img/subnetmode.png)\\n\\n```\\n$ curl 192.168.112.183\\n<!DOCTYPE html>\\n<html>\\n<head>\\n<title>Welcome to nginx!</title>\\n...\\n\\n$ curl 10.100.213.92\\n<!DOCTYPE html>\\n<html>\\n<head>\\n<title>Welcome to nginx!</title>\\n...\\n```\\n\\n## \ud65c\uc6a9\ubc29\uc548\\n\\n\uae30\uc874\uc5d0\ub294 \uc9d1 \ub0b4\ubd80\uc5d0 \uc788\ub294 \uc790\uc6d0 NAS\ub098 macOS \ub4f1\uc744 \uc6d0\uaca9\uc73c\ub85c \uad00\ub9ac\ud558\uae30 \uc704\ud55c \uc6a9\ub3c4\uc600\ub2e4\uba74, \uc774\ubc88 \ud14c\uc2a4\ud2b8\ub97c \ud1b5\ud574 \uae30\ubcf8 Personal \ubb34\ub8cc Plan\uc73c\ub85c\ub3c4 \ud65c\uc6a9\uac00\ub2a5\ud55c \uba87\uac00\uc9c0 \uc720\uc2a4\ucf00\uc774\uc2a4\ub97c \uc0dd\uac01\ud574\ubd24\ub2e4.  \\n\\n- \ucd94\uac00\uc801\uc778 VPN \uad6c\uc131\uc5c6\uc774 \uc6d0\uaca9\uc9c0 \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc874\uc7ac\ud558\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub514\ubc84\uae45 \ubc0f \uad00\ub9ac \uac00\ub2a5 (Telepresence \ub300\uccb4)\\n- sidecar \ubaa8\ub4dc\ub85c \ud65c\uc6a9\uc2dc Private \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud55c \uc11c\ube44\uc2a4 \uad6c\uc131 \ubc0f IP\uad00\ub9ac \ubd88\ud544\uc694 \\n- Prometheus Service Discovry\ub97c tailscale\ub85c \uc9c4\ud589\ud558\uc5ec \uac1c\uc778 \uad00\ub9ac \ub514\ubc14\uc774\uc2a4 \uc804\uccb4 \ubaa8\ub2c8\ud130\ub9c1\\n- \ubaa8\ubc14\uc77c \uc6f9\uc571 \ud14c\uc2a4\ud2b8\uc2dc \ubcf8\uc778 \ud734\ub300\ud3f0\uc73c\ub85c \uc9c1\uc811 \uc561\uc138\uc2a4 \uac00\ub2a5\\n- \ud604\uc7ac \uac1c\uc778 \ud504\ub85c\uc81d\ud2b8\ub85c \ud65c\uc6a9\uc911\uc778 Plex(\ubbf8\ub514\uc5b4\uc11c\ubc84), \ub178\ud2b8 \uc571 \ub4f1\uc744 \uc11c\ube44\uc2a4 \uad6c\uc131\uc5c6\uc774 ACL \ubc0f MFA \uc801\uc6a9\uc744 \ud1b5\ud55c \ubcf4\uc548 \uac15\ud654\\n- wireguard \ud504\ub85c\ud1a0\ucf5c\uc744 \ud65c\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \uc5b4\ub514\uc11c\ub4e0 \ub04a\uae40\uc5c6\uc774 \ud074\ub7ec\uc2a4\ud130 \ub9ac\uc18c\uc2a4 \uc811\uadfc\\n- \ud604\uc7ac \uad6c\uc131\uc911\uc778 site-to-site vpn \ub300\uccb4 (OCI-OCI\uac04)\\n\\n\ub354 \ub9ce\uc740 \ud65c\uc6a9\ubc29\uc548\uc774 \uc788\uc744\ud150\ub370 \uc77c\ub2e8 \uc0dd\uac01\ub098\ub294 \uac83\ub4e4\ub9cc \uc801\uc5b4\ubcf4\uc558\ub2e4.\\n\\n## \uc815\ub9ac\\n\\n\uc774\ubc88 \ud3ec\uc2a4\ud305\uc740 \ub124\ud2b8\uc6cc\ud06c \uc2a4\ud130\ub514\ub97c \uc9c4\ud589\ud558\uba74\uc11c \uacfc\uc81c\ub85c \uc791\uc131\ub41c \ubd80\ubd84\uc774 \uc5c6\uc9c0 \uc54a\ub2e4. \uc815\ub9d0 \uc774\ubc88 \uc2a4\ud130\ub514\ub294 \uc5ed\ub300\uae09\uc73c\ub85c \ud004\ub9ac\ud2f0\ub098 \uc5ec\ub7ec\uac00\uc9c0\uba74\uc5d0\uc11c \uc88b\uc740 \uc810\uc774 \ub9ce\ub2e4. \ud56d\uc0c1 \ub300\ub2e8\ud558\ub2e4\uace0 \ub290\ub07c\ub294 \ubd84\ub4e4\uacfc \ud568\uaed8\ud558\uace0 \uc788\uc5b4\uc11c \ub9c8\uc9c0\ub9c9\uae4c\uc9c0 \uc644\uc8fc\ud560 \uc218 \uc788\ub3c4\ub85d \uc870\uae08 \ub354 \uacf5\ubd80\ud574\uc57c \uaca0\ub2e4\ub294 \uc0dd\uac01\uc774 \ub4e0\ub2e4. \ub2e4\uc2dc\ud55c\ubc88 [\uac00\uc2dc\ub2e4](https://www.facebook.com/jongho.seo.5811)\ub2d8\uc744 `shout-out` \ud558\uace0 2022\ub144 \uccab \ud3ec\uc2a4\ud305\uc740 \uc774\uac83\uc73c\ub85c \ub9c8\ubb34\ub9ac\ud55c\ub2e4.\\n\\n> \ud574\ub2f9 \ud3ec\uc2a4\ud305\uc740 \ud604\uc7ac \uc7ac\uc9c1\uc911\uc778 \ud68c\uc0ac\uc5d0 \uad00\ub828\uc774 \uc5c6\uace0, \uac1c\uc778 \uc5ed\ub7c9 \uac1c\ubc1c\uc744 \uc704\ud55c \uc790\ub8cc\ub85c \ud65c\uc6a9\ud560 \uc608\uc815\uc785\ub2c8\ub2e4."},{"id":"/prometheus/synology-prometheus/","metadata":{"permalink":"/prometheus/synology-prometheus/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2021-06-11-synology-prometheus.md","source":"@site/blog/2021-06-11-synology-prometheus.md","title":"Synology monitoring with Prometheus and snmp exporter","description":"Prometheus\ub85c \uc2dc\ub180\ub85c\uc9c0 NAS Monitoring\ud558\ub294 \ubc29\ubc95 \uc815\ub9ac","date":"2021-06-11T00:00:00.000Z","formattedDate":"June 11, 2021","tags":[{"label":"Prometheus, Synology, \uc2dc\ub180\ub85c\uc9c0","permalink":"/tags/prometheus-synology-\uc2dc\ub180\ub85c\uc9c0"}],"readingTime":11.165,"truncated":true,"authors":[],"frontMatter":{"layout":"single","title":"Synology monitoring with Prometheus and snmp exporter","comments":true,"classes":"wide","description":"Prometheus\ub85c \uc2dc\ub180\ub85c\uc9c0 NAS Monitoring\ud558\ub294 \ubc29\ubc95 \uc815\ub9ac","slug":"/prometheus/synology-prometheus/","date":"2021-06-11T00:00:00.000Z","categories":["prometheus"],"tags":["Prometheus, Synology, \uc2dc\ub180\ub85c\uc9c0"]},"prevItem":{"title":"What is Tailscale?","permalink":"/kubernetes/what-is-tailscale/"},"nextItem":{"title":"vSphere with Tanzu homelab running on ASUS PN50 (2/2)","permalink":"/kubernetes/vSphere-with-Tanzu-homelab-2/"}},"content":"\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 \uc544\uc7ac\ub77c\uba74 \ub2e4\ub4e4 \ud558\ub098\uc529 \uad6c\ube44\ud558\uace0 \uc788\uc744 \uc2dc\ub180\ub85c\uc9c0(Synology) NAS\ub97c Prometheus\uc640 snmp_exporter\ub97c \ud65c\uc6a9\ud574\uc11c \ubaa8\ub2c8\ud130\ub9c1 \ud558\ub294 \ubc29\ubc95\uc744 \uc815\ub9ac\ud55c\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n## \uad6c\uc131\ubc29\uc548\\n\\n\ucd1d 5\uac1c\uc758 \uad6c\uc131\uc73c\ub85c \ubaa8\ub2c8\ud130\ub9c1 \uc2a4\ud0dd\uc744 \uad6c\uc131\ud558\ub824\uace0 \ud55c\ub2e4.  \\n\\n\uad6c\uc131\ubc29\ubc95\uc740 \uc544\ub798\uc640 \uac19\ub2e4. \ubaa8\ub4e0 \uad6c\uc131\uc694\uc18c\ub294 \uc2dc\ub180\ub85c\uc9c0\ub0b4 \ub3c4\ucee4 \ucee8\ud14c\uc774\ub108\ub85c \uad6c\uc131\ub420 \uc608\uc815\uc774\ub2e4.\\n\\n- Prometheus : \ub370\uc774\ud130 \uc218\uc9d1 \ubc0f \uc800\uc7a5\uc744 \ub2f4\ub2f9\ud558\ub294 \uc2dc\uacc4\uc5f4 \ub370\uc774\ud130\ubca0\uc774\uc2a4\\n- Alertmanager : Prometheus\uc5d0\uc11c \ubc1c\uc0dd\ub41c \uc54c\ub9bc\uc744 \uc218\uc2e0\ud558\uc5ec \uba54\uc2dc\uc9c0\ub97c \uc804\ub2ec\\n- Node Exporter : Linux Node\uc758 \ubaa8\ub2c8\ud130\ub9c1 \ub370\uc774\ud130\ub97c Expose\\n- SNMP Exporter : SNMP \uae30\ubc18 \ub514\ubc14\uc774\uc2a4\uc758 \ubaa8\ub2c8\ud130\ub9c1 \ub370\uc774\ud130\ub97c Expose\\n- Grafana : \uc2dc\uac01\ud654 \ub3c4\uad6c\\n\\n![arch](/img/synology/arch.png)  \\n\\n\\n## \uc2dc\ub180\ub85c\uc9c0 \ubaa8\ub2c8\ud130\ub9c1\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c \uc2dc\ub180\ub85c\uc9c0 UI\uc5d0\uc11c\ub3c4 \uad00\ub828\ub41c \ub370\uc774\ud130\ub4e4\uc744 \ud655\uc778\ud560\uc218 \uc788\uace0 \ub514\uc2a4\ud06c \uc624\ub958\ub098 \uc804\uc6d0 \ub4f1 \ud2b9\ubcc4\ud55c \uc774\ubca4\ud2b8\uac00 \ubc1c\uc0dd\ud588\uc744 \uacbd\uc6b0\ub294 \ubcc4\ub3c4\ub85c \uc774\uba54\uc77c\uc774\ub098 \ucee4\uc2a4\ud140 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \ud1b5\ud574 \uc54c\ub9bc\uc744 \ubc1b\uc744 \uc218 \uc788\uc9c0\ub9cc \uba54\ud2b8\ub9ad\uc744 \uae30\ubc18\uc73c\ub85c \ud558\ub294 \ud2b9\uc815 \uc0c1\ud669\uc5d0\uc11c \uc54c\ub9bc\uc744 \ubc1b\uac70\ub098 \ub0b4\uac00 \uc6d0\ud558\ub294 \ubaa8\ub2c8\ud130\ub9c1 \ub300\uc2dc\ubcf4\ub4dc\ub97c \uafb8\ubbf8\uae30 \uc704\ud55c \uc6a9\uc73c\ub85c \uc2dc\ub180\ub85c\uc9c0\ub294 SNMP\uae30\ubc18\uc758 \ubaa8\ub2c8\ud130\ub9c1\uc744 \uc81c\uacf5\ud55c\ub2e4. \ub2e4\ub978 NMS \ub610\ub294 \ubaa8\ub2c8\ud130\ub9c1 \ub3c4\uad6c\ub4f1\uc744 \uc0ac\uc6a9\ud558\uae30 \ubcf4\ub2e4\ub294 \uc5c5\ubb34\uc640 \uad00\ub828\uc788\ub294 \uc2e4\uc81c SNMP exporter\ub97c \uad6c\uc131\ud574\ubcf4\uace0 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4\uc640 \uadf8\ub77c\ud30c\ub098 \ub300\uc2dc\ubcf4\ub4dc\ub97c \ud1b5\ud574 \ubaa8\ub2c8\ud130\ub9c1\uc744 \ud558\ub294\ub370 \ubaa9\uc801\uc774 \uc788\ub2e4.\\n\\n## \uc2dc\ub180\ub85c\uc9c0 \uc124\uc815\\n\\n### \uc0ac\uc804 \uc694\uad6c\uc0ac\ud56d\\n- [\uc2dc\ub180\ub85c\uc9c0 Docker](https://www.synology.com/en-global/dsm/packages/Docker)\\n- SSH \ud5c8\uc6a9\\n- Admin \uad8c\ud55c\\n- SNMP \uc124\uc815\\n\\nSNMP \uc124\uc815\uc744 \uc81c\uc678\ud55c 3\uac00\uc9c0 \uad6c\uc131\uc740 \uae30\ubcf8\uc801\uc73c\ub85c \ub418\uc5b4\uc788\ub2e4 \uac00\uc815\ud558\uace0 \uc9c4\ud589\ud55c\ub2e4.  \\n\\n\uc2dc\ub180\ub85c\uc9c0\ub294 \uae30\ubcf8\uc801\uc73c\ub85c SNMP \uc124\uc815\uc774 \ube44\ud65c\uc131\ud654 \uc0c1\ud0dc\uc774\uae30 \ub54c\ubb38\uc5d0 \ubcc0\uacbd\uc774 \ud544\uc694\ud558\ub2e4. \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 \uc2dc\ub180\ub85c\uc9c0\uc758 \uc81c\uc5b4\ud310 - \ud130\ubbf8\ub110 \ubc0f SNMP - SNMP\ud0ed \uc73c\ub85c \uc774\ub3d9\ud574\uc11c SNMP \uc11c\ube44\uc2a4\ub97c \ud65c\uc131\ud654\ub97c \uccb4\ud06c\ud558\uace0 \uc774\ud6c4 snmp exporter \uc124\uc815\uc5d0\uc11c \uc0ac\uc6a9\ub420 community\uac12\uc744 \uc6d0\ud558\ub294 \uac12\uc73c\ub85c \ubcc0\uacbd\ud55c \ud6c4 \uc800\uc7a5\ud55c\ub2e4.  \\n\\n![snmp](/img/synology/snmp.png)\\n\\n\uadf8\ub7fc \uc774\uc81c \uc2dc\ub180\ub85c\uc9c0\ub294 \uc678\ubd80 \ud1b5\uc2e0\uc744 \uc704\ud55c Port\uc778 UDP 161 port\ub85c snmpd\uc744 \uc2e4\ud589\ud558\uac8c \ub41c\ub2e4. \\n\\n```sh\\nroot@DSM2:~# netstat -unlp | grep 161\\nudp        0      0 0.0.0.0:161             0.0.0.0:*                           9437/snmpd\\nudp6       0      0 :::161                  :::*                                9437/snmpd\\n```\\n\\n## SNMP Exporter\\n\\n[https://github.com/prometheus/snmp_exporter](https://github.com/prometheus/snmp_exporter)\\n\\nSNMP Exporter\ub294 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4\uac00 \uc218\uc9d1\ud560 \uc218 \uc788\ub294 \ud615\uc2dd\uc73c\ub85c SNMP \uba54\ud2b8\ub9ad \ub370\uc774\ud130\ub97c Expose \ud560\ub54c \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc73c\ub85c \uc804\ud1b5\uc801\uc778 \ubaa8\ub2c8\ud130\ub9c1 \ub3c4\uad6c\uc640 \ub9c8\ucc2c\uac00\uc9c0\ub85c MIB\ub97c \uc0ac\uc6a9\ud558\uac8c \ub41c\ub2e4. \ub808\ud3ec\uc9c0\ud1a0\ub9ac \ucee8\uc149\uc5d0\ub3c4 \uc124\uba85\uc774 \uc801\ud600\uc788\ub4ef\uc774 SNMP \ub370\uc774\ud130\ub294 \uacc4\uce35\ud615 \ub370\uc774\ud130 \uad6c\uc870\ub97c \uac00\uc9c0\uace0 \uc788\uace0 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4\ub294 \ub2e4\ucc28\uc6d0 \ub9e4\ud2b8\ub9ad\uc2a4\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 \ub450 \uc2dc\uc2a4\ud15c\uc740 \uc798 \ub9de\ub294\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4.\\n\\nSNMP \ub370\uc774\ud130 \uad6c\uc870\ub97c \uc5ec\uae30\uc11c \uc790\uc138\ud788 \uc124\uba85\ud558\uc9c0\ub294 \uc54a\uaca0\uc9c0\ub9cc  SNMP index\uc640 label\uc744 \ub9e4\ud551\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c \ub370\uc774\ud130\ub97c \ucc98\ub9ac\ud55c\ub2e4. \ub2e4\ub978 \uc775\uc2a4\ud3ec\ud130\uc640 \ub3d9\uc77c\ud558\uac8c daemon \ud615\ud0dc\ub85c \uc2e4\ud589\uc774 \ub418\uace0 `http://localhost:9116/snmp?module=if_mib&target=1.2.3.4` \uc640 \uac19\uc774 module\uacfc target\uc744 \uc124\uc815\ud558\ub294 \ubc29\uc2dd\uc73c\ub85c \ub370\uc774\ud130 \uc218\uc9d1\uc744 \ud560 \uc218 \uc788\ub2e4.\\n\\n\uae30\ubcf8 config \ud30c\uc77c\uc744 `snmp.yml`\uc744 \ucc38\uc870\ud558\uac8c \ub418\ub294\ub370 \uc218\ub3d9\uc73c\ub85c \uc791\uc131\ud558\ub294 \uac83\uc774 \uc544\ub2c8\ub77c generator\ub97c \ud1b5\ud574 \uc0dd\uc131\ud558\uac8c \ub41c\ub2e4.  \\n[https://github.com/prometheus/snmp_exporter/tree/main/generator](https://github.com/prometheus/snmp_exporter/tree/main/generator)\\n\\n\ud574\ub2f9 \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub4ef\uc774 generator\uc5d0\uc11c \ubca4\ub354\ubcc4 MIB \ud30c\uc77c\uacfc generator.yml\ub97c \ucc38\uc870\ud574\uc11c \ube4c\ub4dc, \uc2e4\ud589\ud558\uace0 \uacb0\uacfc\uac12\uc73c\ub85c snmp.yml\uc774 \uc0dd\uc131\ub418\uac8c \ub41c\ub2e4. \ub530\ub85c \ub9cc\ub4e4\uc5b4\ub3c4 \ub418\uc9c0\ub9cc \uc2dc\ub180\ub85c\uc9c0\uc5d0\ub9cc \ud574\ub2f9 \ud30c\uc77c\uc744 \ubc14\ub85c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub3c4\ub85d \ubbf8\ub9ac \ub9cc\ub4e4\uc5b4 \ub450\uc2e0 \ubd84\uc774 \uacc4\uc154\uc11c [tumak](https://grafana.com/orgs/tumak)\uc758 \uadf8\ub77c\ud30c\ub098 \ub300\uc2dc\ubcf4\ub4dc\ub97c \ucc38\uc870\ud558\uc600\ub2e4. \uadf8\ub9ac\uace0 \uc774\ud6c4 \uc2dc\ub180\ub85c\uc9c0 \ub300\uc2dc\ubcf4\ub4dc\ub85c\ub3c4 \uc0ac\uc6a9\ud560 \uc608\uc815\uc774\ub2e4.  \\n\\n[https://grafana.com/grafana/dashboards/14284](https://grafana.com/grafana/dashboards/14284)\\n\\n\ub9cc\ub4e4\uc5b4\uc9c4 `snmp.yml`\uc5d0\uc11c \ubcc0\uacbd\ud574\uc57c \ud560 \ubd80\ubd84\uc740 \ud604\uc7ac \uc2dc\ub180\ub85c\uc9c0\uc5d0\uc11c \uc124\uc815\ub41c SNMP community \uc124\uc815\uc774\ub2e4. snmp.yml \ub9e8 \uc544\ub798 community \uac12\uc744 \uc2dc\ub180\ub85c\uc9c0\uc5d0 \uc124\uc815\ud55c \uac12\uacfc \uc77c\uce58\ud558\uac8c \ubcc0\uacbd\ud55c\ub2e4.  \\n\\n```yaml\\n  auth:\\n    community: synology\\n```\\n\\n## Prometheus, Alertmanager, Exporter, Grafana \uad6c\uc131\\n\\n\uac04\ub2e8\ud55c \uc544\ud0a4\ud14d\ucc98 \uad6c\uc131\ub3c4\ub85c \uc2dc\ub180\ub85c\uc9c0 \uc790\uccb4 \ub610\ub294 OS\uae30\ubc18\uc5d0\uc11c \ubc1c\uc0dd\ud558\ub294 \ubaa8\ub2c8\ud130\ub9c1 \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud558\ub294 \uac01\uac01\uc758 Exporter\ub97c \uad6c\uc131\ud558\uace0 \ud574\ub2f9 \ub370\uc774\ud130\ub97c \uc218\uc9d1\ud558\ub294 Prometheus \uc11c\ubc84\uc640 \uad00\ub828 \ub370\uc774\ud130\ub97c \uc2dc\uac01\ud654\ud558\ub294 Grafana\uae4c\uc9c0 \ud55c\ubc88\uc5d0 \uad6c\uc131\ud558\uae30 \uc704\ud574 Docker-compose\ub97c \uc0ac\uc6a9\ud560 \uc608\uc815\uc774\ub2e4.  \\n\\nDocker Compose \ud30c\uc77c\uc744 \ub9e8 \uc544\ub798 snmp exporter \ubd80\ud130 \ud558\ub098\uc529 \ucabc\uac1c\uc11c \uc0b4\ud3b4\ubcf4\uc790.  \\n\\nSNMP Exporter\ub294 \uc704\uc5d0\uc11c \ub9cc\ub4e0 snmp.yml \ud30c\uc77c\uc744 \ub9c8\uc6b4\ud2b8\ud574\uc11c \uc2e4\ud589\ub418\ub3c4\ub85d \ud55c\ub2e4. \uadf8\ub7ec\uba74 SNMP exporter\uac00 \uc2e4\ud589\ub418\uba74\uc11c snmp\ud30c\uc77c\uc744 \ucc38\uc870\ud574\uc11c \uc2e4\ud589\uc774 \ub418\uace0 prometheus.yaml\uc5d0\uc11c \uc815\uc758\ud55c target\uacfc SNMP \ud504\ub85c\ud1a0\ucf5c\uc744 \ud1b5\ud574 \uad00\ub828\ub41c \uba54\ud2b8\ub9ad \uac12\uc744 \uc218\uc9d1\ud574\uc11c Expose\ud558\uac8c \ub420 \uac83\uc774\ub2e4.  \\n\\n```yaml\\n  snmp-exporter:\\n    image: prom/snmp-exporter\\n    container_name: snmp_exporter\\n    volumes:\\n      - ./snmp_exporter/:/etc/snmp_exporter/\\n    ports:\\n      - 9116:9116\\n    volumes:\\n      - ./snmp-synology/snmp.yml:/etc/snmp_exporter/snmp.yml\\n    command:\\n      - \\"--config.file=/etc/snmp_exporter/snmp.yml\\"\\n```\\n\\n\ub2e4\uc74c\uc740 Node Exporter\ub97c \uc2e4\ud589\ud558\ub294 \ubd80\ubd84\uc73c\ub85c \uc2dc\uc2a4\ud15c\uc5d0 \uad00\ub828\ub41c \uad8c\ud55c\uc774 \ud544\uc694\ud558\ubbc0\ub85c `/proc, /sys, /` \ub4f1 \ud30c\uc77c\uc2dc\uc2a4\ud15c\uc758 read only \uad8c\ud55c\uacfc `privileged: true` \uc124\uc815\uc744 \ud1b5\ud574 \uc2e4\ud589\ub418\uac8c \ub420 \uac83\uc774\ub2e4.\\n\\n```yaml\\n  node-exporter:\\n    privileged: true\\n    image: prom/node-exporter\\n    container_name: node-exporter\\n    restart: always\\n    ports:\\n      - \\"9100:9100\\"\\n    volumes:\\n      - /proc:/host/proc:ro\\n      - /sys:/host/sys:ro\\n      - /:/rootfs:ro\\n    command:\\n      - \\"--path.procfs=/host/proc\\"\\n      - \\"--path.sysfs=/host/sys\\"\\n      - \\"--collector.filesystem.ignored-mount-points\\"\\n      - \\"^/(rootfs/)?(dev|etc|host|proc|run|sys|volume1)($$|/)\\"\\n```\\n\\n\ub2e4\uc74c\uc740 \uc2dc\uac01\ud654\uc640 \uc54c\ub9bc\uc744 \ub2f4\ub2f9\ud560 Grafana\uc640 Alertmanager \ubd80\ubd84\uc73c\ub85c Alertmanager\uc758 \uacbd\uc6b0 \uae30\ubcf8\uc801\uc778 config\ub97c \ub9c8\uc6b4\ud2b8\ud574\uc11c \uc2e4\ud589\uc744 \ud560 \uc608\uc815\uc774\ub2e4.\\n\\n```yaml\\n  grafana:\\n    container_name: grafana\\n    image: grafana/grafana\\n    ports:\\n      - \\"3000:3000\\"\\n    depends_on:\\n      - prometheus\\n\\n  alertmanager:\\n    container_name: alertmanager\\n    image: prom/alertmanager:v0.21.0\\n    ports:\\n      - 9093:9093\\n    volumes:\\n      - ./config/alertmanager.yml:/etc/alertmanager/alertmanager.yml\\n    restart: always\\n```\\n\\n\ub9c8\uc9c0\ub9c9\uc73c\ub85c, Prometheus\ub294 \uc54c\ub9bc\ub8f0\uc744 \uc0dd\uc131\ud558\uae30 \uc704\ud574\uc11c \ubcc4\ub3c4\ub85c rules \ub514\ub809\ud1a0\ub9ac\uc640 \ubbf8\ub9ac \uc0dd\uc131\ud574\ub454 config\ub97c mount \uc2dc\ud0a8\ub2e4.  \\n\\n```yaml\\nversion: \\"3.8\\"\\nservices:\\n  prometheus:\\n    container_name: prometheus\\n    image: quay.io/prometheus/prometheus:v2.26.0\\n    volumes:\\n      - ./config/prometheus.yml:/etc/prometheus/prometheus.yml\\n      - ./rules:/etc/prometheus/rules\\n    command: \\"--config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/prometheus\\"\\n    ports:\\n      - 9090:9090\\n```\\n\\nprometheus.yml config\ub97c \uc0b4\ud3b4\ubcf4\uba74 \uc218\uc9d1\uc8fc\uae30\ub294 1\ubd84\uc73c\ub85c, \ub098\uba38\uc9c0 \uc5bc\ub7ff\ub9e4\ub2c8\uc800\uc640 \uc218\uc9d1\ud560 \ub300\uc0c1\uc778 exporter\ub4e4\uc758 target endpoint\ub97c \ucd94\uac00\ud558\uc5ec \uc2e4\ud589\ud560 \uc608\uc815\uc774\ub2e4. \uc5ec\uae30\uc11c\ub294 \uc2dc\ub180\ub85c\uc9c0 SNMP \uc11c\ube44\uc2a4\uc640 \ud1b5\uc2e0\ud558\uae30 \uc704\ud574 SNMP Exporter\uc758 target\uc744 \uc2e4\uc81c \uc0ac\uc6a9\uc911\uc778 \uc2dc\ub180\ub85c\uc9c0 IP\ub97c \ub4f1\ub85d\ud558\ub3c4\ub85d \ud55c\ub2e4.  \\n\\n```yaml\\nglobal:\\n  scrape_interval:     1m\\n  evaluation_interval: 1m\\n\\nalerting:\\n  alertmanagers:\\n  - static_configs:\\n    - targets: [\'alertmanager:9093\']\\n\\nrule_files:\\n  - \\"/etc/prometheus/rules/*\\"\\n\\nscrape_configs:\\n  - job_name: \'prometheus\'\\n    static_configs:\\n      - targets: [\'localhost:9090\']\\n        labels:\\n          group: \'prometheus\'\\n  - job_name: node\\n    static_configs:\\n    - targets: [\'node-exporter:9100\']\\n  - job_name: \'snmp-exporter\'\\n    static_configs:\\n    - targets: [\'192.168.0.100\']\\n    metrics_path: /snmp\\n    params:\\n      module: [synology]\\n    relabel_configs:\\n      - source_labels: [__address__]\\n        target_label: __param_target\\n      - source_labels: [__param_target]\\n        target_label: instance\\n      - target_label: __address__\\n        replacement: 192.168.0.100:9116  # The SNMP exporter\'s real synology hostname:port. \\n```\\n\\n## Stack \uc2e4\ud589\\n\\n\ubaa8\ub4e0 \uc124\uc815\uc774 \uc644\ub8cc\ub418\uba74 \uc77c\ub2e8 \uae30\ubcf8\uc801\uc778 \uc2e4\ud589\uc774 \uac00\ub2a5\ud55c \uc0c1\ud0dc\ub85c \uc2dc\ub180\ub85c\uc9c0 CLI\ub97c \uc2e4\ud589\ud55c\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c \uc2dc\ub180\ub85c\uc9c0\ub294 admin\uacc4\uc815\uc73c\ub85c \ub85c\uadf8\uc778\ud574\uc11c sudo \uad8c\ud55c\uc744 \ud1b5\ud574 Docker Compose \uc2e4\ud589\uc744 \ud574\uc57c \ud55c\ub2e4.  \\n\\n```sh\\nssh admin@192.168.31.7\\nsudo -i\\n```\\n\\n[https://github.com/ddiiwoong/synology-prometheus.git](https://github.com/ddiiwoong/synology-prometheus.git)\uc744 clone\ud574\uc11c /snmp-synology/snmp.yml \ud30c\uc77c\uc758 community \uac12\uc744 \ubcf8\uc778\uc758 synology \uac12\uc73c\ub85c \ubcc0\uacbd\ud55c \ud6c4 Docker Compose\ub97c \ub370\ubaac\ud615\ud0dc\ub85c \uc2e4\ud589\ud55c\ub2e4.  \\n\\n```sh\\ndocker-compose up -d\\n```\\n\\n\ubcf8\uc778\uc758 `http://<\uc2dc\ub180\ub85c\uc9c0 IP>:9090/targets` \uc73c\ub85c \uc811\uc18d\ud574\uc11c 3\uac1c\uc758 target\uc774 \uc815\uc0c1\uc778\uc9c0 \ud655\uc778\ud55c\ub2e4. \uadf8\ub9ac\uace0 \ud45c\ud604\uc2dd \ube0c\ub77c\uc6b0\uc800\ub85c \ub3cc\uc544\uc640\uc11c `node_cpu_seconds_total` \uacfc `diskModel`\uc744 \ud1b5\ud574 \ub450\uac1c\uc758 exporter\uc5d0\uc11c \ub370\uc774\ud130\uac00 \uc218\uc9d1\ub418\uace0 \uc788\ub294\uc9c0 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. `diskModel`\uc740 \uc2dc\ub180\ub85c\uc9c0\uc5d0 \uc7a5\ucc29\ub41c \ud558\ub4dc\ub514\uc2a4\ud06c \ubaa8\ub378 \uc815\ubcf4\ub97c \ubcf4\uc5ec\uc8fc\ub294 \uba54\ud2b8\ub9ad\uc774\ub2e4.  \\n\\n![diskmodel](/img/synology/diskmodel.png)\\n\\n\uadf8\ub77c\ud30c\ub098 \ub300\uc2dc\ubcf4\ub4dc\ub294 `http://<\uc2dc\ub180\ub85c\uc9c0 IP>:3000` \ub85c \uc811\uc18d\ud574\uc11c \ucd08\uae30 \uacc4\uc815\uc778 `admin:admin`\uc744 \uc785\ub825\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 \uae30\ubcf8 \ud654\uba74\uc744 \ubcfc\uc218 \uc788\ub2e4. \uc5ec\uae30\uc11c \uc88c\uce21\uc758 \uae30\uc5b4\ubaa8\uc591 \uba54\ub274(Configuration)\uc758 `Data Sources`\ub97c \ud074\ub9ad\ud558\uace0 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ub370\uc774\ud130\uc18c\uc2a4\ub97c \ub4f1\ub85d\ud55c\ub2e4.  \\n\\nDocker Compose\ub85c \uc2e4\ud589\ud560 \ub54c \uc544\ub798\uc640 \uac19\uc774 `prometheus` \uc774\ub984\uc73c\ub85c \uc2e4\ud589\ud588\uae30 \ub54c\ubb38\uc5d0 HTTP URL\uc5d0 `prometheus:9090`\uc744 \uc785\ub825\ud558\uace0 `Save & Test`\ub85c \ub370\uc774\ud130 \uc18c\uc2a4\ub97c \uc800\uc7a5\ud55c\ub2e4.  \\n\\n![grafana](/img/synology/grafana.png)\\n\\n## \uc2dc\ub180\ub85c\uc9c0 \ub300\uc2dc\ubcf4\ub4dc \uad6c\uc131\\n\\n\ub9c8\uc9c0\ub9c9\uc73c\ub85c [https://grafana.com/grafana/dashboards/14284](https://grafana.com/grafana/dashboards/14284)\uc758 \ub300\uc2dc\ubcf4\ub4dc\ub97c \ucd94\uac00\ud558\ub294 \uacfc\uc815\uc744 \uc9c4\ud589\ud55c\ub2e4.  \\n\\n\uc88c\uce21\uc758 + \uba54\ub274(Create)\uc758 `Import`\ub97c \ud074\ub9ad\ud558\uace0 \uc704 \ub300\uc2dc\ubcf4\ub4dc ID `14284`\ub97c \uc785\ub825\ud558\uace0 \ub4f1\ub85d\ud558\uba74 \uc544\ub798\uc640 \uac19\uc774 \uc2dc\ub180\ub85c\uc9c0\uc758 \ubaa8\ub2c8\ud130\ub9c1 \ub300\uc2dc\ubcf4\ub4dc\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n![synology](/img/synology/synology.png)\\n\\n## \uc815\ub9ac\\n\\n\uac04\ub2e8(?)\ud558\uac8c \uc2dc\ub180\ub85c\uc9c0 \ub098\uc2a4\ub97c \ubaa8\ub2c8\ud130\ub9c1\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud574\uc11c \uc815\ub9ac\ud574\ubd24\ub2e4. \ub204\uad70\uac00\uc5d0\uac8c\ub294 \uc7ac\ubbf8\ub85c \ub204\uad70\uac00\uc5d0\uac8c\ub294 \ub3c4\uc6c0\uc774 \ub418\uae38 \ubc14\ub77c\uba70, \ud3ec\uc2a4\ud305\uacfc \uad00\ub828\ub41c \ubaa8\ub4e0\uac83\uc740 \uac1c\uc778 \ucde8\ubbf8\ub85c \uc791\uc131\ub41c \ub0b4\uc6a9\uc73c\ub85c \ud68c\uc0ac\ub098 \ub098\uc2a4\uc640 \uad00\ub828\ub41c \uc81c\ud488\uacfc \uad00\uacc4\uac00 \uc5c6\uc74c\uc744 \uc54c\ub9b0\ub2e4."},{"id":"kubernetes/vSphere-with-Tanzu-homelab-2/","metadata":{"permalink":"/kubernetes/vSphere-with-Tanzu-homelab-2/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2020-12-06-vSphere-with-Tanzu-homelab-2.md","source":"@site/blog/2020-12-06-vSphere-with-Tanzu-homelab-2.md","title":"vSphere with Tanzu homelab running on ASUS PN50 (2/2)","description":"\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 Tanzu Cluster\ub97c \ub2e8\uc77c \ud648\ub7a9 vSphere \uc11c\ubc84\uc5d0 \uc62c\ub824\ubcf8\ub2e4","date":"2020-12-06T00:00:00.000Z","formattedDate":"December 6, 2020","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Tanzu","permalink":"/tags/tanzu"},{"label":"vSphere","permalink":"/tags/v-sphere"},{"label":"Homelab","permalink":"/tags/homelab"},{"label":"ASUS","permalink":"/tags/asus"},{"label":"PN50","permalink":"/tags/pn-50"}],"readingTime":17.815,"truncated":true,"authors":[],"frontMatter":{"layout":"single","title":"vSphere with Tanzu homelab running on ASUS PN50 (2/2)","comments":true,"classes":"wide","description":"\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 Tanzu Cluster\ub97c \ub2e8\uc77c \ud648\ub7a9 vSphere \uc11c\ubc84\uc5d0 \uc62c\ub824\ubcf8\ub2e4","slug":"kubernetes/vSphere-with-Tanzu-homelab-2/","date":"2020-12-06T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","Tanzu","vSphere","Homelab","ASUS","PN50"]},"prevItem":{"title":"Synology monitoring with Prometheus and snmp exporter","permalink":"/prometheus/synology-prometheus/"},"nextItem":{"title":"vSphere with Tanzu homelab running on ASUS PN50 (1/2)","permalink":"/kubernetes/vSphere-with-Tanzu-homelab/"}},"content":"\uc9c0\ub09c\uae00\uc5d0 \uc774\uc5b4 \uc774\ubc88\uc5d0\ub294 \ub124\ud2b8\uc6cc\ud06c \uad6c\uc131\ud558\ub294 \ubc29\ubc95\uacfc vSphere Cluster\uc5d0 \ucd94\uac00\uc801\uc778 Kubernetes \ud074\ub7ec\uc2a4\ud130\ub97c \ubc30\ud3ec\ud558\ub294 \uac83\uc5d0 \ub300\ud574 \uc774\uc57c\uae30 \ud558\uace0\uc790 \ud55c\ub2e4. \uc774\ubc88 \uae00\ub3c4 \uc9c0\ub09c\uae00\uacfc \ub3d9\uc77c\ud558\uac8c [virtuallyGhetto](https://www.virtuallyghetto.com/) \ube14\ub85c\uadf8 \ud3ec\uc2a4\ud305\uc744 \ucc38\uace0\ud558\uc5ec \uadf8\ub300\ub85c \uc9c4\ud589\ud55c \ub0b4\uc6a9\uc774\ub77c\uace0 \ubcf4\uba74 \ub41c\ub2e4.\\n\\n[https://www.virtuallyghetto.com/2020/11/complete-vsphere-with-tanzu-homelab-with-just-32gb-of-memory.html](https://www.virtuallyghetto.com/2020/11/complete-vsphere-with-tanzu-homelab-with-just-32gb-of-memory.html)\\n\\n\uc9c0\ub09c \ud3ec\uc2a4\ud305\uc740 \ub2e4\uc74c \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n> \uc774\uc804\uae00 - [vSphere with Tanzu homelab running on ASUS PN50 (1/2)](https://ddii.dev/kubernetes/vSphere-with-Tanzu-homelab/)\\n\\n\x3c!--truncate--\x3e\\n\\n\\n![vcsa](/img/vcsa.png)\\n\\n## VDS(vSphere Distributed Switch) \uad6c\uc131\\n\\n\uc774\ubc88 \uad6c\uc131\uc758 \uacbd\uc6b0\uc5d0\ub294 usb nic\ub97c \ud558\ub098\ub9cc\uc744 \uc0ac\uc6a9\ud574\uc11c \uc9c4\ud589\ud558\uae30 \ub54c\ubb38\uc5d0 \uc704\uc5d0\uc11c \uc124\uc815\ud588\ub358 3\uac1c\uc758 \ub124\ud2b8\uc6cc\ud06c(Management, Frontend, Workload)\ub85c \ubd84\ub9ac\ud558\uae30 \uc704\ud574 VDS\ub97c \uc2e0\uaddc\ub85c \uc0dd\uc131\ud558\uace0 \uae30\uc874 \ub124\ud2b8\uc6cc\ud06c \uc5b4\ub311\ud130\ub97c \ubcc0\uacbd\ud558\ub294 \uc791\uc5c5\uc744 \uc218\ud589\ud574\uc57c \ud55c\ub2e4.  \\n\\n\uba3c\uc800 \uc2e0\uaddc \uad6c\uc131\ud55c vCenter UI([https://vcsa.tanzu.local/ui](https://vcsa.tanzu.local/ui))\ub85c \uc811\uc18d\ud574 `Networking` \uba54\ub274\ub85c \uc774\ub3d9\ud574\uc11c `VDS` \uba54\ub274 \uc6b0\ud074\ub9ad \ud6c4 `Add and Manage Hosts`\ub97c \uc120\ud0dd\ud55c\ub2e4. \\n\\n![network](/img/vcsa_network_menu.png)\\n\\nVDS \uc124\uc815\ud558\ub294 6\ub2e8\uacc4\ub97c \uc9c4\ud589\ud55c\ub2e4. \\n\\n* 1\ub2e8\uacc4 -  `Add hosts`\ub97c \uc120\ud0dd\ud55c\ub2e4.\\n* 2\ub2e8\uacc4 - ESXi host\ub97c \uc120\ud0dd\ud55c\ub2e4. \\n* 3\ub2e8\uacc4 - pyhysical adapter\ub97c \uc0dd\uc131\ud55c \ud6c4\uc5d0 \uc120\ud0dd\ud558\uac8c \ub418\ub294\ub370 \uad6c\uc131\ud55c \ub7a9\uc5d0\uc11c\ub294 USB TYPE NIC\ub97c \uc0ac\uc6a9\ud558\uc5ec `vusb0` \uc5b4\ub311\ud130\ub97c \uc120\ud0dd\ud558\uace0 `Assign uplink`\uc5d0\uc11c `dvUplink1`\ub97c Assign\ud55c\ub2e4.\\n* 4\ub2e8\uacc4 - VMkernel adapter\uc5d0\uc11c vmk0\uc744 \uc120\ud0dd\ud558\uace0 `Assign port group`\uc5d0\uc11c Network\ub97c Management\ub97c Assign\ud55c\ub2e4.\\n* 5\ub2e8\uacc4 - VM Migration\uc740 \uc0dd\ub7b5\ud55c\ub2e4.\\n* 6\ub2e8\uacc4 - \uc124\uc815\ub418\ub294 \ub0b4\uc6a9\uc744 \ud655\uc778\ud558\uace0 Finish\ub97c \ud558\uac8c \ub418\uba74 \uae30\uc874 VCSA\uc758 \uae30\ubcf8 \ub124\ud2b8\uc6cc\ud06c\uac00 `vSwitch`\uc5d0\uc11c `VDS`\ub85c \ubcc0\uacbd\ub418\uc5c8\uae30 \ub54c\ubb38\uc5d0 VSCA Client \uc811\uc18d\uc774 \ub04a\uc5b4\uc9c0\uac8c \ub41c\ub2e4. \\n\\n\ub2e4\uc2dc ESXi Client\ub85c \uc811\uc18d\ud574\uc11c VCSA Port Group(\ub124\ud2b8\uc6cc\ud06c)\uc744 \uc544\ub798\uc640 \uac19\uc774 \uae30\uc874 `VM Network`\uc5d0\uc11c `Management`\ub85c \ubcc0\uacbd\ud558\uba74 \ub2e4\uc2dc VSCA Client\ub85c \uc811\uc18d\uc774 \uac00\ub2a5\ud558\uac8c \ub41c\ub2e4.\\n\\n![network_adapter](/img/vcsa_network.png)\\n\\n## RouterVM\uc758 Network Port Group \ucd94\uac00(Frontend, Workload)\\n\\n\uc774\uc804 \ud3ec\uc2a4\ud305\uc5d0\uc11c \uc0dd\uc131\ud55c Router VM\uc740 \uad6c\uc131\ud560 \ub0b4\ubd80 \ub124\ud2b8\uc6cc\ud06c(10.10.0.0/24 & 10.20.0.0/24)\ub85c\uc758 \ub77c\uc6b0\ud305\uacfc \uc678\ubd80 \ub124\ud2b8\uc6cc\ud06c\ub85c NAT \ubc0f \ud3ec\uc6cc\ub529\uc744 \uc704\ud574\uc11c \ud544\uc694\ud558\uae30 \ub54c\ubb38\uc5d0 vSphere \ub610\ub294 VCSA Client\uc5d0\uc11c `router.tanzu.local`\uc758 \ub124\ud2b8\uc6cc\ud06c \uc5b4\ub311\ud130\ub97c `Frontend`, `Workload`\ub85c \ucd94\uac00\ud558\ub294 \uc791\uc5c5\uc774 \ud544\uc694\ud558\ub2e4.\\n\\n![routervm](/img/routervm.png)\\n\\n\uad6c\uc131\uc744 \uc644\ub8cc\ud55c \ud6c4\uc5d0 \uac04\ub2e8\ud55c \ub124\ud2b8\uc6cc\ud06c \uad6c\uc131\uc744 \ubcf4\uba74 \ub2e4\uc74c\uacfc \uac19\ub2e4.  \\n\\n![vswitch](/img/vswitch.png)\\n\\n\ubb3c\ub9ac \uc778\ud130\ud398\uc774\uc2a4 `vusb0` \uc544\ub798 \uac00\uc0c1 \uc2a4\uc704\uce58\uac00 3\uac1c \uad6c\uc131\ub418\uc5b4 \uc788\uace0 \uc678\ubd80\uc5d0\uc11c\ub3c4 RouterVM\uc744 \ud1b5\ud574 \uc811\uc18d\uc774 \uac00\ub2a5\ud558\ub3c4\ub85d \uc811\uc18d\ud558\ub294 \ub85c\uceec \uba38\uc2e0\uc5d0\uc11c \ub77c\uc6b0\ud305 \uacbd\ub85c \ucd94\uac00\uac00 \ud544\uc694\ud558\ub2e4.\\n\\n* Windows  \\n  `route print` \uba85\ub839\uc73c\ub85c \uc778\ud130\ud398\uc774\uc2a4 ID\ub97c \uba3c\uc800 \ud655\uc778\ud558\uace0 \uc544\ub798\uc640 \uac19\uc774 \uc124\uc815\ud55c\ub2e4.\\n\\n  ```powershell\\n  route ADD 10.10.0.0 MASK 255.255.255.0 192.168.0.201 METRIC 3 IF 5\\n  route ADD 10.20.0.0 MASK 255.255.255.0 192.168.0.201 METRIC 3 IF 5\\n  ```\\n\\n* MacOS\\n  ```sh\\n  sudo route -n add -net 10.10.0.0/24 192.168.0.201\\n  sudo route -n add -net 10.20.0.0/24 192.168.0.201\\n  ```\\n\\n* WSL\\n  ```sh\\n  sudo route -n add -net 10.10.0.0/24 gw <Gateway IP>\\n  sudo route -n add -net 10.20.0.0/24 gw <Gateway IP>\\n  ```\\n\\n## HAProxyVM \uc124\uc815\\n\\n\uc774\uc804 \ud3ec\uc2a4\ud305\uc5d0\uc11c \uc0dd\uc131\ud55c HAProxy\ub3c4 \ucd94\uac00\ub41c \ub124\ud2b8\uc6cc\ud06c \ud658\uacbd\uc73c\ub85c \uc124\uc815\uc744 \ud558\uae30 \uc704\ud574 \ub2e4\uc74c \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc0ac\uc6a9\ud55c\ub2e4.   \\n\\n* [https://github.com/lamw/vsphere-with-tanzu-homelab-scripts/blob/master/deploy_3nic_haproxy.ps1](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts/blob/master/deploy_3nic_haproxy.ps1)\\n\\n\uad6c\uc131\ud55c \ud658\uacbd\uc5d0 \ub9de\uac8c \uc2a4\ud06c\ub9bd\ud2b8\ub0b4 \ubcc0\uc218\ub4e4\uc744 \uc218\uc815\ud55c \ud6c4 \uc2e4\ud589\ud55c\ub2e4.\\n\\n```powershell\\n$HAProxyOVA = \\"C:\\\\esxi\\\\vmware-haproxy-v0.1.8.ova\\"\\n\\n$Cluster = \\"Tanzu-Cluster\\"\\n$VMHost = \\"esxi-01.tanzu.local\\"\\n$Datastore = \\"datastore1\\"\\n\\n$HAProxyDisplayName = \\"haproxy.tanzu.local\\"\\n$HAProxyHostname = \\"haproxy.tanzu.local\\"\\n$HAProxyDNS = \\"192.168.0.201\\"\\n$HAProxyManagementNetwork = \\"Management\\"\\n$HAProxyManagementIPAddress = \\"192.168.0.203/24\\" # Format is IP Address/CIDR Prefix\\n$HAProxyManagementGateway = \\"192.168.0.1\\"\\n$HAProxyFrontendNetwork = \\"Frontend\\"\\n$HAProxyFrontendIPAddress = \\"10.10.0.2/24\\" # Format is IP Address/CIDR Prefix\\n$HAProxyFrontendGateway = \\"10.10.0.1\\"\\n$HAProxyWorkloadNetwork = \\"Workload\\"\\n$HAProxyWorkloadIPAddress = \\"10.20.0.2/24\\" # Format is IP Address/CIDR Prefix\\n$HAProxyWorkloadGateway = \\"10.20.0.1\\"\\n$HAProxyLoadBalanceIPRange = \\"10.10.0.64/26\\" # Format is Network CIDR Notation\\n$HAProxyOSPassword = \\"VMware1!\\"\\n$HAProxyPort = \\"5556\\"\\n$HAProxyUsername = \\"wcp\\"\\n$HAProxyPassword = \\"VMware1!\\"\\n...\\n```\\n\\n```powershell\\n./deploy_3nic_haproxy.ps1\\n```\\n\\n\uc774\ud6c4 HAProxy VM\ub0b4\uc5d0\uc11c \uc5ec\ub7ec \uc778\ud130\ud398\uc774\uc2a4\uc5d0\uc11c `Reverse Path Filtering`\uc744 `Disable`\ud558\uae30 \uc704\ud574 \ub2e4\uc74c \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc2e4\ud589\ud55c\ub2e4. \\n\\n*[setup_haproxy.sh](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts/blob/master/setup_haproxy.sh)  \\n\\n```sh\\n#!/bin/bash\\n\\ntouch /etc/sysctl.d/999-tanzu.conf\\nchmod +x /etc/sysctl.d/999-tanzu.conf\\n\\nIFS=$\'\\\\n\'\\nfor i in $(sysctl -a | grep rp_filter | grep 1);\\ndo\\n    SYSCTL_SETTING=$(echo ${i} | awk \'{print $1}\')\\n    # Update live system\\n    sysctl -w ${SYSCTL_SETTING}=0\\n    # Persist settings upon reboot\\n    echo \\"${SYSCTL_SETTING}=0\\" >> /etc/sysctl.d/999-tanzu.conf\\ndone\\n```\\n\\n> `Reverse Path Filtering`\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ud558\ub098\uc758 \uc778\uc2a4\ud134\uc2a4\uc5d0\uc11c \uc5ec\ub7ec\uac1c\uc758 \uc778\ud130\ud398\uc774\uc2a4\ub85c \ub4e4\uc5b4\uc624\ub294 \ud328\ud0b7\uc758 \uc18c\uc2a4IP\uc5d0 \ub300\ud574\uc11c \ub77c\uc6b0\ud305 \ud14c\uc774\ube14\uc744 \ud655\uc778\ud55c \ud6c4 \ud328\ud0b7\uc774 \ub4e4\uc5b4\uc628 \ub3d9\uc77c\ud55c \uc778\ud130\ud398\uc774\uc2a4\ub85c \ub2e4\uc2dc \ub098\uac00\ub294\uc9c0 \ud655\uc778\ud558\ub294 \uac83\uc744 \ub9d0\ud55c\ub2e4. `rp_filter`\uac00 1\ub85c \uc124\uc815\uc774 \ub418\uc5b4\uc788\uc73c\uba74, \ud2b9\uc815 \uc778\ud130\ud398\uc774\uc2a4\ub85c \ub4e4\uc5b4\uc628 \ud328\ud0b7 \uc815\ubcf4\uc640 OS\uc758 FIB(Forward Information Base)\uc5d0 \uc815\uc758\ub41c \uc815\ubcf4\uc640 \uc77c\uce58\ud558\uc9c0 \uc54a\uc744\uacbd\uc6b0, \ub4e4\uc5b4\uc628 \ud328\ud0b7\uc744 \ubc84\ub9ac\ub294 \uae30\ub2a5\uc744 \ud558\uae30 \ub54c\ubb38\uc5d0 \uc704 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \ud1b5\ud574 rp_filter \uac12\uc744 \ubaa8\ub450 0\uc73c\ub85c \ubcc0\uacbd\ud558\ub294 \uac83\uc774\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 [https://access.redhat.com/solutions/53031](https://access.redhat.com/solutions/53031)\ub97c \ucc38\uace0\ud558\uc790.\\n\\n## Content Library \uad6c\uc131\\n\\n`Content Library`\ub294 \ub808\ud3ec\uc9c0\ud1a0\ub9ac\uc758 \uac1c\ub150\uc73c\ub85c \uc5ec\ub7ec vApp \ud15c\ud50c\ub9bf\uacfc ISO \uc774\ubbf8\uc9c0 \ub4f1\uacfc \uac19\uc740 \ud30c\uc77c\ub4e4\uacfc \ucee8\ud14c\uc774\ub108 \uac1c\uccb4\ub97c \uc800\uc7a5\ud558\uace0 \uad00\ub9ac\ud560 \uc218 \uc788\ub294 \ub3c4\uad6c\uc774\ub2e4. \ub808\uc9c0\uc2a4\ud2b8\ub9ac(Registry)\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc `Content Library`\uc5d0\ub294 VM templates, OVA, OVF \ud30c\uc77c \ub4f1\uc774 \uc800\uc7a5\ub41c\ub2e4.  \\n\\n`Menu` -> `Content Libraries`\ub85c \uc774\ub3d9\ud574\uc11c \uc0c8\ub85c\uc6b4 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \ucd94\uac00\ub97c \ud55c\ub2e4. \uc774\ub984\uacfc vCenter Server\ub97c \uc120\ud0dd\ud558\uace0 2\ubc88\uc9f8 \ub2e8\uacc4\uc5d0\uc11c Subscribed content library\ub97c \uc120\ud0dd\ud558\uace0 `Subscription URL`\uc5d0 https://wp-content.vmware.com/v2/latest/lib.json \ub97c \uc785\ub825\ud558\uace0 3\ubc88\uc9f8 \ub2e8\uacc4\uc5d0\uc11c \uc800\uc7a5\ub420 \ub370\uc774\ud130\uc2a4\ud1a0\uc5b4\ub97c \uc120\ud0dd\ud558\uba74 \ub41c\ub2e4.  \\n\\n\uc2e4\uc81c \uc704 URL\uc740 `OVF Template` \uc5ec\ub7ec\uac1c\ub97c \ub2e4\uc6b4\ubc1b\ub294\ub370 Tanzu Cluster\ub0b4\uc5d0\uc11c Master\uc640 Worker Node\ub4e4\ub85c \uc4f0\uc77c Kubernetes 1.16 ~ 1.18\uae4c\uc9c0 \uc5ec\ub7ec\uac1c\uc758 VM\uc774\ubbf8\uc9c0 (photon OS)\ub4e4\uc774 \ucd94\uac00\uac00 \ub418\ub294\uac83\uc744 \uc54c \uc218 \uc788\ub2e4. \uc544\ub798 \uadf8\ub9bc\uc744 \ubcf4\uba74 \ud604\uc7ac Tanzu\uc5d0\uc11c \uc0ac\uc6a9\ub418\ub294 Kubernetes \ud074\ub7ec\uc2a4\ud130 \ubc84\uc804\uc774 1.18.5\ub77c\ub294 \uac83\uc744 \uc54c \uc218 \uc788\ub2e4.\\n\\n![tkg](/img/content_tkg.png)\\n\\n## Workload Management \uad6c\uc131\\n\\nWorkload Management\ub780 \uc27d\uac8c \uc0dd\uac01\ud558\uba74 vSphere \uae30\ubc18\uc5d0\uc11c Kubernetes \ud074\ub7ec\uc2a4\ud2b8\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub294 \uc5ed\ud560\uc744 \ud558\ub294 \ub3c4\uad6c\ub77c \ubcf4\uba74 \ub41c\ub2e4.  \\n\\nWorkload Management\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \uc5ed\ud560\uc744 \ud55c\ub2e4.  \\n\\n* Kubernetes \ud074\ub7ec\uc2a4\ud130\uc758 \ucef4\ud4e8\ud305, \uc2a4\ud1a0\ub9ac\uc9c0 \ub9ac\uc18c\uc2a4\uc5d0 \ub300\ud55c \uc0ac\uc774\uc9d5 \ubc0f \ub124\uc784\uc2a4\ud398\uc774\uc2a4 \uad00\ub9ac\\n* Kubernetes \ud074\ub7ec\uc2a4\ud130\uc758 \ub124\ud2b8\uc6cc\ud06c \ubc0f DNS, NTP \ubc0f VDS\uac19\uc740 \ub124\ud2b8\uc6cc\ud06c \uad00\ub9ac\\n* Kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0c1\uc138 \uc815\ubcf4 (Node \uac1c\uc218 \ubc0f \uc0c1\ud0dc \uc815\ubcf4)\\n\\nWorkload Management\uc5d0\uc11c \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\uc744 \uc2a4\ud06c\ub9bd\ud2b8\ub85c \uc9c4\ud589\ud558\uae30 \uc804\uc5d0 PowerCLI\ub97c \ud1b5\ud574 \uc811\uc18d \ud14c\uc2a4\ud2b8\ub97c \ud55c\ub2e4. \\n\\n```powershell\\nConnect-VIServer -Server vcsa.tanzu.local -User administrator@vsphere.local -Password VMware1!\\nConnect-CisServer -Server vcsa.tanzu.local -User administrator@vsphere.local -Password VMware1!\\n```\\n\\n\uadf8\ub9ac\uace0 PowerCLI Workload Management \ubaa8\ub4c8\uc744 \uc124\uce58\ud558\uace0 \uc5ec\ub7ec \ud658\uacbd\ubcc0\uc218\ub4e4\uc744 \uc124\uc815\ud55c\ub2e4. \uae30\uc874\uc5d0 \uc0ac\uc6a9\ud55c \uc815\ubcf4\ub4e4\uacfc \uc704\uc5d0\uc11c \ub9cc\ub4e0 Content Library \uc774\ub984\uc73c\ub85c \ubcc0\uacbd\ud558\uace0 \uc2e4\ud589\ud55c\ub2e4.  \\n\\n```powershell\\nImport-Module VMware.WorkloadManagement\\n\\n$vSphereWithTanzuParams = @{\\n    ClusterName = \\"Tanzu-Cluster\\";\\n    TanzuvCenterServer = \\"vcsa.tanzu.local\\";\\n    TanzuvCenterServerUsername = \\"administrator@vsphere.local\\";\\n    TanzuvCenterServerPassword = \\"VMware1!\\";\\n    TanzuContentLibrary = \\"TKG\\"; # Content Library \uc774\ub984\\n    ControlPlaneSize = \\"TINY\\";\\n    MgmtNetwork = \\"Management\\";\\n    MgmtNetworkStartIP = \\"192.168.0.220\\";\\n    MgmtNetworkSubnet = \\"255.255.255.0\\";\\n    MgmtNetworkGateway = \\"192.168.0.1\\";\\n    MgmtNetworkDNS = @(\\"192.168.0.201\\");\\n    MgmtNetworkDNSDomain = \\"tanzu.local\\";\\n    MgmtNetworkNTP = @(\\"162.159.200.123\\");\\n    WorkloadNetwork = \\"Workload\\";\\n    WorkloadNetworkStartIP = \\"10.20.0.10\\";\\n    WorkloadNetworkIPCount = 20;\\n    WorkloadNetworkSubnet = \\"255.255.255.0\\";\\n    WorkloadNetworkGateway = \\"10.20.0.1\\";\\n    WorkloadNetworkDNS = @(\\"192.168.0.201\\");\\n    WorkloadNetworkServiceCIDR = \\"10.96.0.0/24\\";\\n    StoragePolicyName = \\"Tanzu-Storage-Policy\\";\\n    HAProxyVMvCenterServer = \\"vcsa.tanzu.local\\";\\n    HAProxyVMvCenterUsername = \\"administrator@vsphere.local\\";\\n    HAProxyVMvCenterPassword = \\"VMware1!\\";\\n    HAProxyVMName = \\"haproxy.tanzu.local\\";\\n    HAProxyIPAddress = \\"192.168.0.203\\";\\n    HAProxyRootPassword = \\"VMware1!\\";\\n    HAProxyPassword = \\"VMware1!\\";\\n    LoadBalancerStartIP = \\"10.10.0.64\\";\\n    LoadBalancerIPCount = 64\\n}\\nNew-WorkloadManagement2 @vSphereWithTanzuParams\\n```\\n\\n\ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\ub294 \uc2dc\uac04\uc740 \uc57d 40\ubd84 \uc774\uc0c1 \uc18c\uc694\ub418\ub294\ub370 Tanzu-Cluster\uc758 Control Plane Node (Master Node) \uc0dd\uc131\uc774 \uc644\ub8cc\ub418\uba74 IP\uac00 10.10.0.64(HAProxy Load Balancer\uc5d0\uc11c \ud560\ub2f9\ub41c \uccab\ubc88\uc9f8 \uc8fc\uc18c)\ub85c \ud560\ub2f9\uc774 \ub418\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n\ub2e4\uc74c\uc740 Namespace\ub97c \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc744 \uc9c4\ud589\ud55c\ub2e4. `Workload Management`\uc5d0\uc11c `NEW NAMESPACE`\uba54\ub274\ub97c \ud074\ub9ad\ud558\uace0 \uc704\uc5d0\uc11c \uc0dd\uc131\ud55c `Tanzu-Cluster`\ub97c \uc120\ud0dd\ud558\uace0 \uc774\ub984(test)\uc744 \uc785\ub825\ud558\uace0 Namespace\ub97c \uc0dd\uc131\ud55c\ub2e4. \\n\\n![tkg_permission](/img/tkg_permission.png)\\n\\n## Cluster \uc811\uc18d  (Kubernetes CLI)\\n\\n\uc0dd\uc131\ub41c\uac78 \ud655\uc778\ud55c \ud6c4 \ube0c\ub77c\uc6b0\uc800\uc5d0 \ud574\ub2f9 \ud074\ub7ec\uc2a4\ud130\uc758 Control Plane IP (https://10.10.0.64)\ub85c \uc811\uc18d\ud558\uba74 OS\ubcc4(Linux, MacOS, Windows)\ub85c CLI \ud50c\ub7ec\uadf8\uc778\uc744 \uc124\uce58\ud560 \uc218 \uc788\ub2e4.  \\n\\n\uc124\uce58 \ubc0f PATH \uc124\uc815\uc744 \uc9c4\ud589\ud558\uace0 \uc544\ub798\uc640 \uac19\uc774 Control Plane\uc73c\ub85c CLI \ub85c\uadf8\uc778\uc744 \ud558\uba74 \ud604\uc7ac \uc124\uc815\ub41c Context \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4. \\n\\n```sh\\n> kubectl vsphere login --server=10.10.0.64 -u administrator@vsphere.local --insecure-skip-tls-verify\\n\\n        \ud83e\udd73vSphere with Tanzu Basic Cluster enabled by William Lam\'s Script \ud83e\udd73\\n\\nPassword:\\nLogged in successfully.\\n\\nYou have access to the following contexts:\\n   10.10.0.64\\n   docker-desktop\\n   nexclipper\\n   test\\n\\nIf the context you wish to use is not in this list, you may need to try\\nlogging in again later, or contact your cluster administrator.\\n\\nTo change context, use `kubectl config use-context <workload name>`\\n```\\n\\n```sh\\n> kubectl config use-context nexclipper\\nSwitched to context \\"nexclipper\\".\\n\\n> kubectl get nodes\\nNAME                               STATUS   ROLES    AGE     VERSION\\n422f46864113e3de3361943d14073728   Ready    master   4d21h   v1.18.2-6+38ac483e736488\\n422faddc15554b09d82907c0dfb57752   Ready    master   4d21h   v1.18.2-6+38ac483e736488\\n```\\n\\nnexclipper namespace\ub85c context\ub97c \uc804\ud658\ud558\uace0 node\ub97c \ud655\uc778\ud558\uba74 master node\ub97c 2\uac1c \ud655\uc778\ud560 \uc218 \uc788\ub294\ub370 \uc774\ub294 `nexclipper`\ub77c\ub294 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \ucd1d\uad04\ud558\ub294 Super Master(Control Plane) \uac19\uc740 \uac1c\ub150\uc774\ub77c\uace0 \ubcfc \uc218 \uc788\ub2e4. \ucc98\uc74c\uc5d0 \ud074\ub7ec\uc2a4\ud130 \ubc30\ud3ec\uc804\uc5d0 Namespace \ub9ac\uc18c\uc2a4\ub97c \ub9cc\ub4e4\uae38\ub798 \ub2e4\uc18c \ud5f7\uac08\ub9ac\uae34 \ud588\uc9c0\ub9cc Tanzu\uc5d0\uc11c\uc758 Namespace\ub294 \uae30\uc874 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc758 \ub9ac\uc18c\uc2a4\ub97c \ub17c\ub9ac\uc801\uc73c\ub85c \ub098\ub204\ub294 \ucee8\uc149\uc774 \uc544\ub2cc, \uc815\ud574\uc9c4 \ub9ac\uc18c\uc2a4\uc640 \uc720\uc800\uc640 \uadf8\ub8f9\uc758 \uad8c\ud55c\uc744 \uba3c\uc800 Namespace\ub85c \ud560\ub2f9\ud558\uace0 \uadf8\ub2f4\uc5d0 \ub2e4\uc2dc \uc870\uc9c1\uc774\ub098 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ubcc4\ub85c Kubernetes Workload\ub97c \ub2e4\uc2dc \uc81c\uacf5\ud558\ub294 \ucee8\uc149\uc774\ub77c\uace0 \ubcf4\uba74\ub41c\ub2e4.  \\n\\n\ucd5c\uadfc\uc5d0 `SKT`\ub098 `Kakao Enterprise` \ucc98\ub7fc \ucfe0\ubc84\ub124\ud2f0\uc2a4 \ud074\ub7ec\uc2a4\ud130\uc758 \ub77c\uc774\ud504\uc0ac\uc774\ud074\uc744 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub85c \uad00\ub9ac\ud558\ub294 \ucee8\uc149\uc73c\ub85c \uc774\ud574\ud558\uba74 \uc88b\ub2e4. \uc544\ub798 \uadf8\ub9bc\uc744 \ucc38\uace0\ud558\uba74 \uc27d\uac8c \uc774\ud574\ud560 \uc218 \uc788\uc744 \uac83\uc774\ub2e4.  \\n\\n![tanzu](https://docs.vmware.com/en/VMware-vSphere/7.0/vmware-vsphere-with-tanzu/img/GUID-DF8905E1-C098-4882-BFC1-B0BAC668B424-high.png)  \\n\ucc38\uc870 : https://docs.vmware.com/en/VMware-vSphere/7.0/vmware-vsphere-with-tanzu/img/GUID-DF8905E1-C098-4882-BFC1-B0BAC668B424-high.png\\n\\nTanzuKubernetesCluster CRD\ub97c \ud1b5\ud574 \ud074\ub7ec\uc2a4\ud130\ub97c \uc2e0\uaddc\ub85c \uc0dd\uc131\ud55c\ub2e4.  \\n`namespace: nexclipper`\ub85c \uc124\uc815\ud558\uace0 \uc6d0\ud558\ub294 \ubc30\ud3ec \ubc84\uc804\uacfc \uc774\ub984, CNI, Control Plane, Worker Node \uac1c\uc218 \ub4f1\uc744 \uae30\uc7ac\ud558\uac8c \ub418\ub294\ub370 \ud2b9\uc774\ud55c \uac83\uc740 CNI\ub294 [Antrea](https://github.com/vmware-tanzu/antrea)\ub97c \uc0ac\uc6a9\ud558\ub294\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n```yaml\\napiVersion: run.tanzu.vmware.com/v1alpha1\\nkind: TanzuKubernetesCluster\\nmetadata:\\n  name: nexclipper-cluster\\n  namespace: nexclipper\\nspec:\\n  distribution:\\n    version: v1.17.8+vmware.1-tkg.1.5417466\\n  settings:\\n    network:\\n      cni:\\n        name: antrea\\n      pods:\\n        cidrBlocks:\\n        - 193.0.2.0/16\\n      serviceDomain: managedcluster.local\\n      services:\\n        cidrBlocks:\\n        - 195.51.100.0/12\\n  topology:\\n    controlPlane:\\n      class: best-effort-xsmall\\n      count: 1\\n      storageClass: tanzu-storage-policy\\n    workers:\\n      class: best-effort-xsmall\\n      count: 1\\n      storageClass: tanzu-storage-policy\\n```\\n\\n\uc2e0\uaddc TKG \ud074\ub7ec\uc2a4\ud130\ub97c \ubc30\ud3ec\ud55c\ub2e4. \\n\\n```sh\\n> kubectl apply -f tkc.yaml  \\n\\ntanzukubernetescluster.run.tanzu.vmware.com/nexclipper-cluster created\\n```\\n\\n\ubc30\ud3ec\ud558\uace0 tanzukubernetescluster \ub97c \uc870\ud68c\ud574\ubcf4\uba74 Control Plane 1\uac1c, Worker Node 1\uac1c\uc758  v1.17.8 \ubc84\uc804\uc758 \ud074\ub7ec\uc2a4\ud130\uac00 \ubc30\ud3ec\ub41c\uac83\uc744 \uc54c \uc218 \uc788\ub2e4. \\n\\n```\\n> kubectl get tanzukubernetescluster\\nNAME                 CONTROL PLANE   WORKER   DISTRIBUTION                     AGE   PHASE\\nnexclipper-cluster   1               1        v1.17.8+vmware.1-tkg.1.5417466   33m   running\\n```\\n\\n\uc0dd\uc131\ud55c tanzukubernetescluster\ub85c \uc811\uc18d\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 \uc815\ubcf4\ub97c \ud655\uc778\ud55c\ub2e4.\\n\\n```\\n> kubectl-vsphere login --server=10.10.0.64 -u administrator@vsphere.local --insecure-skip-tls-verify --tanzu-kubernetes-cluster-name nexclipper-cluster --tanzu-kubernetes-cluster-namespace nexclipper\\n\\n> kubectl config use-context nexclipper-cluster\\nSwitched to context \\"nexclipper-cluster\\".\\n\\n> kubectl get nodes\\nNAME                                                STATUS   ROLES    AGE     VERSION\\nnexclipper-cluster-control-plane-95nhv              Ready    master   3h10m   v1.17.8+vmware.1\\nnexclipper-cluster-workers-kp68q-78df45db5c-jzmmv   Ready    <none>   3h6m    v1.17.8+vmware.1\\n```\\n\\n\uc0dd\uc131\ud55c \ud074\ub7ec\uc2a4\ud130\uc5d0 \uac04\ub2e8\ud55c \uc571\uc744 \ubc30\ud3ec\ud55c\ub2e4.  \\n[Kubedoom](https://github.com/storax/kubedoom)\uc740 Doom \uac8c\uc784\ub0b4\uc5d0\uc11c \uc560\ud50c\ub9ac\ucf00\uc774\uc158(\uad34\ubb3c)\uc744 \uc77c\ubd80\ub7ec \uc885\ub8cc\uc2dc\ucf1c \ubcf5\uc6d0\uc131\uc744 \ubcf4\uac8c\ud558\ub294 \uc7ac\ubbf8\uc788\ub294 \uc571\uc774\ub2e4.\\n\\n```\\n> git clone https://github.com/storax/kubedoom.git\\n> cd kubedoom\\n> kubectl apply -f manifest/\\n> kubectl -n kubedoom port-forward deployment/kubedoom 5900:5900\\nForwarding from 127.0.0.1:5900 -> 5900\\nForwarding from [::1]:5900 -> 5900\\n```\\n\\n\ubc30\ud3ec\ud55c\ud6c4\uc5d0 \ud3ec\ud2b8\ud3ec\uc6cc\ub529\uc744 \ud55c \uc571\uc73c\ub85c VNC viewer\ub85c \uc811\uc18d\ud558\uba74 \uc7ac\ubbf8\uc788\ub294 \ud654\uba74\uc744 \ubcfc \uc218 \uc788\uc744 \uac83\uc774\ub2e4. VNC \ud328\uc2a4\uc6cc\ub4dc\ub294 `idbehold`\uc774\ub2e4.\\n\\n![doom](/img/doom.png)\\n\\n## Tanzu \uc7a5\ub2e8\uc810 (\uac1c\uc778\uc758\uacac)\\n\\n\ud558\ub4dc\uc6e8\uc11c \uace0\ubbfc, \uad6c\ub9e4, ESXi \uc124\uce58, vCenter, TKG\uc744 \uc124\uce58\ud558\uace0 \uc544\ud0a4\ud14d\ucc98\ub4e4\uc744 \ucc3e\uc544\ubcf4\uba74\uc11c \uba87\uac00\uc9c0 \uc7a5\ub2e8\uc810\uc774 \ub208\uc5d0 \ubcf4\uc600\ub294\ub370 \uac00\uc7a5 \ud070 \uc7a5\uc810\uc740 \ud558\ub098\uc758 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub97c \ub9cc\ub4e4\uc5b4 Super Master(Control Plane)\ub97c \uba3c\uc800 \uad6c\uc131\ud558\uace0 \uc790\uc6d0(\ucef4\ud4e8\ud305, \ub124\ud2b8\uc6cc\ud06c, \uc2a4\ud1a0\ub9ac\uc9c0 \ub4f1)\uacfc \uae30\uc874\uc5d0 \ubcf4\uc720\ud558\uace0 \uc788\ub294 \uad8c\ud55c \uccb4\uacc4\ub85c \ud560\ub2f9\uc744 \ud55c \ub4a4 \ud544\uc694\ud560\ub54c \ub9c8\ub2e4 \ud2b9\uc815 \ud300\uc774\ub098 \uc870\uc9c1\uc5d0\uac8c \ubcc4\ub3c4\uc758 \ud074\ub7ec\uc2a4\ud130\ub97c \ud560\ub2f9\ud558\ub294 \uc544\ud0a4\ud14d\ucc98\ub97c \ucd94\uad6c\ud558\uace0 \uc788\uc5b4 VMware \ud658\uacbd\uc5d0\uc11c Kubernetes\ub97c \uc2e0\uaddc \ub3c4\uc785\ud558\uace0 \uc5d4\ud130\ud504\ub77c\uc774\uc988\uc5d0 \uc801\uc6a9\ud558\uae30 \uc6a9\uc774\ud558\ub2e4\ub294 \uc810\uc774\ub2e4.  \\n\\n\ub610\ud55c \uae30\ubcf8\uc801\uc73c\ub85c \uac16\ucdb0\uc57c \ud558\ub294 Security Policy\ub098 \ub9ac\uc18c\uc2a4 \ud560\ub2f9\uc774 \ud074\ub7ec\uc2a4\ud130 \uad6c\ucd95\uc774\ud6c4\uc5d0 \ub418\ub294 \uac83\uc774 \uc544\ub2c8\ub77c \uc774\ubbf8 \uc815\uc758\ub41c \uaddc\uce59\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130 \uad6c\uc131\uc774 \uc774\ud6c4\uc5d0 \uc9c4\ud589\ub418\uae30 \ub54c\ubb38\uc5d0 \uad00\ub9ac\uc801\uc778 \uce21\uba74\uc5d0\uc11c\ub3c4 \uc7a5\uc810\uc774 \uc788\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4. \\n\\n\ud558\uc9c0\ub9cc \uac1c\uc778\uc801\uc73c\ub85c \uc0dd\uac01\ud558\ub294 \ub2e8\uc810\ub4e4\ub3c4 \uba87\uac00\uc9c0 \uc788\ub294\ub370 \uccab\ubc88\uc9f8\ub294 \uc6a9\uc5b4\uc758 \uc911\ubcf5\uc73c\ub85c \uc778\ud55c \ud63c\ub3d9\uc774 \uc788\uc5c8\ub2e4\ub294\uc810\uc774\ub2e4. \ub124\uc784\uc2a4\ud398\uc774\uc2a4\ub098 \uae30\uc874 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \ub9ce\uc774 \uc0ac\uc6a9\ub418\ub294 \uc6a9\uc5b4\ubcf4\ub2e4\ub294 VMware\uc5d0\uc11c \ub9cc\ub4e0 CRD\ub4f1\uc744 \ubbf8\ub9ac \ud559\uc2b5\ud558\uac70\ub098 \uc54c\uace0 \uc788\uc9c0 \uc54a\uc73c\uba74 \uae30\uc874 \uacbd\ud5d8\uc774 \uc788\ub294 \uc720\uc800\ub3c4 \uc811\uadfc\uc131\uc774 \ub5a8\uc5b4\uc9c8 \uac83 \uac19\ub2e4\ub294 \uc0dd\uac01\uc774 \ub4e4\uc5c8\ub2e4. \\n\\n\ube44\uc6a9 \uce21\uba74\uc5d0\uc11c\ub294 \uc77c\ub2e8 `vCenter` \uc774\uc678\uc5d0 `Workload Management` \ub77c\uc774\uc13c\uc2a4\uac00 \ubcc4\ub3c4\ub85c \ud544\uc694\ud558\uae30 \ub54c\ubb38\uc5d0 \uc790\uc138\ud788 \uc54c\uc544\ubcf4\uc9c4 \uc54a\uc558\uc9c0\ub9cc \uc801\uc9c0 \uc54a\uc740 \ube44\uc6a9\uc774 \ub4e4 \uac83\uc73c\ub85c \uc608\uc0c1\ub41c\ub2e4. \uac8c\ub2e4\uac00 \ub9ce\uc740 \uad6c\uc131\uc694\uc18c\ub85c \uc778\ud55c \uc790\uc6d0\uc774 \uc18c\uc694\uac00 \uc788\uc5b4 \ud558\ub098\uc758 \uc791\uc740 \ud074\ub7ec\uc2a4\ud130\ub9cc \ub744\uc6e0\uc74c\uc5d0\ub3c4 64GB \uba38\uc2e0\uc758 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc774 \uac70\uc758 60GB\uc5d0 \uc721\ubc15\ud588\uae30 \ub54c\ubb38\uc5d0 \uae30\uc874 \uc778\ud504\ub77c \ube44\uc6a9\uc5d0 \ucd94\uac00\uc801\uc778 \ube44\uc6a9\uc5d0 \ub300\ud55c \uace0\ub824\uac00 \ubc18\ub4dc\uc2dc \ud544\uc694\ud560 \uac83 \uac19\ub2e4. \\n\\n\uc704\uc5d0\ub3c4 \uc5b8\uae09\ud588\uc9c0\ub9cc \ub7ec\ub2dd\ucee4\ube0c\uc5d0 \ub300\ud55c \ubd80\ubd84\ub3c4 \ubb38\uc81c\uc810\uc774 \ub420 \uc218 \uc788\uc744\uac83\uc774\ub2e4. NSX\uae30\ubc18\uc758 \uc0c8\ub85c\uc6b4 CNI\ubfd0\ub9cc \uc544\ub2c8\ub77c \uae30\uc874 VMware \uc6b4\uc601\uc744 \ud558\ub358 DevOps\ud300\uc774\ub098 \uc778\ud504\ub77c \uc6b4\uc601\uc870\uc9c1\uc758 \ub7ec\ub2dd\ucee4\ube0c, \ucd94\uc0c1\ud654 \ub808\ubca8\uc774 \ub192\uc544\uc838\uc11c \ub0b4\uac00 \uc6d0\ud558\ub294 \ud074\ub7ec\uc2a4\ud130\uc758 \uc774\ubca4\ud2b8\ub098 \ub85c\uadf8\ub97c \ud655\uc778\ud560 \ub54c \ud0d0\uc0c9\uc801\uc73c\ub85c \uba54\ub274\ub97c \ucc3e\uae30\uac00 \uc27d\uc9c0 \uc54a\uc740 \ubd80\ubd84\ub4e4\uc774 \uc788\uc5c8\ub2e4. \uadf8\ub798\uc11c \ud2b8\ub7ec\ube14\uc288\ud305 \ub54c\uc5d0\ub3c4 \ub85c\uadf8\uc758 \uc6d0\ucc9c\uc744 \ucc3e\ub294\ub370 \uc2dc\uac04\uc774 \ub2e4\uc18c \uac78\ub9ac\uae30\ub3c4 \ud588\ub2e4. \\n\\n\\n## \uc815\ub9ac\\n\\n\ud55c \uc77c\uc8fc\uc77c\ub3d9\uc548 \uc2a4\ud1a0\ub9ac\uc9c0 \uc624\ub958\ub85c \uc528\ub984\ud558\ub2e4\uac00 \uaca8\uc6b0 \uc571\uc744 \ubc30\ud3ec\ud588\uc9c0\ub9cc \uac70\uc758 2\uc8fc\ub3d9\uc548 \uc7ac\ubbf8\uc788\uac8c \uad6c\uc131\ud574\ubcfc\uc218 \uc788\uc5c8\ub2e4. \uc194\uc9c1\ud788 \uc774\uc57c\uae30\ud558\uc790\uba74 \uac1c\uc778 \ud074\ub7ec\uc2a4\ud130\ub85c \uad6c\uc131\ud558\ub294\ub370\ub294 \ucd94\ucc9c\ud558\uc9c0 \uc54a\uc9c0\ub9cc Tanzu\ub97c \uacf5\ubd80\ud558\uace0 \uc6b4\uc601\ud574\uc57c \ud558\ub294 \uacbd\uc6b0\ub098 \uc790\uaca9\uc99d\uc744 \ucde8\ub4dd\ud558\ub294 \ubd80\ubd84\uc774 \ud544\uc694\ud558\ub2e4\uba74 \ud55c\ubc88\ucbe4\uc740 \ud574\ubcfc \uac00\uce58\uac00 \uc788\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4.  \\n\\n\uac70\uc758 1\ub144\ub9cc\uc5d0 \ud3ec\uc2a4\ud305\uc744 \uc791\uc131\ud588\ub294\ub370 \ub2e4\uc74c \ud3ec\uc2a4\ud305\uc5d0\ub294 Security Policy \uad00\ub828\ud55c \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud558\uba74\uc11c \uc5f0\ub9d0\uc744 \uc815\ub9ac\ud574\ubcfc \uc0dd\uac01\uc774\ub2e4."},{"id":"kubernetes/vSphere-with-Tanzu-homelab/","metadata":{"permalink":"/kubernetes/vSphere-with-Tanzu-homelab/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2020-11-30-vSphere-with-Tanzu-homelab.md","source":"@site/blog/2020-11-30-vSphere-with-Tanzu-homelab.md","title":"vSphere with Tanzu homelab running on ASUS PN50 (1/2)","description":"\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 Tanzu Cluster\ub97c \ub2e8\uc77c \ud648\ub7a9 vSphere \uc11c\ubc84\uc5d0 \uc62c\ub824\ubcf8\ub2e4","date":"2020-11-30T00:00:00.000Z","formattedDate":"November 30, 2020","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Tanzu","permalink":"/tags/tanzu"},{"label":"vSphere","permalink":"/tags/v-sphere"},{"label":"Homelab","permalink":"/tags/homelab"},{"label":"ASUS","permalink":"/tags/asus"},{"label":"PN50","permalink":"/tags/pn-50"}],"readingTime":18.245,"truncated":true,"authors":[],"frontMatter":{"layout":"single","title":"vSphere with Tanzu homelab running on ASUS PN50 (1/2)","comments":true,"classes":"wide","description":"\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 Tanzu Cluster\ub97c \ub2e8\uc77c \ud648\ub7a9 vSphere \uc11c\ubc84\uc5d0 \uc62c\ub824\ubcf8\ub2e4","slug":"kubernetes/vSphere-with-Tanzu-homelab/","date":"2020-11-30T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","Tanzu","vSphere","Homelab","ASUS","PN50"]},"prevItem":{"title":"vSphere with Tanzu homelab running on ASUS PN50 (2/2)","permalink":"/kubernetes/vSphere-with-Tanzu-homelab-2/"},"nextItem":{"title":"2019 Retrospective","permalink":"/retrospective/2020plan/"}},"content":"\uc2a4\ud0c0\ud2b8\uc5c5\uc73c\ub85c \uc774\uc9c1\ud6c4 \uc815\uc2e0\uc5c6\ub294 6\uac1c\uc6d4\uc744 \ubcf4\ub0c8\uace0 \uc9d1\uc5d0\uc11c \ud558\ub294 \uc0ac\uc774\ub4dc \ud504\ub85c\uc81d\ud2b8\ub098 \uacf5\ubd80\ud558\ub294 \uac83\ub4e4\uc774 \uc18c\ud640\ud574\uc9c0\ub294\uac83 \uac19\uc544 \ub9c8\uc74c\uc744 \ub2e4\uc7a1\uace0\uc790 \uc791\uc131\ud558\ub294 \ud3ec\uc2a4\ud305\uc774\ub2e4. \ucd5c\uadfc \uba87\uac1c\uc6d4 \uac04\uc740 \ud68c\uc0ac \ube14\ub85c\uadf8 \uae00\ub9cc \uc791\uc131\ud558\ub2e4\ubcf4\ub2c8 \uac1c\uc778 \ube14\ub85c\uadf8\ub97c \uac70\uc758 \ubabb\ud558\uace0 \uc788\uc5b4\uc11c \ud68c\uc0ac \uc81c\ud488\uacfc\ub294 \uc544\uc9c1\uae4c\uc9c0 \uac70\ub9ac\uac00 \uc788\ub294 \ud50c\ub7ab\ud3fc \uacf5\ubd80\ucc28 \uc791\uc131\ud55c\ub2e4. \uc21c\uc218\ud558\uac8c \uc815\ubcf4\uacf5\uc720\ucc28 \uc791\uc131\ud558\ub294 \uac83\uc774\uba70, \ud2b9\uc815\ud68c\uc0ac\uc758 \ud68c\uc0ac\uc758 \uc81c\ud488\uc774\ub098 \ud50c\ub7ab\ud3fc\uc744 \ud64d\ubcf4\ud558\uace0\uc790 \ud568\uc740 \uc544\ub2c8\ub2e4.\\n\\n\x3c!--truncate--\x3e\\n\\n## Tanzu\\n\\n[https://tanzu.vmware.com/content/blog/simplify-your-approach-to-application-modernization-with-4-simple-editions-for-the-tanzu-portfolio](https://tanzu.vmware.com/content/blog/simplify-your-approach-to-application-modernization-with-4-simple-editions-for-the-tanzu-portfolio)  \\n\\nTanzu\ub294 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uac1c\ubc1c, \uad6c\ub3d9, \uc6b4\uc601\ud558\ub294 \ubaa8\ub4e0 \ucee8\ud14c\uc774\ub108 \ud658\uacbd\uc744 \ud1b5\ud569 \uad00\ub9ac\ud558\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\ub97c \uc0c1\uc6a9\ud654 \ud55c \uc81c\ud488\uc73c\ub85c \uc774\ud574\ud558\ub294 \uac83\uc774 \uac00\uc7a5 \uc27d\ub2e4. \\n\\n![tanzu](/img/tanzu.png)  \\n(\ucd9c\ucc98 : VM\uc6e8\uc5b4 \ucf54\ub9ac\uc544 \ubc1c\ud45c\uc790\ub8cc \uac08\ubb34\ub9ac)\\n\\n\ud3ec\ud2b8\ud3f4\ub9ac\uc624\ub97c \uac04\ub2e8\ud788 \uc0b4\ud3b4\ubcf4\uba74 \uae30\uc874 \uc778\ud504\ub77c\ub97c \uad6c\uc131\ud558\ub294 \ub808\uc774\uc5b4\uc778 vSphere \uc704\uc5d0 `VMware Tanzu Kubernetes Grid`\ub97c \ubcfc \uc218 \uc788\ub2e4.  \\n\\n\uc624\ub298\uc740 \uae30\uc874 Pivotal \uc774\ub098 Spring Boot\ub97c \uc81c\uc678\ud55c \ud50c\ub7ab\ud3fc \ub808\uc774\uc5b4\uc758 TKG(Tanzu Kubernetes Grid)\ub97c \ud648\ub7a9\uc73c\ub85c \uad6c\uc131\ud558\ub294 \uacfc\uc815\uc744 \uc815\ub9ac\ud588\ub2e4. \\n\\n\ubaa8\ub4e0 \uacfc\uc815\uc740 virtuallyGhetto \ube14\ub85c\uadf8\ub97c \ucc38\uace0\ud558\uc5ec \uc791\uc131\ud588\uace0 \uac00\uc7a5 \ub530\ub77c\ud55c \ubd80\ubd84\uc740 \uc544\ub798 \ud3ec\uc2a4\ud305\uc774\ub2c8 NUC\uc73c\ub85c \uad6c\uc131\ud558\ub824\uba74 \uc6d0\ubb38\uc744 \ucc38\uace0\ud558\uba74 \ub41c\ub2e4.  \\n[https://www.virtuallyghetto.com/2020/11/complete-vsphere-with-tanzu-homelab-with-just-32gb-of-memory.html#comments](https://www.virtuallyghetto.com/2020/11/complete-vsphere-with-tanzu-homelab-with-just-32gb-of-memory.html#comments)\\n\\n## \uc900\ube44\uc0ac\ud56d(Hardware)\\n\\n* ASUS PN50  \\n  [https://www.asus.com/kr/Mini-PCs/Mini-PC-PN50/](https://www.asus.com/kr/Mini-PCs/Mini-PC-PN50/)\\n\\n  PN50 \ubca0\uc5b4\ubcf8\uc744 \uc120\ud0dd\ud55c \uc774\uc720\ub294 \uc77c\ub2e8 AMD Ryzen 4800u CPU\uac00 \uc800\uc804\ub825\uc778\ub370\ub3c4 \ubd88\uad6c\ud558\uace0 8\ucf54\uc5b4 16\uc2a4\ub808\ub4dc, 64GB sodimm\uc774 \uc9c0\uc6d0\ub418\uba70, 2.5\uc778\uce58\uc640 M.2 SSD\uac00 \ub3d9\uc2dc \uc7a5\ucc29\uc774 \uac00\ub2a5\ud558\ub2e4\ub294 \uc810\uc774\ub2e4. \uc628\ubcf4\ub4dc NIC \ub4dc\ub77c\uc774\ubc84\uac00 vSphere 7.0\uc5d0\uc11c \uc9c0\uc6d0\ub418\uc9c0 \uc54a\uc9c0\ub9cc USB Network Adapter\ub97c \ud1b5\ud574 \uad6c\uc131\uc774 \uac00\ub2a5\ud588\uae30 \ub54c\ubb38\uc5d0 \ub9dd\uc124\uc784 \uc5c6\uc774 \uad6c\ub9e4\ub97c \uacb0\uc815\ud588\ub2e4. \uad6c\uc785\uc740 \ub124\uc774\ubc84 \uac80\uc0c9(asus pn50 4800u)\uc744 \ud1b5\ud574 71\ub9cc\uc6d0 \uc815\ub3c4\uc5d0 \uad6c\ub9e4\ub97c \ud588\ub2e4. \uc774\ub3c4 \uc2a4\ub9c8\uc77c \uce90\uc2dc\ub97c \uc9c1\uc811 \uad6c\ub9e4\ud574\uc11c \uc2e4\uc81c \uad6c\ub9e4\uae08\uc561\uc740 65\ub9cc\uc6d0 \uc815\ub3c4\uac00 \uc18c\uc694\ub418\uc5c8\ub2e4.\\n\\n* SODIMM DDR4 32G PC4-25600 (TeamGroup)  \\n  \ud574\ub2f9 \uc81c\ud488\uc740 \uac00\uc131\ube44\ub85c \uac00\uc7a5 \uc800\ub834\ud558\uac8c \uc0b4 \uc218 \uc788\ub294 \uad6d\ub0b4 \uc6cc\ub7f0\ud2f0\uac00 \uac00\ub2a5\ud55c SODIMM \uba54\ubaa8\ub9ac\ub85c 32G 2\uac1c\ub97c \uad6c\ub9e4\ud588\uc73c\uba70 \ub124\uc774\ubc84 \uac80\uc0c9\uc73c\ub85c 2\uac1c 25\ub9cc\uc6d0 \uc815\ub3c4\ub85c \uad6c\ub9e4\ud588\ub2e4.\\n\\n* 2.5 SSD (ADATA SU655 240GB)  \\n  ESXi \uc11c\ubc84 \uc124\uce58\uc6a9\uc73c\ub85c \uc0ac\uc6a9\ud558\uae30 \uc704\ud574 \uae30\uc874\uc5d0 \uac16\uace0 \uc788\ub358 ADATA SU655 240GB\ub97c \uc0ac\uc6a9\ud588\uace0 \ud604\uc7ac 3.5\ub9cc\uc6d0 \uc815\ub3c4\uc5d0 \uad6c\ub9e4\uac00\ub2a5\ud558\ub2e4. \\n\\n* M.2 SSD (WD BLACK SN750 M.2 NVMe 500GB)  \\n  \uc544\ub9c8\uc874\uc5d0\uc11c \uc9c1\uad6c\ud55c \ub140\uc11d\uc73c\ub85c 69.99\ub2ec\ub7ec \uc18c\uc694\ub418\uc5c8\ub2e4. \ubc30\ub300\uc9c0 \uac00\uaca9\uc744 \ud569\uce58\uba74 8.5\ub9cc\uc6d0 \uc815\ub3c4 \uc18c\uc694\ub418\uc5c8\ub2e4. \\n\\n* Gigabit USB Lancard (tplink UE300C)  \\n  ESXi 7.0\ubc84\uc804\uc5d0\uc11c \uc628\ubcf4\ub4dc NIC \uc778\uc2dd\uc774 \ubd88\uac00\ub2a5\ud55c \uc774\uc720\ub85c \ubcc4\ub3c4\ub85c \uae30\uae30\ube44\ud2b8 \uc720\uc120 \ub79c\uce74\ub4dc\ub97c \uad6c\ub9e4\ud588\ub2e4. 1.5\ub9cc\uc6d0 \uc815\ub3c4\uc5d0 \uad6c\ub9e4\uac00\ub2a5 \ud558\uace0 3\ub144 \ubcf4\uc99d\uc774 \ub418\ub294 TPLINK\uc81c\ud488\uc73c\ub85c \uc120\ud0dd\ud558\uc600\ub2e4.  \\n  [https://coupa.ng/bM0lN8](https://coupa.ng/bM0lN8) -> `\ud574\ub2f9 \ub9c1\ud06c\ub97c \ud1b5\ud574 \uad6c\ub9e4\ud558\uba74 \uc800\uc5d0\uac8c \ucfe0\ud321 \ud30c\ud2b8\ub108\uc2a4\ub97c \ud1b5\ud574 \uc801\ub9bd\uae08\uc774 \uc9c0\uae09\ub418\ub2c8 \ud544\uc694\ud558\uc2e0 \ubd84\uc740 \uc544\ub798\ub97c \ud1b5\ud574 \uad6c\ub9e4\ub97c \ubd80\ud0c1\ub4dc\ub9bd\ub2c8\ub2e4`\\n\\n\uc2e4\uc81c \uc704 \uc2a4\ud399\uc73c\ub85c \ub300\ucda9 \uad6c\ub9e4\ub97c \uc9c4\ud589\ud558\uac8c \ub418\uba74 `104\ub9cc\uc6d0` \uc815\ub3c4 \uc18c\uc694\uac00 \ub420\uac83\uc73c\ub85c \uc608\uc0c1\ub41c\ub2e4. \ud658\uc728\uc774\ub098 \ud560\uc778\uc744 \uc804\ud600 \ubc1b\uc9c0 \uc54a\uace0 1\uac1c\uc758 SSD\ub85c \uad6c\uc131\ud55c\ub2e4\uace0 \uac00\uc815\ud574\ub3c4 \uc57d 8\ucf54\uc5b4 16\uc2a4\ub808\ub4dc 64GB \uba38\uc2e0\uc744 `110\ub9cc\uc6d0` \uc815\ub3c4\ub85c \uad6c\uc131\uc774 \uac00\ub2a5\ud558\ub2e4. \ubb3c\ub860 \uc11c\ubc84\ub098 \uc6cc\ud06c\uc2a4\ud14c\uc774\uc158\uc774\ub098 Intel NUC\uae30\ubc18\uc73c\ub85c\ub3c4 \uad6c\uc131\uc774 \uac00\ub2a5\ud558\uc9c0\ub9cc \uc804\ub825\uc18c\ubaa8\uc640 \uc9d1\uc548\uc744 \ucc28\uc9c0\ud558\ub294 \ubd80\ud53c\ub97c \uace0\ub824\ud558\uba74 \uae08\uc561\uc801\uc73c\ub85c \uba54\ub9ac\ud2b8\uac00 \uc788\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4.\\n\\n## \uc900\ube44\uc0ac\ud56d(Software)\\n\\n* Windows PC (with Powershell, WSL) or MAC\\nWindow\ub97c \uc0ac\uc6a9\uc744 \ud558\uc9c0 \uc54a\uace0 MAC\uc774\ub098 \ub9ac\ub205\uc2a4\ub85c \uad6c\uc131\ud558\ub824 \ud588\uc73c\ub098 \uc628\ubcf4\ub4dc NIC \uc778\uc2dd\uc744 \uc704\ud55c \ub4dc\ub77c\uc774\ubc84 \ud1b5\ud569 \ucee4\uc2a4\ud140 \uc774\ubbf8\uc9c0 \uc791\uc131 \ud3b8\uc758\ub97c \uc704\ud574 Window \ud658\uacbd\uc744 \uc0ac\uc6a9\ud558\uc600\ub2e4.\\n\\n* [ventoy](https://www.ventoy.net/en/index.html)  \\n  ESXi \ubd80\ud305 \uc774\ubbf8\uc9c0 \uc81c\uc791\uc744 \uc704\ud55c \ud234\uc774\uba70 [rufus](https://rufus.ie/)\uc5d0 \ube44\ud574 \ud65c\uc6a9\ub3c4\uac00 \ub192\ub2e4.\\n* [vSphere 7.0 Update 1](https://my.vmware.com/en/group/vmware/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/7_0)  \\n  \ud3c9\uac00\ud310\uc740 [https://my.vmware.com/en/group/vmware/evalcenter?p=vsphere-eval-7](https://my.vmware.com/en/group/vmware/evalcenter?p=vsphere-eval-7) \uc5d0\uc11c \ub2e4\uc6b4\ub85c\ub4dc\uac00 \uac00\ub2a5\ud558\ub2e4.\\n* [PowerShell 7.10](https://github.com/PowerShell/PowerShell/releases/tag/v7.1.0)  \\n  \uae30\ubcf8\uc801\uc73c\ub85c Window\uc5d0\ub294 6.x \ubc84\uc804\uc758 PowerShell\uc774 \uc124\uce58\ub418\uc5b4 \uc788\uae30 \ub54c\ubb38\uc5d0 7.1.0 \ubc84\uc804\uc744 \uc2e0\uaddc\ub85c \uc124\uce58\ud574\uc57c \ud55c\ub2e4.\\n* [PowerCLI](https://www.powershellgallery.com/packages?q=VMware.PowerCLI)  \\n  https://www.powershellgallery.com/packages/VMware.PowerCLI/12.1.0.17009493\\n  \ucee4\uc2a4\ud140 ESXi 7.0 \uc774\ubbf8\uc9c0 \uc81c\uc791\uc744 \uc704\ud574 \ud544\uc694\ud558\ub2e4.\\n* [USB Network Native Driver for ESXi](https://flings.vmware.com/usb-network-native-driver-for-esxi?download_url=https%3A%2F%2Fdownload3.vmware.com%2Fsoftware%2Fvmw-tools%2FUSBNND%2FESXi701-VMKUSB-NIC-FLING-40599856-component-17078334.zip)  \\n  PN50 USB NIC(RTL8153) \uc778\uc2dd\uc744 \uc704\ud55c \ub124\uc774\ud2f0\ube0c \ub4dc\ub77c\uc774\ubc84.\\n* [OVFTool](https://my.vmware.com/group/vmware/downloads/details?downloadGroup=OVFTOOL440P01&productId=974)  \\n  OVA\ub97c \ubc30\ud3ec\ud558\uae30 \uc704\ud55c \ub3c4\uad6c\ub85c Linux 64 bundle\ub85c WSL\uc5d0 \uc124\uce58\ud55c\ub2e4. \\n* [vcsa-deploy](https://my.vmware.com/group/vmware/evalcenter?p=vsphere-eval-7)  \\n  vCenter\ub97c \ubc30\ud3ec\ud558\ub294 \ub3c4\uad6c\ub85c \uc774\ubbf8\uc9c0\ub0b4\uc5d0 \ud3ec\ud568\ub418\uc5b4 \uc788\uae30 \ub54c\ubb38\uc5d0 vCenter Server Appliance ISO\ub97c \ub2e4\uc6b4\ubc1b\uc544 \uc555\ucd95\uc744 \ud480\uba74 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n## \ucd5c\uc885 \uc608\uc0c1 \uad6c\uc131\uc694\uc18c\\n* vCenter Server Appliance\\n* VMFS Storage\\n* vSphere with Tanzu Cluster\\n* HAProxy\\n* Router (Forwarding, DNS)\\n* Supervisor Control Plane VMs (Master 2ea, Worker 3ea)\\n\\n## ESXi \uc124\uce58\\n\\n\ucd08\ubc18\uc5d0\ub3c4 \uc774\uc57c\uae30 \ud588\ub4ef\uc774 ESXi 7.0\uc774\uc0c1\uc5d0\uc11c\ub294 ASUS PN50\uc758 \uc628\ubcf4\ub4dc \uc778\ud130\ud398\uc774\uc2a4\ub97c \uc0ac\uc6a9\ud558\uc9c0 \ubabb\ud55c\ub2e4. \uadf8\ub798\uc11c \ubcc4\ub3c4\ub85c \uad6c\ub9e4\ud55c USB \uc778\ud130\ud398\uc774\uc2a4\uc758 RTL8153 \uce69\uc14b\uc744 \uc774\ubbf8\uc9c0\uc5d0 \ud1b5\ud569\uc2dc\ud0a4\ub294 \uc791\uc5c5\uc774 \ud544\uc694\ud558\ub2e4.  \\n\\n\ub4dc\ub77c\uc774\ubc84 \uc774\ubbf8\uc9c0 \ud1b5\ud569\uc744 \uc704\ud55c \ub0b4\uc6a9\uc740 \uc544\ub798 \ud3ec\uc2a4\ud305\uc744 \ucc38\uace0\ud588\ub2e4.  \\n* [https://www.virten.net/2020/09/esxi-on-amd-ryzen-based-asus-pn50/](https://www.virten.net/2020/09/esxi-on-amd-ryzen-based-asus-pn50/)\\n* [https://www.virten.net/2020/04/how-to-add-the-usb-nic-fling-to-esxi-7-0-base-image/](https://www.virten.net/2020/04/how-to-add-the-usb-nic-fling-to-esxi-7-0-base-image/)\\n\\n### ESXi \ub2e4\uc6b4\ub85c\ub4dc\\n\\n\ub2e4\uc74c \ub9c1\ud06c\uc5d0\uc11c `VMware vSphere 7.0 Update 1` \ub97c \ub2e4\uc6b4\ub85c\ub4dc \ud55c\ub2e4.  \\n* [https://my.vmware.com/en/group/vmware/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/7_0](https://my.vmware.com/en/group/vmware/downloads/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/7_0)\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c VMware \ud68c\uc6d0\uac00\uc785\uc774 \ud544\uc694\ud558\uba70 \ub77c\uc774\uc13c\uc2a4\uac00 \uc5c6\ub294 \uacbd\uc6b0 60\uc77c trial\ub85c \uac00\ub2a5\ud558\ub2e4.  \\n* [https://my.vmware.com/en/group/vmware/evalcenter?p=vsphere-eval-7](https://my.vmware.com/en/group/vmware/evalcenter?p=vsphere-eval-7)\\n\\n### USB Network Native Driver for ESXi\\n\\nUSB NIC Fling \ub4dc\ub77c\uc774\ubc84\ub97c \uc900\ube44\ud55c\ub2e4. \\n\\n* [https://flings.vmware.com/usb-network-native-driver-for-esxi?download_url=https%3A%2F%2Fdownload3.vmware.com%2Fsoftware%2Fvmw-tools%2FUSBNND%2FESXi701-VMKUSB-NIC-FLING-40599856-component-17078334.zip\\n](https://flings.vmware.com/usb-network-native-driver-for-esxi?download_url=https%3A%2F%2Fdownload3.vmware.com%2Fsoftware%2Fvmw-tools%2FUSBNND%2FESXi701-VMKUSB-NIC-FLING-40599856-component-17078334.zip)\\n\\n### PowerShell 7.1.0 \uc124\uce58\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c Window\uc5d0\ub294 6.x \ubc84\uc804\uc758 PowerShell\uc774 \uc124\uce58\ub418\uc5b4 \uc788\uae30 \ub54c\ubb38\uc5d0 \ud2b9\uc815 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uad6c\ub3d9\ud558\uae30 \uc704\ud574\uc11c\ub294 7.1.0 \ubc84\uc804\uc744 \uc2e0\uaddc\ub85c \uc124\uce58\ud574\uc57c \ud55c\ub2e4.  \\n\\n* [https://github.com/PowerShell/PowerShell](https://github.com/PowerShell/PowerShell)\\n\\n\\n### PowerCLI \uc900\ube44\\n\\nPowerCLI \ub2e4\uc6b4\ub85c\ub4dc \ubc0f \uc124\uce58\\n* [https://www.powershellgallery.com/packages/VMware.PowerCLI/12.1.0.17009493](https://www.powershellgallery.com/packages/VMware.PowerCLI/12.1.0.17009493)\\n\\n\uad00\ub9ac\uc790 \uad8c\ud55c\uc73c\ub85c PowerShell\uc744 \uc2e4\ud589\ud558\uace0 PowerCLI \ubaa8\ub4c8 \uc124\uce58\uc804\uc5d0 \uc2e4\ud589 \uad8c\ud55c\uc744 \uc218\uc815\ud55c\ub2e4.  \\n* \ucc38\uace0 : [https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.1](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.1)\\n\\n```powershell\\nSet-ExecutionPolicy -ExecutionPolicy RemoteSigned\\n```\\n\\nPowerCLI\ub97c \uc124\uce58\ud55c\ub2e4.\\n```powershell\\nInstall-Module -Name VMware.PowerCLI -Scope CurrentUser\\n```\\n\\n### Image Profile \ud655\uc778\\n\ud3ec\uc2a4\ud305\uc744 \ud558\ub294 20\ub144 11\uc6d4 29\uc77c \ucd5c\uc2e0 ESXi \uc774\ubbf8\uc9c0\ub294 `ESXi-7.0U1b-17168206-standard`\ub85c vSphere ESXi 7.0 \uc774\ubbf8\uc9c0 \ud504\ub85c\ud544\uc740 \uc544\ub798\uc5d0\uc11c \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n* [https://www.virten.net/vmware/vmware-esxi-image-profiles/](https://www.virten.net/vmware/vmware-esxi-image-profiles/)\\n\\nstable \ub9b4\ub9ac\uc2a4\ub85c \uad6c\uc131\ud558\uae30 \uc704\ud574 \uc774\uc804 \ub9b4\ub9ac\uc2a4\uc778 `ESXi-7.0.1-16850804-standard` \uc774\ubbf8\uc9c0 \ud504\ub85c\ud544\ub85c \uc124\uce58\ub97c \uc9c4\ud589\ud55c\ub2e4.  \\n\\n\uc124\uce58 \ud504\ub85c\uc138\uc2a4\ub97c \uc0b4\ud3b4\ubcf4\uba74 `Add-EsxSoftwareDepot`\ub85c repo\uc124\uc815\uc744 \ud558\uace0 `Export-ESXImageProfile`\ub97c \ud1b5\ud574 \uc6d0\ud558\ub294 \uc774\ubbf8\uc9c0 \ud504\ub85c\ud544\uc758 bundle\uc744 \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\ub294\ub2e4. \uc704\uc5d0\uc11c \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc740 \ub4dc\ub77c\uc774\ubc84\ub97c `Add-EsxSoftwarePackage`\ub85c \ud328\ud0a4\uc9c0\ub97c \ucd94\uac00\ud558\uace0 \uc0c8\ub85c\uc6b4 ISO\uc774\ubbf8\uc9c0\ub97c \uc0dd\uc131\ud558\ub294 \uacfc\uc815\uc744 \uc54c \uc218 \uc788\ub2e4.  \\n\\n\uc774\ubbf8\uc9c0 \ud504\ub85c\ud544 \ubcc0\uacbd\uc744 \ud1b5\ud574 \uc6d0\ud558\ub294 \uc774\ubbf8\uc9c0 \ubc84\uc804\uc73c\ub85c \uad6c\uc131\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n\\n```powershell\\nAdd-EsxSoftwareDepot https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml\\nExport-ESXImageProfile -ImageProfile \\"ESXi-7.0.1-16850804-standard\\" -ExportToBundle -filepath  ESXi-7.0.1-16850804-standard.zip\\nRemove-EsxSoftwareDepot https://hostupdate.vmware.com/software/VUM/PRODUCTION/main/vmw-depot-index.xml\\nAdd-EsxSoftwareDepot .\\\\ESXi-7.0.0-15843807-standard.zip\\nAdd-EsxSoftwareDepot .\\\\ESXi701-VMKUSB-NIC-FLING-40599856-component-17078334.zip\\nNew-EsxImageProfile -CloneProfile \\"ESXi-7.0.1-16850804-standard\\" -name \\"ESXi-7.0.1-16850804-USBNIC\\" -Vendor \\"virten.net\\"\\nAdd-EsxSoftwarePackage -ImageProfile \\"ESXi-7.0.1-16850804-USBNIC\\" -SoftwarePackage \\"vmkusb-nic-fling\\"\\nExport-ESXImageProfile -ImageProfile \\"ESXi-7.0.1-16850804-USBNIC\\" -ExportToIso -filepath ESXi-7.0.1-16850804-USBNIC.iso\\nExport-ESXImageProfile -ImageProfile \\"ESXi-7.0.1-16850804-USBNIC\\" -ExportToBundle -filepath ESXi-7.0.1-16850804-USBNIC.zip\\n```\\n\\n### ESXi \uc124\uce58 \uc774\ubbf8\uc9c0 \uc81c\uc791\\n\\nESXi \ubd80\ud305 \uc774\ubbf8\uc9c0 \uc81c\uc791\uc740 [rufus](https://rufus.ie/), [ventoy](https://www.ventoy.net/en/index.html) \ub458 \uc911 \ud3b8\ud55c \ub3c4\uad6c\ub85c \uc120\ud0dd\ud558\uba74 \ub418\ub294\ub370 ventoy\uac00 \uc870\uae08 \ub354 \ud65c\uc6a9\ub3c4\uac00 \ub192\ub2e4\uace0 \ud310\ub2e8\ud558\uc5ec \uc9c4\ud589\ud588\uace0, OS\uc124\uce58 USB \uc0dd\uc131\uc740 \uc0dd\ub7b5\ud55c\ub2e4. \\n\\n### \ubd80\ud305 \ubc0f \uc124\uce58 \\n\\n\uc77c\ubc18\uc801\uc778 \ubc14\uc774\uc624\uc2a4 \uc124\uc815\uacfc \ub3d9\uc77c\ud558\uac8c Boot \uc6b0\uc120\uc21c\uc704\ub97c USB\ub85c \uc124\uc815\ud558\uace0 \ub2e4\uc74c\uacfc \uac19\uc740 ventoy\ud654\uba74\uc5d0\uc11c \uc55e\uc11c \uc0dd\uc131\ud55c `ESXi-7.0.1-16850804-USBNIC.iso` \uc774\ubbf8\uc9c0\ub85c ESXi \uc124\uce58\ub97c \uc9c4\ud589\ud55c\ub2e4.\\n\\n![ventoy](https://nuanceofiqlusion.files.wordpress.com/2020/07/ventoymainmenu-e1594484932538.png)\\nhttps://nuanceofiqlusion.files.wordpress.com/2020/07/ventoymainmenu-e1594484932538.png  \\n\\n\\n\uc774\ud6c4 \uce5c\uc219\ud55c DCUI(Direct Console User Interface)\ub85c \uc811\uc18d\ud558\uc5ec F2\ubaa8\ub4dc\ub85c \uc811\uc18d\ud558\uc5ec Static IP \uc124\uc815\uacfc network \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud55c\ub2e4.  \\n\\n![esxi](/img/esxi7.png)\\n\\n\\n### vSphere Web Client \uc811\uc18d\\n\\n\uc124\uc815\ud55c Static IP\ub85c \uc811\uc18d\ud558\uc5ec \ud658\uacbd\uc744 \uc810\uac80\ud55c\ub2e4.  \\n\\n![nw](/img/esxi_network.png)\\n\\nManagement Network\uc5d0 vSwitch0\uc774 \uad6c\uc131\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n\uadf8\ub9ac\uace0 \uc124\uce58\ud55c M.2 SSD\ub85c datastore2\ub97c \ucd94\uac00\ud558\uc5ec vCenter \uc124\uce58\ub97c \uc9c4\ud589\ud558\ub3c4\ub85d \ud55c\ub2e4.\\n\\n![storage](/img/esxi_storage.png)\\n\\n## Router \uc124\uce58 \ubc0f \ud658\uacbd \uad6c\uc131\\n\\nRouter VM\uc740 DNS \uc11c\ubc84\uc758 \uc5ed\ud560\ubfd0 \uc544\ub2c8\ub77c \uc55e\uc73c\ub85c \uad6c\uc131\ub420 \ub0b4\ubd80 \ub124\ud2b8\uc6cc\ud06c(10.10.0.0/24 & 10.20.0.0/24)\uc640 \uc678\ubd80 \ub124\ud2b8\uc6cc\ud06c\uc758 \ud3ec\uc6cc\ub529\uacfc NAT \uc5ed\ud560\uc744 \uc218\ud589\ud55c\ub2e4.  \\n\\nPhoton OS 3.0 OVA\ub85c \ubc30\ud3ec\ub418\uba70 [OVFTool](https://my.vmware.com/group/vmware/downloads/details?downloadGroup=OVFTOOL440P01&productId=974)\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubc30\ud3ec\ub97c \uc9c4\ud589\ud558\ub294\ub370 \uc774\ubbf8 \uc791\uc131\ub41c \ubc30\ud3ec \uc2a4\ud06c\ub9bd\ud2b8\ub97c \ud65c\uc6a9\ud55c\ub2e4. \\n\\n* [Photon OS 3.0 OVA](https://packages.vmware.com/photon/3.0/Rev3/ova/photon-hw13_uefi-3.0-a383732.ova)\\n* [https://github.com/lamw/vsphere-with-tanzu-homelab-scripts](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts.git)\\n\\n\\n### Router \uc124\uce58\\n\\n\uc2a4\ud06c\ub9bd\ud2b8 \uc2e4\ud589\uc740 \ub3d9\uc77c\ud55c PowerShell\uc774 \ub3d9\uc791\ud558\ub294 Window WSL2 \ud658\uacbd\uc5d0\uc11c \uc218\ud589\ud588\uae30 \ub54c\ubb38\uc5d0 Window `hosts` \ud30c\uc77c\uacfc WSL\ud658\uacbd\uc758 `/etc/hosts` \ud30c\uc77c\uc5d0 \uc544\ub798\uc640 \uac19\uc774 \uc0ac\uc6a9\ud558\uace0\uc790 \ud558\ub294 IP\uc8fc\uc18c\ub97c \ubbf8\ub9ac \ub4f1\ub85d\ud574\ub193\ub294\ub2e4.  \\n\\n```\\n192.168.0.10    esxi-01.tanzu.local\\n192.168.0.201   router.tanzu.local\\n192.168.0.202   vcsa.tanzu.local\\n192.168.0.203   haproxy.tanzu.local\\n```\\n\\n[\uc2a4\ud06c\ub9bd\ud2b8 \ub808\ud3ec](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts.git)\uc758 `deploy_photon_router_ova.sh`\ub97c \uc790\uc2e0\uc758 \ud658\uacbd\uc5d0 \ub9de\uac8c \uc218\uc815\ud55c\ub2e4. WSL\ub0b4\uc5d0\uc11c Window \uc2dc\uc2a4\ud15c\ub0b4\uc5d0 \ub2e4\uc6b4\ub85c\ub4dc\ud55c OVA\ud30c\uc77c \uacbd\ub85c\ub294 WSL\ub0b4\uc5d0\uc11c \uc2e4\ud589\ub420 \uac83\uc774\uae30\uc5d0 `/mnt/c/esxi/photon-hw13_uefi-3.0-a383732.ova`\ub85c \ubcc0\uacbd\ud558\uc600\ub2e4. Router\uc640 ESXi hostname, password\ub4f1\uc744 \ud655\uc778\ud558\uace0 Network\uacfc Datastore\ub294 \uc704\uc5d0\uc11c \ud655\uc778\ud55c \ub0b4\uc6a9\uc73c\ub85c \uc218\uc815\ud55c\ub2e4.\\n\\n```sh\\n#!/bin/bash\\n# William Lam\\n# www.virtuallyghetto\\n\\nPhotonOVA=\\"/mnt/c/esxi/photon-hw13_uefi-3.0-a383732.ova\\"\\nPhotonRouterVMName=\\"router.tanzu.local\\"\\nESXiHostname=\\"esxi-01.tanzu.local\\"\\nESXiUsername=\\"root\\"\\nESXiPassword=\'VMware1!\'\\n\\nPhotonRouterNetwork=\\"VM Network\\"\\nPhotonRouterDatastore=\\"datastore1\\"\\n\\n### DO NOT EDIT BEYOND HERE ###\\n\\novftool \\\\\\n--name=${PhotonRouterVMName} \\\\\\n--X:waitForIpv4 \\\\\\n--powerOn \\\\\\n--acceptAllEulas \\\\\\n--noSSLVerify \\\\\\n--datastore=${PhotonRouterDatastore} \\\\\\n--net:\\"None=${PhotonRouterNetwork}\\" \\\\\\n${PhotonOVA} \\\\\\n\\"vi://${ESXiUsername}:${ESXiPassword}@${ESXiHostname}\\"\\n```\\n\\n\uc2a4\ud06c\ub9bd\ub4dc\ub97c \uc2e4\ud589\ud558\uba74 OVA\ud30c\uc77c\uc744 \ubc30\ud3ec\ud558\uac8c \ub41c\ub2e4.  \\n\\n```sh\\n$ ./deploy_photon_router_ova.sh\\nOpening OVA source: /mnt/c/esxi/photon-hw13_uefi-3.0-a383732.ova\\nThe manifest validates\\nThe provided certificate is in valid period\\nSource is signed and the certificate validates\\nCertificate information:\\n  CertIssuer:/C=US/ST=California/L=Palo Alto/O=VMware, Inc.\\n  CertSubject:/C=US/ST=California/L=Palo Alto/O=VMware, Inc.\\n  -----BEGIN CERTIFICATE-----\\n  ...\\n  -----END CERTIFICATE-----\\n\\n\\nWarning:\\n - Line -1: Unsupported value \'uefi.secureBoot.enabled\' for attribute \'key\' on element \'ExtraConfig\'.\\nOpening VI target: vi://root@esxi-01.tanzu.local:443/\\nDeploying to VI: vi://root@esxi-01.tanzu.local:443/\\nTransfer Completed\\nPowering on VM: router.tanzu.local\\nTask Completed\\nReceived IP address: 192.168.0.47\\nCompleted successfully\\n```\\n\\n\uc704\uc640 \uac19\uc774 DHCP\ub97c \ud1b5\ud574 \uc784\uc758\uc758 \uc8fc\uc18c(192.168.0.47)\ub97c \ud560\ub2f9 \ubc1b\uac8c \ub418\uace0 \ud574\ub2f9 IP\ub85c SSH\uc811\uc18d\ud558\uc5ec \uae30\ubcf8 \ud328\uc2a4\uc6cc\ub4dc(`changeme`)\ub97c \uc6d0\ud558\ub294 \ud328\uc2a4\uc6cc\ub4dc\ub85c \ubcc0\uacbd\ud55c\ub2e4.\\n\\n```sh\\n$ ssh root@192.168.0.47\\nThe authenticity of host \'192.168.0.47 (192.168.0.47)\' can\'t be established.\\nECDSA key fingerprint is SHA256:ESpN1DMTIu9PKWW4QZIYs4DZ602SsdhjxEYhugkmi+g.\\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\\nWarning: Permanently added \'192.168.0.47\' (ECDSA) to the list of known hosts.\\nPassword:\\n\\ncat > /etc/systemd/network/10-static-eth0.network << EOF\\nYou are required to change your password immediately (administrator enforced)\\nChanging password for root.\\nCurrent password:\\nNew password:\\nRetype new password:\\n 08:58:54 up 32 min,  0 users,  load average: 0.00, 0.00, 0.00\\ntdnf update info not available yet!\\nroot@photon-machine [ ~ ]#\\nroot@photon-machine [ ~ ]# exit\\nlogout\\nConnection to 192.168.0.47 closed.\\n```\\n\\n### Router \ud658\uacbd \uad6c\uc131\\n\\n\uc704 \uc2a4\ud06c\ub9bd\ud2b8 [\ub808\ud3ec\uc9c0\ud1a0\ub9ac](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts)\uc5d0\uc11c DNS\uc5ed\ud560, \ud3ec\uc6cc\ub529\uc744 \uc218\ud589\ud558\ub3c4\ub85d [`setup_photon_router.sh`](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts/blob/master/setup_photon_router.sh)\ub97c \uc218\uc815\ud55c\ub2e4. \\n\\n* `PHOTON_ROUTER_IP`=192.168.0.201 : Router \uc124\uc815\ud560 IP\\n* `PHOTON_ROUTER_GW`=192.168.0.1 : Router\uc758 \uac8c\uc774\ud2b8\uc6e8\uc774\\n* `PHOTON_ROUTER_DNS`=192.168.0.1 : Router\uc758 Forwader DNS\\n* `SETUP_DNS_SERVER`=1 : Router\uac00 \ud074\ub7ec\uc2a4\ud130 \ub0b4 DNS \uc5ed\ud560\uc744 \uc218\ud589\\n\\n\uc704 \uc124\uc815 \uc774\uc678\uc5d0\ub3c4 \ucd94\ud6c4 \ub0b4\ubd80 \ub124\ud2b8\uc6cc\ud06c \uad6c\uc131\uc744 \uc704\ud55c iptables \uad6c\uc131\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\ub2e4.  \\n\\n```sh\\n#!/bin/bash\\n\\nPHOTON_ROUTER_IP=192.168.0.201\\nPHOTON_ROUTER_GW=192.168.0.1\\nPHOTON_ROUTER_DNS=192.168.0.1\\nSETUP_DNS_SERVER=1\\n\\ntdnf -y update\\nif [ ${SETUP_DNS_SERVER} -eq 1 ]; then\\n    tdnf install -y unbound\\n\\n    cat > /etc/unbound/unbound.conf << EOF\\n    server:\\n        interface: 0.0.0.0\\n        port: 53\\n        do-ip4: yes\\n        do-udp: yes\\n        access-control: 192.168.0.0/24 allow\\n        access-control: 10.10.0.0/24 allow\\n        access-control: 10.20.0.0/24 allow\\n        verbosity: 1\\n\\n    local-zone: \\"tanzu.local.\\" static\\n\\n    local-data: \\"router.tanzu.local A 192.168.0.201\\"\\n    local-data-ptr: \\"192.168.0.201 router.tanzu.local\\"\\n\\n    local-data: \\"vcsa.tanzu.local A 192.168.0.202\\"\\n    local-data-ptr: \\"192.168.0.202 vcsa.tanzu.local\\"\\n\\n    local-data: \\"haproxy.tanzu.local A 192.168.0.203\\"\\n    local-data-ptr: \\"192.168.0.203 haproxy.tanzu.local\\"\\n\\n    local-data: \\"esxi-01.tanzu.local A 192.168.0.10\\"\\n    local-data-ptr: \\"192.168.0.10 esxi-01.tanzu.local\\"\\n...\\n```\\n\\n\ud574\ub2f9 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc218\ud589\ud558\uace0 \ub098\uba74 IP\uac00 \ubcc0\uacbd\ub418\uace0 \uc678\ubd80\uc5d0\uc11c\ub3c4 Router DNS\ub97c \ud1b5\ud574 \ucffc\ub9ac\uac00 \uac00\ub2a5\ud55c\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n```powershell\\nPS C:\\\\Users\\\\rokak> nslookup vmware.com 192.168.0.201\\n\uc11c\ubc84:    router.tanzu.local\\nAddress:  192.168.0.201\\n\\n\uad8c\ud55c \uc5c6\ub294 \uc751\ub2f5:\\n\uc774\ub984:    vmware.com\\nAddresses:  2a02:e980:b5::b7\\n            2a02:e980:b1::b7\\n            45.60.101.183\\n            45.60.11.183\\n```\\n\\n### VCSA(vCenter Server Appliance) \ubc30\ud3ec \ubc0f \uad6c\uc131\\n\\n`vcsa-deploy`\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubc30\ud3ec\ub97c \uc9c4\ud589\ud55c\ub2e4. `vcsa-deploy`\ub294 VCSA \uc774\ubbf8\uc9c0\ub0b4\uc5d0 \ubc14\uc774\ub108\ub9ac \ud615\ud0dc\ub85c \uc874\uc7ac\ud558\uae30 \ub54c\ubb38\uc5d0 \uba3c\uc800 VCSA 7.0 Update 1 ISO\ub97c \ub2e4\uc6b4\ub85c\ub4dc\ud55c\ub2e4.  \\n* [https://my.vmware.com/group/vmware/evalcenter?p=vsphere-eval-7](https://my.vmware.com/group/vmware/evalcenter?p=vsphere-eval-7)\\n\\n\uc704 \uc2a4\ud06c\ub9bd\ud2b8 [\ub808\ud3ec\uc9c0\ud1a0\ub9ac](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts)\uc5d0\uc11c [`vcsa.tanzu.local.json`](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts/blob/master/vcsa.tanzu.local.json)\ub97c \uc218\uc815\ud55c\ub2e4.  \\n\\n\ud328\uc2a4\uc6cc\ub4dc, `Network`\uc640 `Datastore`\ub97c \uc124\uc815\ud558\uace0 `dns_servers`\ub97c Router IP\ub85c \ubcc0\uacbd\ud55c\ub2e4. \ub098\uba38\uc9c0\ub294 \uae30\ubcf8\uac12\uc73c\ub85c \uc124\uc815\ud55c\ub2e4. \\n\\n```json\\n{\\n            ...\\n            \\"deployment_network\\": \\"VM Network\\",\\n            \\"datastore\\": \\"datastore2\\"\\n        },\\n        \\"appliance\\": {\\n            \\"__comments\\": [\\n            ...\\n            ],\\n            \\"thin_disk_mode\\": true,\\n            \\"deployment_option\\": \\"tiny\\",\\n            \\"name\\": \\"vcsa.tanzu.local\\"\\n        },\\n        \\"network\\": {\\n            \\"ip_family\\": \\"ipv4\\",\\n            \\"mode\\": \\"static\\",\\n            \\"system_name\\": \\"vcsa.tanzu.local\\",\\n            \\"ip\\": \\"192.168.0.202\\",\\n            \\"prefix\\": \\"24\\",\\n            \\"gateway\\": \\"192.168.0.1\\",\\n            \\"dns_servers\\": [\\n                \\"192.168.0.201\\"\\n            ]\\n        },\\n    ...\\n}\\n```\\n\\n\uc704\uc5d0\uc11c \ub2e4\uc6b4\ub85c\ub4dc \ubc1b\uc558\ub358 VCSA ISO\ub97c \uc555\ucd95\uc744 \ud480\uace0 \uc704 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \ucc38\uc870\ud558\uc5ec \ubc30\ud3ec \uba85\ub839\uc744 \uc2e4\ud589\ud55c\ub2e4. \\n\\n```sh\\n$ cd VMware-VCSA-all-7.0.1-17004997/\\n$ ./vcsa-deploy install --accept-eula --acknowledge-ceip --no-ssl-certificate-verification /mnt/c/esxi/vsphere-with-tanzu-homelab-scripts/vcsa.tanzu.local.json\\n```\\n\\nvCenter\uac00 \uc124\uce58\uac00 \uc644\ub8cc\ub41c \ud6c4 SSH\ub85c \uc811\uc18d\ud55c\ub2e4. \uae30\ubcf8 Shell\uc774 Bash\uac00 \uc544\ub2c8\ubbc0\ub85c `shell` \uba85\ub839\uc73c\ub85c \uc811\uc18d\ud55c\ud6c4 `chsh -s /bin/bash`\ub85c \uae30\ubcf8 Shell\uc744 Bash\ub85c \ubcc0\uacbd\ud55c\ub2e4.  \\n\\n```sh\\n$ ssh root@192.168.0.202\\nThe authenticity of host \'192.168.0.202 (192.168.0.202)\' can\'t be established.\\nECDSA key fingerprint is SHA256:oMr5nJ9RDeZS9E3m586kSFDoNXM76yNiLYaIyDQ6ca4.\\nAre you sure you want to continue connecting (yes/no/[fingerprint])? yes\\nWarning: Permanently added \'192.168.0.202\' (ECDSA) to the list of known hosts.\\n\\nVMware vCenter Server 7.0.1.00100\\n\\nType: vCenter Server with an embedded Platform Services Controller\\n\\nroot@192.168.0.202\'s password:\\nConnected to service\\n\\n    * List APIs: \\"help api list\\"\\n    * List Plugins: \\"help pi list\\"\\n    * Launch BASH: \\"shell\\"\\n\\nCommand>\\nCommand> shell\\nShell access is granted to root\\nroot@vcsa [ ~ ]# chsh -s /bin/bash\\n```\\n\\n### VCSA \uc124\uc815 \ubcc0\uacbd\\n\\n\uba54\ubaa8\ub9ac \uc808\uc57d\uc744 \uc704\ud574 \ub9c8\uc2a4\ud130 \ub178\ub4dc \uac1c\uc218\ub97c \ubcc0\uacbd\ud55c\ub2e4. `/etc/vmware/wcp/wcpsvc.yaml` \uc5d0\uc11c `clusterconfig.minmasters` \uc640 `clusterconfig.maxmasters` \uac12\uc744 2\ub85c \ubcc0\uacbd\ud558\uba74 \ub41c\ub2e4. \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ub2e4\uc74c \ub9c1\ud06c\ub97c \ucc38\uc870\ud55c\ub2e4.\\n\\n* [https://www.virtuallyghetto.com/2020/04/deploying-a-minimal-vsphere-with-kubernetes-environment.html](https://www.virtuallyghetto.com/2020/04/deploying-a-minimal-vsphere-with-kubernetes-environment.html)\\n\\n```yaml\\nlogging:\\n  level: debug\\n  maxsizemb: 10\\n# By default, WCP Agent VM OVF URL points to the ovf bundled in vCSA, served\\n# through lighttpd web server. To override it, set kubevmconfig.ovfurl param.\\n#kubevm:\\n#  ovfurl: \'https://this_vc_pnid:5480/wcpagent/photon-ova-%%SIZE%%.ovf\'\\n#  apiserverport: 6443\\n#  authproxyport: 443\\nrhttpproxy_port: 443\\nclusterconfig:\\n  minmasters: 2\\n  maxmasters: 2\\n  disable_ssl: false\\n  namespace_graceful_disable_duration: 1800\\n  upgrade_precheck_timeout: 300\\n# force_upgrade_clusters:\\n  force_version_for_enable: v1\\\\.18\\\\..*\\n  logging_fluentbit_enabled: false\\n# logging_fluentbit_rsyslog: \\"\\"\\ncsisetting:\\n   csi_enabled: true\\nhdcsconfig:\\n  ovf_url: \'file:///storage/lifecycle/vmware-hdcs\'\\n```\\n\\nvCenter UI\uc0ac\uc6a9\uc744 \uc704\ud574 [`setup_vcsa.ps1`](https://github.com/lamw/vsphere-with-tanzu-homelab-scripts/blob/master/setup_vcsa.ps1) \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc218\uc815\ud55c\ub2e4.  \\n\\n```powershell\\n.\\\\setup_vcsa.ps1\\nConnect-VIServer: C:\\\\esxi\\\\vsphere-with-tanzu-homelab-scripts\\\\setup_vcsa.ps1:17\\nLine |\\n  17 |  $vc = Connect-VIServer $VCSAHostname -User $VCSAUsername -Password $V \u2026\\n     |        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\\n     | 2020-11-30 \uc624\uc804 12:45:18 Connect-VIServer  The SSL connection could not be established,\\n     | see inner exception.\\n```\\n\\n\uc704\uc640 \uac19\uc774 SSL connection \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud558\uae30 \ub54c\ubb38\uc5d0 \uc778\uc99d\uc11c \uccb4\ud06c\ub97c \ubb34\uc2dc\ud558\ub294 \uc124\uc815\uc744 \uba3c\uc11c \ud55c\ub2e4. \\n\\n```powershell\\nSet-PowerCLIConfiguration -InvalidCertificateAction:Ignore\\n```\\n\\n`$VCSAPassword`, `$DatastoreName`, `$ESXiPassword` \ub4f1\uc744 \uc218\uc815\ud558\uace0 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc2e4\ud589\ud55c\ub2e4.\\n\\n```powershell\\nPS C:\\\\esxi\\\\vsphere-with-tanzu-homelab-scripts> .\\\\setup_vcsa.ps1\\n```\\n\\n\uc124\uce58\uac00 \uc644\ub8cc\ub418\uba74 \uc2e0\uaddcUI\ub85c \uc811\uc18d\uc774 \uac00\ub2a5\ud574\uc9c4\ub2e4. \uc774\uc81c\ubd80\ud130\ub294 VCSA\ub85c \uc9c1\uc811 \uc811\uc18d\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n\uae30\ubcf8 \ub85c\uadf8\uc778 \uc544\uc774\ub514\ub294 `administrator@vsphere.local`\ub85c `vcsa.tanzu.local.json` \uc5d0\uc11c \uc124\uc815\ud55c \ud328\uc2a4\uc6cc\ub4dc\ub85c \uc811\uc18d\ud558\uba74 vCenter \uae30\ubc18\uc758 Client UI\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \uc815\uc0c1\uc801\uc73c\ub85c \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc5f0\uacb0\ub41c ESXi \ud638\uc2a4\ud2b8 \uc815\ubcf4\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n![VCSA](/img/vcsa_home.png)\\n\\n\\n\\n## \uc815\ub9ac\\n\\n\uc77c\ub2e8 \uc544\uc8fc \uc791\uc740 \ud558\ub4dc\uc6e8\uc5b4\ub85c \uac00\uc131\ube44 \uc88b\uc740 \ud074\ub7ec\uc2a4\ud130\ub97c \uad6c\ucd95\ud560 \uc218 \uc788\ub294 PN50\uc73c\ub85c Tanzu \ud074\ub7ec\uc2a4\ud130 \uad6c\uc131\uc744 \ud558\uae30 \uc704\ud55c \uae30\ucd08\uc791\uc5c5\uc774 \uc644\ub8cc\ub418\uc5c8\ub2e4.  \\n\\n\uae00\uc774 \uae38\uc5b4\uc9c0\ub294 \uad00\uacc4\ub85c VDS(vSphere Distributed Switch)\ub97c \uad6c\uc131\ud558\ub294 \uc774\ud6c4 \ubd80\ubd84\uc740 \ub2e4\uc74c \ud3ec\uc2a4\ud305\uc5d0\uc11c \uacc4\uc18d \uc774\uc5b4\ub098\uac08 \uc608\uc815\uc774\ub2e4. \\n\\n> \ub2e4\uc74c\uae00 - [vSphere with Tanzu homelab running on ASUS PN50 (2/2)](https://ddii.dev/kubernetes/vSphere-with-Tanzu-homelab-2/)"},{"id":"retrospective/2020plan/","metadata":{"permalink":"/retrospective/2020plan/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2020-01-03-2020plan.md","source":"@site/blog/2020-01-03-2020plan.md","title":"2019 Retrospective","description":"19\ub144\ub3c4\ub97c \ub3cc\uc544\ubcf4\uba70","date":"2020-01-03T00:00:00.000Z","formattedDate":"January 3, 2020","tags":[{"label":"Retrospective","permalink":"/tags/retrospective"},{"label":"2019","permalink":"/tags/2019"},{"label":"2020","permalink":"/tags/2020"},{"label":"Planning","permalink":"/tags/planning"}],"readingTime":6.255,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"2019 Retrospective","comments":true,"classes":"wide","description":"19\ub144\ub3c4\ub97c \ub3cc\uc544\ubcf4\uba70","slug":"retrospective/2020plan/","date":"2020-01-03T00:00:00.000Z","categories":["Retrospective"],"tags":["Retrospective","2019","2020","Planning"]},"prevItem":{"title":"vSphere with Tanzu homelab running on ASUS PN50 (1/2)","permalink":"/kubernetes/vSphere-with-Tanzu-homelab/"},"nextItem":{"title":"CircleCI\ub85c AWS BATCH(ECS) CI/CD Pipeline \uad6c\uc131","permalink":"/devops/circleci-ecs/"}},"content":"\ub610 \ud55c\ud574\uac00 \uc9c0\ub098\uac14\ub2e4. 2019\ub144 \ud55c\uc77c \uc815\ub9ac\ud558\uba74\uc11c 2020\ub144 \ud50c\ub79c \uae30\ub85d\uc6a9\uc73c\ub85c \ub044\uc801\uac70\ub824\ubcf8\ub2e4.\\n\\n- Work\\n    - 18\ub144\ub3c4 \uae4c\uc9c0 \uc11c\ube44\uc2a4 \uac1c\ubc1c\uc744 \ub9e1\uc558\uc9c0\ub9cc \uac11\uc791\uc2a4\ub7fd\uac8c \ubd80\uc11c \uc774\ub3d9\uc73c\ub85c \uc778\ud574 FaaS \uac1c\ubc1c\uc744 \uc190\uc744 \ub5bc\uace0 \uc2e0\uaddc \ubd80\uc11c\ub85c \uc774\uc804\ud558\uac8c \ub418\uc5c8\ub2e4. \uc791\ub144 \ucd08\uc5d0\ub3c4 \ud070 \ubcc0\ud654\uc600\ub294\ub370 \uc774\ubc88\uc5d0\ub3c4 \ub354 \ud070 \ubcc0\ud654\uc600\ub2e4.\\n    - \ubb38\uc81c\ub294 \uac1c\ubc1c\ubcf4\ub2e4\ub294 \uae30\ud68d\ucabd\uc5d0 \ub354 \uac00\uae4c\uc6b4 \uc5c5\ubb34\uc600\uace0 \ub370\uc774\ud130 \ubd84\uc11d \uad00\ub828\ud55c \ud50c\ub7ab\ud3fc\uc744 \uac1c\ubc1c\ud558\ub294 TF\uc5d0 \ud3ec\ud568\ub418\uac8c \ub418\uc5c8\ub2e4. \uba38\uc2e0\ub7ec\ub2dd, \ub370\uc774\ud130 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1\uacfc\ub294 \ub2f4\uc744 \uc313\uc558\uc5c8\uc9c0\ub9cc \uc5b4\uca54\uc218 \uc5c6\uc774 \ubd84\uc11d \uad00\ub828\ud558\uc5ec \uacfc\uc81c \uc218\ud589\\n    - 1-3\uc6d4\uc5d0\ub294 \uc8fc\ub85c \ubaa8\ube4c\ub9ac\ud2f0 \uad00\ub828 \uc5d0\ucf54\ud30c\ud2b8\ub108\ub4e4\uacfc \ud611\ub825 \ubc0f \uc0ac\uc5c5\uac1c\ubc1c\uc744 \uc704\ud55c \uae30\uc220\uac80\ud1a0 \ubc0f \uac80\uc99d.\\n    - 4-6\uc6d4\uc5d0\ub294 \uadf8\ub8f9 \uad00\uacc4\uc0ac\ub4e4\uc758 \ub370\uc774\ud130\ub808\uc774\ud06c\uc5d0 \ub300\ud55c \uc815\uc758\uc640 \uc124\uacc4, \ud50c\ub7ab\ud3fc \uad6c\ud604\uc744 \uc704\ud55c Design-Thinking, \uc11c\ube44\uc2a4 \ud3ec\ud138 \uae30\ud68d \ub4f1\uc744 \uc218\ud589\ud558\uace0 \uadf8\ub8f9 \uad00\uacc4\uc0ac\ub4e4\uc758 \ub370\uc774\ud130\ub808\uc774\ud06c\uc5d0 \ub300\ud55c \uc815\uc758\uc640 \uc124\uacc4 \uc9c4\ud589.\\n    - 7-9\uc6d4\uc5d0\ub294 \uc11c\ube44\uc2a4 \ud3ec\ud138 \uac1c\ubc1c\uc744 \uc704\ud55c CI/CD \uc120\uc815 \ubc0f devops \ud30c\uc774\ud504\ub77c\uc778 \uad6c\uc131, \ub370\uc774\ud130 preparation \ud234 \uac80\ud1a0 \ubc0f AWS Managed \uc11c\ube44\uc2a4 \uac80\uc99d \ubc0f \uad6c\ud604 \uc5c5\ubb34\ub97c \uc218\ud589\ud588\ub2e4. \ub610\ud55c \ud504\ub860\ud2b8\uc5d4\ub4dc \uc11c\ube44\uc2a4 \ucc98\ub9ac\ub97c \uc704\ud55c \ub78c\ub2e4\ud568\uc218 \uac1c\ubc1c \ubc0f documents \ub808\ud3ec\uc9c0\ud1a0\ub9ac \uad6c\ucd95 \uc9c4\ud589.\\n    - 10-12\uc6d4\uae4c\uc9c0\ub294 \uc11c\ube44\uc2a4 \ud3ec\ud138 \uc624\ud508 \ubc0f \uace0\ub3c4\ud654, \ub2e4\uc74c \ub2e8\uacc4 \uc11c\ube44\uc2a4 \uae30\ud68d \uc218\ud589\ud568.\\n\\n- Main Tools\\n    - Python, Node.js, Java(Springboot)\\n    - AWS - ECS, Lambda, CloudFront, Athena, Glue, S3, SageMaker\\n    - IBM Cloud - Object Storage\\n    - Github Team\\n    - CircleCI, Github Action\\n\\n- Side (Community\ud3ec\ud568)\\n    - \ubc88\uc5ed : [\ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \uc778\ud504\ub77c\uc2a4\ud2b8\ub7ed\ucc98 \ubaa8\ub2c8\ud130\ub9c1 [\uac00\uc0c1\uba38\uc2e0, \ucee8\ud14c\uc774\ub108 \ud658\uacbd\uc758 \ud504\ub85c\uba54\ud14c\uc6b0\uc2a4 \ubaa8\ub2c8\ud130\ub9c1 \uc2e4\uc2b5\uacfc \ud65c\uc6a9]](http://acornpub.co.kr/book/monitoring-prometheus)\\n    - \ube14\ub85c\uadf8 \ud3ec\uc2a4\ud305 - 13\ud68c (\ubaa9\ud45c 25\ud68c \ubbf8\ub2ec\uc131)\\n    - \uc0ac\ub0b4 \uc5f0\uad6c \uacfc\uc81c - \uba40\ud2f0\ud074\ub77c\uc6b0\ub4dc \uad6c\ud604\uc744 \uc704\ud55c IaC \uc5f0\uad6c (5-10\uc6d4)\\n        - Terraform, Terratest, Ansible, Kubespary, CircleCI \uc870\ud569\uc73c\ub85c \ud558\ub098\uc758 \ud30c\uc774\ud504\ub77c\uc778\uc5d0\uc11c Bastion \uc5c6\uc774 \uba40\ud2f0 \ud074\ub77c\uc6b0\ub4dc(AWS, IBM, GCP) \ud658\uacbd\uc5d0 Elastic \ubc0f K8s \ud074\ub7ec\uc2a4\ud130 \ubc30\ud3ec \ubc0f \ud14c\uc2a4\ud2b8 \uc790\ub3d9\ud654 \ud658\uacbd \uad6c\uc131\\n    - Istio \uc2a4\ud130\ub514 (9-11\uc6d4)\\n        - \ub2e4\uc591\ud55c \ud68c\uc0ac\ubd84\ub4e4\uacfc \uc2a4\ud130\ub514 \uc9c4\ud589 (\uce74\uce74\uc624\ubc45\ud06c, \uc774\ubca0\uc774, \ud558\uc774\ud37c\ucee4\ub125\ud2b8)\\n            - \ub2e4\uc591\ud55c \uacbd\ud5d8\uc744 \ub4e4\uc744\uc218 \uc788\uc5b4\uc11c \uc88b\uc740 \uacbd\ud5d8!!\\n        - \uc790\ub8cc : [https://github.com/dev-chulbuji/istio-study](https://github.com/dev-chulbuji/istio-study)\\n    - K8s Korea Group \ubaa8\ub2c8\ud130\ub9c1 \uc18c\ubaa8\uc784 \uc9c4\ud589\\n        - 1\ucc28 (4/25) SK u-tower\\n            - \ubc1c\ud45c1 : OpenCensus with Prometheus and Kubernetes (\uae40\uc9c4\uc6c5)\\n            - \ubc1c\ud45c2 - Service Mesh(Istio) Monitoring (\ub098\uc815\ud638)\\n        - 2\ucc28(6/4) \uba54\uac00\uc874\\n            - \ubc1c\ud45c1 : \ucfe0\ubc84\ub124\ud2f0\uc2a4 \uc6b4\uc601 \uad00\ub9ac \uc624\ud508\uc18c\uc2a4: NexClipper \uc18c\uac1c (\uae40\uc9c4\uc6a9)\\n            - \ubc1c\ud45c2 : \ub09c\uc0c1\ud1a0\uc758 (\ubaa8\ub2c8\ud130\ub9c1, \uc544\ud0a4\ud14d\ucc98 \uacbd\ud5d8 \ub4f1 \uc790\uc720\uc8fc\uc81c \uacf5\uc720, \ud1a0\uc758)\\n    - AWS Korea User \uc18c\ubaa8\uc784 \ucc38\uc5ec\\n        - \ud310\uad50, \ucee8\ud14c\uc774\ub108, \uc11c\ubc84\ub9ac\uc2a4, \ub370\uc774\ud130 \uc0ac\uc774\uc5b8\uc2a4, \uba38\uc2e0\ub7ec\ub2dd \uc2a4\ud130\ub514, \ub370\ube0c\uc635\uc2a4\\n    - CircleCI \ubc0b\uc5c5 \ucc38\uc5ec\\n        - 1\ucc28 (5/14), 2\ucc28 (8/27)\\n    - Open Infrastructure & Cloud Native Days Korea 2019 \ucc38\uc5ec (7/18-19)\\n    - Kubernetes Forum Seoul \ucc38\uc5ec (12/9)\\n        - CFP \ud0c8\ub77d \u3160\u3160\\n    - \uac1c\uc778 \uc11c\ubc84, NAS 2\ub300 Shutdown (\uc804\uae30\uc138 \uc555\ubc15\uc5d0\uc11c \ud574\ubc29\ub428)\\n        - G Suite Business \ub85c \uac08\uc544\ud0d0\\n    - \ubbf8\ub514\uc5b4 \ud658\uacbd \uac1c\ud3b8\\n        - \uc2a4\ub9c8\ud2b8TV \uc9c1\uad6c (75SM8670PUA)\\n        - PS4 \uad6c\ub9e4 (\ub2cc\ud150\ub3c4 \uc2a4\uc704\uce58, Xbox \uae30\uc874\ubcf4\uc720)\\n    - K3s Home Lab\uad6c\uc131 \ubc0f \uc774\ub354\ud328\ub4dc \uc11c\ube44\uc2a4 \uc6b4\uc601\\n        - 1.16 \ud074\ub7ec\uc2a4\ud130 : 1 Master, 3 Workers\\n    - \ub3c5\uc11c\\n        - 20\uad8c \ub0b4\uc678 (\uae30\uc220\uc11c \ud3ec\ud568)\\n    - \uad50\uc721\\n        - Google Study Jam - \ud074\ub77c\uc6b0\ub4dc 4\ud68c, \uba38\uc2e0\ub7ec\ub2dd 4\ud68c \uc218\ub8cc\\n        - Udemy - CKA, CKAD\\n        - Elasticsearch Engineer I, II\\n\\n- Speak\\n    - 2018\ub144\uc5d0 \ube44\ud574 \ub300\uc678 \ubc1c\ud45c\uac00 \ub9ce\uc774 \uc801\uc5c8\ub2e4. \uc2e4\uc81c K8s \uad00\ub828 \uc5c5\ubb34\ub97c \ud558\uc9c0 \uc54a\uc544 \uadf8\ub7f0 \ub4ef \ud558\ub2e4.\\n    - 4\uc6d4 AWS Korea User Group \ud310\uad50\uc18c\ubaa8\uc784\\n        - [Amazon EKS Workshop \uc0b4\ud3b4\ubcf4\uae30](https://www.slideshare.net/JinwoongKim8/eks-workshop-140043415)\\n    - 4\uc6d4 Kubernetes Korea Group \ubaa8\ub2c8\ud130\ub9c1 \uc18c\ubaa8\uc784\\n        - [Opencensus with prometheus and kubernetes](https://www.slideshare.net/JinwoongKim8/open-census-with-prometheus-and-kubernetes)\\n    - 4\uc6d4 Google Cloud Next \u201819 Extended Korea\\n        - [Knative\ub85c \uc11c\ubc84\ub9ac\uc2a4 \uc6cc\ud06c\ub85c\ub4dc \uad6c\ud604](https://www.slideshare.net/JinwoongKim8/knative)\\n    - 6\uc6d4 Korea DevOps MeetUP \u201819 - 4\uc6d4 \ubc1c\ud45c \uc218\uc815\\n        - [OpenCensus with Prometheus and Kubernetes](https://www.slideshare.net/JinwoongKim8/opencensus-with-prometheus-and-kubernetes)\\n    - 7\uc6d4 CircleCI Korea User Group 2nd Meetup\\n        - [Data(?)Ops with CircleCI](https://www.slideshare.net/JinwoongKim8/dataops-with-circleci)\\n    - 9\uc6d4 AWS Korea User Group \ud310\uad50\uc18c\ubaa8\uc784\\n        - [DataOps with CircleCI](https://www.slideshare.net/JinwoongKim8/dataops-with-circleci)\\n    - 11\uc6d4 \uc0ac\ub0b4 Open Tech Lounge \ubc1c\ud45c\\n        - \uba40\ud2f0\ud074\ub77c\uc6b0\ub4dc \uad6c\ud604\uc744 \uc704\ud55c IaC \uc5f0\uad6c\\n\\n- 2020 \ubaa9\ud45c\\n    - \ucee4\ubba4\ub2c8\ud2f0 \ud65c\ub3d9\uc740 \ucd5c\ub300\ud55c \uc904\uc774\uae30 (\ud544\uc218\uc801\uc778 \ubd80\ubd84\ub9cc)\\n        - SRE group \ud65c\uc131\ud654 \ubc29\uc548 \uace0\ubbfc\\n        - \ubc0b\uc5c5, \uc138\ubbf8\ub098 \uad00\ub828 \uce98\ub9b0\ub354 \uc5f0\ub3d9 \uc790\ub3d9\ud654 \ubc29\uc548 \uace0\ubbfc\\n    - \ubc88\uc5ed \ubc0f \ucc45 \uc4f0\ub294\uac74 \uace0\ubbfc\uc744 \ub354...\\n    - Level Up\\n        - \uc601\uc5b4!! - \ubc1c\ud45c\uae4c\uc9c0\\n        - Full-Stack ??\\n        - \uba38\uc2e0\ub7ec\ub2dd, \ub525\ub7ec\ub2dd\\n        - ELK \ucffc\ub9ac \uc798\uc9dc\uae30\\n        - NoSQL\\n    - \uae30\uc874\uc5c5\ubb34 K8s \uc804\ud658 \ubc0f \uace0\ub3c4\ud654\\n        - \uc11c\ubc84\ub9ac\uc2a4, \ub9e4\ub2c8\uc9c0\ub4dc \ubc29\ud5a5\uc73c\ub85c\\n    - \uc0ac\uc774\ub4dc \ud504\ub85c\uc81d\ud2b8\\n        - \ud648 \ubbf8\ub514\uc5b4 \uad00\ub9ac \uace0\ub3c4\ud654 (Plex)\\n        - [nextcloud](https://nextcloud.com/) \uc11c\ube44\uc2a4 \uc624\ud508 (\uc9c0\uc778 \ub300\uc0c1)\\n        - \ubaa8\ubc14\uc77c \uc6f9\uc571 3\uac1c \ub9cc\ub4e4\uae30 (\ubbf8\ub514\uc5b4 \uad00\ub9ac, \ucf54\ubbf9 \ubdf0\uc5b4, \uc2a4\ud2b8\ub9ac\ubc0d)\\n        - \uc624\ud508\uc18c\uc2a4 \uae30\uc5ec"},{"id":"devops/circleci-ecs/","metadata":{"permalink":"/devops/circleci-ecs/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-06-30-circleci-ecs.md","source":"@site/blog/2019-06-30-circleci-ecs.md","title":"CircleCI\ub85c AWS BATCH(ECS) CI/CD Pipeline \uad6c\uc131","description":"\uc774\uc804 \ud3ec\uc2a4\ud305\uc5d0\uc11c EKS \ud074\ub7ec\uc2a4\ud130\uc640 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ubc30\ud3ec \ubc0f \ud14c\uc2a4\ud2b8\ub97c \uac04\ub2e8\ud558\uac8c \ud574\ubd24\ub2e4.  \uc774\ubc88\uc5d0\ub294 AWS ECS \ub610\ub294 AWS Batch Application\uc744 CircleCI\ub97c \ud1b5\ud574 \ubc30\ud3ec \ubc0f \uc5c5\ub370\uc774\ud2b8 \ud558\ub294 \uac83\uc744 \uc54c\uc544\ubcf8\ub2e4.","date":"2019-06-30T00:00:00.000Z","formattedDate":"June 30, 2019","tags":[{"label":"DevOps","permalink":"/tags/dev-ops"},{"label":"CI/CD","permalink":"/tags/ci-cd"},{"label":"Pipeline","permalink":"/tags/pipeline"},{"label":"CircleCI","permalink":"/tags/circle-ci"},{"label":"GitHub","permalink":"/tags/git-hub"},{"label":"GitOps","permalink":"/tags/git-ops"},{"label":"ECS","permalink":"/tags/ecs"},{"label":"AWS Batch","permalink":"/tags/aws-batch"}],"readingTime":10.595,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"CircleCI\ub85c AWS BATCH(ECS) CI/CD Pipeline \uad6c\uc131","comments":true,"classes":"wide","slug":"devops/circleci-ecs/","date":"2019-06-30T00:00:00.000Z","categories":["DevOps"],"tags":["DevOps","CI/CD","Pipeline","CircleCI","GitHub","GitOps","ECS","AWS Batch"]},"prevItem":{"title":"2019 Retrospective","permalink":"/retrospective/2020plan/"},"nextItem":{"title":"CircleCI - GitHub \uc5f0\ub3d9 \ubc0f EKS \uad6c\uc131\ud558\uae30","permalink":"/devops/circleci/"}},"content":"[\uc774\uc804 \ud3ec\uc2a4\ud305](https://ddii.dev/devops/circleci/)\uc5d0\uc11c EKS \ud074\ub7ec\uc2a4\ud130\uc640 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \ubc30\ud3ec \ubc0f \ud14c\uc2a4\ud2b8\ub97c \uac04\ub2e8\ud558\uac8c \ud574\ubd24\ub2e4.  \uc774\ubc88\uc5d0\ub294 AWS ECS \ub610\ub294 AWS Batch Application\uc744 CircleCI\ub97c \ud1b5\ud574 \ubc30\ud3ec \ubc0f \uc5c5\ub370\uc774\ud2b8 \ud558\ub294 \uac83\uc744 \uc54c\uc544\ubcf8\ub2e4.  \\n\\n## Application \uc694\uad6c\uc0ac\ud56d\\n\uae30\ubcf8\uc801\uc73c\ub85c \ud604\uc7ac \uc5c5\ubb34 \uc911\uc5d0 IBM\ud074\ub77c\uc6b0\ub4dc\uc5d0\uc11c AWS\ub85c \ub370\uc774\ud130\ub97c \uac00\uc838\uc640\uc57c \ud558\ub294 \uc5c5\ubb34\uac00 \uc0dd\uaca8\uc11c \uc2dc\uc791\ub418\uc5c8\uace0 \uc815\uae30\uc801\uc73c\ub85c \ub9e4\uc77c \uc0c8\ubcbd\uc5d0 \ud06c\ub864\ub9c1(Pull)\ubc29\uc2dd\uc73c\ub85c \ub370\uc774\ud130\ub97c \ubcf5\uc81c\ud574\uc57c\ud558\ub294 Use-Case\ub97c \uad6c\ud604\ud574\uc57c \ud588\ub2e4.  \\nCI/CD Pipeline\uad6c\uc131\uc774 \uc8fc \ubaa9\uc801\uc73c\ub85c Application\uad6c\ud604\uc740 \ud3ec\uc2a4\ud305 \ub0b4\uc6a9\uc5d0\uc11c \uc81c\uc678\ud558\uc600\ub2e4.  \\n\\n### \uae30\ubcf8 \uc694\uad6c\uc0ac\ud56d\\n* Github Account\\n* CircleCI Account (Github Auth)\\n* AWS ECR(Elastic Container Registry)\\n* AWS Batch(ECS) \\n\\n## CI/CD \uad6c\uc131\uc548\\n\\n\uc2e4\uc81c \ud504\ub85c\uc81d\ud2b8\uc5d0 \uc801\uc6a9\ud560 \uad6c\uc131\uc548\uc774\ub2e4.  \\n\uae30\ubcf8\uc801\uc73c\ub85c \ubaa8\ub4e0 \uad6c\uc131\uc740 \ucd5c\ub300\ud55c \ube44\uc6a9\uc774 \ub4e4\uc9c0 \uc54a\uace0 AWS \uc885\uc18d\uc131\uc744 \uc81c\uac70\ud55c \ubc29\ubc95\uc73c\ub85c \uad6c\uc131\ud558\uc600\ub2e4.  \\n\\n* Code Repository : Github\\n* CI : CircleCI\\n* Registry : AWS ECR\\n* CD : CircleCI\\n* Target : AWS Batch(ECS)\\n* Notification : Slack\\n\\n\uc774\ubc88 \ub370\ubaa8\uc5d0\uc11c\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \uc2dc\ub098\ub9ac\uc624\ub85c \uc9c4\ud589\ud558\ub824\uace0 \ud55c\ub2e4.  \\n1. Terraform\uc73c\ub85c AWS Batch \uc0dd\uc131\\n2. Github\uc5d0 \uc218\uc815\ub41c Batch Code(Shell Script) Commit & Triggering CircleCI\\n3. Docker Build & AWS ECR\ub85c Push\\n4. S3\ub85c myjob shell \ud30c\uc77c \ubcf5\uc0ac\\n5. AWS Batch(ECS) Job Definition \ubcc0\uacbd(Change Image)\\n\\n### AWS Batch\\n\uae30\ubcf8\uc801\uc73c\ub85c Batch \ucef4\ud4e8\ud305\uc744 \ubaa9\uc801\uc73c\ub85c \ud558\ub294 \uc11c\ube44\uc2a4\ub85c \ucef4\ud4e8\ud305 \ud0c0\uc785\uc744 Fargate \ub610\ub294 EC2 \uc911 \ud558\ub098\ub97c \uc120\ud0dd\ud558\uc5ec \ub3d9\uc801\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ud558\ub294 \uc11c\ube44\uc2a4\uc774\ub2e4.  \\n\ucd08\uae30 \uc124\uc815\uc774 \ubc88\uac70\ub86d\uae34 \ud558\uc9c0\ub9cc \ud55c\ubc88 \uad6c\uc131\ud558\uace0 \ub098\uba74 \ubcc4\ub3c4 \uad00\ub9ac\uac00 \ud544\uc694\uc5c6\uace0 Batch\uc791\uc5c5\uc774 \ubc1c\uc0dd\ud558\ub294\uac83\uacfc \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \ubcf4\uad00\ube44\uc6a9 \uc774\uc678\uc5d0\ub294 \ucd94\uac00 \ube44\uc6a9\uc774 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 \ube44\uc6a9\uce21\uba74\uc5d0\uc11c \uc7a5\uc810\uc774 \uc788\ub294 \uc11c\ube44\uc2a4\uc774\ub2e4.  \\n\uc704\uc5d0\uc11c \uc774\uc57c\uae30\ud55c \uc815\uae30\uc801\uc73c\ub85c \uc0c8\ubcbd\ub9c8\ub2e4 \ud06c\ub864\ub9c1(Pull)\ubc29\uc2dd\uc73c\ub85c \ub370\uc774\ud130\ub97c \ubcf5\uc81c\ud574\uc57c\ud558\ub294 Use-Case\ub97c \uad6c\ud604\ud558\ub294\uac83\uc774 \uc801\ub2f9\ud55c \uc6cc\ud06c\ub85c\ub4dc \uad6c\ud604\ubc29\ubc95\uc774\ub77c \uc0dd\uac01\ud588\uae30 \ub54c\ubb38\uc5d0 AWS Batch \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\uac8c \ub418\uc5c8\ub2e4.  \\n\\n\uac04\ub2e8\ud55c Batch demo\ub294 [https://github.com/awslabs/aws-batch-helpers/](https://github.com/awslabs/aws-batch-helpers/)\uc5d0\uc11c \ud655\uc778\uc774 \uac00\ub2a5\ud558\uba70 CircleCI\uc5f0\ub3d9\uc744 \uc704\ud574 Fork\ud6c4  \uc9c4\ud589\ud558\uc600\ub2e4.\\n\\nDemo Repository : [https://github.com/ddiiwoong/aws-batch-helpers/](https://github.com/ddiiwoong/aws-batch-helpers/)\\n\\n### CircleCI\\n\ubaa8\ub4e0 Pipeline\uc740 CircleCI\uae30\ubc18\uc73c\ub85c \uc791\uc131\ud558\uc600\ub2e4.  \ud639\uc790\ub294 AWS Code Commit, Pipeline\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub290\ub0d0\uace0 \ubb38\uc758\ud558\uc2dc\ub294 \ubd84\ub4e4\ub3c4 \uc788\ub294\ub370 \ub2e4\uc74c\uacfc \uac19\uc740 \uc774\uc720\ub85c CircleCI\ub97c \uc120\ud0dd\ud558\uc600\ub2e4.  \\n\\n* Fully Managed (Serverless)\\n* AWS \uc885\uc18d\uc131 \ucd5c\uc18c\ud654  \\n* Git, Registry, CD\uc601\uc5ed\uc758 \ud655\uc7a5\uc131 \uace0\ub824\\n* AWS Console \uc811\uc18d \ucd5c\uc18c\ud654\\n* \uc27d\uace0 \ub2e8\uc21c\ud558\uac8c \ube4c\ub4dc \ud658\uacbd\uad6c\uc131\\n* \uc18c\uaddc\ubaa8 \ud504\ub85c\uc81d\ud2b8 \ube60\ub974\uac8c \uc2dc\uc791 \uac00\ub2a5\\n\\n### Amazon Elastic Container Registry (ECR)\\n\uac1c\uc778\uc801\uc73c\ub85c Registry\ub294 \uad6c\ucd95\ud615\ubcf4\ub2e4\ub294 Managed\uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub294\uac83\uc774 \uc88b\ub2e4\uace0 \ubcf4\uae30 \ub54c\ubb38\uc5d0 Webhook\uc744 Native\ud558\uac8c \uc9c0\uc6d0\ud558\ub294 DockerHub\ub3c4 \ub300\uccb4 \uac00\ub2a5\ud558\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4.  \\n* Fully Managed\\n* Security (IAM) \uc5f0\ub3d9\\n* CircleCI Orbs \uc81c\uacf5\\n* EKS, ECS \uc5f0\ub3d9 \uc6a9\uc774\\n\\n### Terraform\\n\\n[https://www.terraform.io/docs/providers/aws/index.html](https://www.terraform.io/docs/providers/aws/index.html)  \\n\\n\uc120\uc5b8\uc801 \uc778\ud504\ub77c\uc2a4\ud2b8\ub7ed\ucc98 \uad00\ub9ac \ub3c4\uad6c\ub85c \ub9ce\uc774 \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 \ub3c4\uad6c\uc774\uba70 Docs\uc640 \ube14\ub85c\uadf8 \uc790\ub8cc\uac00 \ub9ce\uc740 \uad00\uacc4\ub85c \ub530\ub85c \uc124\uba85\ud558\uc9c0 \uc54a\uaca0\ub2e4.  \\n\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 AWS Batch\ub97c \uc0dd\uc131\ud558\ub294 \uc601\uc5ed\uc744 Terraform\uc774 \ub2f4\ub2f9\ud55c\ub2e4.  \\n\\n## CircleCI Config \uc791\uc131\\n```yaml\\nversion: 2.1\\norbs:\\n  aws-ecr: circleci/aws-ecr@6.1.0\\n  aws-ecs: circleci/aws-ecs@0.0.8\\n  aws-s3: circleci/aws-s3@1.0.11\\n  aws-cli: circleci/aws-cli@0.1.13\\njobs:\\n  sh-s3-upload:\\n    docker:\\n      - image: \'circleci/python:2.7\'\\n    steps:\\n      - checkout\\n      - aws-s3/copy:\\n          from: ./myjob.sh\\n          to: \'s3://batch-ecr-test/myjob.sh\'\\n  deploy-batch:\\n    executor: aws-cli/default\\n    steps:\\n      - checkout\\n      - aws-cli/install\\n      - run:\\n          name: Update AWS Batch Job\\n          command: |\\n            aws batch register-job-definition --job-definition-name fetch_and_run --type container --container-properties \'{ \\"image\\": \\"823928750534.dkr.ecr.ap-northeast-2.amazonaws.com/fetch_and_run:v20190623\\", \\"vcpus\\": 1, \\"memory\\": 512}\'\\nworkflows:\\n  build-and-deploy:\\n    jobs:\\n      - aws-ecr/build-and-push-image:\\n          repo: $AWS_RESOURCE_NAME_PREFIX\\n          tag: v20190623\\n      - sh-s3-upload:\\n          name: sh-s3-upload\\n          requires:\\n            - aws-ecr/build-and-push-image\\n      - deploy-batch:\\n          name: deploy-batch\\n          requires:\\n            - sh-s3-upload\\n```\\n\\n\ub2e8\uacc4\ubcc4 \uc124\uba85\uc744 \uc704\ud574 \ubd80\ubd84\uc801\uc73c\ub85c \uc124\uba85\ud558\ub3c4\ub85d \ud558\uaca0\ub2e4.  \\n1. Terraform\uc73c\ub85c Batch \ubc30\ud3ec\\n    ```json\\n    resource \\"aws_batch_compute_environment\\" \\"default\\"{ \\n      compute_environment_name = \\"env_fetch_and_run\\" \\n      compute_resources { \\n        instance_role = \\"arn:aws:iam::823928750534:instance-profile/ecsInstanceRole\\" \\n        instance_type = [\\n          \\"optimal\\",\\n        ]\\n        desired_vcpus = 1 \\n        max_vcpus = 1 \\n        min_vcpus = 0 \\n        security_group_ids = [\\n          \\"sg-0632cf81b5c4dff17\\" \\n        ]\\n        subnets = [\\n          \\"subnet-0c4f8135b536e8fab\\",\\n          \\"subnet-0a261950d894cf27e\\"\\n        ] \\n        type = \\"EC2\\" \\n      } \\n      service_role = \\"arn:aws:iam::823928750534:role/service-role/AWSBatchServiceRole\\" \\n      type =\\"MANAGED\\"\\n    }\\n    ```\\n    Batch Computing \ud658\uacbd\uc744 \uad6c\uc131\ud558\uac8c \ub418\ub294\ub370 `\\"aws_batch_compute_environment\\"`\ub97c \uc0ac\uc6a9\ud55c\ub2e4.  \\n    * compute_environment_name : (\ud544\uc218) \ucef4\ud4e8\ud305 \ud658\uacbd \uc774\ub984\\n    * compute_resources.instance_role : (\ud544\uc218) EC2\uc5d0 \uc801\uc6a9\ub418\ub294 Role\\n    * compute_resources.instance_type : (\ud544\uc218) \uc0ac\uc6a9 \uac00\ub2a5\ud55c instance \uc720\ud615\\n    * compute_resources.desired_vcpus : (\uc635\uc158) \uc6d0\ud558\ub294 CPU\uc218\\n    * compute_resources.max_vcpus : (\ud544\uc218) \ucd5c\ub300 CPU\uc218  \\n    * compute_resources.min_vcpus : (\ud544\uc218) \ucd5c\uc18c CPU\uc218\\n    * compute_resources.security_group_ids : (\ud544\uc218) EC2\uc5d0 \uc801\uc6a9\ub418\ub294 Security Group\\n    * compute_resources.subnets : (\ud544\uc218) Subnets \ubaa9\ub85d\\n    * compute_resources.type : (\ud544\uc218) EC2\ub97c \uae30\ubc18\uc73c\ub85c \uc0dd\uc131, SPOT instance \uc0ac\uc6a9\uac00\ub2a5  \\n    * service_role : (\ud544\uc218) AWS Batch\uac00 \ub2e4\ub978 AWS \uc11c\ube44\uc2a4\ub97c \ud638\ucd9c \ud560\uc218\uc788\uac8c \ud574\uc8fc\ub294 IAM Role(ARN)\\n    * type : (\ud544\uc218) MANAGED\ub098 UNMANAGED\ub97c \uc120\ud0dd\ud560 \uc218 \uc788\uace0, MANAGED\uc758 \uacbd\uc6b0 compute_resources\uc5d0 \uc138\ubd80 \uc0ac\ud56d\uc744 \uc124\uc815\ud560 \uc218 \uc788\ub2e4.  \\n\\n    ```json\\n    resource \\"aws_batch_job_definition\\" \\"default\\" {\\n      name = \\"fetch_and_run\\" \\n      type = \\"container\\"\\n\\n      container_properties = <<CONTAINER_PROPERTIES\\n    {\\n        \\"command\\": [],\\n        \\"image\\": \\"823928750534.dkr.ecr.ap-northeast-2.amazonaws.com/fetch_and_run:v20190623\\",\\n        \\"vcpus\\": 1,\\n        \\"memory\\": 512,\\n        \\"volumes\\": [],\\n        \\"environment\\": [],\\n        \\"mountPoints\\": [],\\n        \\"ulimits\\": [] \\n    }\\n    CONTAINER_PROPERTIES\\n    }\\n    ```\\n    Job Definition \uc815\uc758(\\"aws_batch_job_definition\\")\uc5d0\uc11c\ub294 Resource spec \ubc0f Command(Docker RUN), Container IMAGE \ub4f1\uc744 \uc120\uc5b8\ud558\uac8c \ub41c\ub2e4.  \\n    * name : (\ud544\uc218) Job Definition \uc774\ub984\\n    * type : (\ud544\uc218) Job Definition \uc720\ud615, ECS\ub85c \ucc98\ub9ac\ud558\uae30 \uc704\ud574 container\ub85c \uc120\ud0dd\\n    * container_properties : (\uc120\ud0dd) JSON \ud615\ud0dc\ub85c \uc791\uc131\ud558\ub294 container \uc18d\uc131\uc815\ubcf4 (Image, Resources, Command, MountPoint \ub4f1)\\n\\n2. .circleci/config.yml\uc5d0 CircleCI \ubc84\uc804 \uba85\uc2dc \ubc0f \uad00\ub828 orb(ecr,ecs,s3,cli) \ucd94\uac00  \\n    \uae30\ubcf8\uc801\uc73c\ub85c 2.1\ub85c \uc124\uc815\uc744 \ud574\uc57c ecs, eks orb \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\ub2e4.\\n    ```yaml\\n    version: 2.1\\n      orbs:\\n        aws-ecr: circleci/aws-ecr@6.1.0\\n        aws-ecs: circleci/aws-ecs@0.0.8\\n        aws-s3: circleci/aws-s3@1.0.11\\n        aws-cli: circleci/aws-cli@0.1.13\\n    ```\\n\\n3. workflow \uad6c\uc131\\n\\n    `build-and-push-image` -> `sh-s3-upload` -> `deploy-batch` \uc21c\uc73c\ub85c \uc21c\ucc28\uc801\uc73c\ub85c pipeline\uad6c\uc131\uc744 \ud558\uc600\ub2e4.  \\n\\n    ```\\n    workflows:\\n      build-and-deploy:\\n        jobs:\\n          - aws-ecr/build-and-push-image:\\n              repo: $AWS_RESOURCE_NAME_PREFIX # data-crawler-test\\n              tag: v20190623\\n              # create-repo: true\\n              # dockerfile: Dockerfile\\n          - sh-s3-upload:\\n              name: sh-s3-upload\\n              requires:\\n                - aws-ecr/build-and-push-image\\n          - deploy-batch:\\n              name: deploy-batch\\n              requires:\\n                - sh-s3-upload\\n    ```\\n\\n    \uae30\ubcf8\uc801\uc73c\ub85c CircleCI\uc5d0\uc11c\ub294 orb job\uc744 [orb name]/[predefined-job] \ud615\uc2dd\uc73c\ub85c \uc120\uc5b8\ud55c\ub2e4.  \\n\\n    I. \uccab\ubc88\uc9f8 step\uc5d0\uc11c\ub294 container image\ub97c build\ud558\uace0 push\ud558\ub294 Job\uc744 \uc218\ud589\ud558\ubbc0\ub85c `aws-ecr/build-and-push-image`\uc744 \uc120\uc5b8\ud55c\ub2e4.  \\n    \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 [https://circleci.com/orbs/registry/orb/circleci/aws-ecr](https://circleci.com/orbs/registry/orb/circleci/aws-ecr)\ub97c \ud655\uc778\ud558\uc790.  \\n\\n    II. \ub450\ubc88\uc9f8 step\uc5d0\uc11c\ub294 S3\uc5d0 \ubc30\uce58\uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc62c\ub9ac\ub294 Custom Job\uc744 \uc218\ud589\ud55c\ub2e4.  Job\uc740 Step\uc758 \ubaa8\uc74c\uc73c\ub85c \uc120\ud589\ub418\uc5b4\uc57c\ud560 Job\uc740 \uc0c1\uc704\uc5d0 `requires:` \uc5d0\uc11c \uc120\uc5b8\ud558\uba74 \ub41c\ub2e4.  \\n\\n    III. \uc138\ubc88\uc9f8 step\uc5d0\uc11c\ub294 AWS Batch job definition\uc758 container image\ub97c \uad50\uccb4(revision \ubcc0\uacbd)\ud558\ub294 Custom Job\uc744 \uc218\ud589\ud55c\ub2e4.  \\n\\n4. custom job \uad6c\uc131\\n    Workflow\uc5d0\uc11c \uc120\uc5b8\ud55c Custom Job\uc758 \uc0c1\uc138 definition\uc744 \uae30\uc7ac\ud55c\ub2e4.  \\n    ```yaml\\n    jobs:\\n      sh-s3-upload:\\n        docker:\\n          - image: \'circleci/python:2.7\'\\n        steps:\\n          - checkout\\n          - aws-s3/copy:\\n              from: ./myjob.sh\\n              to: \'s3://batch-ecr-test/myjob.sh\'\\n      deploy-batch:\\n        executor: aws-cli/default\\n        steps:\\n          - aws-cli/install\\n          - run:\\n              name: Update AWS Batch Job\\n              command: |\\n                aws batch register-job-definition --job-definition-name fetch_and_run --type container --container-properties \'{ \\"image\\": \\"823928750534.dkr.ecr.ap-northeast-2.amazonaws.com/fetch_and_run:v20190623\\", \\"vcpus\\": 1, \\"memory\\": 512}\'\\n    ```\\n    I. `sh-s3-upload` \uc5d0\uc11c\ub294 `aws-s3/copy` \ub97c \uc0ac\uc6a9\ud558\uc5ec \uc6d0\ud558\ub294 S3\ubc84\ud0b7\uc5d0 \uc0ac\uc6a9\ud560 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \uc5c5\ub85c\ub4dc \ud55c\ub2e4.  `checkout`\uc5d0\uc11c\ub294 \ud604\uc7ac \uc0c1\ud0dc\uc758 git repo\ub97c clone\ud558\uac8c \ub41c\ub2e4.  \\n\\n    II. `deploy-batch` \uc5d0\uc11c\ub294 `aws-cli/install` \ub97c \uc0ac\uc6a9\ud558\uc5ec \uae30\uc874\uc5d0 \uc791\uc131\ud55c Batch Job definition\uc744 awscli\ub85c \uc6d0\ud558\ub294 \uc0c8\ub85c\uc6b4 image\ub85c \uc5c5\ub370\uc774\ud2b8 \ud558\uac8c \ub41c\ub2e4.  \\n\\n## CircleCI \uc2e4\ud589\\n\ube4c\ub4dc \ubc0f \ubc30\ud3ec\uacfc\uc815\uc744 \uac04\ub2e8\ud558\uac8c \uc124\uba85\ud558\uba74 \ucf54\ub4dc\uac00 \uc5c5\ub370\uc774\ud2b8\ub418\uba74 CircleCI\ub294 \ud574\ub2f9 \uc800\uc7a5\uc18c\uc758 `.circleci/config.yml` \uc744 \uae30\uc900\uc73c\ub85c \ube4c\ub4dc \ubc0f \ubc30\ud3ec\ub97c \uc2dc\uc791\ud558\uac8c \ub41c\ub2e4.  \\n\\n## README.md\uc5d0 Build Status Badge \ub2ec\uae30\\n[https://circleci.com/docs/2.0/status-badges/](https://circleci.com/docs/2.0/status-badges/)  \\n\\n![badge](/img/circle-badge.png)\\n\uc704 \ub9c1\ud06c\uc640 \uc124\uc815\uc744 \ucc38\uace0\ud558\uc5ec \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 Build Statud Badge\ub97c \ub2ec \uc218 \uc788\ub2e4.  \\n\\n![badge](/img/circle-badge-ss.png)\\n\\n## \uc815\ub9ac\\n\uc774\ubc88\uc5d0\ub294 CircleCI\ub97c \uac00\uc9c0\uace0 AWS Batch job\uc744 \uad6c\uc131\ud558\ub294 \ub370\ubaa8\ub97c \uc9c4\ud589\ud558\uc600\ub2e4.  \\n\\n\uc5bc\ub9c8\uc804\uc778\uac00\uc5d0\ub3c4 [\uc5b4\ud615\ubd80\ud615](https://github.com/leoh0)\ub2d8\uaed8\uc11c\ub3c4 \uc5b8\uae09\ud558\uc2e0 \uc120\uc5b8\uc801\uc778 \uad6c\uc131 \uae30\ubc18\uc5d0 \ucd5c\ub300\ud55c serverless \ud658\uacbd\uc5d0\uc11c\uc758 \ubc30\ud3ec\ub97c \ucd94\uad6c\ud558\uac8c \ub418\ub2e4 \ubcf4\ub2c8 \uc544\ub798\uc640 \uac19\uc740 `CI/CD Pipeline \uc2dc\ub098\ub9ac\uc624`\ub97c \uad6c\uc0c1\ud558\uac8c \ub418\uc5c8\ub2e4.  \\n\\n![cicd](/img/circlecicd.png)\\n\\n\uc0c8\ub85c\uc6b4 \uae30\ub2a5\uc758 \ube0c\ub79c\uce58(New Feature)\uac00 Git\uc5d0 push\ub418\uba74 \ube4c\ub4dc\uc640 \ud14c\uc2a4\ud2b8\uac00 \ud2b8\ub9ac\uac70\ub418\uc5b4 \uc790\ub3d9\uc73c\ub85c \uc9c4\ud589\ub418\uace0 \ub3d9\uc2dc\uc5d0 \uac1c\ubc1c\uc790\uac00 PR\uc744 \uc791\uc131\ud558\uba74 \ub3d9\ub8cc \ubc0f \ub2f4\ub2f9 \uc0c1\uae09\uc790\uc5d0\uac8c \ucf54\ub4dc \ub9ac\ubdf0\ub97c \ubc1b\uac8c \ub41c\ub2e4.  \\n\\n\ub9ac\ubdf0\uac00 \ud1b5\uacfc\ub418\uace0 CircleCI\uc5d0\uc11c \ube4c\ub4dc\uac00 \uc131\uacf5\ud588\ub2e4\uba74 \uc2b9\uc778\ub2e8\uacc4\ub97c \ud1b5\ud574 Merge\ub97c \ud558\uace0 CircleCI \uac00 \ud55c \ubc88 \ub354 \ube4c\ub4dc\ub97c \uc2dc\uc791\ud558\uace0 \ubc30\ud3ec\uae4c\uc9c0 \uc218\ud589\ud558\uac8c \ub41c\ub2e4.  \\n\\nECS\ub098 Batch\ub85c \ubc30\ud3ec\ub294 CircleCI\ub97c \ud1b5\ud574 \uc9c1\uc811 \ubc30\ud3ec\ub97c \ud558\uace0 EC2\ub098 EKS\ub85c\uc758 \ubc30\ud3ec\ub294 Terraform \ubc0f ArgoCD\ub97c \ud1b5\ud574 \ubc30\ud3ec\ub97c \uc9c4\ud589\ud558\ub294 \ubc29\uc2dd\uc774\ub2e4.  \\n\\n\ub2e4\uc74c\ubc88 \ud3ec\uc2a4\ud305\uc5d0\ub294 \uc704 \uadf8\ub9bc \uae30\ubc18\uc73c\ub85c CircleCI\uc640 ArgoCD\ub97c \ud65c\uc6a9\ud558\uc5ec EKS\uae30\ubc18 \ubc30\ud3ec\uacfc\uc815\uc744 \uc815\ub9ac\ud560 \uc608\uc815\uc774\ub2e4.  \\n\\n[![ko-fi](https://www.ko-fi.com/img/githubbutton_sm.svg)](https://ko-fi.com/X8X1W6OZ)"},{"id":"devops/circleci/","metadata":{"permalink":"/devops/circleci/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-06-18-circleci.md","source":"@site/blog/2019-06-18-circleci.md","title":"CircleCI - GitHub \uc5f0\ub3d9 \ubc0f EKS \uad6c\uc131\ud558\uae30","description":"CI/CD\ub294 \uac1c\ubc1c\ub2e8\uacc4\uc5d0\uc11c \uc9c0\uc18d\uc801\uc778 \ud1b5\ud569, \ubc30\ud3ec\ub97c \ud1b5\ud574 \ud6a8\uc728\uc131\uc744 \ub192\uc5ec\uc8fc\ub294 \ub3c4\uad6c\ub77c\uace0 \ub9d0\ud560\uc218 \uc788\ub2e4.  \ud2b9\ud788 GitOps\uac00 \uc911\uc694\uc2dc \ub418\ub294 \ucd5c\uadfc \ud2b8\ub80c\ub4dc\uc5d0\uc11c Public Git\uc11c\ube44\uc2a4\uc640 \ud1b5\ud569\uc740 \ud544\uc218\uc801\uc778 \uc694\uc18c\uc774\ub2e4.","date":"2019-06-18T00:00:00.000Z","formattedDate":"June 18, 2019","tags":[{"label":"DevOps","permalink":"/tags/dev-ops"},{"label":"CI/CD","permalink":"/tags/ci-cd"},{"label":"Pipeline","permalink":"/tags/pipeline"},{"label":"CircleCI","permalink":"/tags/circle-ci"},{"label":"GitHub","permalink":"/tags/git-hub"},{"label":"GitOps","permalink":"/tags/git-ops"},{"label":"EKS","permalink":"/tags/eks"}],"readingTime":10.68,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"CircleCI - GitHub \uc5f0\ub3d9 \ubc0f EKS \uad6c\uc131\ud558\uae30","comments":true,"classes":"wide","slug":"devops/circleci/","date":"2019-06-18T00:00:00.000Z","categories":["DevOps"],"tags":["DevOps","CI/CD","Pipeline","CircleCI","GitHub","GitOps","EKS"]},"prevItem":{"title":"CircleCI\ub85c AWS BATCH(ECS) CI/CD Pipeline \uad6c\uc131","permalink":"/devops/circleci-ecs/"},"nextItem":{"title":"Yaml \uc791\uc131 \uae30\ubcf8 Tip","permalink":"/kubernetes/CKAD-1/"}},"content":"CI/CD\ub294 \uac1c\ubc1c\ub2e8\uacc4\uc5d0\uc11c \uc9c0\uc18d\uc801\uc778 \ud1b5\ud569, \ubc30\ud3ec\ub97c \ud1b5\ud574 \ud6a8\uc728\uc131\uc744 \ub192\uc5ec\uc8fc\ub294 \ub3c4\uad6c\ub77c\uace0 \ub9d0\ud560\uc218 \uc788\ub2e4.  \ud2b9\ud788 GitOps\uac00 \uc911\uc694\uc2dc \ub418\ub294 \ucd5c\uadfc \ud2b8\ub80c\ub4dc\uc5d0\uc11c Public Git\uc11c\ube44\uc2a4\uc640 \ud1b5\ud569\uc740 \ud544\uc218\uc801\uc778 \uc694\uc18c\uc774\ub2e4. \\n\\n[GitHub MarketPlace](https://github.com/marketplace)\uc5d0\uc11c `CI` \ub77c\uace0 \uac80\uc0c9\ud558\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \uacb0\uacfc\ub97c \uc5bb\uc744\uc218 \uc788\ub2e4.  \\n\\n![github-ci](/img/github-ci.png)\\n\\nCircleCI, Travis CI, Google Cloud Build \ub4f1 \ucd5c\uadfc \ud2b8\ub80c\ub4dc\ud55c \ub3c4\uad6c\ub4e4\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 `CircleCI`\ub97c `GitHub`\uacfc \uc5f0\ub3d9\ud574\uc11c AWS ECR Push \ubc0f EKS\ub85c \ubc30\ud3ec\ud558\ub294 \uac04\ub2e8\ud55c Pipeline\uc744 \uad6c\uc131\ud558\ub294 \ubc29\ubc95\uc744 \uc801\uc5b4\ubcf4\uace0\uc790 \ud55c\ub2e4.  \\n\\n## CircleCI - GitHub Accout \uc5f0\ub3d9\\n\\n[circleci.com](https://circleci.com)\uc5d0 \uc811\uc18d\ud558\uc5ec Sign Up\uc744 \uc9c4\ud589\ud558\uba74 GitHub\uacfc BitBucket \uacc4\uc815\uc744 \uc5f0\ub3d9\ud560 \uc218 \uc788\ub294\ub370 \uc77c\ubc18\uc801\uc778 GitHub 3rd Party OAuth\uc5f0\ub3d9 \uc9c4\ud589\uc744 \ud558\uac8c\ub41c\ub2e4.  \\n\\n![init](/img/circleci-init.png)\\n\\n\uc704 \uadf8\ub9bc\ucc98\ub7fc \ubaa8\ub4e0 Repository\uac00 \ud655\uc778\ub418\uace0 Follow\ud560 Repository\ub97c \uc120\ud0dd\ud558\uba74 \ucd08\uae30 \uad6c\uc131\uc774 \uc644\ub8cc\ub41c\ub2e4.  \\n\\n![error](/img/init-error.png)\\n\\n\uccab \uc5f0\ub3d9\uc774 \ub418\uba74 Build\ub97c \uc9c4\ud589\ud558\uac8c \ub418\ub294\ub370 \uc704 \uadf8\ub9bc\uacfc \uac19\uc774 error\ub97c \ubcf4\uac8c \ub418\ub294\ub370 \uc774\ub294 \uae30\ubcf8\uc801\uc73c\ub85c circleci\uac00 \ud544\uc694\ub85c \ud558\ub294 \uae30\ubcf8 \uc124\uc815\uac12(.circleci/config.yaml)\uc774 \uc5c6\uc5b4\uc11c \ubc1c\uc0dd\ud558\ub294 \uc624\ub958\uc774\ub2e4.  \\n\\n```sh\\n#!/bin/sh -eo pipefail\\n# No configuration was found in your project. Please refer to https://circleci.com/docs/2.0/ to get started with your configuration.\\n# \\n# -------\\n# Warning: This configuration was auto-generated to show you the message above.\\n# Don\'t rerun this job. Rerunning will have no effect.\\nfalse\\n```\\n\\n\uc704\uc5d0\uc11c \ubcf4\uc774\ub294\uac83 \ucc98\ub7fc config\ub97c \uccb4\ud06c\ud558\ub294\uac83\ub3c4 \ud558\ub098\uc758 \uac00\uc0c1\uba38\uc2e0(\ucee8\ud14c\uc774\ub108)\uc774 \uc9c4\ud589\ud558\ub294\ub370 CircleCI\ucf58\uc194\uc5d0\uc11c `Spin up Environment` \ub85c\uadf8\ub97c \ubcf4\uba74 Docker(18.09.6)\ub85c aws Linux\uae30\ubc18\uc73c\ub85c \ud658\uacbd\uad6c\uc131\uc744 \ud558\ub294 \uac83\uc744 \uc54c \uc218 \uc788\ub2e4.\\n\\n```sh\\nBuild-agent version 1.0.11727-b0960fc9 (2019-05-23T02:12:54+0000)\\nDocker Engine Version: 18.09.6\\nKernel Version: Linux 9a20a41aeae4 4.15.0-1035-aws #37-Ubuntu SMP Mon Mar 18 16:15:14 UTC 2019 x86_64 Linux\\nStarting container bash:4.4.19\\n  using image bash@sha256:9f0a4aa3c9931bd5fdda51b1b2b74a0398a8eabeaf9519d807e010b9d9d41993\\n...\\n```\\n## CircleCI Grossary\\n\\n\uc544\ub798 \ub9c1\ud06c\ub294 CircleCI\uc5d0\uc11c \uc790\uc8fc \uc0ac\uc6a9\ud558\ub294 \uc6a9\uc5b4\ub4e4\uc744 \ub530\ub85c \uc815\ub9ac\ud55c \ud398\uc774\uc9c0\uc774\ub2e4.  \uc8fc\ub85c \ucee8\ud14c\uc774\ub108 \uae30\ubc18\uc73c\ub85c \ub3d9\uc791\ud558\uae30 \ub54c\ubb38\uc5d0 \uc6a9\uc5b4\ub4e4\uc740 Docker\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \uc6a9\uc5b4\uacfc \uacb9\uce58\ub294 \ubd80\ubd84\uc774 \ub9ce\ub2e4.   \\n\\n[https://circleci.com/docs/2.0/glossary/](https://circleci.com/docs/2.0/glossary/)\\n\\n\uc704 \ub9c1\ud06c \ub0b4\uc6a9\uc744 \ud655\uc778\ud558\uba74 `Orbs`\ub77c\ub294 \uc6a9\uc5b4\uac00 \ub098\uc624\ub294\ub370 \uc774\ub294 \uacf5\uc720\uac00\ub2a5\ud55c \ud328\ud0a4\uc9c0\ub85c Jenkins\uc758 Plugin\uacfc \uc720\uc0ac\ud55c \uac1c\ub150\uc774\ub77c\uace0 \ubcf4\uba74 \ub41c\ub2e4. CircleCI\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 \uc790\uccb4 \ud328\ud0a4\uc9c0 \ubfd0\ub9cc \uc544\ub2c8\ub77c 3rd Party orbs\ub97c \uc81c\uacf5\ud558\uace0 \uc788\ub2e4. \\n\\nMacOS\uc5d0\uc11c\ub294 brew\ub97c \ud1b5\ud574 cli\ub97c \uc124\uce58\ud558\uace0 orb \ub9ac\uc2a4\ud2b8\ub97c \ud655\uc778\ud558\uac70\ub098 [https://circleci.com/orbs/registry/](https://circleci.com/orbs/registry/)\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n\\n```sh\\n$ brew install circleci\\n$ circleci orb list\\nOrbs found: 43. Showing only certified orbs.\\nAdd --uncertified for a list of all orbs.\\n\\ncircleci/android (0.1.0)\\ncircleci/artifactory (1.0.0)\\ncircleci/aws-cli (0.1.13)\\ncircleci/aws-code-deploy (0.0.9)\\ncircleci/aws-ecr (6.1.0)\\ncircleci/aws-ecs (0.0.8)\\ncircleci/aws-eks (0.1.0)\\ncircleci/aws-s3 (1.0.11)\\n...\\ncircleci/jira (1.0.5)\\ncircleci/jq (1.9.0)\\ncircleci/kubernetes (0.3.0)\\ncircleci/lein-nvd (0.0.2)\\ncircleci/maven (0.0.8)\\ncircleci/node (1.0.1)\\n...\\ncircleci/slack (3.2.0)\\ncircleci/twilio (0.0.1)\\ncircleci/welcome-orb (0.3.1)\\n\\nIn order to see more details about each orb, type: `circleci orb info orb-namespace/orb-name`\\n\\nSearch, filter, and view sources for all Orbs online at https://circleci.com/orbs/registry/\\n```\\n\\n## Circle Architecture\\n\\n![circle-arch](https://circleci.com/docs/assets/img/docs/arch.png)\\n\\nGitHub \ub610\ub294 Bitbucket\uc5d0\uc11c \uad00\ub9ac\ud558\ub294 Repository\uac00 CircleCI \ud504\ub85c\uc81d\ud2b8\ub85c \uc2b9\uc778\ub418\uba74 \ucd5c\ucd08\uc5d0\ub294 \ucee8\ud14c\uc774\ub108\ub098 \uac00\uc0c1\uba38\uc2e0\ud658\uacbd(2core 4GB)\uc774 \ud504\ub85c\ube44\uc800\ub2dd \ub418\uace0 \uc790\ub3d9\uc73c\ub85c \ud14c\uc2a4\ud2b8\uac00 \uc9c4\ud589\ub41c\ub2e4.  \\n\\n\ud14c\uc2a4\ud2b8\uac00 \uc644\ub8cc\ub41c \ud6c4 \uc131\uacf5 \ub610\ub294 \uc2e4\ud328\uc5d0 \ub300\ud55c Alert\uc124\uc815(Email, Slack)\uc774 \uac00\ub2a5\ud558\uace0 \uac01 \ub2e8\uacc4(job, workflow)\uc5d0 \ub300\ud55c \uacb0\uacfc\ub294 \uac01 \ub2e8\uacc4\ubcc4 \uc138\ubd80 \uc815\ubcf4 \ud398\uc774\uc9c0\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n\ub610\ud55c \ubc30\ud3ec\ub294 AWS CodeDeploy, AWS ECS, AWS S3, AWS EKS, Google Kubernetes Engine (GKE) \ubc0f Heroku \ub4f1 \ub2e4\uc591\ud55c \ud658\uacbd\uc5d0 \ucf54\ub4dc\ub97c \ubc30\ud3ec\ud558\ub3c4\ub85d \uad6c\uc131 \ud560 \uc218 \uc788\ub2e4. \uc774\uc678\uc758 \ud074\ub77c\uc6b0\ub4dc \uc11c\ube44\uc2a4 \ubc30\ud3ec\ub294 SSH\ub97c \ud1b5\ud574 \uc9c1\uc811 \uc0ac\uc6a9\ud558\uac70\ub098 terraform\uacfc \uac19\uc740 \ub3c4\uad6c\ub97c \uac00\uc9c0\uace0 \ud574\ub2f9 \ud074\ub77c\uc6b0\ub4dc \uc11c\ube44\uc2a4\uc758 API\ud1b5\ud574 \uc790\ub3d9\ud654\uac00 \uac00\ub2a5\ud55c \uad6c\uc870\ub85c \ub418\uc5b4\uc788\ub2e4.  \\n\\n## CircelCI AWS EKS\\n\\n[https://github.com/CircleCI-Public/circleci-demo-aws-eks](https://github.com/CircleCI-Public/circleci-demo-aws-eks)\\n\\n\uc704 demo\ub294 CircleCI\ub97c \uc774\uc6a9\ud558\uc5ec \ub2e4\uc74c\uacfc \uac19\uc740 workflow (\uc0c1\uc138\ub0b4\uc6a9 \uc544\ub798 config.yaml \ucc38\uace0)\ub97c \uc218\ud589\ud55c\ub2e4.  \\n\\n```yaml\\nversion: 2.1\\n\\norbs:\\n    aws-eks: circleci/aws-eks@0.1.0\\n    aws-ecr: circleci/aws-ecr@3.1.0\\n    kubernetes: circleci/kubernetes@0.3.0\\n```\\n\uacf5\ud1b5\uc801\uc73c\ub85c orb\ub97c 3\uac00\uc9c0\ub97c \ucd94\uac00\ud558\uc600\uae30 \ub54c\ubb38\uc5d0 \uac01\ub2e8\uacc4\ub9c8\ub2e4 \uad00\ub828 orb\ub97c \ucd94\uac00\ud558\ub294 \ub2e8\uacc4\ub97c \uac70\uce58\uac8c \ub41c\ub2e4.\\n\\n1. \ud658\uacbd\uc124\uc815 \ubc0f Docker Build \ubc0f ECR\ub85c Push\\n  ```yaml\\n  workflows:\\n    deployment:\\n      jobs:\\n        - aws-ecr/build_and_push_image:\\n            name: build-and-push-image\\n            account-url: AWS_ECR_URL\\n            region: AWS_DEFAULT_REGION\\n            repo: eks_orb_demo_app\\n            dockerfile: ~/project/demo_app/Dockerfile\\n            path: ~/project/demo_app\\n            tag: ${CIRCLE_SHA1}\\n            # repository\uac00 \uc5c6\uc744 \uacbd\uc6b0 \uc0dd\uc131\ud558\ub294 \uc635\uc158\\n            # create-repo: true\\n  ```\\n  * environment variables \uc124\uc815 \\n    * Project - BUILD SETTINGS - Environment Variables \uc5d0\uc11c Key-Value\ud615\ud0dc\ub85c \uc785\ub825  \\n      * AWS_DEFAULT_REGION : `us-west-2`\\n      * AWS_ECR_URL : `219547004475.dkr.ecr.us-west-2.amazonaws.com/eks_orb_demo_app`  \\n   * github \uc5f0\ub3d9 (ssh-key \uc5f0\ub3d9 \ubc0f repo clone)\\n   * aws cli \uc124\uce58 \ubc0f AWS Access, Secret Key\uc124\uc815\\n   * ECR Login\\n   * Image Build ([https://github.com/ddiiwoong/circleci-demo-aws-eks/blob/master/demo_app/Dockerfile](https://github.com/ddiiwoong/circleci-demo-aws-eks/blob/master/demo_app/Dockerfile))\\n  * Push Image to ECR\\n\\n1. EKS\ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131 (No Scripts)\\n  ```yaml\\n  workflows:\\n    deployment:\\n      jobs:\\n        - aws-eks/create-cluster:\\n            cluster-name: eks-orb-demo-app-deployment\\n            aws-region: $AWS_DEFAULT_REGION\\n            requires:\\n              - build-and-push-image\\n  ```\\n  * kops, kubectl, aws iam authenticator, aws cli \uc124\uce58\\n  * kubectl config \uc124\uc815 (aws iam authenticator)\\n  * eksctl \uc124\uce58\\n  * eksctl\ub85c \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131 \ubc0f \uac80\uc99d (Cloudformation)\\n    * variables \uc0ac\uc804 \uc124\uc815\uac00\ub2a5 ($AWS_DEFAULT_REGION)\\n\\n2. Demo Application \ubc30\ud3ec\\n  ```yaml\\n  jobs:\\n    deploy-application:\\n      executor: aws-eks/python3\\n      parameters:\\n      ...\\n      steps:\\n        - checkout\\n        - run:\\n            name: Create deployment manifest\\n            command: |\\n              BUILD_DATE=$(date \'+%Y%m%d%H%M%S\')\\n              cat deployment/demo-app-deployment.yaml.template |\\\\\\n                sed \\"s|DOCKER_IMAGE_NAME|<< parameters.docker-image-name >>|\\\\\\n                  g;s|BUILD_DATE_VALUE|$BUILD_DATE|g;s|VERSION_INFO_VALUE|\\\\\\n                  << parameters.version-info >>|g\\" > deployment/demo-app-deployment.yaml\\n        - aws-eks/update-kubeconfig-with-authenticator:\\n            cluster-name: << parameters.cluster-name >>\\n            install-kubectl: true\\n            aws-region: << parameters.aws-region >>\\n        - kubernetes/create-or-update-resource:\\n            resource-file-path: \\"deployment/demo-app-deployment.yaml\\"\\n            get-rollout-status: true\\n            resource-name: deployment/demoapp\\n        - kubernetes/create-or-update-resource:\\n            resource-file-path: \\"deployment/demo-app-service.yaml\\"\\n  ...\\n  workflows:\\n    deployment:\\n      jobs:\\n        - deploy-application:\\n          cluster-name: eks-orb-demo-app-deployment\\n          aws-region: $AWS_DEFAULT_REGION\\n          docker-image-name: \\"${AWS_ECR_URL}/eks_orb_demo_app:${CIRCLE_SHA1}\\"\\n          version-info: \\"${CIRCLE_SHA1}\\"\\n          requires:\\n            - aws-eks/create-cluster\\n  ...\\n  ```\\n  * deployment manifest\uc0dd\uc131 (deployment template)\\n  * kops, kubectl, aws iam authenticator, aws cli \uc124\uce58 (orb\uc124\uc815: aws-eks,kubernetes)\\n  * kubectl config \uc124\uc815 (aws iam authenticator)\\n  * resource(deployment, service) \ubc30\ud3ec (orb\uc124\uc815: aws-eks,kubernetes)\\n  * rollout \uc218\ud589 (0->3)\\n\\n3. application test\\n  ```yaml\\n  workflows:\\n    deployment:\\n      jobs:\\n        - test-application:\\n          name: test-application\\n          cluster-name: eks-orb-demo-app-deployment\\n          aws-region: $AWS_DEFAULT_REGION\\n          expected-version-info: \\"${CIRCLE_SHA1}\\"\\n          requires:\\n            - deploy-application\\n  jobs:\\n    test-application:\\n      executor: aws-eks/python3\\n      parameters:\\n        ...\\n      steps:\\n        - aws-eks/update-kubeconfig-with-authenticator:\\n            cluster-name: << parameters.cluster-name >>\\n            install-kubectl: true\\n            aws-region: << parameters.aws-region >>\\n        - run:\\n            name: Wait for service to be ready\\n            command: |\\n              kubectl get pods\\n              kubectl get services\\n              sleep 30\\n              for attempt in {1..20}; do\\n                EXTERNAL_IP=$(kubectl get service demoapp | awk \'{print $4}\' | tail -n1)\\n                echo \\"Checking external IP: ${EXTERNAL_IP}\\"\\n                if [ -n \\"${EXTERNAL_IP}\\" ] && [ -z $(echo \\"${EXTERNAL_IP}\\" | grep \\"pending\\") ]; then\\n                  break\\n                fi\\n                echo \\"Waiting for external IP to be ready: ${EXTERNAL_IP}\\"\\n                sleep 10\\n              done\\n              sleep 180\\n              curl -s --retry 10 \\"http://$EXTERNAL_IP\\" | grep \\"<< parameters.expected-version-info >>\\"\\n  ```\\n  * kops, kubectl, aws iam authenticator, aws cli \uc124\uce58 (orb\uc124\uc815: aws-eks,kubernetes)\\n  * kubectl config \uc124\uc815 (aws iam authenticator)\\n  * External IP \uccb4\ud06c \ubc0f curl \ud14c\uc2a4\ud2b8\\n\\n4. Demo Application \uc0ad\uc81c\\n  ```yaml\\n  jobs:  \\n    undeploy-application:\\n      executor: aws-eks/python3\\n      parameters:\\n      ...\\n      steps:\\n        - aws-eks/update-kubeconfig-with-authenticator:\\n            cluster-name: << parameters.cluster-name >>\\n            install-kubectl: true\\n            aws-region: << parameters.aws-region >>\\n        - kubernetes/delete-resource:\\n            resource-types: \\"deployment,service\\"\\n            label-selector: \\"app=demo\\"\\n            wait: true\\n        - run:\\n            name: Check on pod status\\n            command: |\\n              kubectl get pods\\n  workflows:\\n    deployment:\\n      jobs:\\n        - undeploy-application:\\n          cluster-name: eks-orb-demo-app-deployment\\n          aws-region: $AWS_DEFAULT_REGION\\n          requires:\\n            - test-application\\n  ```\\n  * kops, kubectl, aws iam authenticator, aws cli \uc124\uce58 (orb\uc124\uc815: aws-eks,kubernetes)\\n  * kubectl config \uc124\uc815 (aws iam authenticator)\\n  * deployment \uc0ad\uc81c \ubc0f \uc0c1\ud0dc \uccb4\ud06c\\n\\n5. EKS\ud074\ub7ec\uc2a4\ud130 \uc0ad\uc81c (No Scripts)\\n  ```yaml\\n  workflows:\\n    deployment:\\n      jobs:\\n        - aws-eks/delete-cluster:\\n          cluster-name: eks-orb-demo-app-deployment\\n          aws-region: $AWS_DEFAULT_REGION\\n          wait: true\\n          requires:\\n            - undeploy-application\\n  ```\\n  * kops, kubectl, aws iam authenticator, aws cli \uc124\uce58 (orb\uc124\uc815: aws-eks,kubernetes)\\n  * kubectl config \uc124\uc815 (aws iam authenticator)\\n  * eksctl \uc124\uce58\\n  * eksctl\ub85c \ud074\ub7ec\uc2a4\ud130 \uc0ad\uc81c \ubc0f \uac80\uc99d (Cloudformation)\\n\\n\uc0c1\uc138 config\ub294 \ub2e4\uc74c \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n[https://github.com/ddiiwoong/circleci-demo-aws-eks/blob/master/.circleci/config.yml](https://github.com/ddiiwoong/circleci-demo-aws-eks/blob/master/.circleci/config.yml)\\n\\n## pipeline \uc218\ud589\\n\\n\uc704 Workflow\ub97c \uc218\ud589\ud558\uac8c \ub418\uba74 \ub9c8\uc9c0\ub9c9\uc5d0 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uacfc \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ad\uc81c\ud558\uae30 \ub54c\ubb38\uc5d0 \ud574\ub2f9 workflow\ub294 \uc81c\uc678\ud558\uace0 \uc218\ud589\ud55c\ub2e4. \ud574\ub2f9 config\ub97c commit\ud558\uba74 \ubc14\ub85c \ud574\ub2f9 CI\uac00 \ud2b8\ub9ac\uac70 \ub418\uc5b4 \uc2dc\uc791\ub418\uac8c \ub41c\ub2e4.\\n\\n```yaml\\n      # - undeploy-application:\\n      #     cluster-name: eks-orb-demo-app-deployment\\n      #     aws-region: $AWS_DEFAULT_REGION\\n      #     requires:\\n      #       - test-application\\n      # - aws-eks/delete-cluster:\\n      #     cluster-name: eks-orb-demo-app-deployment\\n      #     aws-region: $AWS_DEFAULT_REGION\\n      #     wait: true\\n      #     requires:\\n      #     - undeploy-application\\n```\\n\\n![result](/img/workflow-result.png)\\n\\n\ud074\ub7ec\uc2a4\ud130 \uad6c\uc131\ud3ec\ud568\ud574\uc11c \ucd1d 20\ubd84\uc815\ub3c4 \uc18c\uc694\ub418\uc5c8\ub2e4. \uc2e4\uc81c `eksctl`\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uac8c \ub418\uba74 CloudFormation\uc73c\ub85c \uc218\ud589\ub418\uae30 \ub54c\ubb38\uc5d0 \uc57d 15-20\ubd84 \uc815\ub3c4 \uc18c\uc694\ub418\ub2c8 \uac04\ub2e8\ud55c \ube4c\ub4dc,\ubc30\ud3ec,\ud14c\uc2a4\ud2b8\ub294 5\ubd84\uc815\ub3c4 \uc18c\uc694\ub41c\uac83\uc744 \uc54c \uc218 \uc788\ub2e4.  \\n\\n\uc0ad\uc81c\ub294 \uc5ed\uc21c\uc73c\ub85c \uc9c4\ud589\ud558\uac70\ub098 \uc704\uc5d0 \uc8fc\uc11d \ucc98\ub9ac\ub41c \uc601\uc5ed\ub9cc \uc218\ud589\ud558\uba74 \ub41c\ub2e4.\\n\\n## \uc815\ub9ac\\n\uac04\ub2e8\ud558\uac8c CircleCI\ub97c \uac00\uc9c0\uace0 GitOps\uc640 CI/CD\ub97c \uad6c\uc131\ud558\ub294 \ub370\ubaa8\ub97c \uc9c4\ud589\ud558\uc600\ub2e4.  \\n\\nCircleCI\ub294 Jenkins\uc640 \uc720\uc0ac\ud558\uc9c0\ub9cc Public\uc11c\ube44\uc2a4\uc774\uace0 Slave\uad00\ub9ac\uc5d0 \ub300\ud574\uc11c \uc758\uc874\uc801\uc774\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 \uae30\uc874\uc5d0 Jenkins\ub97c \uc0ac\uc6a9\ud55c \uacbd\ud5d8\uc774 \uc788\ub2e4\uba74 \uc544\uc8fc \uc27d\uac8c \uad6c\uc131\ud560 \uc218 \uc788\ub2e4.  \\n\\n[https://circleci.com/docs/2.0/migrating-from-jenkins](https://circleci.com/docs/2.0/migrating-from-jenkins)\ub97c \ucc38\uace0\ud558\uba74 Jenkins\uc640 \ucc28\uc774\uc810\uc744 \uc54c \uc218 \uc788\ub294\ub370 \uac00\uc7a5 \ud070 \uc7a5\uc810\uc740 \ubcd1\ub82c\ub85c \ud14c\uc2a4\ud2b8\ub098 Job\uc744 \uc218\ud589\ud560\uc218 \uc788\ub2e4\ub294 \uc810\uacfc Lambda\uc640 \uac19\uc740 \uc11c\ubc84\ub9ac\uc2a4 \uc571\uc744 \ubc30\ud3ec\ud560\ub54c \uc815\ub9d0 \uc11c\ubc84\ub9ac\uc2a4 \ud658\uacbd\uc73c\ub85c \uad6c\uc131\ud560\uc218 \uc788\ub2e4\ub294 \uc810\uc774\ub2e4.  \\n\\n\uc774\ub294 Git Repository\ub97c \uc5f0\ub3d9\ud560\ub54c\ub3c4 Java Plugin\uc744 \uc124\uce58\ud574\uc57c\ud558\ub294 \ubc88\uac70\ub85c\uc6c0\uc744 \ub35c \uc218 \uc788\ub2e4. \uac00\uc7a5 \uc911\uc694\ud55c\uac74 SaaS\ub77c\ub294 \uc7a5\uc810\ub3c4 \ubb34\uc2dc\ud560\uc218 \uc5c6\ub2e4. Travis \ubb34\ub8cc \ud50c\ub79c\uacfc \ube44\uad50\ud574\ub3c4 \uc791\uc740 \ud504\ub85c\uc81d\ud2b8\uc758 \uacbd\uc6b0 \ubcc4\ub3c4\uc758 Docker environment(2core, 4GB)\ub97c \uc81c\uacf5\ubc1b\uae30 \ub54c\ubb38\uc5d0 \uc9c0\uc5f0\uc5c6\uc774 \ubc14\ub85c \ube4c\ub4dc\uac00 \uac00\ub2a5\ud558\ub2e4\ub294 \uc810\uc774\ub2e4.  \\n\\n\ub2e4\uc74c\ubc88 \ud3ec\uc2a4\ud305\uc5d0\ub294 terraform\uc744 \ud1b5\ud574 ECR\uacfc ECS\ub85c \ubc30\ud3ec\ud558\ub294 workflow\ub97c \uc0b4\ud3b4\ubcf4\ub824\uace0 \ud55c\ub2e4."},{"id":"kubernetes/CKAD-1/","metadata":{"permalink":"/kubernetes/CKAD-1/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-06-10-CKAD-1.md","source":"@site/blog/2019-06-10-CKAD-1.md","title":"Yaml \uc791\uc131 \uae30\ubcf8 Tip","description":"CKAD\uac80\uc815\uc2dc YAML \uc791\uc131 tip","date":"2019-06-10T00:00:00.000Z","formattedDate":"June 10, 2019","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"CKAD","permalink":"/tags/ckad"},{"label":"Exam","permalink":"/tags/exam"},{"label":"Tip","permalink":"/tags/tip"}],"readingTime":1.1,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Yaml \uc791\uc131 \uae30\ubcf8 Tip","comments":true,"classes":"wide","description":"CKAD\uac80\uc815\uc2dc YAML \uc791\uc131 tip","slug":"kubernetes/CKAD-1/","date":"2019-06-10T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","CKAD","Exam","Tip"]},"prevItem":{"title":"CircleCI - GitHub \uc5f0\ub3d9 \ubc0f EKS \uad6c\uc131\ud558\uae30","permalink":"/devops/circleci/"},"nextItem":{"title":"Knative on EKS","permalink":"/kubernetes/knative-on-aws/"}},"content":"\ucd5c\uadfc \ud3ec\uc2a4\ud305\uc744 \ud560 \uc5ec\uc720\uac00 \ub418\uc9c0 \uc54a\uc544 \uc77c\ub2e8 \ud2c8\ud2c8\ud788 \uc900\ube44\uc911\uc778 CKAD \uc900\ube44\ud558\ub294 \ud301\uc774\ub098 \uc815\ubcf4\ub4f1\uc744 \uba3c\uc800 \uc815\ub9ac\ud558\uace0\uc790 \ud55c\ub2e4.  \\n\uadf8\uc911 \uae30\ubcf8\uc774 \ub418\ub294 YAML\uc744 \ucd5c\ucd08 \uc791\uc131\ud560\ub54c \ud301\uc744 \uc815\ub9ac\ud574\ubd24\ub2e4.  \\n\\n## Manifest YAML\uc791\uc131 Tip\\nCLI\uc548\uc5d0\uc11c Manifest YAML\ud30c\uc77c\uc744 \uc791\uc131\ud558\ub294\uac83\uc740 \uc27d\uc9c0 \uc54a\ub2e4. \ud2b9\ud788 \uc2dc\ud5d8\uc911\uc5d0 Copy/Paste\ub97c \ud558\ub294\uac83\uc740 \uc5b4\ub835\uace0 \ub290\ub9ac\uac8c \uc9c4\ud589\ub420\uc218 \uc788\uc73c\ubbc0\ub85c CLI\uc548\uc5d0\uc11c \ud574\uacb0\ud558\ub294\uac83\uc774 \uc88b\ub2e4.\\n\\n### kubectl run \ud65c\uc6a9\\n[https://kubernetes.io/docs/reference/kubectl/conventions/](https://kubernetes.io/docs/reference/kubectl/conventions/#generators)\\n\\n\uc704 \ub9c1\ud06c\ub97c \uc798 \uae30\uc5b5\ud574\ub193\uace0 \uc2e4\uc81c \uc2dc\ud5d8\uc744 \ubcfc\ub54c template\uc791\uc131\uc744 \uc704\ud574 \uc544\ub798\uc640 \uac19\uc774 Manifest\ub97c \ud574\ubcf4\ub294\uac83\uc774 \uac00\uc7a5 \uc88b\ub2e4.\\n\\n#### Pod Manifest YAML\\n```sh\\n$ kubectl run --generator=run-pod/v1 nginx --image=nginx --dry-run -o yaml\\n```\\n\\n#### Deployment YAML\\n```sh\\n$ kubectl run --generator=deployment/v1beta1 nginx --image=nginx --dry-run --replicas=4 -o yaml\\n```\\n#### YAML\ub85c \uc800\uc7a5\\n```sh\\n$ kubectl run --generator=deployment/v1beta1 nginx --image=nginx --dry-run --replicas=4 -o yaml > nginx-deployment.yaml\\n```"},{"id":"kubernetes/knative-on-aws/","metadata":{"permalink":"/kubernetes/knative-on-aws/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-05-14-knative-on-aws.md","source":"@site/blog/2019-05-14-knative-on-aws.md","title":"Knative on EKS","description":"EKS\uc5d0\uc11c\ub3c4 Knative\ub97c \uad6c\uc131\ud574\ubcf4\uc790","date":"2019-05-14T00:00:00.000Z","formattedDate":"May 14, 2019","tags":[{"label":"Knative","permalink":"/tags/knative"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"FaaS","permalink":"/tags/faa-s"},{"label":"AWS","permalink":"/tags/aws"},{"label":"Lambda","permalink":"/tags/lambda"},{"label":"Serverless","permalink":"/tags/serverless"},{"label":"EKS","permalink":"/tags/eks"}],"readingTime":11.905,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Knative on EKS","comments":true,"classes":"wide","description":"EKS\uc5d0\uc11c\ub3c4 Knative\ub97c \uad6c\uc131\ud574\ubcf4\uc790","slug":"kubernetes/knative-on-aws/","date":"2019-05-14T00:00:00.000Z","categories":["Kubernetes"],"tags":["Knative","Kubernetes","FaaS","AWS","Lambda","Serverless","EKS"]},"prevItem":{"title":"Yaml \uc791\uc131 \uae30\ubcf8 Tip","permalink":"/kubernetes/CKAD-1/"},"nextItem":{"title":"eksworkshop","permalink":"/kubernetes/eksworkshop/"}},"content":"\uc774\ubc88\uc5d0\ub294 Knative\ub97c EKS\uc5d0 \uad6c\uc131\ud574\ubcf4\ub824\uace0 \ud55c\ub2e4. 4\uc6d4\uc740 \ubc1c\ud45c \ubc0f \uc5ec\ub7ec\uac00\uc9c0 \uc5c5\ubb34\ub85c \uc778\ud574\uc11c \ud3ec\uc2a4\ud305\uc744 \ud560 \uc2dc\uac04\uc774 \ubd80\uc871\ud588\uc9c0\ub9cc 5\uc6d4\ubd80\ud130 \uc870\uae08\uc529 \uc5ec\uc720\uac00 \uc0dd\uaca8\uc11c \ub354 \ubc14\ube60\uc9c0\uae30\uc804\uc5d0 \uc880 \uc368\ubcf4\ub824\uace0 \ud55c\ub2e4. \uc0ac\uc2e4 [Facebook @\ucd5c\uc6a9\ud638](https://www.facebook.com/yongho1037)\ub2d8\uaed8\uc11c \ud55c\ubc88 \ud574\ubcf4\ub294\uac83\ub3c4 \uc88b\uaca0\ub2e4\uace0 \ud558\uc154\uc11c \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud558\uc600\ub2e4.  \\n\\n## Knative on EKS\\n\\n\uc81c\ubaa9\ub9cc \ubcf4\uba74 Lambda\ub098 ECS, Batch \uc11c\ube44\uc2a4\uac00 \uc788\ub294\ub370 \uc65c \uc774\uac78 \uc368\uc57c\ud558\uc9c0? \ub77c\ub294 \uc0dd\uac01\ubd80\ud130 \ud558\ub294 \uc0ac\ub78c\ub3c4 \uc788\uc744\uac83 \uac19\ub2e4. \ud558\uc9c0\ub9cc \uc774\uc804 \ud3ec\uc2a4\ud305\ub4e4\uacfc \ubc1c\ud45c\uc5d0\uc11c\ub3c4 \uc5ec\ub7ec\ubc88 \uc774\uc57c\uae30 \ud55c\uac83\ucc98\ub7fc Knative\ub294 \uac04\ub2e8\ud558\uac8c \uc11c\ubc84\ub9ac\uc2a4 \uc6cc\ud06c\ub85c\ub4dc\ub97c \ube4c\ub4dc, \ubc30\ud3ec, \uad00\ub9ac\ud558\uae30 \uc704\ud55c Kubernetes\uae30\ubc18 FaaS\ud50c\ub7ab\ud3fc\uc774\uace0 \ud604\uc7ac [CNCF Landscape](https://landscape.cncf.io/)\uc5d0\uc11c \uac00\uc7a5 \ube60\ub978 \uc18d\ub3c4\ub85c \uac1c\ubc1c\ub418\uace0 \uc788\ub294 \uc624\ud508\uc18c\uc2a4 \ud504\ub85c\uc81d\ud2b8 \uc911 \ud558\ub098\uc774\ub2e4.\\n\\n## EKS \ubc30\ud3ec\\n\\n\uc55e\uc120 [eksworkshop \ud3ec\uc2a4\ud305](https://ddii.dev/kubernetes/eksworkshop/)\uc5d0\uc11c\ucc98\ub7fc \uac04\ub2e8\ud55c \ubc30\ud3ec\ub97c \uc704\ud574 `eksctl`\ub85c 2-node \ud074\ub7ec\uc2a4\ud130\ub97c \ubc30\ud3ec\ud55c\ub2e4.  \\n\uc0ac\uc804 \uc900\ube44\uc0ac\ud56d\uc740 [\uc774\uc804 \ud3ec\uc2a4\ud305](https://ddii.dev/kubernetes/eksworkshop/)\uc774\ub098 [https://eksctl.io/](https://eksctl.io/)\uc744 \ucc38\uace0\ud558\uc790.  \\n\\n```sh\\n$ eksctl create cluster --name=eksworkshop-eksctl --nodes=2 --node-ami=auto\\n```\\n\\n\uc0dd\uc131\ub41c \ud074\ub7ec\uc2a4\ud130 \uc0c1\ud0dc\ub97c \ud655\uc778\ud55c\ub2e4. \\n\\n```sh\\n$ kubectl get nodes\\nNAME                                                STATUS    ROLES     AGE       VERSION\\nip-192-168-24-168.ap-northeast-2.compute.internal   Ready     <none>    2m        v1.11.9\\nip-192-168-78-204.ap-northeast-2.compute.internal   Ready     <none>    2m        v1.11.9\\n```\\n\\n## istio \uc124\uce58\\n\\nKnative\ub294 istio \uc758\uc874\uc131\uc744 \uac00\uc9c0\uace0 \uc788\uae30 \ub54c\ubb38\uc5d0 Istio\ub97c \uba3c\uc800 \ubc30\ud3ec\ud55c\ub2e4. \ubb3c\ub860 [\uc774\uc804 \ud3ec\uc2a4\ud305](https://ddii.dev/kubernetes/knative-using-gloo/)\uc5d0\uc11c \uc124\uba85\ud55c\uac83 \ucc98\ub7fc Gloo\ub97c \uc0ac\uc6a9\ud574\ub3c4 \ub418\uc9c0\ub9cc \uc774\ubc88\uc5d0\ub294 Istio\ub97c \uc124\uce58\ud558\uc600\ub2e4.  \\n\\n```sh\\n$ kubectl apply -f https://github.com/knative/serving/releases/download/v0.5.0/istio-crds.yaml \\n$ kubectl apply -f https://github.com/knative/serving/releases/download/v0.5.0/istio.yaml\\n```\\n\\n\ubc30\ud3ec\ub41c Pods, Services, Replicasets \uc744 \ud655\uc778\ud55c\ub2e4.\\n\\n```sh\\n$ kubectl get pods -n istio-system\\nNAME                                     READY     STATUS      RESTARTS   AGE\\ncluster-local-gateway-65c8b667c8-269cf   1/1       Running     0          17m\\nistio-citadel-76bd44d8f7-5cltj           1/1       Running     0          17m\\nistio-cleanup-secrets-7jpth              0/1       Completed   0          17m\\nistio-egressgateway-b9d56b4f8-pdjhs      1/1       Running     0          17m\\nistio-galley-7db7db89db-5stkp            1/1       Running     0          17m\\nistio-ingressgateway-f77fbc787-npw9d     1/1       Running     0          17m\\nistio-pilot-69f975bf4f-4dq4d             2/2       Running     0          17m\\nistio-pilot-69f975bf4f-q9g8g             2/2       Running     0          16m\\nistio-pilot-69f975bf4f-tnm92             2/2       Running     0          16m\\nistio-policy-8db48cbcd-dl2th             2/2       Running     0          17m\\nistio-security-post-install-xv8z6        0/1       Completed   0          17m\\nistio-sidecar-injector-cd54ffccd-kj2n6   1/1       Running     0          17m\\nistio-telemetry-d78cd45db-8x2cw          2/2       Running     0          17m\\n\\n$ kubectl get svc -n istio-system\\nNAME                     TYPE           CLUSTER-IP       EXTERNAL-IP                                                                   PORT(S)                                                                                                                   AGE\\ncluster-local-gateway    ClusterIP      10.100.97.146    <none>                                                                        80/TCP,443/TCP,31400/TCP,15011/TCP,8060/TCP,15030/TCP,15031/TCP                                                           17m\\nistio-citadel            ClusterIP      10.100.147.235   <none>                                                                        8060/TCP,9093/TCP                                                                                                         17m\\nistio-egressgateway      ClusterIP      10.100.25.44     <none>                                                                        80/TCP,443/TCP                                                                                                            17m\\nistio-galley             ClusterIP      10.100.158.45    <none>                                                                        443/TCP,9093/TCP                                                                                                          17m\\nistio-ingressgateway     LoadBalancer   10.100.62.157    a4e1d5201758f11e9b7f402c4d4b0376-510368564.ap-northeast-2.elb.amazonaws.com   80:31000/TCP,443:30753/TCP,31400:31922/TCP,15011:31331/TCP,8060:30389/TCP,853:30257/TCP,15030:30827/TCP,15031:30153/TCP   17m\\nistio-pilot              ClusterIP      10.100.25.194    <none>                                                                        15010/TCP,15011/TCP,8080/TCP,9093/TCP                                                                                     17m\\nistio-policy             ClusterIP      10.100.73.149    <none>                                                                        9091/TCP,15004/TCP,9093/TCP                                                                                               17m\\nistio-sidecar-injector   ClusterIP      10.100.117.18    <none>                                                                        443/TCP                                                                                                                   17m\\nistio-telemetry          ClusterIP      10.100.87.12     <none>                                                                        9091/TCP,15004/TCP,9093/TCP,42422/TCP                                                                                     17m\\n\\n$ kubectl get rs -n istio-system\\nNAME                               DESIRED   CURRENT   READY     AGE\\ncluster-local-gateway-65c8b667c8   1         1         1         17m\\nistio-citadel-76bd44d8f7           1         1         1         17m\\nistio-egressgateway-b9d56b4f8      1         1         1         17m\\nistio-galley-7db7db89db            1         1         1         17m\\nistio-ingressgateway-f77fbc787     1         1         1         17m\\nistio-pilot-69f975bf4f             3         3         3         17m\\nistio-policy-8db48cbcd             1         1         1         17m\\nistio-sidecar-injector-cd54ffccd   1         1         1         17m\\nistio-telemetry-d78cd45db          1         1         1         17m\\n```\\n\\nIstio injection\uc744 \ud558\uae30 \uc704\ud574 \ubc30\ud3ec\ud560 defaults namespace \uc804\uccb4\uc5d0 Labeling\uc744 \ud55c\ub2e4.\\n\\n```sh\\n$ kubectl label namespace default istio-injection=enabled\\nnamespace/default labeled\\n\\n$ kubectl get namespaces --show-labels\\nNAME           STATUS    AGE       LABELS\\ndefault        Active    43m       istio-injection=enabled\\nistio-system   Active    27m       istio-injection=disabled\\nkube-public    Active    43m       <none>\\nkube-system    Active    43m       <none>\\n```\\n\\n## Knative \uc124\uce58\\n\\nbuild, evening, serving \ubc0f \ubaa8\ub2c8\ud130\ub9c1 \ub9ac\uc18c\uc2a4\ub97c \ubc30\ud3ec\ud55c\ub2e4.\\n\\n```sh\\nkubectl apply -f https://github.com/knative/serving/releases/download/v0.5.0/serving.yaml \\\\\\n   -f https://github.com/knative/build/releases/download/v0.5.0/build.yaml \\\\\\n   -f https://github.com/knative/eventing/releases/download/v0.5.0/release.yaml \\\\\\n   -f https://github.com/knative/eventing-sources/releases/download/v0.5.0/eventing-sources.yaml \\\\\\n   -f https://github.com/knative/serving/releases/download/v0.5.0/monitoring.yaml \\\\\\n   -f https://raw.githubusercontent.com/knative/serving/v0.5.0/third_party/config/build/clusterrole.yaml\\n```\\n\\n\ubaa8\ub4e0 Knative namespaces \ubc0f resources\ub97c \ud655\uc778\ud55c\ub2e4.\\n\\n```sh\\n$ kubectl get namespaces | grep knative\\nknative-build        Active    8m\\nknative-eventing     Active    8m\\nknative-monitoring   Active    8m\\nknative-serving      Active    8m\\nknative-sources      Active    8m\\n\\n$ kubectl get pods -n knative-serving\\nNAME                          READY     STATUS    RESTARTS   AGE\\nactivator-664b5b9598-dsjvq    2/2       Running   0          10m\\nautoscaler-64d5bd84b8-bqghq   2/2       Running   0          10m\\ncontroller-658b9d5c6c-tnwvz   1/1       Running   0          10m\\nwebhook-5dffbfbb8b-525vt      1/1       Running   0          10m\\n\\n$ kubectl get pods -n knative-build \\nNAME                                READY     STATUS    RESTARTS   AGE\\nbuild-controller-86f5b5b96d-zg8j2   1/1       Running   0          11m\\nbuild-webhook-6fddd7c6df-68fkw      1/1       Running   0          11m\\n\\n$ kubectl get pods -n knative-eventing \\nNAME                                            READY     STATUS    RESTARTS   AGE\\neventing-controller-6fdccd8c95-bckws            1/1       Running   0          11m\\nin-memory-channel-controller-6fddb6655f-vbc64   1/1       Running   0          11m\\nin-memory-channel-dispatcher-7684cd7c7d-ftqhc   2/2       Running   2          11m\\nwebhook-d496c66bd-688xz                         1/1       Running   0          11m\\n```\\n\\n```sh\\n$ kubectl get pods -n knative-monitoring \\nNAME                                  READY     STATUS    RESTARTS   AGE\\nelasticsearch-logging-0               1/1       Running   0          14m\\nelasticsearch-logging-1               1/1       Running   0          12m\\ngrafana-754bc795bb-wxwml              1/1       Running   0          14m\\nkibana-logging-7f7b9698bc-rrnw6       1/1       Running   0          14m\\nkube-state-metrics-5bccdf746f-fhv7t   4/4       Running   0          12m\\nnode-exporter-w9jlq                   2/2       Running   0          14m\\nnode-exporter-wgv2j                   2/2       Running   0          14m\\nprometheus-system-0                   1/1       Running   0          14m\\nprometheus-system-1                   1/1       Running   0          14m\\n```\\n\\n\ubaa8\ub2c8\ud130\ub9c1 \ub9ac\uc18c\uc2a4\ub3c4 \ud655\uc778\ud55c\ub2e4. \uc704\uc758 \ub9ac\uc18c\uc2a4\ub97c \ubcf4\uba74 Fluentd\uac00 \ubc30\ud3ec\ub418\uc9c0 \uc54a\uc740 \uc0c1\ud0dc\uc774\ubbc0\ub85c DaemonSet\uc73c\ub85c \ub3d9\uc791\ud560\uc218 \uc788\ub3c4\ub85d \uc544\ub798\uc640 \uac19\uc774 \uc124\uc815\ud558\uba74 DaemonSet\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n```sh\\n$ kubectl label nodes --all beta.kubernetes.io/fluentd-ds-ready=\\"true\\"\\n```\\n\\n## Build\uc5d0\uc11c \uc0ac\uc6a9\ud560 Docker Credential \uc124\uc815\\n\\n\uc77c\ub2e8 Knative Build\ub97c \uc218\ud589\ud560\ub54c \uc77c\ubc18\uc801\uc73c\ub85c Container Registry\ub97c \ub9ce\uc774 \uc0ac\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 Registry Credential \uc124\uc815\uc744 \ud574\uc57c\ud55c\ub2e4.  \\n\\nECR\uc758 \uacbd\uc6b0 [https://github.com/knative/build-templates](https://github.com/knative/build-templates)\uc758 ecr_helper\ub97c \uc0ac\uc6a9\ud558\uba74 \uc27d\uac8c ECR account\ub97c \uc124\uc815\ud560 \uc218 \uc788\uc9c0\ub9cc `Serving`\ub2e8\uacc4\uc5d0\uc11c 401\uc5d0\ub7ec\uac00 \ub098\ub294 \uc774\uc720\ub97c \uc7a1\uc9c0 \ubabb\ud574\uc11c \uc77c\ub2e8 Dockerhub\ub97c \uac00\uc9c0\uace0 \uc9c4\ud589\ud558\uc600\ub2e4.\\n\\n\uac04\ub2e8\ud55c \ub370\ubaa8\ucf54\ub4dc\ub294 \uc544\ub798 repository\uc5d0 \ubbf8\ub9ac \uc791\uc131\ud574\ub1a8\ub2e4.  \\n\\n[https://github.com/ddiiwoong/hello-python.git](https://github.com/ddiiwoong/hello-python.git)\\n\\n`docker-secret.yaml` \uc744 \ubcf4\uba74 dockerhub push\ub97c \uc704\ud574 basic-auth\ub97c \uc218\ud589\ud558\uac8c \ub418\ub294\ub370 dockerhub id/password \ub97c base64\ub85c encoding\ud574\uc11c Secret\uc73c\ub85c \uc800\uc7a5\ud55c\ub2e4.  \\n\\n```yaml\\napiVersion: v1\\nkind: Secret\\nmetadata:\\n  name: basic-user-pass\\n  annotations:\\n    build.knative.dev/docker-0: https://index.docker.io/v1/\\ntype: kubernetes.io/basic-auth\\ndata:\\n  # Use \'echo -n \\"username\\" | base64\' to generate this string\\n  username: BASE64_ENCODED_USERNAME\\n  # Use \'echo -n \\"password\\" | base64\' to generate this string\\n  password: BASE64_ENCODED_PASSWORD\\n```\\n\\n\uadf8\ub9ac\uace0 ServiceAccount `build-bot`\uc744 \uc0dd\uc131\ud558\uae30 \uc704\ud55c yaml (sa.yaml)\ub97c \uc791\uc131\ud55c\ub2e4.  \\n\\n```yaml\\napiVersion: v1\\nkind: ServiceAccount\\nmetadata:\\n  name: build-bot\\nsecrets:\\n  - name: basic-user-pass\\n```\\n\\n\uc704\uc5d0\uc11c \uc791\uc131\ud55c Secret(basic-user-pass)\uacfc ServiceAccount(build-bot)\ub97c \ubc30\ud3ec\ud55c\ub2e4.  \\n\\n\\n```sh\\n$ kubectl apply -f docker-secret.yaml\\nsecret \\"basic-user-pass\\" created\\n$ kubectl apply -f sa.yaml\\nserviceaccount \\"build-bot\\" created\\n```\\n\\n\uc800\uc7a5\ub41c Secret(basic-user-pass)\uacfc ServiceAccount(build-bot)\ub97c \ud655\uc778\ud55c\ub2e4.\\n\\n```sh\\n$ kubectl get secret\\nNAME                        TYPE                                  DATA      AGE\\nbasic-user-pass             kubernetes.io/basic-auth              2         2h\\nbuild-bot-token-gfkg9       kubernetes.io/service-account-token   3         2h\\nbuilder-token-kp7ww         kubernetes.io/service-account-token   3         10h\\ndefault-token-9cpp5         kubernetes.io/service-account-token   3         10h\\necr-creds                   kubernetes.io/basic-auth              2         10h\\nistio.build-bot             istio.io/key-and-cert                 3         2h\\nistio.builder               istio.io/key-and-cert                 3         10h\\nistio.default               istio.io/key-and-cert                 3         10h\\nistio.knative-serve         istio.io/key-and-cert                 3         2h\\nknative-serve-token-9j82l   kubernetes.io/service-account-token   3         2h\\n\\n$ kubectl get sa\\nNAME            SECRETS   AGE\\nbuild-bot       2         2h\\nbuilder         2         10h\\ndefault         1         10h\\nknative-serve   2         2h\\n```\\n\\n## Python \ucf54\ub4dc \ubc0f Dockerfile \uc791\uc131\\n\\nTARGET \ud658\uacbd\ubcc0\uc218\ub97c \ubc1b\uc544\uc11c Hello World\uc640 \uac19\uc774 \ucd9c\ub825\ud558\ub294 \uac04\ub2e8\ud55c Flask\uae30\ubc18 \uc571\uc744 \uc791\uc131\ud55c\ub2e4.  \\n\\n\uac04\ub2e8\ud55c \ub370\ubaa8\ucf54\ub4dc\ub294 \uc544\ub798 repository\uc5d0 \ubbf8\ub9ac \uc791\uc131\ud574\ub1a8\ub2e4.  \\n\\n[https://github.com/ddiiwoong/hello-python.git](https://github.com/ddiiwoong/hello-python.git)\\n\\n```py\\nimport os\\n\\nfrom flask import Flask\\n\\napp = Flask(__name__)\\n\\n@app.route(\'/\')\\ndef hello_world():\\n    target = os.environ.get(\'TARGET\', \'NOT SPECIFIED\')\\n    return \'Hello World: {}!\\\\n\'.format(target)\\n\\nif __name__ == \\"__main__\\":\\n    app.run(debug=True, host=\'0.0.0.0\', port=int(os.environ.get(\'PORT\', 8080)))\\n```\\n\\n\uc704 \uc571(app.py)\uc744 \ubc30\ud3ec\ud558\ub294 Dockerfile\uc744 \uc791\uc131\ud55c\ub2e4.\\n\\n```dockerfile\\nFROM python:alpine\\n\\nENV APP_HOME /app\\nCOPY . $APP_HOME\\nWORKDIR $APP_HOME\\n\\nRUN pip install Flask\\n\\nENTRYPOINT [\\"python\\"]\\nCMD [\\"app.py\\"]\\n```\\n\\n## Knative Build \\n\\n\ubbf8\ub9ac Dockerhub\uc5d0\uc11c `hello-python` repository(docker.io/ddiiwoong/hello-python)\ub97c \uc0dd\uc131\ud55c\ub2e4.  \\n\uadf8\ub9ac\uace0 \uc704\uc5d0\uc11c \uc0dd\uc131\ud55c `build-bot` \uacc4\uc815\uacfc image tag `hello-python`\uc815\ubcf4\ub97c Build template\uc5d0 \uc791\uc131\ud558\uc5ec \ubc30\ud3ec\ud55c\ub2e4.  \\n\uc544\ub798 Knative Build \uacfc\uc815\uc740 `kaniko executor`\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub2e4\uc74c\uacfc \uac19\uc740 \uacfc\uc815\uc744 \uc218\ud589\ud55c\ub2e4.  \\n1. `spec.source` \uc5d0\uc11c Source Clone (git)\ub97c \uc218\ud589\ud558\uace0 \uc774\ud6c4  \\n2. `spec.steps` \uc5d0\uc11c Docker Build, Tag, Registry Login, Push\ub97c \uc218\ud589\ud55c\ub2e4.  \\n\\n```yaml\\napiVersion: build.knative.dev/v1alpha1\\nkind: Build\\nmetadata:\\n  name: python-build\\nspec:\\n  serviceAccountName: build-bot\\n  source:\\n    git:\\n      url: https://github.com/ddiiwoong/hello-python.git\\n      revision: master\\n  steps:\\n  - name: build-and-push\\n    image: gcr.io/kaniko-project/executor:v0.1.0\\n    args:\\n    - --dockerfile=/workspace/Dockerfile\\n    - --destination=docker.io/ddiiwoong/hello-python:latest\\n```\\n\\n`build`\ub97c \uc218\ud589\ud55c\ub2e4. \\n\\n```sh\\n$ kubectl apply -f build.yaml\\nbuild.build.knative.dev/python-build created\\n\\n$ kubectl get build\\nNAME           SUCCEEDED   REASON    STARTTIME   COMPLETIONTIME\\npython-build   True                  18m\\n```\\n\\n\uc815\uc0c1\uc801\uc73c\ub85c Build\uac00 \uc644\ub8cc\ub418\uba74 Dockerhub\uc5d0 \uc815\uc758\ud55c TAG(ddiiwoong/hello-python)\ub85c \uc774\ubbf8\uc9c0\uac00 \ub4f1\ub85d\ub41c\uac78 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n```sh\\n$ docker pull ddiiwoong/hello-python\\nUsing default tag: latest\\nlatest: Pulling from ddiiwoong/hello-python\\ne7c96db7181b: Pull complete\\n799a5534f213: Pull complete\\n913b50bbe755: Pull complete\\n11154abc6081: Pull complete\\nc805e63f69fe: Pull complete\\n6eabcf0f7a50: Pull complete\\n74101057f4ec: Pull complete\\nDigest: sha256:51dc4a7ce38a5e7894adcfc00eaee6c5ea6aca1ef6c7521f9b7ea6382c013b9b\\nStatus: Downloaded newer image for ddiiwoong/hello-python:latest\\n```\\n\\n## Knative Serving \uc73c\ub85c \ubc30\ud3ec\\n\\n#### service.yaml\\n```yaml\\napiVersion: serving.knative.dev/v1alpha1\\nkind: Service\\nmetadata:\\n  name: helloworld-python\\n  namespace: default\\nspec:\\n  runLatest:\\n    configuration:\\n      revisionTemplate:\\n        spec:\\n          container:\\n            image: ddiiwoong/hello-python:latest\\n            env:\\n            - name: TARGET\\n              value: \\"Python Sample v1 with Knative on EKS\\"\\n```\\n\\n\ube4c\ub4dc\ub41c image (ddiiwoong/hello-python:latest)\ub85c Knative Service\ub97c \uc0dd\uc131\ud55c\ub2e4.  \\n\\n```sh\\n$ kubectl apply -f service.yaml\\nservice.serving.knative.dev/helloworld-python created\\n```\\n\\n`istio-system` Namespace\uc5d0 `istio-ingressgateway` Service\ub97c \ud655\uc778\ud55c\ub2e4.  \\n\\n```sh\\nkubectl get svc istio-ingressgateway --namespace istio-system\\nNAME                   TYPE           CLUSTER-IP      EXTERNAL-IP                                                                    PORT(S)                                                                                                                   AGE\\nistio-ingressgateway   LoadBalancer   10.100.208.80   a220723d475df11e980220a02e220b34-2021915778.ap-northeast-2.elb.amazonaws.com   80:31581/TCP,443:31490/TCP,31400:30367/TCP,15011:32495/TCP,8060:31418/TCP,853:30310/TCP,15030:32405/TCP,15031:31410/TCP   13h\\n```\\n  \\nALB: a220723d475df11e980220a02e220b34-2021915778.ap-northeast-2.elb.amazonaws.com  \\n\\n\uc704\uc640 \uac19\uc774 AWS LoadBalancer\ub85c \ubc30\ud3ec\uba74 ALB\uac00 \uc790\ub3d9\uc73c\ub85c \uc0dd\uc131\ub418\ubbc0\ub85c \ucd94\ud6c4 eksctl\ub85c \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ad\uc81c\ud558\uae30 \uc804\uc5d0 \ubc18\ub4dc\uc2dc LoadBalancer \ud615\ud0dc\ub85c \ubc30\ud3ec\ub41c \uc11c\ube44\uc2a4\ub97c \uc0ad\uc81c\ud558\uace0 \uc9c4\ud589\ud574\uc57c \ud55c\ub2e4.  \\n\\nKnative Service\ub97c \ud655\uc778\ud55c\ub2e4. \\n```sh\\n$ kubectl get ksvc\\nNAME                DOMAIN                                  LATESTCREATED             LATESTREADY               READY     REASON\\nhelloworld-python   helloworld-python.default.example.com   helloworld-python-4rw95   helloworld-python-4rw95   True\\n```\\n\\n\uc704\uc5d0\uc11c \uc5bb\uc740 \ub450\uac00\uc9c0 \uc815\ubcf4(LoadBalancer, Domain)\ub85c \uc0dd\uc131\ub41c app\uc744 \ud14c\uc2a4\ud2b8\ud55c\ub2e4.  \\nKnative\ub294 \ub0b4\ubd80\uc801\uc73c\ub85c example.com\uc774\ub77c\uace0 \ud558\ub294 \uae30\ubcf8 domain\uc744 \uc0ac\uc6a9\ud558\ubbc0\ub85c \ub0b4\ubd80\uc801\uc73c\ub85c\ub294 `helloworld-python.default.example.com`\uc73c\ub85c curl\uc744 \uc2e4\ud589\ud558\uac8c \ub41c\ub2e4.  \\n\\n```sh\\n$ curl -H \\"Host:helloworld-python.default.example.com\\" http://a220723d475df11e980220a02e220b34-2021915778.ap-northeast-2.elb.amazonaws.com\\nHello World: Python Sample v1 with Knative on EKS!\\n```\\n\\n`Cold Start`(default timeout 5\ubd84) \ub54c\ubb38\uc5d0 \uc7a0\uc2dc \uc751\ub2f5\uc774 \ub2a6\uc5b4\uc9c8 \uc218\ub3c4 \uc788\uc9c0\ub9cc(2-5\ucd08) \uc7a0\uc2dc \uae30\ub2e4\ub9ac\uba74 \uc704\ucc98\ub7fc \uacb0\uacfc\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n\\n## \uc815\ub9ac\\n\\n\uc704\uc5d0\uc11c\ub3c4 \uc7a0\uae50 \uc5b8\uae09\ud588\uc9c0\ub9cc Lambda\ub098 ECS, Batch \uc11c\ube44\uc2a4\uac00 \uc788\ub294\ub370 Knative on EKS \ub97c \uad6c\uc9c0 \uc65c \ud558\ub290\ub0d0\ub77c\uace0 \uad81\uae08\ud574\ud558\ub294 \ubd84\ub4e4\uc774 \uacc4\uc2e4\uc9c0\ub3c4 \ubaa8\ub978\ub2e4. \ud558\uc9c0\ub9cc \ub2e4\ub4e4 \uc544\ub798\uc640 \uac19\uc740 \uace0\ubbfc\uc744 \ud574\ubd24\uc744\uac70\ub77c \uc0dd\uac01\ud55c\ub2e4.  \\n\\n\ucee8\ud14c\uc774\ub108\uc640 Kubernetes\uac00 DevOps\ub3c4\uad6c\ub85c\uc11c\uc758 \ud45c\uc900\uc774 \ub418\uc5b4\uac00\ub294 \uc2dc\ub300\uc5d0 Lambda\ub97c \uc4f8\uc9c0 \uc624\ud508\uc18c\uc2a4\ub97c \uc4f8\uc9c0\uc5d0 \ub300\ud55c \uace0\ubbfc\uc740 \uacb0\uad6d \uc774\uc2dd\uc131\uacfc \ubca4\ub354 \uc885\uc18d\uc131\uc744 \uc81c\uac70\ud558\uace0 \uc6b4\uc601\ud6a8\uc728\ud654 \uce21\uba74\uc5d0\uc11c \uadf8 \ub2f5\uc744 \ucc3e\uc744\uc218 \uc788\uc744\uac83 \uac19\ub2e4.  \\n\\n\ud604\uc7ac \ubab8\ub2f4\uace0 \uc788\ub294 \ucd5c\uadfc \ud504\ub85c\uc81d\ud2b8\uc5d0\uc11c Lambda, ECS, Batch \ub4f1\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\uc544\uc84c\ub294\ub370 \uc2e4\uc81c \uc5d4\ud130\ud504\ub77c\uc774\uc988\uc5d0\uc11c \uc815\ud574\uc9c4 \uc790\uc6d0\ub0b4\uc5d0\uc11c \uc815\ud574\uc9c4 \uc77c\uc744 \ud560\ub54c\ub294 \ub9e4\ub2c8\uc9c0\ub4dc \uc11c\ube44\uc2a4\uac00 \uc801\ud569\ud558\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4. \ud558\uc9c0\ub9cc On-Premise \ub610\ub294 \uadf8\uc5d0 \uc900\ud558\ub294 Kubernetes \ud074\ub7ec\uc2a4\ud130\ub97c \uc6b4\uc601\ud558\ub294 \uc870\uc9c1\uc5d0\uc11c\ub294 Knative\ub97c \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108 \uae30\ubc18 \uc11c\ube44\ub9ac\uc2a4 \uc6cc\ud06c\ub85c\ub4dc\ub97c \uad6c\ud604\ud558\ub294 \uac83\uc774 \ud5a5\ud6c4 Hybrid \uad00\uc810\uc5d0\uc11c \ud655\uc7a5\uc131\uacfc \ubca4\ub354 \uc885\uc18d\uc131\uc744 \uc81c\uac70\ud558\ub294\ub370 \ud070 \ub3c4\uc6c0\uc774 \ub420\uac83\uc774\ub77c \uc0dd\uac01\ud55c\ub2e4.  \\n\\n\uc870\uae08\uc529 Kubernetes \ubc0f \uc0dd\ud0dc\uacc4 Learning\uc5d0 \ub300\ud55c \ud53c\ub85c\ub3c4\uac00 \uc99d\uac00\ud558\uace0 \uc788\uace0 Hype Driven Development(\uc124\ub808\ubc1c \uc8fc\ub3c4\uac1c\ubc1c)\uac00 \ub418\ub294\uac83 \uac19\uc544\uc11c \uc544\uc26c\uc6b4 \ubd80\ubd84\uc740 \uc788\uc9c0\ub9cc \ud604\uc7ac \uac00\uc7a5 \ud56b\ud55c \uae30\uc220\uc774\uace0 \uad00\uc2ec\ub3c4\uac00 \ub192\uae30 \ub54c\ubb38\uc5d0 \ubc30\uc6cc\ub450\uba74 \uc5b8\uc820\uac00\ub294 \uc368\uba39\uac8c \ub420\uac70\ub77c \ud655\uc2e0\ud55c\ub2e4.  \\n\\n\ub2e4\uc2dc\ud55c\ubc88 Conference driven development(architecture)\uac00 \ub418\uc9c0 \uc54a\ub3c4\ub85d \uc790\uc911\ud558\uace0 Loudest Guy\uac00 \ub418\uc9c0 \uc54a\ub3c4\ub85d \uc870\uc2ec\ud574\uc57c\ud560 \uac83 \uac19\ub2e4."},{"id":"kubernetes/eksworkshop/","metadata":{"permalink":"/kubernetes/eksworkshop/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-03-29-eksworkshop.md","source":"@site/blog/2019-03-29-eksworkshop.md","title":"eksworkshop","description":"eskworkshop \ud29c\ud1a0\ub9ac\uc5bc\uc744 \uc2e4\ud589\ud558\uace0 \uac04\ub2e8\ud55c Microservice\uc571\uc744 \ubc30\ud3ec\ud574\ubcf4\uc790","date":"2019-03-29T00:00:00.000Z","formattedDate":"March 29, 2019","tags":[{"label":"eks","permalink":"/tags/eks"},{"label":"aws","permalink":"/tags/aws"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"eskworkshop","permalink":"/tags/eskworkshop"},{"label":"kubectl","permalink":"/tags/kubectl"},{"label":"Managed Kubernetes","permalink":"/tags/managed-kubernetes"}],"readingTime":14.23,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"eksworkshop","comments":true,"classes":"wide","description":"eskworkshop \ud29c\ud1a0\ub9ac\uc5bc\uc744 \uc2e4\ud589\ud558\uace0 \uac04\ub2e8\ud55c Microservice\uc571\uc744 \ubc30\ud3ec\ud574\ubcf4\uc790","slug":"kubernetes/eksworkshop/","date":"2019-03-29T00:00:00.000Z","categories":["Kubernetes"],"tags":["eks","aws","Kubernetes","eskworkshop","kubectl","Managed Kubernetes"]},"prevItem":{"title":"Knative on EKS","permalink":"/kubernetes/knative-on-aws/"},"nextItem":{"title":"git-sync","permalink":"/kubernetes/git-sync/"}},"content":"## Amazon EKS (Elastic Container Service for Kubernetes)\\n\\nKubernetes Managed Service\uc778 Amazon EKS\uac00 2018\ub144 7\uc6d4 \ucd9c\uc2dc\ub418\uace0 2019\ub144 1\uc6d4 \uc815\uc2dd\uc73c\ub85c \uc11c\uc6b8\ub9ac\uc804\uc5d0 \ucd9c\uc2dc\ub418\uc5c8\ub2e4. \uac1c\uc778\uc801\uc73c\ub85c \uc644\uc804\uad00\ub9ac\ud615 Kubernetes \ucd9c\uc2dc\uac00 \ub2a6\uc5b4\uc838\uc11c AWS \ud589\ubcf4\uac00 \ub2e4\uc18c \ub2a6\ub2e4\uace0 \uc0dd\uac01\uc740 \ud588\uc73c\ub098 ALB\uc640 VPC\uc5f0\ub3d9, \uc5ec\ub7ec\uac00\uc9c0 \uae30\uc874 OpenSource\uc640\uc758 \uc5f0\uacb0\uace0\ub9ac\ub97c \ubc30\uc81c\ud558\uace0 \uc790\uccb4 Managed\uc11c\ube44\uc2a4\uc640 \uc5f0\ub3d9\ud560\uac83\ub4e4\uc774 \ub9ce\uae30 \ub54c\ubb38\uc5d0 \ub2f9\uc5f0\ud788 \ud0c0\uc0ac\uc5d0 \ube44\ud574 \ub2a6\uc5b4\uc9c4\uac78\ub85c \ubcf4\uc778\ub2e4. \uc5b8\uc81c\ub098 \uadf8\ub7ac\uc9c0\ub9cc \uc624\ud508\uc18c\uc2a4\ub97c \ubc1b\uc544\ub4e4\uc774\ub294 \ub290\ub08c\uc774 \uc544\ub2c8\ub77c \ubb54\uac00 \uc644\uc131\ub41c \uc81c\ud488\uc744 \uc4f0\ub294 \ub290\ub08c(?)\uc774\ub2e4. \ubb3c\ub860 \ubd88\ud3b8\ud55c \ubd80\ubd84\uacfc \uac10\uc218\ud574\uc57c\ud560 \ub0b4\uc6a9\ub4e4\uc740 \uc870\uae08 \uc788\uc9c0\ub9cc \uae30\uc874 AWS \ucda9\uc131 User\uc5d0\uac8c \ud638\uc751\uc744 \uc5bb\uc744\uc218 \uc788\uae30 \ub54c\ubb38\uc774 \uc544\ub2d0\uae4c\ub77c\ub294 \uc0dd\uac01\uc744 \ud574\ubcf4\uba74\uc11c \ud3ec\uc2a4\ud305\uc744 \uc2dc\uc791\ud558\ub824\uace0 \ud55c\ub2e4.  \\n\\n\uc624\ud508\uc18c\uc2a4\uac00 \uc544\ub2cc Managed\uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \ub9ac\ubdf0\ub294 \ucc98\uc74c\uc774\uc9c0\ub9cc 4\uc6d4 10\uc77c [AWS\ud310\uad50\uc18c\ubaa8\uc784](https://www.meetup.com/ko-KR/awskrug/events/260024327/) \ubc1c\ud45c\ub3c4 \uc788\uace0, \uc2e4\uc81c \uace0\ub824\uc911\uc778 \uc544\ud0a4\ud14d\ucc98\uc5d0 \ud3ec\ud568\uc774 \ub418\uc5b4\uc57c \ud558\ub294 EKS\uc5d0 \ub300\ud574\uc11c \uc0b4\ud3b4\ubcf4\uace0 eskworkshop \ud29c\ud1a0\ub9ac\uc5bc\uc744 \uc2e4\ud589\ud574\ubcf4\uba74\uc11c \ub2e4\ub978 \uad00\ub9ac\ud615 Kubernetes \uc11c\ube44\uc2a4\ub4e4\uc5d0 \ube44\ud574 \uc5b4\ub5a4 \uc0ac\ud56d\uc744 \uc880\ub354 \uace0\ubbfc\ud574\uc57c \ud558\ub294\uc9c0 \uc815\ub9ac\ud574\ubcf4\uace0 \ub118\uc5b4\uac00\uba74 \uc88b\uc744\ub4ef \ud558\ub2e4.\\n\\n## eksworkshop.com\\n\\n[https://eksworkshop.com/](https://eksworkshop.com/)  \\nKubernete\ub97c \ucc98\uc74c\uc811\ud558\ub294 \uc720\uc800\ub97c \uc704\ud55c \uae30\ubcf8 \uac1c\ub150\uacfc \uc544\ud0a4\ud14d\ucc98, \uadf8\ub9ac\uace0 VPC, ALB\ub97c \ud65c\uc6a9\ud558\uc5ec EKS\uc5d0 \ub300\ud55c \uc124\uce58, \uad6c\uc131, \ub370\ubaa8\uc571 \ubc30\ud3ec \ub4f1\uc744 \ud574\ubcfc\uc218 \uc788\ub294 \ud29c\ud1a0\ub9ac\uc5bc \uc0ac\uc774\ud2b8\uc774\ub2e4.  \\n\\n[AWSKRUG](https://www.facebook.com/groups/awskrug/)\uc5d0\uc11c \ud55c\uae00\ud654 \uc791\uc5c5\ub3c4 \uc9c4\ud589\uc911\uc774\ub2e4.  [\ud55c\uae00\ud654 \ub9c1\ud06c](https://awskrug.github.io/eks-workshop/deploy/)\\n\\n## eksworkshop \ub530\ub77c\ud558\uae30\uc804 \uc0ac\uc804 \uc900\ube44\uc0ac\ud56d\\n\\neksworkshop\uc5d0\uc11c\ub294 \uae30\ubcf8\uc801\uc73c\ub85c workshop\uc774\ub77c\ub294 \uc2e0\uaddc IAM \uacc4\uc815\uc744 \uc0dd\uc131\ud558\uace0 Cloud9 Workspace \uc640 \uba87\uac00\uc9c0 \uc124\uc815\ub4e4\uc744 \uc9c4\ud589\ud558\uc9c0\ub9cc [AWS\ud310\uad50\uc18c\ubaa8\uc784](https://www.meetup.com/ko-KR/awskrug/events/260024327/)\uc744 \uc704\ud574 \ucd5c\ub300\ud55c \ube44\uc6a9\uc774 \ub4dc\ub294 \uad6c\uc131\uc694\uc18c\ub97c \ubc30\uc81c\ud558\uace0 \uc791\uc131\ud558\uace0\uc790 \ud55c\ub2e4.\\n\\n### AWS account\\nFree Tier\ub294 EKS\ub97c \uc790\uc720\ub86d\uac8c \ud65c\uc6a9\ud560\uc218 \uc5c6\ub2e4.  \\n\uad00\ub828 issue - [https://github.com/aws/containers-roadmap/issues/78](https://github.com/aws/containers-roadmap/issues/78)  \\n\\n\uc2e4\uc81c \uc0ac\uc6a9\uc911\uc778 \uacc4\uc815\uc774\ub098 Credit\uc774 \ud655\ubcf4\ub41c \uacc4\uc815\uc774 \ud544\uc694\ud558\ub2e4.  \\n\\n### IAM \uc124\uc815 (JSON template)\\nEKSworkshop\uc5d0\uc11c\ub294 Full administrator \uacc4\uc815\uc744 \ud544\uc694\ub85c \ud558\uc9c0\ub9cc eksctl\ub85c \ubc30\ud3ec\ub97c \uc9c4\ud589\ud558\ubbc0\ub85c \uadf8 \uae30\uc900\uc73c\ub85c IAM\uc124\uc815\uc744 \uc9c4\ud589\ud55c\ub2e4.  \\n\\n[terraform eks iam \uc124\uc815](https://github.com/terraform-aws-modules/terraform-aws-eks/blob/master/examples/eks_test_fixture/README.md)\uc744 \ucc38\uace0\ud558\ub824\uace0 \ud588\uc9c0\ub9cc eksctl\uacfc terraform\uacfc\uc758 \uc57d\uac04 \ub2e4\ub978 \ubc29\uc2dd\uc758 \ubc30\ud3ec\ub85c \uc778\ud574 \uc5b4\uca54\uc218\uc5c6\uc774 EKS Full Access\uad8c\ud55c\uc744 \ud560\ub2f9\ud558\uc600\ub2e4.  \\n(\ub2e4\ub978 \uc720\uacbd\ud5d8\uc790\uc758 \ub3c4\uc6c0\uc774 \ud544\uc694\ud55c \uc0c1\ud669 \u3160\u3160)\\n\\n\uc790\uc138\ud55c JSON \ub0b4\uc6a9\uc740 [\ub9c1\ud06c](https://github.com/ddiiwoong/eksworkshop/blob/master/iam_for_eksworkshop.json)\ub97c \ucc38\uace0\ud55c\ub2e4.  \\n\\n### kubectl, aws-iam-authenticator\\n* kubectl : kubernetes CLI\\n* aws-iam-authenticator : AWS IAM Authenticator CLI\\n\\n#### kubectl config\ub97c \uc800\uc7a5\ud558\uae30 \uc704\ud574 .kube directory\ub97c \uc0dd\uc131\\n\\n```bash\\n$ mkdir -p ~/.kube\\n``` \\n\\n#### kubectl \uc124\uce58 (linux)\\n```bash\\n$ sudo curl --silent --location -o /usr/local/bin/kubectl \\"https://amazon-eks.s3-us-west-2.amazonaws.com/1.11.5/2018-12-06/bin/linux/amd64/kubectl\\"\\n$ sudo chmod +x /usr/local/bin/kubectl\\n```\\n\\n#### kubectl \uc124\uce58 (MacOS Homebrew)\\nMacOS\ub294 brew\ub85c \uc124\uce58\ud558\uc600\ub2e4.  \\n[https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-with-homebrew-on-macos](https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-with-homebrew-on-macos)\\n```bash\\n$ brew install kubernetes-cli\\n```\\n\\n#### kubectl \uc124\uce58 (windows PowerShell)\\n[https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-kubectl.html](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-kubectl.html)\\n\\n```\\ncurl -o kubectl.exe https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/windows/amd64/kubectl.exe\\n```\\n\\n\\n#### kubectl \uc124\uce58 \ud655\uc778\\n\\n\ud604\uc7ac MacOS\uc5d0\uc11c\ub294 1.11.7 \ubc84\uc804\uc774 \uc124\uce58\ub418\uc5b4 \uc788\ub2e4. (\ub2e4\ub978\uacbd\ub85c\ub85c \uc124\uce58\ub428)\\n```bash\\n$ kubectl version --short --client\\nClient Version: v1.11.7-dispatcher\\n```\\n\\n#### aws-iam-authenticator \uc124\uce58\\nAmazon EKS\ub294 IAM\uc744 \uc0ac\uc6a9\ud558\uc5ec Kubernetes\uc6a9 AWS IAM Authenticator\ub97c \ud1b5\ud574 Kubernetes \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc778\uc99d\uc744 \uc81c\uacf5\ud55c\ub2e4.  Go(\ubc84\uc804 1.7\uc774\uc0c1)\uac00 \uc124\uce58\ub418\uc5b4 \uc788\uc73c\uba74 \uc544\ub798\uc640 \uac19\uc774 \uc9c4\ud589\ud558\uba74 \ub41c\ub2e4. \\n```bash\\n$ go get -u -v github.com/kubernetes-sigs/aws-iam-authenticator/cmd/aws-iam-authenticator\\n$ sudo mv ~/go/bin/aws-iam-authenticator /usr/local/bin/aws-iam-authenticator\\n```\\n\\n\ub9cc\uc57d Go\uc124\uce58\uac00 \uc548\ub418\uc5b4 \uc788\ub2e4\uba74 \ub2e4\uc74c \ub9c1\ud06c\ub97c \ud1b5\ud574 \uc124\uce58 \uc9c4\ud589\ud560\uc218 \uc788\ub2e4.  \\n[https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-aws-iam-authenticator.html](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-aws-iam-authenticator.html)\\n\\n#### aws-iam-authenticator binary \ub2e4\uc6b4\ub85c\ub4dc\\n\\nLinux: [https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/linux/amd64/aws-iam-authenticator](https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/linux/amd64/aws-iam-authenticator)  \\nMacOS: [https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/darwin/amd64/aws-iam-authenticator](https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/darwin/amd64/aws-iam-authenticator)  \\nWindows: [https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/windows/amd64/aws-iam-authenticator.exe](https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/windows/amd64/aws-iam-authenticator.exe)\\n\\n##### MacOS\uc758 \uacbd\uc6b0 \\n```bash\\n$ curl -o aws-iam-authenticator https://amazon-eks.s3-us-west-2.amazonaws.com/1.10.3/2018-07-26/bin/darwin/amd64/aws-iam-authenticator\\n$ chmod +x ./aws-iam-authenticator\\n$ cp ./aws-iam-authenticator $HOME/bin/aws-iam-authenticator && export PATH=$HOME/bin:$PATH\\n```\\n\\n##### MacOS bash \ud658\uacbd\ubcc0\uc218 \ucd94\uac00\\n```bash\\n$ echo \'export PATH=$HOME/bin:$PATH\' >> ~/.bash_profile\\n```\\n\\n##### MacOS zsh \ud658\uacbd\ubcc0\uc218 \ucd94\uac00\\n```bash\\n$ echo \'export PATH=$HOME/bin:$PATH\' >> ~/.zshrc\\n```\\n\\n#### aws-iam-authenticator binary \ud655\uc778\\n```bash\\n$ aws-iam-authenticator help\\n```\\n\\n### eksctl\\n\\n![mascot](https://github.com/weaveworks/eksctl/blob/master/logo/eksctl.png?raw=true)\\n\\neksctl\uc740 weaveworks\uc5d0\uc11c contribute\ud558\uace0 \uc788\ub294 \uc624\ud508\uc18c\uc2a4\ub85c EKS \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud558\ub294 \uac04\ub2e8\ud55c CLI \ub3c4\uad6c\uc774\ub2e4. Go\ub85c \uc791\uc131\ub418\uc5b4 \uc788\uace0 CloudFormation\uc744 \uae30\ubcf8\uc73c\ub85c \ub3d9\uc791\ud55c\ub2e4.  \\n\\n[https://eksctl.io/](https://eksctl.io/)  \\n[https://github.com/weaveworks/eksctl](https://github.com/weaveworks/eksctl)\\n\\n#### eksctl binary \ub2e4\uc6b4\ub85c\ub4dc\\n```bash\\n$ curl --silent --location \\"https://github.com/weaveworks/eksctl/releases/download/latest_release/eksctl_$(uname -s)_amd64.tar.gz\\" | tar xz -C /tmp\\n$ sudo mv -v /tmp/eksctl /usr/local/bin\\n```\\n\\n#### MacOS Homebrew \uc124\uce58\\n```bash\\n$ brew tap weaveworks/tap\\n$ brew install weaveworks/tap/eksctl\\n```\\n\\n#### Windows \uc124\uce58 (PowerShell, chocolatey)\\n```\\nchocolatey install eksctl\\n```\\n\\n#### eksctl \ub3d9\uc791\ud655\uc778\\n```bash\\n$ eksctl version\\n```\\n\\n#### CLI API \uc790\uaca9\uc99d\uba85 \uad6c\uc131\\n\\n\uc0ac\uc804\uc124\uc815\ud55c aws configure\uac00 \uc788\ub294\uc9c0 \ud655\uc778. \uae30\uc874 Terraform\uc774\ub098 kops \uc0ac\uc6a9\ud55c\uc801\uc774 \uc788\uc73c\uba74 \uac74\ub108\ub6f0\uc5b4\ub3c4 \ub41c\ub2e4.  \\n```bash\\n$ ls  ~/.aws\\n```\\n\uc5c6\uc744\uacbd\uc6b0 aws \uc790\uaca9\uc99d\uba85\uc744 \uc0dd\uc131\ud55c\ub2e4.\\n\\n#### ~/.aws/credentials\\n```\\n[default]\\naws_access_key_id={EXAMPLE}\\naws_secret_access_key={EXAMPLEKEY}\\n```\\n\\n#### ~/.aws/config\\n```\\n[default]\\nregion=ap-northeast-2\\noutput=json\\n```\\n\\n## EKS \ubc30\ud3ec\\nkubectl, aws-iam-authenticator, eksctl, AWS \uc790\uaca9\uc99d\uba85 \ud658\uacbd\uae4c\uc9c0 \uad6c\uc131\ub418\uc5b4 \uc788\uc73c\uba74 \ubc14\ub85c \ubc30\ud3ec\uac00 \uac00\ub2a5\ud558\ub2e4.  \\n\\n```bash\\n$ eksctl create cluster --name=eksworkshop-eksctl --nodes=3 --node-ami=auto\\n[\u2139]  using region ap-northeast-2\\n[\u2139]  setting availability zones to [ap-northeast-2a ap-northeast-2c ap-northeast-2a]\\n[\u2139]  subnets for ap-northeast-2a - public:192.168.0.0/19 private:192.168.96.0/19\\n[\u2139]  subnets for ap-northeast-2c - public:192.168.32.0/19 private:192.168.128.0/19\\n[\u2139]  subnets for ap-northeast-2a - public:192.168.64.0/19 private:192.168.160.0/19\\n[\u2139]  nodegroup \\"ng-cfb3cb01\\" will use \\"ami-0c7972077aa002104\\" [AmazonLinux2/1.11]\\n[\u2139]  creating EKS cluster \\"eksworkshop-eksctl\\" in \\"ap-northeast-2\\" region\\n[\u2139]  will create 2 separate CloudFormation stacks for cluster itself and the initial nodegroup\\n[\u2139]  if you encounter any issues, check CloudFormation console or try \'eksctl utils describe-stacks --region=ap-northeast-2 --name=eksworkshop-eksctl\'\\n[\u2139]  creating cluster stack \\"eksctl-eksworkshop-eksctl-cluster\\"\\n[\u2139]  creating nodegroup stack \\"eksctl-eksworkshop-eksctl-nodegroup-ng-cfb3cb01\\"\\n[\u2139]  --nodes-min=2 was set automatically\\n[\u2139]  --nodes-max=2 was set automatically\\n[\u2714]  all EKS cluster resource for \\"eksworkshop-eksctl\\" had been created\\n[\u2714]  saved kubeconfig as \\"/Users/ddii/.kube/config\\"\\n[\u2139]  nodegroup \\"ng-cfb3cb01\\" has 0 node(s)\\n[\u2139]  waiting for at least 2 node(s) to become ready in \\"ng-cfb3cb01\\"\\n[\u2139]  nodegroup \\"ng-cfb3cb01\\" has 2 node(s)\\n[\u2139]  node \\"ip-192-168-42-42.ap-northeast-2.compute.internal\\" is ready\\n[\u2139]  node \\"ip-192-168-66-165.ap-northeast-2.compute.internal\\" is ready\\n[\u2139]  kubectl command should work with \\"/Users/ddii/.kube/config\\", try \'kubectl get nodes\'\\n[\u2714]  EKS cluster \\"eksworkshop-eksctl\\" in \\"ap-northeast-2\\" region is ready\\n```\\n\\n\uc11c\uc6b8\ub9ac\uc804(ap-northeast-2)\uae30\uc900 \uc57d 15-20\ubd84\uc774 \uc18c\uc694\ub418\uba70 `eksctl` \uae30\ubcf8 \uc124\uc815\uac12\uc740 \ub2e4\uc74c\uacfc \uac19\ub2e4.\\n\\n* \ud074\ub7ec\uc2a4\ud130\uba85\uc740 \uc790\ub3d9\uc0dd\uc131, --name \uc635\uc158\uc73c\ub85c \uc9c0\uc815\uac00\ub2a5 (eksworkshop-eksctl)\\n* CloudFormation : eksctl-{$Cluster_Name}-cluster\\n* m5.large * 2 instances ([EKS Instance Type](https://github.com/awslabs/amazon-eks-ami/blob/7f6c8cb3597e17f6e5f7df96d12bccf5604dc909/amazon-eks-nodegroup.yaml) NodeInstanceType.AllowedValues \ucc38\uace0)\\n* Default AMI : AWS EKS AMI (custom EKS AMI \uac00\ub2a5 - Packer\ud65c\uc6a9)\\n* Default Region : us-west-2\\n* dedicated VPC : 192.168.0.0/16 \\n* kubernetes version : 1.11.x ([EKS Version](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/platform-versions.html) \ucc38\uace0)\\n* StorageClass : gp2 ([AWS EBS](https://kubernetes.io/docs/concepts/storage/storage-classes/#aws-ebs) \ucc38\uace0)\\n* CNI : [Amazon VPC](https://github.com/aws/amazon-vpc-cni-k8s)\\n* Node Autoscaler : --node-min, --node-max Auto Scaling \uc124\uc815\\n* \uae30\ubcf8 Pod \uac1c\uc218 : [\ucc38\uace0](https://github.com/awslabs/amazon-eks-ami/blob/7f6c8cb3597e17f6e5f7df96d12bccf5604dc909/files/eni-max-pods.txt)\\n* nodegroup : worker\uac00 \ud3ec\ud568\ub418\ub294 group \\n* kubeconfig : ~/.kube/config \ub85c \ud1b5\ud569\ub428\\n \\n### Config File \uc0ac\uc6a9\\n\\n[https://github.com/weaveworks/eksctl/tree/master/examples](https://github.com/weaveworks/eksctl/tree/master/examples)\ub97c \ucc38\uace0\ud558\uc5ec `YAML`\ud615\ud0dc\ub85c \uc791\uc131\ud558\uc5ec \ubc30\ud3ec\uac00\ub2a5\ud558\ub2e4. \\n\\n```bash\\n$ eksctl create cluster -f example.yaml\\n```\\n\\n\uae30\uc874\uc5d0 \uad00\ub9ac\ud558\ub294 VPC subnet\uc815\ubcf4 \ubc0f AutoScaling, AZ(availabilityZones)\uc124\uc815, nodegroup \uad00\ub9ac, node Instance\uc5d0 preBootstrapCommand\ub4f1\uc744 \uc544\ub798 \uc608\uc2dc\uc640 \uac19\uc774 \ubbf8\ub9ac \uc791\uc131\ud558\uba74 GitOps\uce21\uba74\uc5d0\uc11c \ud65c\uc6a9\ub3c4\uac00 \ub354\uc6b1 \ub192\uc544\uc9c8\uc218 \uc788\ub2e4.\\n\\n#### 05-advanced-nodegroups.yaml\\n```yaml\\n# An advanced example of ClusterConfig object with customised nodegroups:\\n--- \\napiVersion: eksctl.io/v1alpha4\\nkind: ClusterConfig\\n\\nmetadata:\\n  name: cluster-5\\n  region: eu-west-2\\n\\nnodeGroups:\\n  - name: ng1-public\\n    instanceType: m5.xlarge\\n    minSize: 2\\n    maxSize: 8\\n    labels:\\n      nodegroup-type: frontend-workloads\\n    iam:\\n      withAddonPolicies:\\n        autoScaler: true\\n\\n  - name: ng2-private-a\\n    instanceType: m5.large\\n    desiredCapacity: 2\\n    labels:\\n      nodegroup-type: backend-cluster-addons\\n    privateNetworking: true\\n    preBootsrapCommand:\\n      # allow docker registries to be deployed as cluster service \\n      - \'echo {\\\\\\"insecure-registries\\\\\\": [\\\\\\"172.20.0.0/16\\\\\\",\\\\\\"10.100.0.0/16\\\\\\"]} > /etc/docker/daemon.json\'\\n      - \\"systemctl restart docker\\"\\n\\n  - name: ng3-private-b\\n    instanceType: c3.8xlarge\\n    desiredCapacity: 4\\n    labels:\\n      nodegroup-type: very-special-science-workloads\\n    privateNetworking: true\\n    availabilityZones: [\\"eu-west-2a\\"] # use single AZ to optimise data transfer between isntances\\n    preBootstrapCommand:\\n      # disable hyperthreading\\n      - \\"for n in $(cat /sys/devices/system/cpu/cpu*/topology/thread_siblings_list | cut -s -d, -f2- | tr \',\' \'\\\\n\' | sort -un); do echo 0 > /sys/devices/system/cpu/cpu${n}/online; done\\"\\n\\n# cluster AZs must be set explicitly for single AZ nodegroup example to work\\navailabilityZones: [\\"eu-west-2a\\", \\"eu-west-2b\\", \\"eu-west-2c\\"]\\n```\\n\\n## Kubernetes \ub300\uc2dc\ubcf4\ub4dc \ubc30\ud3ec\\n\\nKubernetes \uacf5\uc2dd \ub300\uc2dc\ubcf4\ub4dc\ub294 \uae30\ubcf8\uc73c\ub85c \ubc30\ud3ec\ub418\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 \uc218\ub3d9\uc73c\ub85c \ubc30\ud3ec\ud574\uc57c\ud55c\ub2e4. \uc124\uce58 \ubc29\ubc95\uc740 [\uacf5\uc2dd \ubb38\uc11c](https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/)\uc5d0\uc11c \ud655\uc778\uac00\ub2a5\ud558\ub2e4.  \\n\\n\uc704\uc5d0\uc11c \uad6c\uc131\ub41c \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c Kubernetes \ub300\uc2dc\ubcf4\ub4dc\ub97c \ubc30\ud3ec\ud55c\ub2e4.\\n```bash\\n$ kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml\\n```\\n\\n\uc811\uc18d\uc744 \uc704\ud574 kube-proxy \uae30\ub2a5\uc744 \ud65c\uc6a9\ud558\uc5ec 8080\ud3ec\ud2b8\ub85c expose\ub97c \uc9c4\ud589\ud55c\ub2e4. \ubaa8\ub4e0 \uc778\ud130\ud398\uc774\uc2a4\uc5d0\uc11c \ud544\ud130\ub9c1\uc5c6\uc774 \uc811\uc18d\uc774 \uac00\ub2a5\ud558\ub3c4\ub85d \uc635\uc158\uc744 \uc9c0\uc815\ud55c\ub2e4. \\n\uc544\ub798 \uba85\ub839\uc740 \ud130\ubbf8\ub110\uc5d0\uc11c \ubc31\uadf8\ub77c\uc6b4\ub4dc\ub85c \uacc4\uc18d \ub3d9\uc791\ud55c\ub2e4.  \\n```bash\\n$ kubectl proxy --port=8080 --address=\'0.0.0.0\' --disable-filter=true &\\nW0328 16:39:09.061754    9100 proxy.go:139] Request filter disabled, your proxy is vulnerable to XSRF attacks, please be cautious\\n```\\n\\nTOKEN\uc73c\ub85c \uc811\uc18d\ud558\uae30 \uc704\ud574 aws-iam-authenticator\ub97c \ud1b5\ud574 \ud574\ub2f9 \ud074\ub7ec\uc2a4\ud130 token\uc744 \ud655\uc778\ud55c\ub2e4.  \\n```bash\\n$ aws-iam-authenticator token -i eksworkshop-eksctl --token-only\\nk8s-aws-v1.aHR0cHM6Ly9zdHMuYXAtbm9ydGhlYXN0LTIuYW1hem9uYXdzLmNvbS8_QWN0aW9uPUdldENhbGxlcklkZW50aXR5JlZlcnNpb249MjAxMS0wNi0xNSZYLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFKMjVNVjJSVVZQNlRWTURBJTJGMjAxOTAzMjglMkZhcC1ub3J0aGVhc3QtMiUyRnN0cyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMTkwMzI4VDA3NDEwNVomWC1BbXotRXhwaXJlcz0wJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCUzQngtazhzLWF3cy1pZCZYLUFtei1TaWduYXR1cmU9Yjc0NzkzYzUwOTU5NDYwMzMxMjY2YjExYWY4ODBkM2Q2OWQ5MWRhYzFhZWY1NjZmZTAwNTNlNWY2MTM0NGFlZQ\\n```\\n\\n\uadf8\ub0e5 localhost:8080 \uc73c\ub85c\ub9cc \uc811\uc18d\ud558\uba74 \uad6c\uc131\ub41c \ud074\ub7ec\uc2a4\ud130 kube API list\ub97c \ud655\uc778\ub418\ubbc0\ub85c \uc544\ub798 \uacbd\ub85c\ub85c \uc811\uc18d\ud55c\ub2e4.  \\n\uc704\uc5d0\uc11c \ucd9c\ub825\ub41c TOKEN\uac12\uc73c\ub85c \ub85c\uadf8\uc778\ud55c\ub2e4. Token \uc138\uc158 Timeout\uc774 \uc788\uc73c\ub2c8 \uc138\uc158\ub9cc\ub8cc\uc2dc `aws-iam-authenticator` \uba85\ub839\uc744 \ud1b5\ud574 \uac31\uc2e0\uac12\uc744 \uc785\ub825\ud558\uba74 \ub41c\ub2e4.  \\n```\\nhttp://localhost:8080/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login\\n```\\n![dashboard](/img/k8s_dashboard.png)\\n\\n\\n## Microservice app \ubc30\ud3ec\\n\uac00\uc7a5 \uae30\ubcf8\uc801\uc778 [Sock Shop](https://microservices-demo.github.io/)\uc744 \ubc30\ud3ec\ud558\uae30 \uc704\ud574 Git Clone \uc218\ud589\\n```bash\\n$ git clone https://github.com/microservices-demo/microservices-demo.git sockshop\\n$ cd sockshop/deploy/kubernetes\\n```\\n\\n`NodePort`\ub85c \ub418\uc5b4\uc788\ub294 Front-End Service\ub97c `LoadBalancer`\ub85c \uc218\uc815\ud55c\ub2e4.\\n```bash\\n$ sed -i \'s/NodePort/LoadBalancer/g\' complete-demo.yaml\\n$ cat complete-demo.yaml | grep LoadBalancer\\n type: LoadBalancer\\n```\\n\\n\\nnamespace \uc0dd\uc131 \ubc0f sock-shop \ubc30\ud3ec\\n```bash\\n$ kubectl create namespace sock-shop\\n$ kubectl apply -f complete-demo.yaml\\n$ kubectl get all\\n```\\n\\n\uc11c\ube44\uc2a4 \uc811\uc18d\ud655\uc778\uc744 \uc704\ud574\uc11c\ub294 ALB\ubc30\ud3ec\uc2dc\uac04(DNS\uc804\ud30c)\uc774 \uc77c\uc815 \uc18c\uc694\ub418\ubbc0\ub85c \uc7a0\uc2dc\ud6c4 \uc811\uc18d\uc744 \uc2dc\ub3c4\ud55c\ub2e4.\\n```bash\\n$ kubectl get svc\\nNAME           TYPE           CLUSTER-IP       EXTERNAL-IP                                                                 PORT(S)        AGE\\ncarts          ClusterIP      10.100.84.58     <none>                                                                      80/TCP         1h\\ncarts-db       ClusterIP      10.100.227.156   <none>                                                                      27017/TCP      1h\\ncatalogue      ClusterIP      10.100.206.52    <none>                                                                      80/TCP         1h\\ncatalogue-db   ClusterIP      10.100.119.66    <none>                                                                      3306/TCP       1h\\nfront-end      LoadBalancer   10.100.249.164   a4c42cfe951be11e9bb8c0a8cd8a2e5d-8156023.ap-northeast-2.elb.amazonaws.com   80:30001/TCP   1h\\norders         ClusterIP      10.100.160.17    <none>                                                                      80/TCP         1h\\norders-db      ClusterIP      10.100.70.203    <none>                                                                      27017/TCP      1h\\npayment        ClusterIP      10.100.57.233    <none>                                                                      80/TCP         1h\\nqueue-master   ClusterIP      10.100.146.109   <none>                                                                      80/TCP         1h\\nrabbitmq       ClusterIP      10.100.32.115    <none>                                                                      5672/TCP       1h\\nshipping       ClusterIP      10.100.180.174   <none>                                                                      80/TCP         1h\\nuser           ClusterIP      10.100.211.41    <none>                                                                      80/TCP         1h\\nuser-db        ClusterIP      10.100.87.142    <none>                                                                      27017/TCP      1h\\n```\\n  \\n\\n\ube0c\ub77c\uc6b0\uc800\uc5d0\uc11c ALB\uc8fc\uc18c `a4c42cfe951be11e9bb8c0a8cd8a2e5d-8156023.ap-northeast-2.elb.amazonaws.com` \ub85c \uc811\uc18d\ud558\uc5ec sock-shop Demo Web\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4.  \\n\\n![sockshop](/img/sock-shop.png)\\n\\n\\n## EKS \ud074\ub7ec\uc2a4\ud130 \ubc0f \uc0ad\uc81c\\n\\n\uc704\uc5d0\uc11c \uc678\ubd80\uc811\uc18d\uc744 \uc704\ud574 LoadBalancer\ub97c \uc218\ub3d9\uc73c\ub85c \uc124\uc815\ud558\uc600\uc73c\ubbc0\ub85c EC2 - Load Balancer\uc11c \ud504\ub85c\ube44\uc800\ub2dd\ub41c ALB\ub97c \uc0ad\uc81c\ud558\uace0 \uc9c4\ud589\ud574\uc57c \ud55c\ub2e4.  \\n\\n\ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc2e4\ud589 \uc911\uc778 \ubaa8\ub4e0 \uc11c\ube44\uc2a4\ub97c \ub2e4\uc2dc \ud655\uc778\ud558\uace0 EXTERNAL-IP\uac12\uacfc \uc5f0\uacb0\ub41c \ubaa8\ub4e0 \uc11c\ube44\uc2a4\ub97c \uc0ad\uc81c\ud55c\ub2e4.  \\n```bash\\n$ kubectl get svc --all-namespaces\\n$ kubectl delete svc front-end\\n```\\n\\nALB\uc640 VPC \uc0ad\uc81c\uac00 \uc644\ub8cc\ub41c\uac83\uc744 \ud655\uc778\ud558\uace0 \ud074\ub7ec\uc2a4\ud130\ub97c \uc0ad\uc81c\ud558\uc790.  \\n\\n```bash\\n$ eksctl delete cluster --name=eksworkshop-eksctl\\n[\u2139]  deleting EKS cluster \\"eksworkshop-eksctl\\"\\n[\u2139]  will delete stack \\"eksctl-eksworkshop-eksctl-nodegroup-ng-3af535b7\\"\\n[\u2139]  waiting for stack \\"eksctl-eksworkshop-eksctl-nodegroup-ng-3af535b7\\" to get deleted\\n[\u2139]  will delete stack \\"eksctl-eksworkshop-eksctl-cluster\\"\\n[\u2714]  kubeconfig has been updated\\n[\u2714]  the following EKS cluster resource(s) for \\"eksworkshop-eksctl\\" will be deleted: cluster. If in doubt, check CloudFormation console\\n```\\n\\n## \uc815\ub9ac\\n\uc11c\uc6b8 \ub9ac\uc804(ap-northeast-2)\uc5d0 EKS\uac00 \uc624\ud508\ub418\uace0 Production\ud658\uacbd\uc744 EKS\ub85c \ub118\uc5b4\uac00\ub294 \uae30\uc5c5\ub4e4\uc774 \ub9ce\uc544\uc9c0\uace0 \uc788\ub294\uac74 \uc544\uc8fc \uae0d\uc815\uc801\uc778 \ud604\uc0c1\uc774\ub2e4.  \\n\ub610\ud55c \uc5c4\uccad\ub09c \uc18d\ub3c4\uc758 \uae30\uc220\uac1c\ubc1c\uacfc \ub2e4\uc591\ud55c \ud234\ub4e4\ub85c Kubernetes Cluster\ub97c \uad6c\uc131\ud558\uac70\ub098 Microservice\ud615\ud0dc\uc758 App\uc744 \ubc30\ud3ec\ud558\ub294\uac83\uc740 \uc810\uc810 \ub300\uc911\ud654 \ub418\uc5b4\uac00\uace0 \uc788\ub2e4.  \\n\uc2e4\uc81c Production\uc5d0\uc11c \uad6c\ud604\uc744 \ud558\uae30 \uc704\ud574\uc11c\ub294 \ubcf4\uc548 \ubc0f \uc131\ub2a5\uc744 \ub3d9\uc2dc\uc5d0 \uace0\ub824\ud55c \ub124\ud2b8\uc6cc\ud06c(CNI), Ingress \uc124\uc815\uc774\ub098 \uc804\uccb4 \ud074\ub7ec\uc2a4\ud130 \ud37c\ud3ec\uba3c\uc2a4 \uce21\uba74\uc5d0\uc11c\uc758 \ud30c\ub77c\ubbf8\ud130 \ud29c\ub2dd\uc774 \ub354\uc6b1 \ub354 \uc911\uc694\ud574\uc9c0\uace0 \uad00\ub828\ub41c DevOps(SRE) \uc778\ub825\ub4e4\uc758 \uc911\uc694\ub3c4\uac00 \ub192\uc544\uc9c8\uac83\uc740 \ubd84\uba85\ud574 \ubcf4\uc778\ub2e4.  \\n\\nEKS\ub97c \uc624\ud508\uc18c\uc2a4 \uce21\uba74\uc5d0\uc11c \uace0\ub824\ud588\uc744\ub54c\uc5d0\ub294 \uc608\uc804\uc5d0 \ud398\uc774\uc2a4\ubd81\uc774\ub098 \ub2e4\ub978\uacf3\uc5d0\uc11c \uc885\uc885 \uc774\uc57c\uae30 \ud588\ub358\uac83\ucc98\ub7fc AWS \uace0\uc720\uc758 Lock-in \uc804\ub7b5\uc744 \uc5c4\uccad\ub098\uac8c \uace0\ubbfc\ud558\uace0 \ubc1c\ud45c\ud55c\ub4ef\ud55c \uc0dd\uac01\uc774 \ud55c \ub290\ub08c\uc744 \uc9c0\uc6b8\uc218\ub294 \uc5c6\ub294\uac74 \uc0ac\uc2e4\uc774\uc9c0\ub9cc \ud6cc\ub96d\ud55c \uc81c\ud488\uc778\uac74 \ud655\uc2e4\ud558\uace0 \ub2e8\uae30\uac04\uc5d0 \uc11c\ube44\uc2a4 \uc131\uc7a5\uc18d\ub3c4\ub97c \ub0bc \uc218 \uc788\ub294 \uc11c\ube44\uc2a4\ub77c \uc0dd\uac01\ud55c\ub2e4.  \\n\\n\ub9c8\uc9c0\ub9c9\uc73c\ub85c Managed Kubernetes\uc758 \uc120\ud0dd\uc740 \uc5d4\uc9c0\ub2c8\uc5b4\uc758 \ubaab\uc73c\ub85c \ubcf4\uace0 \uac01 \ubca4\ub354\ubcc4 \ube44\uad50\ud55c \uc544\ub798 \ub9c1\ud06c\ub97c \ucc38\uc870\ud574\uc11c \uc120\uc815 \uae30\uc900\uc744 \uc7a1\uc73c\uba74 \ub354\uc6b1 \uc88b\uc744\uac83 \uac19\ub2e4.  \\n[https://docs.google.com/spreadsheets/d/1U0x4-NQegEPGM7eVTKJemhkPy18LWuHW5vX8uZzqzYo/edit#gid=0](https://docs.google.com/spreadsheets/d/1U0x4-NQegEPGM7eVTKJemhkPy18LWuHW5vX8uZzqzYo/edit#gid=0)"},{"id":"kubernetes/git-sync/","metadata":{"permalink":"/kubernetes/git-sync/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-03-21-git-sync.md","source":"@site/blog/2019-03-21-git-sync.md","title":"git-sync","description":"git-sync\uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf8\ub2e4.","date":"2019-03-21T00:00:00.000Z","formattedDate":"March 21, 2019","tags":[{"label":"git-sync","permalink":"/tags/git-sync"},{"label":"GitOps","permalink":"/tags/git-ops"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"ssh git","permalink":"/tags/ssh-git"},{"label":"sidecar","permalink":"/tags/sidecar"},{"label":"sidecar pattern","permalink":"/tags/sidecar-pattern"}],"readingTime":8.095,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"git-sync","comments":true,"classes":"wide","description":"git-sync\uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf8\ub2e4.","slug":"kubernetes/git-sync/","date":"2019-03-21T00:00:00.000Z","categories":["Kubernetes"],"tags":["git-sync","GitOps","Kubernetes","ssh git","sidecar","sidecar pattern"]},"prevItem":{"title":"eksworkshop","permalink":"/kubernetes/eksworkshop/"},"nextItem":{"title":"VScode Server","permalink":"/tools/vscode-server/"}},"content":"git repo\ub97c kubernetes volume\uc73c\ub85c \uad6c\ud604\ud560\uc218 \uc788\ub294 sidecar pattern `git-sync` \ud504\ub85c\uc81d\ud2b8\uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf8\ub2e4.\\n\\n## git-sync\\n\\n[Kubernetes Github](https://github.com/kubernetes)\uc5d0 \ubc29\ubb38\ud558\uba74 \ub2e4\uc591\ud55c \ud504\ub85c\uc81d\ud2b8\ub4e4\uc744 \ubcfc \uc218 \uc788\ub2e4.  \\n[Kubernetes Project](https://github.com/kubernetes/kubernetes)\ubd80\ud130 minikube, kubeadm, kubectl, kubelet, dashboard\ub4f1 \ud544\uc218\uc801\uc73c\ub85c \ud544\uc694\ud558\uac70\ub098 \ub9ce\uc774 \uc0ac\uc6a9\ub418\ub294 \ud504\ub85c\uc81d\ud2b8\ub97c \ubcfc \uc218 \uc788\ub294\ub370,\\n\uae30\uc874\uc5d0 storage volume \uc73c\ub85c \ud65c\uc6a9\ub418\ub358 [gitrepo](https://kubernetes.io/docs/concepts/storage/volumes/#gitrepo)\uac00 `deprecated` \ub418\uc5b4\uc11c \ubc29\ubc95\uc744 \ucc3e\ub2e4\uac00 \uc720\uc0ac\ud55c \ud504\ub85c\uc81d\ud2b8\ub97c \uacf5\uc2dd repo\uc5d0\uc11c \uc6b0\uc5f0\ud788 \ubc1c\uacac\ud558\uac8c \ub418\uc5c8\ub2e4.  \\n\\n[git-sync](https://github.com/kubernetes/git-sync)\ub294 sidecar \ubc29\uc2dd\uc73c\ub85c git repository\ub97c clone\ud558\ub294 \ud504\ub85c\uc81d\ud2b8\uc774\ub2e4.  \\n\\n\ucd5c\ucd08 \ud55c\ubc88 clone\ub3c4 \uac00\ub2a5\ud558\uace0 \uc77c\uc815\ud55c \uac04\uaca9\uc73c\ub85c \ub04c\uc5b4\uc640\uc11c \uc751\uc6a9\ud504\ub85c\uadf8\ub7a8\uc5d0 \uc0ac\uc6a9\ud560 \uc218 \uc788\uace0 \uc6d0\ud558\ub294 branch, Tag \ub610\ub294 \ud2b9\uc815 git hash \uae30\ubc18\uc73c\ub85c pulling\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n\\nupstream\uc758 repository\uc5d0\uc11c \ub300\uc0c1\uc774 \ubcc0\uacbd\ub418\uc5c8\uc744\ub54c \ub2e4\uc2dc pulling\ud558\uace0, webhook\uae30\ub2a5\uc744 \ucd94\uac00\ud558\uc5ec \ube44\ub3d9\uae30\uc131\uc73c\ub85c POST \uc694\uccad\uc774 \uc788\uc744\ub54c\ub9cc git-sync\ub97c \uc218\ud589\ud560\uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \\nContinuous Deployment\ub97c \uac04\ub2e8\ud558\uac8c \uad6c\ud604\ud558\ub294\ub370 \ud65c\uc6a9\ub420 \uc218 \uc788\ub2e4. \\n\\n## GitHub SSH\uc124\uc815\\n\\ngit \ub0b4\uc6a9\uc744 pulling\uc744 \ud560\ub54c https, ssh \ubc29\ubc95\uc744 \uc0ac\uc6a9\ud558\ub294\ub370 GitHub ssh key\ub97c kubernetes cluster\uc758 secret\uc73c\ub85c \uc0ac\uc6a9\uc744 \ud560\uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 ssh \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc744 \uc791\uc131\ud558\uc600\ub2e4.  \\n\\n\uc544\ub798 \ubaa8\ub4e0 \uacfc\uc815\uc740 MacOS\uc5d0\uc11c \uc9c4\ud589\ud558\uc600\uace0 \ub2e4\ub978 OS\ub294 \uc544\ub798 \ub9c1\ud06c\uc5d0\uc11c \ud655\uc778 \uac00\ub2a5\ud558\ub2e4.  \\n[https://help.github.com/en/articles/connecting-to-github-with-ssh](https://help.github.com/en/articles/connecting-to-github-with-ssh)\\n\\n\uc0ac\uc6a9\ud558\uace0\uc790 \ud558\ub294 \ud130\ubbf8\ub110\uc5d0\uc11c \ub4f1\ub85d\ud0a4\ub97c \ud655\uc778\ud558\uc790.\\n\\n### \uae30\uc874\uc5d0 \ub4f1\ub85d\ub41c SSH key \ud655\uc778\\n```\\n$ ls -al ~/.ssh\\n```\\n\\n### \uc0c8\ub85c\uc6b4 SSH key \uc0dd\uc131\\n```\\n$ ssh-keygen -t rsa -b 4096 -C \\"ddiiwoong@gmail.com\\"\\n# Start the SSH key creation process\\n> Enter file in which the key is (/Users/you/.ssh/id_rsa): [Hit enter]\\n> Key has comment \'/Users/you/.ssh/id_rsa\'\\n> Enter new passphrase (empty for no passphrase): [Type new passphrase]\\n> Enter same passphrase again: [One more time for luck]\\n> Your identification has been saved with the new passphrase.\\n```\\n\\n### ssh agent \uc2e4\ud589\uc911\uc778\uc9c0 \ud655\uc778\\n```\\neval \u201c$(ssh-agent -s)\u201d\\n> Agent pid 59566\\n```\\n\\n### \uc0dd\uc131\ub41c \ud0a4\ub97c keychain\uc5d0 \uc800\uc7a5 \ubc0f \ud655\uc778\\n```\\n$ ssh-add -K ~/.ssh/id_rsa\\n$ cat ~/.ssh/id_rsa.pub\\n```\\n\\n### \ubcf5\uc0ac \ubc0f github\uc5d0 \ucd94\uac00\\n```\\n$ pbcopy < ~/.ssh/id_rsa.pub\\n```\\nSetting - SSH and GPG keys - SSH keys - New SSH key  \\n`Title`\uc740 \uad6c\ubd84\uc790\ub85c \uc785\ub825\ud558\uace0 GitHub password\ub97c \ud55c\ubc88\ub354 \uc785\ub825\ud558\uace0 \uc644\ub8cc\ud55c\ub2e4.  \\n\\n### \ud130\ubbf8\ub110\uc5d0\uc11c SSH\uc811\uc18d \ud655\uc778\\n```\\n$ ssh -T git@github.com\\nHi ddiiwoong! You\'ve successfully authenticated, but GitHub does not provide shell access.\\n```\\n\\n## git-sync\ub97c \uc704\ud55c secret \ub4f1\ub85d\\n\\n[https://github.com/kubernetes/git-sync/blob/master/docs/ssh.md](https://github.com/kubernetes/git-sync/blob/master/docs/ssh.md)\\n\\n### secret \uc0dd\uc131\\n\uc704\uc5d0\uc11c \uc0dd\uc131\ud55c SSH key\ub97c Kubernetes Cluster\uc5d0 Secret resource\ub85c \uc800\uc7a5\uc744 \ud55c\ub2e4.\\n\\n```\\n$ ssh-keyscan github.com > /tmp/known_hosts\\n# github.com:22 SSH-2.0-babeld-9d924d26\\n# github.com:22 SSH-2.0-babeld-9d924d26\\n# github.com:22 SSH-2.0-babeld-9d924d26\\n```\\n\\nknown_hosts\uc640 key\ub97c Secret\uc73c\ub85c \uc800\uc7a5\ud55c\ub2e4.\\n```\\n$ kubectl create secret generic git-creds \\\\\\n    --from-file=ssh=$HOME/.ssh/id_rsa \\\\\\n    --from-file=known_hosts=/tmp/known_hosts\\n\\n$ kubectl get secret git-creds\\nNAME        TYPE      DATA      AGE\\ngit-creds   Opaque    2         1d\\n```\\n\\n## sample ngnix \ubc30\ud3ec\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c `git-sync/cmd/git-sync/main.go` \uc18c\uc2a4\ub97c \ud655\uc778\ud558\uba74 \uc5ec\ub7ec\uac00\uc9c0 flag\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub294\ub370 \uc8fc\ub85c \uc0ac\uc6a9\ud558\ub294 \uc635\uc158\uc740 \ub2e4\uc74c\uacfc \uac19\ub2e4.\\n* ssh : pulling \ubc29\uc2dd (default=false)\\n* root : git clone\uc774 \uc218\ud589\ub418\ub294 root directory (default=\\"$HOME/git\\")\\n* repo : clone \ub300\uc0c1 Repository (default=\\"\\")\\n* branch : branch (default=master)\\n* rev : git revision (tag or hash) to check out\\n* depth : commit depth (default=0)\\n* dest : repository \ubc30\ud3ec directory\\n\\n\uae30\ud0c0 \uc635\uc158\ub4e4\uc740 `git-sync/cmd/git-sync/main.go` \uc5d0\uc11c \ud655\uc778\uc774 \uac00\ub2a5\ud558\uba70 \ud574\ub2f9 \uc635\uc158\ub4e4\uc744 \ubcc0\uc218\ub85c \ucc98\ub9ac\ud558\uc5ec \ud65c\uc6a9\ud558\uba74 \ub41c\ub2e4.\\n\\n### git-sync-demo.yaml \uc791\uc131\\n\\n```\\napiVersion: extensions/v1beta1\\nkind: Deployment\\nmetadata:\\n  labels:\\n    app: git-sync-demo\\n  name: git-sync-demo\\n  namespace: default\\nspec:\\n  replicas: 2\\n  selector:\\n    matchLabels:\\n      app: git-sync-demo\\n  template:\\n    metadata:\\n      labels:\\n        app: git-sync-demo\\n    spec:\\n      containers:\\n      - name: nginx\\n        image: nginx:1.14-alpine\\n        ports:\\n        - containerPort: 80\\n        volumeMounts:\\n        - name: git-sync-volume\\n          mountPath: /usr/share/nginx\\n      - name: git-sync\\n        image: k8s.gcr.io/git-sync:v3.1.1\\n        imagePullPolicy: Always\\n        args:\\n         - \\"-ssh\\"\\n         - \\"-repo=git@github.com:ddiiwoong/git-sync-demo.git\\"\\n         - \\"-root=/usr/share/nginx\\"\\n         - \\"-dest=html\\"\\n         - \\"-branch=master\\"\\n         - \\"-depth=1\\"\\n        volumeMounts:\\n        - name: git-sync-volume\\n          mountPath: /usr/share/nginx\\n        - name: git-secret\\n          mountPath: /etc/git-secret\\n      volumes:\\n      - name: git-sync-volume\\n        emptyDir: {}\\n      - name: git-secret\\n        secret:\\n          secretName: git-creds\\n          defaultMode: 288 # = mode 0440\\n      securityContext:\\n        fsGroup: 65533 # to make SSH key readable\\n---\\nkind: Service\\napiVersion: v1\\nmetadata:\\n  name: git-sync-demo\\nspec:\\n  type: NodePort\\n  selector:\\n    app: git-sync-demo\\n  ports:\\n  - protocol: TCP\\n    port: 80\\n    targetPort: 80\\n```\\n### \ud655\uc778\uc0ac\ud56d\\n\uc77c\ub2e8 ngnix\ub85c 1.14-alpine Image\ub97c \uae30\ubcf8\uc73c\ub85c \ud558\uace0 git-sync container\uac00 sidecar\ub85c \ub4e4\uc5b4\uac00\ub3c4\ub85d \uc791\uc131\ud558\uc600\ub2e4.  \\n\uc2e4\uc81c \ub3d9\uc791\ud558\ub294 \uc21c\uc11c\ub300\ub85c manifest\ub97c \uc544\ub798\uc11c\ubd80\ud130 \uc0b4\ud3b4\ubcf4\uc790.\\n\\n* git-sync-volume\uc740 `emptyDir`, git-secret\uc740 `secret` volume \uc124\uc815\\n  ```\\n  ...\\n      volumes:\\n      - name: git-sync-volume\\n        emptyDir: {}\\n      - name: git-secret\\n        secret:\\n          secretName: git-creds\\n          defaultMode: 288 # = mode 0440\\n  ...\\n  ```\\n* sidecar container image\ub97c `k8s.gcr.io/git-sync:v3.1.1`\ub85c \uc124\uc815\\n* `git-sync-volume`, `git-sync-volume` volume\uc744 `git-sync` sidecar\uc5d0 \ub9c8\uc6b4\ud2b8\\n* \uc704\uc5d0\uc11c \uc774\uc57c\uae30\ud55c `git-sync` flag, args\ub85c \uc124\uc815\\n  ```\\n  ...\\n      containers:\\n      - name: git-sync\\n        image: k8s.gcr.io/git-sync:v3.1.1\\n        imagePullPolicy: Always\\n        args:\\n         - \\"-ssh\\"\\n         - \\"-repo=git@github.com:ddiiwoong/git-sync-demo.git\\"\\n         - \\"-root=/usr/share/nginx\\"\\n         - \\"-dest=html\\"\\n         - \\"-branch=master\\"\\n         - \\"-depth=1\\"\\n        volumeMounts:\\n        - name: git-sync-volume\\n          mountPath: /usr/share/nginx\\n        - name: git-secret\\n          mountPath: /etc/git-secret\\n  ...\\n  ```\\n* nginx \uae30\ubcf8 \uc704\uce58\uac00 `/usr/share/nginx` \uc774\ubbc0\ub85c mount \uc704\uce58\ub97c git-sync-volume\uc73c\ub85c \uc124\uc815\\n  ```\\n  ...\\n    spec:\\n      containers:\\n      - name: nginx\\n        image: nginx:1.14-alpine\\n        ports:\\n        - containerPort: 80\\n        volumeMounts:\\n        - name: git-sync-volume\\n          mountPath: /usr/share/nginx\\n  ...\\n  ```\\n\\n\uc704 nginx\ub97c \ubc30\ud3ec\ud558\uace0 \uc811\uc18d\ud558\uba74 `Hello git-sync demo v1.0`\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n\uacb0\uad6d git repo code (static html page)\ub294 `/usr/share/nginx/html` \uc704\uce58\uc5d0 clone \ub418\ub294\uac83\ucc98\ub7fc \ubcf4\uc774\uc9c0\ub9cc \\n\uc2e4\uc81c clone \uc704\uce58\ub97c \ud655\uc778\ud574\ubcf4\uba74 symbolic link\ub85c \ud2b9\uc815 revision dir\ub97c \uac00\ub9ac\ud0a4\uace0 \uc788\ub2e4.\\n\\n```\\n$ kubectl exec -it git-sync-demo-665c9c9ddf-6nwc4 sh\\nDefaulting container name to nginx.\\nUse \'kubectl describe pod/git-sync-demo-665c9c9ddf-6nwc4 -n default\' to see all of the containers in this pod.\\n/ # cd /usr/share/nginx/\\n/usr/share/nginx # ls -al\\ntotal 16\\ndrwxrwsrwx    4 root     nogroup       4096 Mar 21 06:54 .\\ndrwxr-xr-x    1 root     root          4096 Mar  8 03:09 ..\\ndrwxr-sr-x    9 65533    nogroup       4096 Mar 21 06:54 .git\\nlrwxrwxrwx    1 65533    nogroup         44 Mar 21 06:54 html -> rev-07aa36f719091d75b5665203fa5846a549e7d540\\ndrwxr-sr-x    2 65533    nogroup       4096 Mar 21 06:54 rev-07aa36f719091d75b5665203fa5846a549e7d540\\n/usr/share/nginx # cat ./html/index.html\\n<!DOCTYPE html>\\n<html>\\n  <head>\\n    <title>Hello git-sync demo</title>\\n  </head>\\n  <body>\\n    <h1>Hello git-sync demo v1.0</h1>\\n  </body>\\n</html>\\n```\\n\\ngithub\uc5d0 \uc788\ub294 \uc704 index.html \ub0b4\uc6a9\uc744 \uc218\uc815\ud558\uace0 commit\uc744 \ud558\uac8c \ub418\uba74 \uc2e4\uc2dc\uac04\uc73c\ub85c \uc544\ub798\uc640 \uac19\uc774 revision \uc815\ubcf4 \ubc0f \ub0b4\uc6a9\uc774 \ubc14\ub010\uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4.  \\n\\n```\\n/usr/share/nginx # ls -al\\ntotal 16\\ndrwxrwsrwx    4 root     nogroup       4096 Mar 21 13:40 .\\ndrwxr-xr-x    1 root     root          4096 Mar  8 03:09 ..\\ndrwxr-sr-x    9 65533    nogroup       4096 Mar 21 13:40 .git\\nlrwxrwxrwx    1 65533    nogroup         44 Mar 21 13:40 html -> rev-b125908649135856d79c515c17decba68797a6cb\\ndrwxr-sr-x    2 65533    nogroup       4096 Mar 21 13:40 rev-b125908649135856d79c515c17decba68797a6cb\\n/usr/share/nginx # cat ./html/index.html\\n<!DOCTYPE html>\\n<html>\\n  <head>\\n    <title>Hello git-sync demo</title>\\n  </head>\\n  <body>\\n    <h1>Hello git-sync demo v1.1</h1>\\n  </body>\\n</html>\\n```\\n\\n## \uc815\ub9ac\\ngit-sync\ub97c \uac04\ub2e8\ud558\uac8c \ud14c\uc2a4\ud2b8\ud574\ubd24\ub2e4.  \\n\uac04\ub2e8\ud558\uac8c `sidecar` \ubc29\uc2dd\uc758 clone tool\ub85c\uc11c `git-sync`\ub97c \ud65c\uc6a9\ud558\uba74 \uc5ec\ub7ec\uac00\uc9c0\ub85c \ucda9\ubd84\ud788 \ud65c\uc6a9\uc774 \uac00\ub2a5\ud560 \uac83\uc774\ub2e4.  \\n\ud3ec\uc2a4\ud305\uc744 \uc791\uc131\ud558\uba74\uc11c \ub5a0\uc624\ub978 \ud65c\uc6a9\uc6a9\ub3c4\ub97c \uc815\ub9ac\ud558\uba74 \uc544\ub798\uc640 \uac19\ub2e4. \uc5b4\ucc0c\ubcf4\uba74 sidecar pattern\uc758 \ud65c\uc6a9\ubc29\uc548\uc774\ub77c\uace0\ub3c4 \ubcfc\uc218 \uc788\ub2e4.\\n\\n* CDN\uc744 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0 git\uc5d0\uc11c \uc18c\uaddc\ubaa8\ub85c \ucee8\ud150\uce20\ub97c \uac00\uc838\uc62c\ub54c\\n* DBMS\uac00 \ud544\uc694\uc5c6\uc744 \uc815\ub3c4\uc758 \uc801\uc740 \ub370\uc774\ud130\ub97c \uac00\uc838\uc62c\ub54c\\n* jekyll\uc774\ub098 hugo \uac19\uc740 \uc815\uc801 \uc0ac\uc774\ud2b8(\ube14\ub85c\uadf8)\uc758 sidecar \ud328\ud134 (GitPage\ucc98\ub7fc markdown\uc744 \ucd94\uac00\ud558\uace0 git commit\ud558\uba74 \ubc14\ub85c \uc0ac\uc774\ud2b8\uc5d0 \ubc18\uc601\ub418\ub294 \ubc29\uc2dd)\\n* nginx, haproxy, apache\uc640 \uac19\uc774 config \ubcc0\uacbd\uc774 \ud544\uc694\ud560\ub54c webhook\ubc29\uc2dd\uc73c\ub85c \uc124\uc815\uc744 \ubcc0\uacbd\ud55c\ud6c4 pod\ub97c \uc7ac\uae30\ub3d9\ud558\ub294 GitOps \uad6c\ud604"},{"id":"tools/vscode-server/","metadata":{"permalink":"/tools/vscode-server/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-03-20-vscode-server.md","source":"@site/blog/2019-03-20-vscode-server.md","title":"VScode Server","description":"code-server\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub85c\uceec VScode \uc124\uce58\uc5c6\uc774 \uc6d0\uaca9 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9\ud574\ubcf4\uc790.","date":"2019-03-20T00:00:00.000Z","formattedDate":"March 20, 2019","tags":[{"label":"vscode","permalink":"/tags/vscode"},{"label":"code-server","permalink":"/tags/code-server"},{"label":"kubernetes","permalink":"/tags/kubernetes"},{"label":"online coding","permalink":"/tags/online-coding"},{"label":"GoormIDE","permalink":"/tags/goorm-ide"},{"label":"Cloud9","permalink":"/tags/cloud-9"}],"readingTime":5.13,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"VScode Server","comments":true,"classes":"wide","description":"code-server\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub85c\uceec VScode \uc124\uce58\uc5c6\uc774 \uc6d0\uaca9 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9\ud574\ubcf4\uc790.","slug":"tools/vscode-server/","date":"2019-03-20T00:00:00.000Z","categories":["Tools"],"tags":["vscode","code-server","kubernetes","online coding","GoormIDE","Cloud9"]},"prevItem":{"title":"git-sync","permalink":"/kubernetes/git-sync/"},"nextItem":{"title":"K3s on Raspberry Pi Cluster","permalink":"/kubernetes/k3s-homelab/"}},"content":"IntelliJ IDEA\ub97c \uc0ac\uc6a9\ud558\ub2e4\uac00 \uac1c\ubc1c\uc5c5\ubb34\ub97c \uac70\uc758 \uc190\ub193\ub2e4\uc2dc\ud53c \ud558\ub2e4\ubcf4\ub2c8 \ub77c\uc774\uc13c\uc2a4\ub97c \uc5f0\uc7a5\ud558\uc9c0 \ubabb\ud558\uac8c \ub418\uc5c8\uace0 \uc8fc\ub85c Local\uc5d0\uc11c VScode\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\ub2e4. \ud604\uc7ac \ubd80\uc11c\uc640 \uc5c5\ubb34\ub3c4 \ubc14\ub00c\uc5c8\uace0 \uc6cc\ub099 \uace0\uac00\ub2e4\ubcf4\ub2c8 IDE\ub97c \ubd80\uc11c\ube44\ub85c \uad6c\ub9e4\ud558\ub3c4 \uc5b4\ub835\ub2e4. \ubb50 \uc5bc\ub9c8\ub098 \ud55c\ub2e4\uace0 \ub9d0\ud560\uc218\ub3c4 \uc788\uaca0\uc9c0\ub9cc \uc5c5\ubb34\ud2b9\uc131\uc0c1 \uac1c\ubc1c\ud234\uc744 \uc0ac\ub2ec\ub77c\uace0 \ud560\uc218 \uc5c6\uace0 \ucd5c\uadfc \ud06c\ub86c\ubd81\uc774\ub098 \uc544\uc774\ud328\ub4dc \ud504\ub85c\uac19\uc740 \ud0dc\ube14\ub9bf\uc744 \uac00\uc9c0\uace0 \ub2e4\ub2c8\uc2dc\ub294 \ubd84\ub4e4\ub3c4 \ub9ce\uace0 \ub2e8\uc21c \ud544\uae30\ub098 \uba54\ubaa8\uac00 \uc544\ub2cc \uc628\ub77c\uc778 \ud658\uacbd\uc5d0\uc11c \ube14\ub85c\uae45 \ud3ec\uc2a4\ud305 \uc815\ub3c4\ub294 \ud560\uc218 \uc788\ub2e4\ub294 \uac00\uc815\uc73c\ub85c Web IDE\ub97c \uad6c\uc131\ud558\ub294 \ud3ec\uc2a4\ud305\uc744 \uc2dc\uc791\ud574\ubcf8\ub2e4. \\n\\n## Web IDE\\n\uc774\ubc88 \ud3ec\uc2a4\ud305\uc744 \uc4f0\uae30 \uc2dc\uc791\ud558\uba74\uc11c 2017\ub144 AWS re;invent\uc5d0\uc120\uac00 Cloud9 \uc81c\ud488\uc774 \ucd9c\uc2dc\ub418\uc5b4\uc11c Lambda\uc5d0\uc11c \uc0ac\uc6a9\ud588\ub358 \uc7a5\uba74\uc774 \uac11\uc790\uae30 \ub5a0\uc62c\ub790\ub2e4. Cloud 9\uc740 [https://github.com/c9/core](https://github.com/c9/core)\ub97c \uae30\ubc18\uc73c\ub85c instance\ub97c \ub744\ub294\uac83\uc744 \uae30\ubcf8\uc73c\ub85c \ud55c\ub2e4. Lambda\uc758 \uae30\ubcf8 \uc5d0\ub514\ud130\ub3c4 \ub098\uc058\uc9c4 \uc54a\uc9c0\ub9cc Cloud9\uc5d0\uc11c \uac15\uc870\ud558\ub294 \ubd80\ubd84\uc740 \ucf54\ub4dc \ud611\uc5c5\uc774\ub2e4. \\n\\n![cloud9](https://d1.awsstatic.com/product-marketing/Tulip/C9-Collab-Image@3x.e03a65d9488633c154358430540ab363dd1e8f45.png)\\n\\nAWS\uc5d0\uc11c \uc11c\ube44\uc2a4\ub85c \ucd9c\uc2dc\ub418\uae30 \uc774\uc804\uc5d0\ub3c4 Dockerhub\uc5d0\uc11c\ub3c4 \uc885\uc885 \ud655\uc778\ud560\uc218 \uc788\uc5c8\uc9c0\ub9cc \ud604\uc7ac\ub294 \ucc3e\uc544\ubcf4\uae30 \uc5b4\ub835\ub2e4. \\n\\n\uad6d\ub0b4\uc5d0\ub294 Cloud \ud615\ud0dc\ub85c [GoormIDE](https://ide.goorm.io/) \uc81c\ud488\uc774 \uc788\ub2e4.  \\nFree \uc5d0\ub514\uc158\ub3c4 \uc788\uc73c\ub2c8 \ub530\ub85c \ud655\uc778\ud574\ubcf4\uba74 \ub41c\ub2e4. (\uc751\uc6d0\ud569\ub2c8\ub2e4!)\\n\\n\uc774\uc678\uc5d0\ub3c4 [https://github.com/theia-ide/theia](https://github.com/theia-ide/theia), [https://github.com/codercom/code-server](https://github.com/codercom/code-server)\uc640 \uac19\uc740 Web\uae30\ubc18 \uc624\ud508\uc18c\uc2a4\uac00 \uc874\uc7ac\ud558\uace0 \ub458\ub2e4 \uc0c1\uc6a9\uc774\ub098 Beta\ud615\ud0dc\ub85c \uc11c\ube44\uc2a4 \uc911\uc774\ub2e4. \\n\\n## code-server\\n\\n[code-server](https://github.com/codercom/code-server)\ub294 \uc6d0\uaca9\uc11c\ubc84 \ud615\ud0dc\ub85c \ub3d9\uc791\ud558\ub294 \ube0c\ub77c\uc6b0\uc800 \uae30\ubc18 [VSCode](https://github.com/Microsoft/vscode) IDE\uc774\ub2e4.\\n\\n\uadf8\ub7f0\ub370 \uc65c \uad6c\uc9c0 VScode \uc124\uce58\ud615\uc744 \ub0c5\ub450\uace0 Server\ub85c \uad6c\ub3d9\ud558\ub290\ub0d0? \uc544\ub798\uc640 \uac19\uc774 \uc124\uba85\ud558\uace0 \uc788\ub2e4.\\n* Chromebook, Table(IPAD) \uc5d0\uc11c Coding \uac00\ub2a5\\n* \uc800\uc0ac\uc591 Client\uc5d0\uc11c\ub3c4 Cloud \uae30\ubc18 Server\uc758 \uc774\uc810 \uc0ac\uc6a9\uac00\ub2a5\\n* Battery! (\uc81c\uc77c \uc911\uc694\ud3ec\uc778\ud2b8) \\n\\n\uad6c\ub3d9\ubc29\uc2dd\uc740 \uc5ec\ub7ec\ubc29\uc2dd\uc774 \uc874\uc7ac\ud55c\ub2e4. \\n* Hosted : [coder](https://coder.com/) - Enterprise \\n* Docker\\n    ```\\n    $ docker run -t -p 127.0.0.1:8443:8443 -v \\"${PWD}:/root/project\\" codercom/code-server code-server --allow-http --no-auth\\n    ```\\n* Bianry\\n    ```\\n    $ code-server <initial directory to open>\\n    ```\\n\\n## code-server kubernetes\uc5d0 \ubc30\ud3ec\\n\\n\uacf5\uc2dd [Image](https://hub.docker.com/r/codercom/code-server)\uc640 [Dockerfile](https://github.com/codercom/code-server/blob/master/Dockerfile)\ub294 \ud574\ub2f9 \ub9c1\ud06c\ub97c \ucc38\uc870\ud55c\ub2e4.\\n\uc0b4\uc9dd \ubcc0\uacbd\ud574\uc11c \uc7ac\ube4c\ub4dc\ud558\ub824\uace0 \ud588\ub294\ub370 \ub9e5\ubd81 \uba54\ubaa8\ub9ac\uac00 \ubd80\uc871\ud55c\uc9c0 `yarn build`\ud560\ub54c `Serve fails with Error Code 137` \uac00 \ubc1c\uc0dd\ud558\uc600\ub2e4. \uc774\ubb38\uc81c\ub294 \ub098\uc911\uc5d0 \ud574\uacb0\ud558\uae30\ub85c \ud558\uace0 \uc77c\ub2e8 \ubc30\ud3ec\ud558\uc790.  \\n\\n\ub85c\uceec minikube\uc5d0\uc11c \ud14c\uc2a4\ud2b8\ud558\uae30 \uc704\ud574  \\n[https://github.com/codercom/code-server/blob/master/deployment/deployment.yaml](https://github.com/codercom/code-server/blob/master/deployment/deployment.yaml) \uc5d0\uc11c ClusterIP\ub97c  NodePort\ub85c \uc218\uc815\ud558\uace0 \ud328\uc2a4\uc6cc\ub4dc\ub97c \ub85c\uadf8\uc5d0\uc11c \ud655\uc778\ud558\uc9c0 \uc54a\uace0 \uc0ac\uc6a9\ud560\uc218 \uc788\ub3c4\ub85d `1234`\ub85c \uc124\uc815\ud558\uace0 \ubc30\ud3ec\ud55c\ub2e4. \\n\\n### deployment.yaml\\n```\\napiVersion: v1\\nkind: Namespace\\nmetadata:\\n  name: code-server\\n---\\napiVersion: v1\\nkind: Service\\nmetadata:\\n name: code-server\\n namespace: code-server\\nspec:\\n ports:\\n - port: 8443\\n   name: https\\n   protocol: TCP\\n selector:\\n   app: code-server\\n type: NodePort\\n---\\napiVersion: extensions/v1beta1\\nkind: Deployment\\nmetadata:\\n  labels:\\n    app: code-server\\n  name: code-server\\n  namespace: code-server\\nspec:\\n  selector:\\n    matchLabels:\\n      app: code-server\\n  replicas: 1\\n  template:\\n    metadata:\\n      labels:\\n        app: code-server\\n    spec:\\n      containers:\\n      - image: codercom/code-server\\n        imagePullPolicy: Always\\n        name: code-server\\n        ports:\\n        - containerPort: 8443\\n          name: https\\n        args:\\n         - \\"--password=1234\\"\\n```\\n```\\n$ kubectl create -f deployment.yaml\\n```\\n\\n\uc774\ud6c4 \uc11c\ube44\uc2a4 \ud655\uc778 \ubc0f minikube service\ub85c expose \uc2dc\ud0a8\ub2e4.\\n\\n```\\n$ kubectl get svc\\nNAME          TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\\ncode-server   NodePort   10.111.206.64   <none>        8443:32665/TCP   15m\\n\\n$ minikube service code-server\\n\\n$ minikube service list\\n|-------------|---------------|-----------------------------|\\n|  NAMESPACE  |     NAME      |             URL             |\\n|-------------|---------------|-----------------------------|\\n| code-server | code-server   | http://192.168.99.102:32665 |\\n| default     | git-sync-demo | http://192.168.99.102:31595 |\\n| default     | kubernetes    | No node port                |\\n| kube-system | kube-dns      | No node port                |\\n|-------------|---------------|-----------------------------|\\n```\\n\\n\ud574\ub2f9 URL\ub85c \uc811\uc18d\ud558\uc5ec \ud328\uc2a4\uc6cc\ub4dc `1234`\ub97c \uc785\ub825\ud558\uba74 vscode\uac00 \uc6d0\uaca9\uc73c\ub85c \uc2e4\ud589\ub41c \uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4.\\n![vscode](/img/vscode.png)\\n\\n## \uc815\ub9ac\\n\uc2e4\uc81c \uc0ac\uc6a9\uc744 \ud574\ubcf4\uba74 \uc544\uc9c1 \ubc84\uadf8\uac00 \ub9ce\ub2e4. \uc560\ub4dc\uc628\uc774\ub098 \ud50c\ub7ec\uadf8\uc778 \uc124\uce58\uc2dc \uc81c\ub300\ub85c \ub3d9\uc791\uc744 \ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0\ub3c4 \uc788\uc5c8\uace0 \\n[git-sync](https://github.com/kubernetes/git-sync) \ud504\ub85c\uc81d\ud2b8\uc640 \uc5f0\ub3d9\uc744 \ud1b5\ud574 \uc2e4\uc81c gitOPS\ub97c \uad6c\ud604\ud574\ubcf4\uace0\uc790 \ud558\uc600\uc73c\ub098 \ubc30\ud3ec\ud6c4\uc5d0 mount\ub41c repository volume\uc5d0 \ubcc0\uacbd\uc0ac\ud56d\uc774 \ubc1c\uc0dd\uc2dc \uac11\uc790\uae30 UI\uac00 \uba39\ud1b5\uc774 \ub418\ub294 \uacbd\uc6b0\uac00 \ubc1c\uc0dd\ud558\uae30\ub3c4 \ud558\uc600\ub2e4. Kubernetes\ud50c\ub7ab\ud3fc\uc744 \uac1c\ubc1c\uc790\uc5d0\uac8c PaaS\ud615\ud0dc\ub85c \uc81c\uacf5\ud558\ub294 \uacbd\uc6b0 webIDE\uc758 \uc88b\uc740 \uc635\uc158\uc774 \ub420\uc218 \uc788\uc744\uac83 \uac19\ub2e4."},{"id":"kubernetes/k3s-homelab/","metadata":{"permalink":"/kubernetes/k3s-homelab/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-03-11-k3s-homelab.md","source":"@site/blog/2019-03-11-k3s-homelab.md","title":"K3s on Raspberry Pi Cluster","description":"\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 k3s\ub97c \ub77c\uc988\ubca0\ub9ac\ud30c\uc774 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc62c\ub824\ubcf4\uace0 \ud65c\uc6a9\ubc29\uc548\uc5d0 \ub300\ud574\uc11c \uace0\ubbfc\ud574\ubcf8\ub2e4","date":"2019-03-11T00:00:00.000Z","formattedDate":"March 11, 2019","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Rancher","permalink":"/tags/rancher"},{"label":"K3s","permalink":"/tags/k-3-s"},{"label":"Raspberry","permalink":"/tags/raspberry"},{"label":"Homelab","permalink":"/tags/homelab"}],"readingTime":12.09,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"K3s on Raspberry Pi Cluster","comments":true,"classes":"wide","description":"\uc774\ubc88 \ud3ec\uc2a4\ud2b8\uc5d0\uc11c\ub294 k3s\ub97c \ub77c\uc988\ubca0\ub9ac\ud30c\uc774 \ud074\ub7ec\uc2a4\ud130\uc5d0 \uc62c\ub824\ubcf4\uace0 \ud65c\uc6a9\ubc29\uc548\uc5d0 \ub300\ud574\uc11c \uace0\ubbfc\ud574\ubcf8\ub2e4","slug":"kubernetes/k3s-homelab/","date":"2019-03-11T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","Rancher","K3s","Raspberry","Homelab"]},"prevItem":{"title":"VScode Server","permalink":"/tools/vscode-server/"},"nextItem":{"title":"Cloud-Native Microservices Demo Application with OpenCensus","permalink":"/kubernetes/microservices-demo/"}},"content":"\uc774\ubc88\uc5d0\ub294 \uacbd\ub7c9 Kubernetes\ub77c\uace0 \uc774\uc57c\uae30\ud558\ub294 [K3s](https://github.com/rancher/k3s)\ub97c Raspberry Pi \ud074\ub7ec\uc2a4\ud130\uc0c1\uc5d0 \uad6c\ub3d9\ud558\ub824\uace0 \ud55c\ub2e4. \\n\uc21c\uc218\ud558\uac8c \uac1c\uc778\uc758\uacac\uc73c\ub85c \uc791\uc131\ud558\uc600\uace0 \uc808\ub300 \uc81c\ud488\uc774\ub098 \ubd80\ud488\ud64d\ubcf4\ub97c \ud558\uace0\uc790 \ud558\ub294 \uc758\ub3c4\ub294 \uc804\ud600 \uc5c6\ub2e4.\\n\\n## K3s?\\n\\n**K3s**\ub294 Rancher Lab\uc5d0\uc11c \ucd5c\uc18c\uc790\uc6d0\uc744 \uc0ac\uc6a9\ud558\ub294 Kubernetes \ud074\ub7ec\uc2a4\ud130 \uad6c\uc131\uc744 \uc704\ud55c \uc194\ub8e8\uc158\uc73c\ub85c \uc2dc\uc791\ub418\uc5c8\uace0 2019\ub144 3\uc6d4 12\uc77c \ud604\uc7ac 0.2\ubc84\uc804\uc774 \ub9b4\ub9ac\uc988\ub41c \uc0c1\ud0dc\uc774\ub2e4. \ubc14\uc774\ub108\ub9ac \uc804\uccb4\uac00 40mb\uac00 \ub418\uc9c0 \uc54a\uace0 \uc124\uce58\uac00 \uc27d\ub2e4\ub294 \uc810\uc5d0\uc11c \ucd5c\uadfc \ud2b8\uc704\ud130 \uc0c1\uc5d0\uc11c \uc774\uc288\uac00 \ub418\uace0 \uc788\ub294 \ud504\ub85c\uc81d\ud2b8\ub77c\uace0 \ud560 \uc218 \uc788\ub2e4. \\n\\n\uc8fc\ub85c Edge, IoT \ub4f1 \uc800\uc804\ub825, \uc800\uc0ac\uc591 \uae30\ubc18 ARM\uacc4\uc5f4 \ucef4\ud4e8\ud305\uc5d0 \ucd5c\uc801\ud654 \ub418\uc5b4 \uc788\uace0 \uc2e4\uc81c \uc2e4\ud5d8\uc801\uc774\uae34 \ud558\uc9c0\ub9cc \uac04\ub2e8\ud55c \uae30\ub2a5\uc774\ub098 baremetal \uae30\ubc18 \ud074\ub7ec\uc2a4\ud130 \ud14c\uc2a4\ud2b8\ub97c \uc9d1\uc5d0\uc11c \ud574\ubcf4\uae30\uc5d0\ub294 \ub531 \uc88b\uc740 \ud504\ub85c\uc81d\ud2b8\ub77c \ud560 \uc218 \uc788\ub2e4. \uc774\ubbf8 vSphere, OpenStack\uae30\ubc18\uc73c\ub85c \ud14c\uc2a4\ud2b8\ub294 \ucc28\uace0 \ub118\uce58\uac8c \ud574\ubd24\uc9c0\ub9cc \uc77c\ub2e8 \ubb3c\ub9ac\uc801\uc778 \ucf00\uc774\uc2a4\ubd80\ud130 \ubcf4\uace0\ub098\uba74 \ud558\ub4dc\uc6e8\uc5b4\ub97c \uc88b\uc544\ud558\ub294 \uc0ac\ub78c\ub4e4\uc5d0\uac8c\ub294 \uc544\uc8fc \uc7ac\ubbf8\uc788\ub294 \uc7a5\ub09c\uac10\uc774 \uc544\ub2d0\uc218 \uc5c6\uc744 \uac83\uc774\ub2e4. \\n\\n[K3s Github](https://github.com/rancher/k3s) \uc0c1\uc138 \uc124\uba85\uc5d0 \ubcf4\uba74 Cloud Provider, Storage Plugin\uc740 \uc81c\uac70\ud558\uc600\uace0  default \uc800\uc7a5\uc18c\uac00 `etcd`\uac00 \uc544\ub2cc `sqlite3`\uc73c\ub85c \ub418\uc5b4\uc788\ub2e4\uace0 \ud55c\ub2e4. \\n\\n## \uc0ac\uc804 \uc900\ube44\uc0ac\ud56d\\n\\n* \ucd5c\uc18c 2\uac1c \uc774\uc0c1\uc758 Raspberry Pi 2B/3B/3B+, 4ea  \\n\uc624\ud508\ub9c8\ucf13\uc5d0\uc11c \ud560\uc778\ucfe0\ud3f0 \uc801\uc6a9\ud574\uc11c Raspberry Pi 3B+, 4ea\ub97c `166,820\uc6d0`(\ub300\ub2f9 42,000\uc6d0) \uc815\ub3c4\uc5d0 \uad6c\ub9e4\ud558\uc600\ub2e4.  \\n\ucd5c\uc800\uac00 \uac80\uc0c9\uc73c\ub85c \ub300\ub2f9 46,000\uc6d0 \uc815\ub3c4 \ud588\ub358\uac83 \uac19\ub2e4. \\n\\n* Stackable Case  \\n[iUniker Raspberry Pi Cluster Case](https://www.amazon.com/gp/product/B07CTG5N3V/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&psc=1) \uac15\ucd94!! (\uac1c\uc778\uc801\uc73c\ub85c \ucfe8\ub7ec\uc640 \ub514\uc790\uc778\uc774 \ub9d8\uc5d0 \ub4ec)  \\n\ubc30\uc1a1\ube44\ud3ec\ud568 29.19\ub2ec\ub7ec, \uc57d `33,000\uc6d0`\\n\\n* micro SDHC 4ea  \\n16GB\ub85c\ub3c4 \ucda9\ubd84\ud558\uc9c0\ub9cc \uc0bc\uc131\uc804\uc790 micro SDHC CLASS10 UHS-I EVO (32GB), 4ea\ub97c \uc624\ud508\ub9c8\ucf13\uc5d0\uc11c \uc0ac\uac8c\ub418\uba74 \ubc30\uc1a1\ub8cc \ud3ec\ud568\ud574\uc11c 8,500\uc6d0 * 4ea = `34,000\uc6d0`\uc5d0 \uad6c\ub9e4\uac00 \uac00\ub2a5\ud558\ub2e4. \uc624\ud508\ub9c8\ucf13\uc5d0\uc11c\ub294 \uac1c\ub2f9 \ubc30\uc1a1\ub8cc\ub97c \ub0b4\uc57c\ud55c\ub2e4. \ud558\uc9c0\ub9cc \ucfe0\ud321\uc5d0\uc11c\ub294 2ea\ub97c \ub85c\ucf13\ubc30\uc1a1\uc73c\ub85c 15,380\uc6d0\uc5d0 \uad6c\ub9e4\uac00 \uac00\ub2a5\ud558\ubbc0\ub85c \uc57d `31,000\uc6d0`\uc5d0 4\uac1c\ub97c \uad6c\ub9e4\ud560\uc218 \uc788\ub2e4. \\n\\n* \uba40\ud2f0\ucda9\uc804\uae30  \\n1\ub9cc\uc6d0\ub300 \ud6c4\ubc18\uc5d0\uc11c 2\ub9cc\uc6d0 \ucd08\ubc18\uc774\uba74 6\ud3ec\ud2b8 \ucda9\uc804\uae30\ub97c \uad6c\ub9e4\ud560\uc218 \uc788\ub294\ub370 \uad6c\ub9e4\ud588\ub358 \uac00\uc7a5 \ud070 \uae30\uc900\uc740 Pi 4\ub300\ub97c \ub3d9\uc2dc\uc5d0 2.5A \uc804\ub958\ub97c \uc548\uc815\uc801\uc73c\ub85c \uacf5\uae09\ud558\ub824\uba74 \ucd5c\ub300 10A\ub97c \uc9c0\uc6d0\ud558\ub294 \uba40\ud2f0 \ucda9\uc804\uae30\ub97c \uc0ac\uc57c\ud588\uc5c8\uace0 4-5\ud3ec\ud2b8 \uc9dc\ub9ac \ucda9\uc804\uae30\ub4e4\uc740 \ub300\ubd80\ubd84 \ucd5c\ub300 \uc804\ub958\uac00 8A\ub85c \ucda9\uc871\ud558\uc9c0 \ubabb\ud574 4\ud3ec\ud2b8\ub9cc \uc0ac\uc6a9\ud558\ub354\ub77c\ub3c4 \uc548\uc815\uc801\uc778 \uc804\ub958 \uacf5\uae09\uc744 \uc704\ud574 6\ud3ec\ud2b8 \ucda9\uc804\uae30\ub85c \uc120\ud0dd\ud558\uc600\ub2e4.  \\n\ucfe0\ud321 \ub85c\ucf13\ubc30\uc1a1 - \ud3ec*\uc9c0 \uac00\uc815\uc6a9 6\ud3ec\ud2b8 \uae09\uc18d \uba40\ud2f0 \ucda9\uc804\uae30, `22,900\uc6d0`\\n\\n* micro 5pin 20cm 2.4A \uc9c0\uc6d0 \ucf00\uc774\ube14 4ea  \\nPi \uad8c\uc7a5 \uc804\ub958\uac00 2.5A\ub77c\uace0 \ud588\uc9c0\ub9cc 2.4A, 3A \uc9dc\ub9ac\uc911\uc5d0 \uc800\ub834\ud55c 2.4A \uc9c0\uc6d0 \uc20f\ucf00\uc774\ube14\ub85c \uad6c\ub9e4\ud558\uc600\ub2e4.  \\n\uc624\ud508\ub9c8\ucf13\uc5d0\uc11c \ubc30\uc1a1\ub8cc \ud3ec\ud568, `7800\uc6d0`\\n\\n* UTP Cat5e 30cm \ucf00\uc774\ube14 4ea  \\n\uadf8\ub0e5 \uc81c\uc77c\uc2fc\uac78\ub85c \uc624\ud508\ub9c8\ucf13\uc5d0\uc11c \ubc30\uc1a1\ub8cc \ud3ec\ud568 `4,100\uc6d0`\uc5d0 \uad6c\ub9e4\ud558\uc600\ub2e4.\\n\\n* \uae30\uac00\ube44\ud2b8 \uc9c0\uc6d0\ub418\ub294 5\ud3ec\ud2b8 \uc774\uc0c1 \uc2a4\uc704\uce58 \ud5c8\ube0c(\uacf5\uc720\uae30)  \\n\uc9d1\uc5d0 \uc788\ub358 \uacf5\uc720\uae30 \ud65c\uc6a9 (iptime A1004) \ud558\uc600\uc9c0\ub9cc \ucd5c\uc800 5\ud3ec\ud2b8 \uc774\uc0c1 \uc2a4\uc704\uce58 \ud5c8\ube0c\uc911 \uc81c\uc77c \uc2fc \ubaa8\ub378\uc740 `16,000\uc6d0`\ub300\ub85c \uac00\uaca9 \ud615\uc131\uc911\uc774\ub2e4. \\n\\n\uc2e4\uc81c \uc704 \uc2a4\ud399\uc73c\ub85c \ub300\ucda9 \uad6c\ub9e4\ub97c \uc9c4\ud589\ud558\uac8c \ub418\uba74 18.4 + 3.3 + 3.1 + 2.3 + 0.8 + 0.4 + 1.6 = `29.9\ub9cc\uc6d0` \uc815\ub3c4 \uc18c\uc694\uac00 \ub420 \uac83\uc73c\ub85c \uc608\uc0c1\ub41c\ub2e4. \uc9d1\uc5d0 \uad74\ub7ec\ub2e4\ub294 \ubd80\ud488\uc774\ub098 \ucda9\uc804\uae30, \ucf00\uc774\ube14, SD\uce74\ub4dc\ub4e4\uc744 \ud65c\uc6a9\ud558\uba74 `25\ub9cc\uc6d0` \uc774\ub0b4\ub85c\ub3c4 \ucda9\ubd84\ud788 \uac00\ub2a5\ud558\ub2e4.\\n\\n## \uad6c\ub9e4 \uc81c\ud488 \uc870\ub9bd\\n\uc870\ub9bd\uc740 \uadf8\ub2e4\uc9c0 \uc5b4\ub835\uc9c0 \uc54a\uc740\ub370 \ucf00\uc774\uc2a4 \uad6c\ub9e4\uc2dc \uc81c\uacf5\ub418\ub294 \ubc29\uc5f4\ud310(CPU, GPU, RAM)\uc744 \uaf3c\uaf3c\ud558\uac8c \ubd99\uc774\uace0 \ucfe8\ub7ec\ub97c GPIO\uc5d0 \uc5f0\uacb0\ud55c\ub2e4.  \\n\uadf8\ub807\uac8c \uc5b4\ub824\uc6b4 \uc810\uc740 \uc5c6\uc9c0\ub9cc \ubcf8\uccb4\ub97c \ucf00\uc774\uc2a4\uc5d0 \uace0\uc815\ud560\ub54c \ub108\ud2b8\uac00 \uc791\uc544 \uc190\uc774 \ud070 \uc0ac\ub78c\uc740 \uc870\uae08 \ud798\ub4e4 \uc218\ub3c4 \uc788\uc744 \uac83 \uac19\ub2e4. \\n\\n\ucf00\uc774\uc2a4\uc758 CPU \ucfe8\ub7ec\uac00 \ud654\ub8e1\uc810\uc815\uc774\ub2e4.\\n\\n![cases](/img/cases.jpg)  \\n![heat](/img/heat.jpg)  \\n![cooler](/img/cooler.jpg)\\n![3stack](/img/3stack.jpg)\\n![charger](/img/charger.jpg)\\n![full](/img/fullstack.jpg)\\n![complete](/img/complete.jpg)\\n\\n## OS \uc124\uce58\\n\\nSD\uce74\ub4dc\uc5d0 \uc124\uce58\ub294 MacOS\uc0c1\uc5d0\uc11c \uc9c4\ud589\ud558\uc600\ub2e4.\\n\\n[Raspbian Lite](https://www.raspberrypi.org/downloads/raspbian/)\ub97c \ub0b4\ub824\ubc1b\uc544 [Etcher](https://www.balena.io/etcher/)\ub97c \uc0ac\uc6a9\ud558\uc5ec OS\ub97c \uc124\uce58\ud55c\ub2e4. \\n\\n\uc790\uc138\ud55c \ucd94\uac00\uc801\uc778 \uc124\uce58\ubc29\ubc95\uc740 \ub2e4\uc74c \ub9c1\ud06c\ub97c \ud1b5\ud574\uc11c\ub3c4 \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n[Installing operating system images](https://www.raspberrypi.org/documentation/installation/installing-images/README.md)  \\n\\n## \ud658\uacbd \uc124\uc815\\nMac\uc5d0\uc11c\ub294 `/Volumes/boot`\uc5d0 \ub9c8\uc6b4\ud2b8\uac00 \ub41c\ub2e4. OS\ub9c8\ub2e4 \ub2e4\ub974\uc9c0\ub9cc Linux\uc5d0\uc11c\ub294 `/mnt/boot`, Windows\uc5d0\uc11c\ub294 `boot` \ub85c \ub9c8\uc6b4\ud2b8\uac00 \ub41c\ub2e4.\\n\\nSSH Service \uc790\ub3d9 \ud65c\uc131\ud654\ub97c \uc704\ud574 \uc704 OS\ubcc4 mount\ub41c root \uacbd\ub85c\uc5d0 ssh \ube48 \ud30c\uc77c\uc744 \uc0dd\uc131\ud558\uac8c \ub418\uba74 reboot\uc774\ud6c4\uc5d0 SSH \uc811\uc18d\uc774 \uac00\ub2a5\ud574\uc9c4\ub2e4.\\n```\\n$ sudo touch /Volumes/boot/ssh\\n```\\n\\n\ub610\ud55c container \uc0ac\uc6a9\uc744 \uc704\ud574 root\uacbd\ub85c\uc758 `cmdline.txt` \ud30c\uc77c \ub9c8\uc9c0\ub9c9\uc5d0 cgroup \uc124\uc815\uc744 \ucd94\uac00\ud55c\ub2e4.  \\n```\\ncgroup_memory=1 cgroup_enable=memory\\n```\\n\\nSD\uce74\ub4dc\ub97c \ub9cc\ub4e4\uace0 \uac01\uac01\uc758 Pi\uc5d0 \uc7a5\ucc29\ud6c4\uc5d0 UTP\ucf00\uc774\ube14\uacfc \uc804\uc6d0\uc744 \ubaa8\ub450 \uc5f0\uacb0\ud55c\ub2e4.\\n\ubd80\ud305\uc774 \uc644\ub8cc\ub418\uba74 default id/pass \uc778 `pi/raspberry`\ub85c \ub85c\uadf8\uc778 \ud558\uace0 `sudo raspi-config` \ub97c \ud1b5\ud574 \ud328\uc2a4\uc6cc\ub4dc \ubcc0\uacbd, hostname \uc124\uc815, GPU memory split \uc124\uc815 \ub4f1\uc744 \uc644\ub8cc\ud558\uc790.  \\n\ub098\uc911\uc5d0\ub294 PXE booting \ubc0f ansible \uc790\ub3d9\ud654\ub85c \uad6c\ud604\ud558\uba74 \ubb34\uc778\ud658\uacbd \uc124\uce58\uac00 \uac00\ub2a5\ud560\uac83 \uac19\ub2e4. (Edge Computing)\\n\\n```\\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 Raspberry Pi Software Configuration Tool (raspi-config) \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n\u2502                                                                                                  \u2502\\n\u2502        1 Change User Password Change password for the current user                               \u2502\\n\u2502        2 Network Options      Configure network settings                                         \u2502\\n\u2502        3 Boot Options         Configure options for start-up                                     \u2502\\n\u2502        4 Localisation Options Set up language and regional settings to match your location       \u2502\\n\u2502        5 Interfacing Options  Configure connections to peripherals                               \u2502\\n\u2502        6 Overclock            Configure overclocking for your Pi                                 \u2502\\n\u2502        7 Advanced Options     Configure advanced settings                                        \u2502\\n\u2502        8 Update               Update this tool to the latest version                             \u2502\\n\u2502        9 About raspi-config   Information about this configuration tool                          \u2502\\n\u2502                                                                                                  \u2502\\n\u2502                                                                                                  \u2502\\n\u2502                                                                                                  \u2502\\n\u2502                           <Select>                           <Finish>                            \u2502\\n\u2502                                                                                                  \u2502\\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\n```\\n* 1 Change User Password\\n* 2 Network Options - hostname\\n    * k3s-master, k3s-slave-01, k3s-slave-02, k3s-slave-03\\n* 4 Localisation Options - TimeZone\\n    * Asia, Seoul\\n* 7 Advanced Options - GPU Memory split \\n    * 16mb\\n\\n\ubaa8\ub450 \uc644\ub8cc\uac00 \ub418\uc5c8\uc73c\uba74 pi\ub4e4\uc744 \uc7ac\uae30\ub3d9\ud558\uc790.\\n```\\n$ sudo reboot\\n```\\n\\n## k3s \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\\n\\n### Server \uae30\ub3d9\\n\\narmhf(arm hard float) \uc9c0\uc6d0\uc774 \ub418\ub294 \ucd5c\uc2e0 \ub9b4\ub9ac\uc988 v0.2.0\ub97c \ub2e4\uc6b4\ubc1b\ub294\ub2e4.  \\n```\\n$ wget -O k3s https://github.com/rancher/k3s/releases/download/v0.2.0/k3s-armhf && \\\\\\n  chmod +x k3s && \\\\\\n  sudo mv k3s /usr/local/bin/k3s\\n```\\n\\nMaster node \uae30\ub3d9 (\ubc31\uadf8\ub77c\uc6b4\ub4dc)\\n```\\n$ sudo k3s server &\\n```\\n\\n\ud574\ub2f9 node\ub97c Control plane \ud615\ud0dc\ub85c \ubd84\ub9ac\uc2dc\ucf1c workload\uc5d0\uc11c \uc81c\uc678\ud558\ub824\uba74 `--disable-agent` \uc635\uc158\uc744 \uc0ac\uc6a9\ud55c\ub2e4.\\n```\\n& k3s server --disable-agent\\n```\\n\\n\uc815\uc0c1\uc801\uc73c\ub85c k3s \uae30\ub3d9\uc774 \uc644\ub8cc\ub418\uba74 `/etc/rancher/k3s/k3s.yaml`\uc5d0\uc11c Kubeconfig\ub97c \ud655\uc778\ud560\uc218 \uc788\ub2e4. \uadf8\ub9ac\uace0 node \uc0c1\ud0dc\ub3c4 \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4.\\n```\\n$ sudo k3s kubectl get nodes\\nNAME          STATUS   ROLES    AGE   VERSION\\nk3s-master    Ready    <none>   21h   v1.13.4-k3s.1\\n```\\n\\n### node \ucd94\uac00\\n\\n`/var/lib/rancher/k3s/server/manifests` \uc5d0\uc11c TOKEN\uc744 \ud655\uc778\ud55c\ub2e4. \\n\\n```\\n$ sudo cat /var/lib/rancher/k3s/server/node-token\\nK100fa5235031f2b8e92e01b8bd3255142422a7aeaa47657ad4c68969d35cddbf3a::node:431342ac6204466e8f81445edb8c2e3a\\n```\\n\\nworker node\uc5d0 \uc811\uc18d\ud55c\ub2e4\uc74c \ub3d9\uc77c\ud558\uac8c \ucd5c\uc2e0 \ub9b4\ub9ac\uc988 v0.2.0\ub97c \ub2e4\uc6b4\ubc1b\ub294\ub2e4.  \\n```\\n$ wget -O k3s https://github.com/rancher/k3s/releases/download/v0.2.0/k3s-armhf && \\\\\\n  chmod +x k3s && \\\\\\n  sudo mv k3s /usr/local/bin/k3s\\n```\\n\\n\uc704\uc5d0\uc11c \ub098\uc628 TOKEN\uac12\uacfc Kube API Endpoint\uc815\ubcf4\ub85c node\ub4e4\uc744 \ucc28\ub840\ub85c \ucd94\uac00 \uc2dc\ud0a4\uba74 \ubaa8\ub4e0 \uc791\uc5c5\uc774 \uc644\ub8cc\ub41c\ub2e4. \\n```\\n$ export NODE_TOKEN=\\"K100fa5235031f2b8e92e01b8bd3255142422a7aeaa47657ad4c68969d35cddbf3a::node:431342ac6204466e8f81445edb8c2e3a\\"\\n$ export MASTER_IP=\\"https://192.168.0.14:6443\\"\\n$ sudo k3s agent --server https://${MASTER_IP}:6443 --token ${NODE_TOKEN} &\\n```\\n\\n\uc644\uc131\ub41c \ud074\ub7ec\uc2a4\ud130\ub97c \ud655\uc778\ud55c\ub2e4. \uc678\ubd80 \ub85c\uceec\uc5d0\uc11c \ud655\uc778\ud558\ub824\uba74 `/etc/rancher/k3s/k3s.yaml` \ud30c\uc77c\uc744 `~/.kube/config`\uc5d0 \ucd94\uac00\ud558\uba74 \ub41c\ub2e4. \ud074\ub7ec\uc2a4\ud130 \ub0b4\ubd80\uc5d0\uc11c kubectl \uba85\ub839\uc740 k3s \ubc14\uc774\ub108\ub9ac \ub0b4\ubd80\uc5d0 \ud3ec\ud568\ub418\uc5b4 \uc788\uc73c\ubbc0\ub85c `sudo k3s kubectl` \uba85\ub839\uc744 \uc0ac\uc6a9\ud558\uc600\ub2e4.\\n\\n```\\n$ sudo k3s kubectl get node -o wide\\nNAME          STATUS   ROLES    AGE   VERSION         INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME\\nk3s-master    Ready    <none>   22h   v1.13.4-k3s.1   192.168.1.14   <none>        Raspbian GNU/Linux 9 (stretch)   4.14.79-v7+      containerd://1.2.4+unknown\\nk3s-slave01   Ready    <none>   21h   v1.13.4-k3s.1   192.168.1.15   <none>        Raspbian GNU/Linux 9 (stretch)   4.14.79-v7+      containerd://1.2.4+unknown\\nk3s-slave02   Ready    <none>   10h   v1.13.4-k3s.1   192.168.1.16   <none>        Raspbian GNU/Linux 9 (stretch)   4.14.79-v7+      containerd://1.2.4+unknown\\nk3s-slave03   Ready    <none>   10h   v1.13.4-k3s.1   192.168.1.17   <none>        Raspbian GNU/Linux 9 (stretch)   4.14.79-v7+      containerd://1.2.4+unknown\\n```\\n\\nnode \uc0c1\uc138\uc815\ubcf4\ub97c \ubcf4\uba74 \uae30\ubcf8\uc801\uc73c\ub85c K8s `v1.13.4`, runtime\uc740 `containerd`\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uc74c\uc744 \uc54c \uc218 \uc788\ub2e4.  \\n\\n```\\n$ sudo k3s kubectl get svc --all-namespaces\\nNAMESPACE     NAME         TYPE           CLUSTER-IP     EXTERNAL-IP                 PORT(S)                      AGE\\ndefault       kubernetes   ClusterIP      10.43.0.1      <none>                      443/TCP                      21h\\nkube-system   kube-dns     ClusterIP      10.43.0.10     <none>                      53/UDP,53/TCP,9153/TCP       21h\\nkube-system   traefik      LoadBalancer   10.43.19.160   192.168.1.14,192.168.1.15   80:32304/TCP,443:31690/TCP   21h\\n```\\n\\nRancher\ucabd\uc5d0\uc11c\ub3c4 \uc624\ub298\ub0a0\uc9dc(3/12)\ub85c F5\uac00 Nginx\ub97c \uc778\uc218\ud558\ub294\uac83\uc744 \uc608\uacac\ud588\ub358 \uac83\uc77c\uae4c?  \\nService\ub97c \ud655\uc778\ud558\uba74 traefik\uc774 \uae30\ubcf8\uc73c\ub85c \ub418\uc5b4\uc788\ub2e4. \uc544\ub798\ucc98\ub7fc \uae30\ubcf8\uc801\uc73c\ub85c loadbalancer\ub85c \ud65c\uc6a9\ub418\uace0 \uc788\ub294 traefik\uc744 Helm Chart CRD\ub97c \ud1b5\ud574 \ubc30\ud3ec\ub41c\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \ub610\ud55c \uc5bc\ub9c8\uc804 \uc878\uc5c5\ud55c CoreDNS\ub3c4 \ubcf4\uc778\ub2e4.   \\n\\n```\\n$ sudo k3s kubectl get pod --all-namespaces\\nNAMESPACE     NAME                             READY   STATUS      RESTARTS   AGE\\nkube-system   coredns-7748f7f6df-qflx9         1/1     Running     0          21h\\nkube-system   helm-install-traefik-dqqg9       0/1     Completed   0          21h\\nkube-system   svclb-traefik-598fd65c97-4xtkf   2/2     Running     0          21h\\nkube-system   svclb-traefik-598fd65c97-vbsqv   2/2     Running     0          19h\\nkube-system   traefik-6876857645-2sqg9         1/1     Running     0          21h\\n\\n$ sudo k3s kubectl get crd\\nNAME                            CREATED AT\\naddons.k3s.cattle.io            2019-03-11T16:46:22Z\\nhelmcharts.k3s.cattle.io        2019-03-11T16:46:22Z\\nlistenerconfigs.k3s.cattle.io   2019-03-11T16:46:22Z\\n```\\n\\n## \uc815\ub9ac\\n\uc544\uc8fc \uc801\uc740\ube44\uc6a9(?)\uc73c\ub85c \ucde8\ubbf8\uc0bc\uc544 k3s \ud074\ub7ec\uc2a4\ud130\ub97c \uad6c\uc131\ud574\ubd24\ub2e4.  \\n\uc544\uc9c1 ARM\uacc4\uc5f4\uc5d0\uc11c kubernetes workload\ub97c \uad6c\ub3d9\ud558\ub294 \uac83\uc740 \uc2dc\uae30\uc0c1\uc870\uc774\uae34 \ud558\uc9c0\ub9cc \uae30\uc874\uc5d0 kubeadm\uc744 \uac00\uc9c0\uace0 pi\uc5d0 \ubc30\ud3ec\ud558\ub294\uac83\uc5d0 \ube44\ud558\uba74 \uc124\uce58 \ub09c\uc774\ub3c4\ub098 \uc790\uc6d0\uc0ac\uc6a9\ub7c9 \uce21\uba74\uc5d0\uc11c \uc7a5\uc810\uc774 \ub9ce\uc740 \ud504\ub85c\uc81d\ud2b8\uc774\ub2e4.  \\n\ud574\uc678 \ube14\ub85c\uadf8\ub098 \ud2b8\uc704\ud130\ub97c \ubcf4\uba74 \ucd5c\uadfc `k3s`\uc5d0 \ub300\ud55c \uad00\uc2ec\ub3c4\uac00 \ub192\uc544\uc9c0\ub294\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub294\ub370 \ub2e8\uc21c\ud788 \ucde8\ubbf8\uc0dd\ud65c\ub9cc\uc774 \uc544\ub2c8\ub77c IoT, Edge\uc5d0\uc11c\uc758 Serverless Workload \uc218\ud589\uc774\ub77c\ub358\uc9c0 ARM \uacc4\uc5f4 \ucd5c\uc801\ud654\ub41c \ubaa8\uc2b5\ub9cc\uc73c\ub85c\ub3c4 \ucda9\ubd84\ud788 \uac00\ub2a5\uc131\uc740 \ubcf4\uc5ec\uc900\uac83 \uac19\ub2e4.  \\nRancher 2.0 \uc774\ud6c4\ub85c Kubernetes \uc5f0\uad00\ub41c \uad00\uc2ec\ub3c4\uac00 \ub5a8\uc5b4\uc84c\uc5c8\ub294\ub370 \uc5d4\uc9c0\ub2c8\uc5b4\ub4e4\uc758 \uad00\uc2ec\uc744 \ub044\ub294\ub370\ub294 \uc131\uacf5\ud55c\ub4ef \ud558\uace0 AWS\uc758 Greengrass, Firecracker\uc640 \ub3d9\uc77c\uc120\uc0c1\uc5d0\uc11c \ubd10\ub3c4 \uacac\uc904\ub9cc\ud55c \uac00\uce58\uac00 \uc788\ub2e4\uace0 \uc0dd\uac01\ub41c\ub2e4."},{"id":"kubernetes/microservices-demo/","metadata":{"permalink":"/kubernetes/microservices-demo/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-03-07-microservices-demo.md","source":"@site/blog/2019-03-07-microservices-demo.md","title":"Cloud-Native Microservices Demo Application with OpenCensus","description":"Hipster Shop: Cloud-Native Microservices Demo Application \ub97c \uc0b4\ud3b4\ubcf4\uace0 \uc548\uc5d0 \ub4e4\uc5b4\uc788\ub294 \uc5ec\ub7ec\uac00\uc9c0 \uc624\ud508\uc18c\uc2a4\ub4e4\uc744 \uc54c\uc544\ubcf8\ub2e4","date":"2019-03-07T00:00:00.000Z","formattedDate":"March 7, 2019","tags":[{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Istio","permalink":"/tags/istio"},{"label":"Stackdriver","permalink":"/tags/stackdriver"},{"label":"Prometheus","permalink":"/tags/prometheus"},{"label":"gRPC","permalink":"/tags/g-rpc"},{"label":"OpenCensus","permalink":"/tags/open-census"},{"label":"skaffold","permalink":"/tags/skaffold"}],"readingTime":13.585,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Cloud-Native Microservices Demo Application with OpenCensus","comments":true,"classes":"wide","description":"Hipster Shop: Cloud-Native Microservices Demo Application \ub97c \uc0b4\ud3b4\ubcf4\uace0 \uc548\uc5d0 \ub4e4\uc5b4\uc788\ub294 \uc5ec\ub7ec\uac00\uc9c0 \uc624\ud508\uc18c\uc2a4\ub4e4\uc744 \uc54c\uc544\ubcf8\ub2e4","slug":"kubernetes/microservices-demo/","date":"2019-03-07T00:00:00.000Z","categories":["Kubernetes"],"tags":["Kubernetes","Istio","Stackdriver","Prometheus","gRPC","OpenCensus","skaffold"]},"prevItem":{"title":"K3s on Raspberry Pi Cluster","permalink":"/kubernetes/k3s-homelab/"},"nextItem":{"title":"Knative with Gloo","permalink":"/kubernetes/knative-using-gloo/"}},"content":"[https://github.com/GoogleCloudPlatform/microservices-demo](https://github.com/GoogleCloudPlatform/microservices-demo)\uc5d0\uc11c \uc18c\uac1c\ub41c Demo Application\uc778 `Hipster Shop`\uc744 Kubernetes \uae30\ubc18\uc73c\ub85c \ubc30\ud3ec\ud558\uace0 \uad00\ub828 \uc624\ud508\uc18c\uc2a4\ub4e4\uc744 \ub354 \uc54c\uc544\ubcf4\uace0\uc790 \ud55c\ub2e4.\\n\\n\uc704 \ub9c1\ud06c\uc5d0 \uac00\uc11c \ubcf4\uba74 \uc54c\uc218 \uc788\uc9c0\ub9cc `Hipster Shop` \uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc 10\uac1c\uc758 Microservice\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\uace0 \uc0c1\ud488\uc744 \uac80\uc0c9 \ubc0f \uad6c\ub9e4\ud560 \uc218\uc788\ub294 \uc6f9 \uae30\ubc18 \uc774\ucee4\uba38\uc2a4 Application\uc73c\ub85c \uad6c\uc131 \ub418\uc5b4\uc788\ub2e4.\\n\\n![arch](https://github.com/GoogleCloudPlatform/microservices-demo/raw/master/docs/img/architecture-diagram.png)\\n\\n\uac01\uac01\uc758 \uc11c\ube44\uc2a4\ub294 **gRPC** \ub85c \ud1b5\uc2e0\ud558\uace0 \uc678\ubd80 \uc0ac\uc6a9\uc790\ub9cc HTTP\ub85c \uc811\uadfc\ud55c\ub2e4. \ubaa8\ub4e0 \uc11c\ube44\uc2a4\ub294 \uc11c\ub85c \ub2e4\ub978 \uc5b8\uc5b4(Go, C#, Node.js, Python, Java)\ub85c \uad6c\uc131\ub418\uc5b4 \uc788\uace0 \ub300\ubd80\ubd84\uc758 Microservice\ub4e4\uc740 `Istio` service mesh \ud615\ud0dc\ub85c \uad6c\uc131\ud560\uc218 \uc788\ub3c4\ub85d \ub418\uc5b4\uc788\ub2e4. `Skaffold`\ub97c \ud1b5\ud574 \ubc30\ud3ec\ud558\uace0 `OpenCensus`\ub77c\uace0 \ud558\ub294 gRPC/HTTP\uae30\ubc18 Tracing tool\uc744 \ud65c\uc6a9\ud558\uc5ec Google `Stackdriver`\ub85c \ubcf4\ub0b4\ub3c4\ub85d \ub418\uc5b4\uc788\uc9c0\ub9cc  Prometheus\uc5d0 \ud1b5\ud569\ud558\ub294 \ubc29\ud5a5\uc73c\ub85c \uc791\uc131\ud558\uae30 \uc704\ud574\uc11c Prometheus \uae30\ubc18\uc73c\ub85c Metric\uc744 \uc218\uc9d1\ud558\ub294 Fork\ub41c \ub370\ubaa8 Application\uc744 \uac80\uc0c9\uc744 \ud1b5\ud574 \ucc3e\uc744\uc218 \uc788\uc5c8\ub2e4.  \\n[https://github.com/census-ecosystem/opencensus-microservices-demo](https://github.com/census-ecosystem/opencensus-microservices-demo)  \\n\\n## OpenCensus\\n\\n[OpenCensus(OC)](https://opencensus.io/)\ub294 Microservice \ubc0f Monolith \uc11c\ube44\uc2a4\ub97c Tracing \ubc0f Metric Monitoring \ud560 \uc218 \uc788\ub294 \ub77c\uc774\ube0c\ub7ec\ub9ac\ub97c \uc81c\uacf5\ud558\ub294 \uc624\ud508\uc18c\uc2a4\uc774\ub2e4.\\n\\n\uc544\ub798\uc640 \uac19\uc774 \ub2e4\uc591\ud55c \uc5b8\uc5b4\ub97c \uc9c0\uc6d0 \ud55c\ub2e4.\\n* Java , Go, Python, C++, Nodejs, Erlang, Ruby, PHP, C#\\n\\n\ub610\ud55c \uc218\uc9d1\ub41c \ub370\uc774\ud130\ub97c Prometheus, Stackdriver Tracing and Monitoring, DataDog, Graphite, Zipkin, Jaeger, Azure Insights \ub4f1 \uacfc \uac19\uc740 \ubc31\uc5d4\ub4dc Application\uc73c\ub85c \ub0b4\ubcf4\ub0bc \uc218 \uc788\uae30 \ub54c\ubb38\uc5d0 \uac1c\ubc1c\uc790, \uc6b4\uc601\uc790 \uce21\uba74\uc5d0\uc11c \uc88b\uc740 \uc120\ud0dd\uc0ac\ud56d\uc774 \ub420 \uc218 \uc788\ub2e4.  \\n\\nMicroservice\uc640 \uac19\uc740 \ubd84\uc0b0 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \uac1c\ubc1c\uc790/\uc6b4\uc601\uc790 \uad00\uc810\uc758 \uac00\uc7a5 \uc911\uc694\ud55c \ubbf8\uc158\uc740 \uac01\uac01\uc758 \uc218\ud589\ub418\ub294 \uc11c\ube44\uc2a4\ub4e4\uc758 \uc2e4\ud589 \uc2dc\uac04\uc744 \ud655\uc778\ud558\uace0 \uc0c1\ud638 API\uac04 \ud1b5\uc2e0\uc774 \uc5bc\ub9c8\ub098 \uac78\ub9ac\ub294\uc9c0\ub97c \ud655\uc778\ud558\uace0 Span(\uc544\ub798 \uadf8\ub9bc\ucc38\uc870)\uc5d0\uc11c \uac00\uc7a5 \uc9c0\uc5f0\uc774 \ubc1c\uc0dd\ud558\ub294 \uc11c\ube44\uc2a4\ub97c \ube68\ub9ac \ucc3e\uc544\ub0b4 \ud655\uc778\ud558\uace0 \uc870\uce58\ud558\ub294 \uac83\uc774\ub77c \ud560 \uc218 \uc788\ub2e4.\\n\\n![span](https://www.jaegertracing.io/img/spans-traces.png)\\n\\nOpenCensus\ub294 \uc8fc\ub85c \ub450\uac00\uc9c0 \uae30\ub2a5\uc73c\ub85c \ud65c\uc6a9\ub41c\ub2e4.  \\n\uccab\ubc88\uc9f8\ub294 Metric \uc218\uc9d1\uc774\uace0 \ub450\ubc88\uc9f8\ub294 Tracing \uae30\ub2a5\uc774\ub2e4.  \\nLog\uac19\uc740 \uacbd\uc6b0 \ud604\uc7ac \ubbf8\uc9c0\uc6d0\uc774\uc9c0\ub9cc \ub2e4\uc74c \uba54\uc774\uc800 \ub9b4\ub9ac\uc988\uc5d0 \ucd94\uac00\ub420 \uc608\uc815\uc774\ub77c\uace0 \ud558\ub2c8 \uc870\uae08\ub354 \uc9c0\ucf1c\ubcf4\uba74 \uc88b\uc744\uac83 \uac19\ub2e4.\\n\\n* Metrics\\n  * \ub370\uc774\ud130\ubca0\uc774\uc2a4 \ubc0f API\uc758 \uc751\ub2f5\uc2dc\uac04, \uc694\uccad content length, open file descriptor \uc218\uc640 \uac19\uc774 \ucd94\uc801\ud558\uace0\uc790\ud558\ub294 \uc815\ub7c9 \ub370\uc774\ud130\ub97c \ub9d0\ud55c\ub2e4. Metric \uc744 \uc2dc\uac01\ud654\ud574\uc11c \ubcf4\uba74 \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8 \ubc0f \uc11c\ube44\uc2a4\uc758 \uc131\ub2a5\uacfc \ud488\uc9c8\uc744 \uce21\uc815\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub420 \uc218 \uc788\ub2e4. \uc608\ub97c \ub4e4\uba74 \uc694\uccad \uc751\ub2f5\uc2dc\uac04\uc758 \ud3c9\uade0\uac12\uc774\ub098 cache hit/miss \uc218\uc640 \uac19\uc740 \uac83\ub4e4\uc774 \ub420 \uc218 \uc788\ub2e4. \\n\\n* Traces\\n  * \uc11c\ube44\uc2a4 \uc694\uccad\uc5d0 \ub300\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158 \ub610\ub294 \uc11c\ube44\uc2a4 \uad6c\uc870\ub97c \ud655\uc778\ud560\uc218 \uc788\uace0 \ubaa8\ub4e0 \uc11c\ube44\uc2a4 \uac04 \ub370\uc774\ud130 \ud750\ub984\uc744 \uc2dc\uac01\ud654\ud558\uc5ec \uc544\ud0a4\ud14d\ucc98\uc0c1\uc758 \ubcd1\ubaa9 \ud604\uc0c1\uc744 \ud30c\uc545\ud558\ub294 \ub370 \ub3c4\uc6c0\uc774 \ub41c\ub2e4.\\n\\n## Hipster Shop Demo\\n\\n\uc704\uc5d0\uc11c \uc5b8\uae09\ud588\ub358 \ub0b4\uc6a9\ucc98\ub7fc GCP\uc5d0\uc11c \uc791\uc131\ud55c [Hipster Shop Demo](https://github.com/GoogleCloudPlatform/microservices-demo)\ub294 minikube \ubc0f GCP \ub370\ubaa8\ub85c \ub418\uc5b4\uc788\uace0 \ucf54\ub4dc\uc548\uc5d0 \uae30\ubcf8 Metric \uc124\uc815\uc774 Stackdriver\uc73c\ub85c \ub418\uc5b4\uc788\uc5b4 Prometheus Exporter \uc801\uc6a9\uc744 \ud558\ub824\uba74 \ucf54\ub4dc \uc218\uc815\uc774 \ud544\uc694\ud558\uae30 \ub54c\ubb38\uc5d0 Prometheus\uae30\ubc18\uc73c\ub85c \uc791\uc131\ub41c [Forked Repo](https://github.com/census-ecosystem/opencensus-microservices-demo)\ub97c \uc0b4\ud3b4\ubcf4\uae30\ub85c \ud558\uc600\ub2e4.\\n\\n\\n### Requirement\\n\ud604\uc7ac \uac00\uc9c0\uace0 \uc788\ub294 MacOS \ud658\uacbd\uc5d0\uc11c \uad6c\ub3d9\ud558\uc600\ub2e4. \ucd5c\uc18c \uc2a4\ud399\uc740 \ub530\ub85c \uae30\uc7ac\ud558\uc9c0 \uc54a\uc558\uc73c\ub098 K8s 1.11 \uc774\uc0c1\uc744 \uad8c\uc7a5\ud55c\ub2e4.\\n* kubectl : v1.10.7\\n* Minikube : v0.34.1\\n* Kubernetes : v1.13.3\\n* [skaffold](https://github.com/GoogleContainerTools/skaffold/#installation) : v0.24\\n\\n### minikube \uae30\ub3d9\\n\ucd5c\uc18c 3 CPU, 6Gb Memory\uac00 \ud544\uc694\ud558\ub2e4. \uadf8\ub0e5 minikube\ub97c \uad6c\ub3d9\uc2dc\uae30\uba74 4 CPU, 8Gb \ub85c \uad6c\ub3d9\uc774 \ub418\uae30 \ub54c\ubb38\uc5d0 \ubcc4\ub2e4\ub978 \uc635\uc158 \uc5c6\uc774 default\ub85c \uad6c\ub3d9\ud558\uba74 \ub41c\ub2e4. \\n```bash\\n$ minikube start\\n$ kubectl get nodes\\nNAME       STATUS    ROLES     AGE       VERSION\\nminikube   Ready     master    6h        v1.13.3\\n```\\n\\n### Repository Clone\\n```bash\\n$ git clone https://github.com/census-ecosystem/opencensus-microservices-demo.git\\n$ cd opencensus-microservices-demo\\n```\\n\\n\ub0b4\ubd80 \uad6c\uc870\ub97c \uc0b4\ud3b4\ubcf4\uba74 \uae30\ubcf8\uc801\uc73c\ub85c [skaffold](https://github.com/GoogleContainerTools/skaffold)\ub97c \ud65c\uc6a9\ud558\uc5ec \ubc30\ud3ec\ub97c \uc9c4\ud589\uc744 \ud558\ub294 \uac83\uc744 \uc54c\uc218\uc788\ub2e4.  \\n`skaffold`\ub294 \ub85c\uceec\uc5d0\uc11c Kubernetes \uae30\ubc18 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158 \uac1c\ubc1c\uacfc \ubc30\ud3ec(CD)\ub97c \ube60\ub974\uac8c \ub3c4\uc640\uc8fc\ub294 CLI tool\uc774\ub2e4. \uc18c\uc2a4\ucf54\ub4dc\uc758 \ubcc0\ud654\ub97c \uac10\uc9c0\ud558\uc5ec build, registry push/tagging, deploy\uae4c\uc9c0 \uc790\ub3d9\uc73c\ub85c \ud560 \uc218 \uc788\ub294 \ub85c\uceec \uae30\ubc18 \ub3c4\uad6c\uc774\ub2e4.\\n\\n`skaffold dev`\ub294 \ub85c\uceec \ud658\uacbd\uc758 \ubc18\ubcf5\uc801\uc778 \uac1c\ubc1c\uc5d0 \ud65c\uc6a9\ud558\uace0 \uc2e4\uc81c \ubc30\ud3ec\ub294 CI Process\uc5d0\uc11c `skaffold run`\uc744 \ud1b5\ud574 \ubc30\ud3ec\ub97c \uc9c4\ud589\ud560 \uc218 \uc788\ub2e4.  \\n\\n![skaffold demo](https://github.com/GoogleContainerTools/skaffold/raw/master/docs/static/img/intro.gif)\\n\\nKubernetes \ubc30\ud3ec\ud234\uc5d0 \ub300\ud574 \ube44\uad50\ud55c \uae00\uc740 [\ube14\ub85c\uadf8 \ub9c1\ud06c](https://blog.hasura.io/draft-vs-gitkube-vs-helm-vs-ksonnet-vs-metaparticle-vs-skaffold-f5aa9561f948/)\ub97c \ud1b5\ud574 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n\uc544\ub798\uc5d0\uc11c\ub294 `skaffold`\uc5d0 \ub300\ud55c \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \ubbf8\ub904\ub450\uace0 \ubc30\ud3ec\ud558\ub294 \ub3c4\uad6c\ub85c\uc11c\ub9cc \uc124\uba85\ud55c\ub2e4.  \\n\\n\uae30\ubcf8\uc801\uc73c\ub85c \uad6c\uc131\uc744 \ud558\uace0\uc790 \ud558\ub294 \ub0b4\uc6a9\uc740 helm\ucc98\ub7fc template \ud30c\uc77c\uc744 \uc0ac\uc6a9\ud558\uac8c \ub418\ub294\ub370 \ud504\ub85c\uc81d\ud2b8 root\uc5d0 `skaffold.yaml` \uc5d0 build\ub97c \uc704\ud55c image name, tag, src \uc704\uce58\ub4f1 \uae30\ubcf8\uc801\uc778 \ub0b4\uc6a9\uc744 \uae30\uc7ac\ud55c\ub2e4. \ud30c\uc77c\ub0b4\uc6a9\uc744 \uc0b4\ud3b4\ubcf4\uba74 build\uc5d0 \uad00\ub828\ub41c \ub0b4\uc6a9\ub4e4\uc744 \uc791\uc131\ud558\uace0 deploy\ud560 manifests\uc758 \uc704\uce58\uae4c\uc9c0 \uc9c0\uc815\ud558\ub3c4\ub85d \ub418\uc5b4\uc788\ub2e4. \ub85c\uceec\ud658\uacbd\uc5d0\uc11c \ud655\uc778\uc744 \uc704\ud574 grafana, prometheus, jaeger\uac00 \ucd94\uac00\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```yaml\\napiVersion: skaffold/v1alpha2\\nkind: Config\\nbuild:\\n  tagPolicy:\\n    gitCommit: {}\\n  artifacts:\\n  - imageName: gcr.io/opencensus-microservices-demo/emailservice\\n    workspace: src/emailservice\\n  - imageName: gcr.io/opencensus-microservices-demo/productcatalogservice\\n    workspace: src/productcatalogservice\\n  - imageName: gcr.io/opencensus-microservices-demo/recommendationservice\\n    workspace: src/recommendationservice\\n  - imageName: gcr.io/opencensus-microservices-demo/shippingservice\\n    workspace: src/shippingservice\\n  - imageName: gcr.io/opencensus-microservices-demo/checkoutservice\\n    workspace: src/checkoutservice\\n  - imageName: gcr.io/opencensus-microservices-demo/paymentservice\\n    workspace: src/paymentservice\\n  - imageName: gcr.io/opencensus-microservices-demo/currencyservice\\n    workspace: src/currencyservice\\n  - imageName: gcr.io/opencensus-microservices-demo/cartservice\\n    workspace: src/cartservice\\n  - imageName: gcr.io/opencensus-microservices-demo/frontend\\n    workspace: src/frontend\\n  - imageName: gcr.io/opencensus-microservices-demo/loadgenerator\\n    workspace: src/loadgenerator\\n  - imageName: gcr.io/opencensus-microservices-demo/adservice\\n    workspace: src/adservice\\n  - imageName: gcr.io/opencensus-microservices-demo/grafana\\n    workspace: src/grafana\\n  - imageName: gcr.io/opencensus-microservices-demo/prometheus\\n    workspace: src/prometheus\\n  - imageName: gcr.io/opencensus-microservices-demo/jaeger\\n    workspace: src/jaeger\\ndeploy:\\n  kubectl:\\n    manifests:\\n    - ./kubernetes-manifests/**.yaml\\n```\\n\\nGo\ub85c \uc791\uc131\ub41c Frontend microservice\uc744 \uc0b4\ud3b4\ubcf4\uc790. [**./src/frontend/main.go**]\\n\\n### library \ucd94\uac00 \ubc0f http handler \ucd08\uae30\ud654\\n\\nGo\uae30\ubc18 exporter \ud328\ud0a4\uc9c0(jaeger,prometheus)\ub97c \ucd94\uac00\uc801\uc73c\ub85c import \ud558\uace0 http handler\ub97c \uc704\ud55c [ochttp \ud328\ud0a4\uc9c0](https://godoc.org/go.opencensus.io/plugin/ochttp)\ub97c \ucd94\uac00\ud558\uc600\ub2e4. \\n```go\\nimport (\\n...\\n        \\"go.opencensus.io/exporter/jaeger\\"\\n        \\"go.opencensus.io/exporter/prometheus\\"\\n        \\"go.opencensus.io/plugin/ochttp\\"\\n        \\"go.opencensus.io/plugin/ochttp/propagation/b3\\"\\n...\\n)\\nfunc main() {\\n...\\n        var handler http.Handler = r\\n        handler = &logHandler{log: log, next: handler}\\n        handler = ensureSessionID(handler)      \\n        // add opencensus instrumentation\\n        handler = &ochttp.Handler{ \\n                Handler:     handler,\\n                Propagation: &b3.HTTPFormat{}}\\n        log.Infof(\\"starting server on \\" + addr + \\":\\" + srvPort)\\n        log.Fatal(http.ListenAndServe(addr+\\":\\"+srvPort, handler))\\n}\\n```\\n\\n### exporter \ub4f1\ub85d(Jaeger Tracing \ubc0f Prometheus exporter)\\n\\n\uc608\uc2dc\ucc98\ub7fc \uac01\uac01\uc758 \uc11c\ube44\uc2a4\uc5d0 jaeger\uc640 prometheus exporter Endpoint\ub97c \uc27d\uac8c \ub4f1\ub85d\ud560\uc218 \uc788\ub2e4.  \\n\ub610\ud55c initTracing() \uc5d0\uc11c\ub294 \ub370\ubaa8\ub97c \uc704\ud574 trace.AlwaysSample()\uc744 \uc0ac\uc6a9\ud558\uc600\ub2e4. \uc2e4\uc81c \uc6b4\uc601\ud658\uacbd\uc5d0\uc11c\ub294 [\ub2e4\uc74c \ub9c1\ud06c](https://github.com/census-instrumentation/opencensus-specs/blob/master/trace/Sampling.md)\ub97c \ucc38\uace0\ud574\uc11c \uc0ac\uc6a9\ud558\ub294 \uac83\uc744 \uad8c\uace0\ud558\uace0 \uc788\ub2e4. \\n\\n```go\\n...\\nfunc initJaegerTracing(log logrus.FieldLogger) {\\n        // Register the Jaeger exporter to be able to retrieve\\n        // the collected spans.\\n        exporter, err := jaeger.NewExporter(jaeger.Options{\\n                Endpoint: \\"http://jaeger:14268\\",\\n                Process: jaeger.Process{\\n                        ServiceName: \\"frontend\\",\\n                },\\n        })\\n        if err != nil {\\n                log.Fatal(err)\\n        }\\n        trace.RegisterExporter(exporter)\\n}\\n\\nfunc initTracing(log logrus.FieldLogger) {\\n        // This is a demo app with low QPS. trace.AlwaysSample() is used here\\n        // to make sure traces are available for observation and analysis.\\n        // In a production environment or high QPS setup please use\\n        // trace.ProbabilitySampler set at the desired probability.\\n        trace.ApplyConfig(trace.Config{\\n                DefaultSampler: trace.AlwaysSample(),\\n        })\\n        initJaegerTracing(log)\\n}\\n\\nfunc initPrometheusStatsExporter(log logrus.FieldLogger) *prometheus.Exporter {\\n\\texporter, err := prometheus.NewExporter(prometheus.Options{})\\n\\n\\tif err != nil {\\n\\t\\tlog.Fatal(\\"error registering prometheus exporter\\")\\n\\t\\treturn nil\\n\\t}\\n\\n\\tview.RegisterExporter(exporter)\\n\\treturn exporter\\n}\\nfunc startPrometheusExporter(log logrus.FieldLogger, exporter *prometheus.Exporter) {\\n\\taddr := \\":9090\\"\\n\\tlog.Infof(\\"starting prometheus server at %s\\", addr)\\n\\thttp.Handle(\\"/metrics\\", exporter)\\n\\tlog.Fatal(http.ListenAndServe(addr, nil))\\n}\\n...\\n```\\n\\n### Demo Application \ubc30\ud3ec\\n\\nminikube\uc5d0 Hipster Shop Demo\ub97c \ubc30\ud3ec\ud55c\ub2e4. \ub2e8\uc21c\ud558\uac8c `skaffold run` \uba85\ub839\uc73c\ub85c \uc9c4\ud589\ud558\uba74 \ub41c\ub2e4.\\n\\n```\\n$ skaffold run\\n```\\n\\n\ud604\uc7ac \uc0ac\uc6a9\uc911\uc778 2018 Macbook Pro(3.1 GHz Intel Core i7, 16GB) \uc0c1\uc758 Docker\uae30\ubc18 minikube \ud658\uacbd\uc73c\ub85c\ub3c4 \ubc30\ud3ec\ub97c \ud558\uc600\ub294\ub370 \uc2dc\uac04\uc774 \uaf64 \uc18c\uc694\ub418\uc5c8\ub2e4.(20\ubd84\uc774\uc0c1)  \\n\ucf54\ub4dc\ub97c \uc2e4\uc2dc\uac04\uc73c\ub85c \uc218\uc815\ud558\uace0 \ube4c\ub4dc, \ubc30\ud3ec\ub418\ub294 \uac83\uc740 `skaffold dev` \uba85\ub839\uc73c\ub85c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \uc9c4\ud589\ub418\ub294 \uacfc\uc815\uc744 \ubcf4\uba74 [draft.sh](https://draft.sh/) \ud504\ub85c\uc81d\ud2b8\uc640\ub3c4 \uaf64 \uc720\uc0ac\ud558\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4.  \\n\\n\uc5d0\ub7ec\uc5c6\uc774 run\uc774 \uc2e4\ud589\ub418\uace0 \ub09c\ud6c4 minikube\uc5d0 \ubc30\ud3ec\ub41c pod\uc640 service\ub97c \ud655\uc778\ud55c\ub2e4. \uc911\uac04\uc5d0 loadgenerator\uac00 init\uc778 \uc774\uc720\ub294 minikube \uc790\uc6d0\uc774 \ubd80\uc871\ud574\uc11c \ubc1c\uc0dd\ud558\ub294 \ud604\uc0c1\uc774\ub2e4.\\n\\n```bash\\n$ kubectl get pod\\nNAME                                     READY     STATUS     RESTARTS   AGE\\nadservice-7c7d687dcb-xzr4m               1/1       Running    1          4h\\ncartservice-f54bcb9ff-tcfgn              1/1       Running    4          4h\\ncheckoutservice-576446687b-95bwj         1/1       Running    1          4h\\ncurrencyservice-5bd99bf97d-28mtz         1/1       Running    1          4h\\nemailservice-6cb587798d-wwzdh            1/1       Running    1          4h\\nfrontend-6bf9796f7b-ch9pl                1/1       Running    4          4h\\ngrafana-6678c5c5d9-2qx75                 1/1       Running    1          4h\\njaeger-5b66bdf7f7-csdzx                  1/1       Running    2          4h\\nloadgenerator-7c4f446774-68djg           0/1       Init:0/1   1          4h\\npaymentservice-fc4c8589-wrfg7            1/1       Running    1          4h\\nproductcatalogservice-84878c8b9c-jhgnw   1/1       Running    1          4h\\nprometheus-58d98b7578-87td6              1/1       Running    1          4h\\nrecommendationservice-8564f9d894-smlpf   1/1       Running    1          4h\\nredis-cart-798bc66d58-xn6ff              1/1       Running    1          4h\\nshippingservice-789656f6bc-rgzrp         1/1       Running    1          4h\\n\\n$ kubectl get svc\\nNAME                    TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                                                            AGE\\nadservice               ClusterIP      10.107.196.115   <none>        9555/TCP,9090/TCP                                                  4h\\ncartservice             ClusterIP      10.98.151.164    <none>        7070/TCP                                                           4h\\ncheckoutservice         ClusterIP      10.97.9.197      <none>        5050/TCP                                                           4h\\ncurrencyservice         ClusterIP      10.103.112.225   <none>        7000/TCP                                                           4h\\nemailservice            ClusterIP      10.97.184.174    <none>        5000/TCP                                                           4h\\nfrontend                ClusterIP      10.103.40.138    <none>        80/TCP,9090/TCP                                                    4h\\nfrontend-external       LoadBalancer   10.108.170.241   <pending>     80:31944/TCP                                                       4h\\ngrafana                 ClusterIP      10.104.141.254   <none>        3000/TCP                                                           4h\\ngrafana-external        LoadBalancer   10.102.166.138   <pending>     3000:30459/TCP                                                     4h\\njaeger                  ClusterIP      10.98.71.173     <none>        9411/TCP,5775/UDP,6831/UDP,6832/UDP,5778/TCP,16686/TCP,14268/TCP   4h\\njaeger-external         LoadBalancer   10.96.164.126    <pending>     16686:32362/TCP                                                    4h\\nkubernetes              ClusterIP      10.96.0.1        <none>        443/TCP                                                            6h\\npaymentservice          ClusterIP      10.109.31.241    <none>        50051/TCP                                                          4h\\nproductcatalogservice   ClusterIP      10.101.124.106   <none>        3550/TCP                                                           4h\\nprometheus              ClusterIP      10.103.107.213   <none>        9090/TCP                                                           4h\\nrecommendationservice   ClusterIP      10.104.225.28    <none>        8080/TCP                                                           4h\\nredis-cart              ClusterIP      10.101.24.157    <none>        6379/TCP                                                           4h\\nshippingservice         ClusterIP      10.104.224.18    <none>        50051/TCP                                                          4h\\n```\\n\\n### \uc11c\ube44\uc2a4 \uc811\uc18d \ubc0f Metric/Tracing \ud655\uc778\\n\ub85c\uceec minikube\ud658\uacbd\uc774\uae30 \ub54c\ubb38\uc5d0 external service\uac00 pending\uc774\ubbc0\ub85c service\ub97c minikube NAT IP\ub85c expose \uc2dc\ud0a8\ub2e4.\\n\\n```bash\\n$ minikube service frontend-external\\n$ minikube service grafana-external\\n$ minikube service jaeger-external\\n$ minikube service list\\n|-------------|-----------------------|-----------------------------|\\n|  NAMESPACE  |         NAME          |             URL             |\\n|-------------|-----------------------|-----------------------------|\\n| default     | adservice             | No node port                |\\n| default     | cartservice           | No node port                |\\n| default     | checkoutservice       | No node port                |\\n| default     | currencyservice       | No node port                |\\n| default     | emailservice          | No node port                |\\n| default     | frontend              | No node port                |\\n| default     | frontend-external     | http://192.168.99.101:31944 |\\n| default     | grafana               | No node port                |\\n| default     | grafana-external      | http://192.168.99.101:30459 |\\n| default     | jaeger                | No node port                |\\n| default     | jaeger-external       | http://192.168.99.101:32362 |\\n| default     | kubernetes            | No node port                |\\n| default     | paymentservice        | No node port                |\\n| default     | productcatalogservice | No node port                |\\n| default     | prometheus            | No node port                |\\n| default     | recommendationservice | No node port                |\\n| default     | redis-cart            | No node port                |\\n| default     | shippingservice       | No node port                |\\n| kube-system | kube-dns              | No node port                |\\n|-------------|-----------------------|-----------------------------|\\n```\\n\\n3\uac1c\uc758 \uc11c\ube44\uc2a4\ub85c \uac01\uac01 \uc811\uc18d\uc774 \ub418\ub294\uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4.\\nGrafana \ub300\uc2dc\ubcf4\ub4dc\ub85c \ub4e4\uc5b4\uac00\uba74 \ud604\uc7ac \uc218\uc9d1\ub418\ub294 prometheus source(http://prometheus:9090)\ub97c \ud1b5\ud574 OpenCensus\uae30\ubc18 Application Metric\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n![hipster_grafana](/img/hipster_grafana.png)\\n\\n\uadf8\ub9bc\uc5d0\uc11c \ubcf4\uba74 \uc804\uccb4 \uc11c\ube44\uc2a4 \uc751\ub2f5\uc5d0 \ub300\ud55c 99% \ubc31\ubd84\uc704 \uc9c0\uc5f0\uc2dc\uac04\uc774 944ms \uc778\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n\ub610\ud55c Jaeger\ub97c \ud1b5\ud574 DAG(Directed acyclic graph) \ubc0f \uc11c\ube44\uc2a4\uac04 Tracing \uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n![DAG](/img/dag.png)\\n\\n![tracing](/img/tracing.png)\\n\\n## \uc815\ub9ac\\nOpenCensus \uae30\ubc18\uc73c\ub85c \uac1c\ubc1c\uc790\uac00 \ucf54\ub4dc\ub97c \uc791\uc131\ud558\uace0 Microservice\ub97c minikube\uc5d0\uc11c \ubc30\ud3ec\ud558\uace0 Prometheus, Jaeger Exporter \uc5f0\ub3d9\uc744 \ud1b5\ud574 \uc2dc\uc2a4\ud15c\ubfd0\ub9cc\uc774 \uc544\ub2cc Application\uae30\ubc18 Metrics/Stats\uc744 \uc218\uc9d1\ud558\uace0 \uac1c\ubc1c\uc790\uac00 \uc791\uc131\ud55c \ucf54\ub4dc\ub97c \uc9c1\uc811 Tracing\ud558\ub294 \uac04\ub2e8\ud55c \ub370\ubaa8\ub97c \uc9c4\ud589\ud558\uc600\ub2e4. (Istio\ub97c \ud3ec\ud568\ud574\uc11c Public\ud658\uacbd\uc5d0 \ubc30\ud3ec\ud574\ubd10\ub3c4 \uc88b\uc740 \uacf5\ubd80\uac00 \ub420 \uac83 \uac19\ub2e4)  \\n\\n\ud5a5\ud6c4 [OpenMetric](https://openmetrics.io/)\uacfc [Opencensus](https://opencensus.io/)\uac00 \uc2e4\uc81c \uac1c\ubc1c\uc790 \uae30\ubc18\uc73c\ub85c \ud65c\uc131\ud654\ub418\uace0 \uc801\uc6a9\uc774 \ub41c\ub2e4\uba74 Telemetric \uce21\uba74\uc5d0\uc11c \ub9ce\uc740 Use-Case\uac00 \ub3c4\ucd9c\ub420 \uc218 \uc788\uc744\uac83 \uac19\ub2e4.  \\n\\n\uc704\uc5d0\uc11c \uc5b8\uae09\ud588\ub4ef\uc774 Prometheus\uae30\ubc18 Kubernetes \ud074\ub7ec\uc2a4\ud130\ub97c \uc6b4\uc601\ud558\uace0 \uc788\ub294 \ud300\uc758 \uacbd\uc6b0 \uac1c\ubc1c\uc790\uc758 \uc791\uc131 \ucf54\ub4dc\ub97c \ucd5c\uc18c\ud654\ud560 \uc218 \uc788\ub294 \ub3c4\uad6c\ub85c\uc11c \ucda9\ubd84\ud788 \ud65c\uc6a9\ub420 \uc218 \uc788\uc5b4 \ubcf4\uc778\ub2e4.  \\n\\n\uaf2d Cloud Native \uae30\ubc18 Web \uac1c\ubc1c\uc774 \uc544\ub2c8\ub354\ub77c\ub3c4 \uae30\uc874 \uacf5\uc7a5, \uae08\uc735, \ubcd1\uc6d0 \ub4f1 \uc758 IoT\ub098 \uc13c\uc11c/\uc124\ube44\ub97c \uc704\ud55c \ube44\uc988\ub2c8\uc2a4\uc5d0\ub3c4 Backend\ub85c\uc11c \ud655\uc7a5\uc131\uc788\ub294 \ub3c4\uad6c\ub85c\uc11c \ud65c\uc6a9\uc774 \ub420 \uc218 \uc788\uc744\uac83 \uac19\ub2e4."},{"id":"kubernetes/knative-using-gloo/","metadata":{"permalink":"/kubernetes/knative-using-gloo/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-02-28-knative-using-gloo.md","source":"@site/blog/2019-02-28-knative-using-gloo.md","title":"Knative with Gloo","description":"Istio\uc5d0 \uc885\uc18d\ub418\uc5b4\uc788\ub294 Knative\uac00 \uc544\ub2cc \uacbd\ub7c9\ud654\ub41c Ingress \uc624\ud508\uc18c\uc2a4 Gloo\ub97c \ud65c\uc6a9\ud55c Knative \uc124\uce58 \ubc0f \ud65c\uc6a9","date":"2019-02-28T00:00:00.000Z","formattedDate":"February 28, 2019","tags":[{"label":"Knative","permalink":"/tags/knative"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"FaaS","permalink":"/tags/faa-s"},{"label":"Serverless","permalink":"/tags/serverless"},{"label":"CRDs","permalink":"/tags/cr-ds"},{"label":"CloudEvents","permalink":"/tags/cloud-events"},{"label":"Mesh","permalink":"/tags/mesh"},{"label":"Gloo","permalink":"/tags/gloo"}],"readingTime":8.575,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Knative with Gloo","comments":true,"classes":"wide","description":"Istio\uc5d0 \uc885\uc18d\ub418\uc5b4\uc788\ub294 Knative\uac00 \uc544\ub2cc \uacbd\ub7c9\ud654\ub41c Ingress \uc624\ud508\uc18c\uc2a4 Gloo\ub97c \ud65c\uc6a9\ud55c Knative \uc124\uce58 \ubc0f \ud65c\uc6a9","slug":"kubernetes/knative-using-gloo/","date":"2019-02-28T00:00:00.000Z","categories":["Kubernetes"],"tags":["Knative","Kubernetes","FaaS","Serverless","CRDs","CloudEvents","Mesh","Gloo"]},"prevItem":{"title":"Cloud-Native Microservices Demo Application with OpenCensus","permalink":"/kubernetes/microservices-demo/"},"nextItem":{"title":"Knative CLI - knctl","permalink":"/kubernetes/knative-knctl/"}},"content":"## Knative Routing\\nKnative\ub294 \uc55e\uc5d0\uc11c\ub3c4 \uba87\ubc88 \uc5b8\uae09\ud558\uc600\uc9c0\ub9cc \uae30\ubcf8\uc801\uc73c\ub85c `Routing`\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc678\ubd80\uc5d0 \ub178\ucd9c\ud560 \uc11c\ube44\uc2a4\ub4e4\uc5d0 \ub300\ud55c HTTP Endpoint\ub97c \uc81c\uacf5\ud55c\ub2e4. \uc5b4\ub5bb\uac8c \ubcf4\uba74 \uae30\ubcf8\uc801\uc73c\ub85c API Gateway \uc5ed\ud560\uc744 \ud558\uae30\ub3c4 \ud558\uace0 Ingress \uc5ed\ud560\uc744 \ud558\uae30\ub3c4 \ud55c\ub2e4. \ubcf4\ud1b5 Service mesh\uc778 `Istio`\ub97c \uc0ac\uc6a9\ud558\uc5ec ingress\ub97c \uad6c\ud604\ud558\ub294\uac83\uc774 \ub2f9\uc5f0\ud558\ub2e4\uace0 \uc0dd\uac01\ud558\uae30\ub3c4 \ud558\uc9c0\ub9cc Istio\uc758 \ubaa8\ub4e0 \uae30\ub2a5\uc774 Knative\uc5d0 \ud544\uc694\ud558\uc9c0\ub294 \uc54a\uace0 \uc124\uce58\ub418\ub294\uac83 \uc790\uccb4\uac00 \ub9ac\uc18c\uc2a4 \uc18c\ubaa8\uac00 \uaf64 \ub41c\ub2e4\ub294\uac83\uc740 \uc124\uce58 \ud574\ubcf8\uc0ac\ub78c\uc740 \uc54c\uace0 \uc788\uc744\uac83\uc774\ub2e4. \\n\\n## Service \\n### Kubernetes\\n![ingress](https://www.nginx.com/wp-content/uploads/2017/09/NGINX-Plus-Features-Kubernetes-Ingress-Controller-644x372@2x.png)  \\n\uc774\ubbf8\uc9c0\ucd9c\ucc98 : https://www.nginx.com/blog/announcing-nginx-ingress-controller-for-kubernetes-release-1-3-0/\\n\\n\\nKubernetes\uc5d0\uc11c\ub294 \uc77c\ubc18\uc801\uc73c\ub85c \uc11c\ube44\uc2a4 \uc811\uc18d\uc744 \uad6c\ud604\ud558\uac8c \ub418\uba74 \uae30\ubcf8\uc801\uc73c\ub85c Pod\uc640 Service\ub97c \uc0dd\uc131\ud558\uace0 Ingress\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud074\ub7ec\uc2a4\ud130 \ub0b4\ubd80\ub85c \ub4e4\uc5b4\uc624\ub294 \ud2b8\ub798\ud53d\uc744 \ucc98\ub9ac\ud558\uac8c \ub41c\ub2e4.\\n\\n### Knative\\n![Serving](https://i1.wp.com/blog.openshift.com/wp-content/uploads/intro.png?w=499&ssl=1)  \\n\uc774\ubbf8\uc9c0\ucd9c\ucc98 : https://blog.openshift.com/knative-serving-your-serverless-services/\\n\\n\\nKnative\uc5d0\uc11c\ub294 \uc55e\uc120 Knative \uad00\ub828 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub3c4 \uc124\uba85\ud588\ub4ef\uc774 `Automatic scaling up and down to zero` \ud2b9\uc131\uc744 \uac00\uc9c0\uace0 \uc788\uae30\uc5d0 Pod\uac00 \ucd5c\ucd08 \uc2e4\ud589\ub418\uc5b4\uc788\uc9c0 \uc54a\uc740 \uc0c1\ud0dc\uc5d0\uc11c \ud2b8\ub798\ud53d\uc774 \ub4e4\uc5b4\uc624\uac8c \ub418\uba74 [Knative Serving Activator](https://github.com/knative/serving/blob/master/docs/scaling/DEVELOPMENT.md)\uc5d0 \uc758\ud574\uc11c Pod\uac00 \uc5c6\ub294 Revision\uc744 \ud655\uc778\ud558\uace0 Cold Start \ud615\ud0dc\ub85c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uac8c \ub41c\ub2e4. \ub098\ub294 \uc774\uac8c \uc9c4\uc815\ud55c \uc11c\ubc84\ub9ac\uc2a4\ub77c\uace0 \uc0dd\uac01\ud558\uc9c0\ub9cc \uc8fc\ubcc0\uc5d0 \ubc18\ubc15\ud558\uc2dc\ub294 \ubd84\ub4e4\ub3c4 \uac04\ud639 \uc788\ub2e4.\\n\\n\uc774\ud6c4 Pod\uac00 Warm \uc0c1\ud0dc\uac00 \ub418\uace0 \ub098\uba74 Istio Route(Ingress Gateway)\ub97c \ud1b5\ud574 \ud2b8\ub798\ud53d\uc774 Pod\ub85c \uc804\ub2ec\ub418\uc5b4 \ud1b5\uc2e0\uc774 \uc774\ub904\uc9c0\uac8c \ub41c\ub2e4.\\n\\n\ud604\uc7ac Knative\ub294 \ud604\uc7ac Ingress Gateway \uc758\uc874\uc131\uc744 \uac00\uc9c0\uace0 \uc788\uace0 Envoy\uae30\ubc18 Service Mesh\uc778 `Istio`, Envoy\uae30\ubc18 API Gateway\uc778 `Gloo` \ub450\uac00\uc9c0 \uc635\uc158\uc73c\ub85c Ingress \uad6c\ud604\uc774 \uac00\ub2a5\ud558\ub2e4.\\n\\n\\n## Istio \\nKnative\ub294 \uae30\ubcf8\uc801\uc73c\ub85c Ingress Gateway\uae30\ub2a5\uc744 \ud0d1\uc7ac\ud558\uace0 \uc788\ub294\ub370 \uc774\ub294 Istio\uc758 \uae30\ub2a5\uc911 \ud558\ub098\ub2e4.  \\nIstio\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 Core Feature\ub97c \uac00\uc9c4\ub2e4. \uc0c1\uc138\ud55c \ub0b4\uc6a9\uc740 [https://istio.io/docs/concepts/what-is-istio/](https://istio.io/docs/concepts/what-is-istio/) \uc5d0\uc11c \ud655\uc778\ud558\uba74 \ub41c\ub2e4.\\n\\n* Traffic management\\n* Security\\n* Policies and Telemetry\\n* Performance and Scalability\\n\\nIstio\ub294 48\uac1c\uc758 `CRDs`(CustomResourceDefinition objects)\ub97c \uac00\uc9c0\uace0 \uc788\ub294\ub370 \uc774\uc911 Knative Serving\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294\uac74 `VirtualService` \ub2e8 \ud558\ub098\ub2e4.\\n\\n## Gloo\\n[Gloo](https://gloo.solo.io/)\ub294 Kubernetes-native ingress controller\uc774\uc790 [Next Generation API Gateway](https://medium.com/solo-io/announcing-gloo-the-function-gateway-3f0860ef6600) \ub97c \uc704\ud574 \uc2dc\uc791\ub41c \ud504\ub85c\uc81d\ud2b8\uc774\ub2e4. \uc2e4\uc81c Redhat\uc5d0\uc11c Openshift\uae30\ubc18 Microservice \ubc0f Istio \uac1c\ubc1c\uc5c5\ubb34\ub97c \ud558\ub2e4\uac00 \ucd5c\uadfc\uc5d0 solo.io\uc758 CTO\ub85c \uc774\uc9c1\ud55c [Christian Posta](https://blog.christianposta.com/)\uac00 \ubc00\uace0 \uc788\ub294 \ud504\ub85c\uc81d\ud2b8\uc774\uae30\ub3c4 \ud558\ub2e4. \\n\\n\\n![gloo](https://cdn-images-1.medium.com/max/1600/0*Z0Jb5DJFOyeY91sN.)\\n\\n\\n`Gloo`\ub294 Envoy Proxy \uae30\ubc18\uc73c\ub85c \ub3d9\uc791\ud558\uba70 \\n\uae30\uc874 Legacy\ubd80\ud130 Container\uc11c\ube44\uc2a4, FaaS(AWS Lambda, Azure Functions, GCP Functions)\uc601\uc5ed\uc758 Application\ub4e4\uc744 REST, gRPC, SOAP, Web Socker\uae30\ubc18\uc73c\ub85c Aggregate \ud574\uc11c Function \uae30\ubc18 \ucd94\uc0c1\ud654\ub97c \uad6c\ud604\ud574 \uc8fc\ub294 \uc624\ud508\uc18c\uc2a4 \ud504\ub85c\uc81d\ud2b8\ub77c \uc815\uc758 \ud560 \uc218 \uc788\ub2e4. \\n\\nIstio\uc758 Ingress\uae30\ub2a5\uc678\uc758 \uc5ec\ub7ec\uac00\uc9c0 \ubd80\uac00 \uae30\ub2a5(Telemetry, Security, Policy Enforcement)\ub4e4\uc740 Knative\uc5d0\uc11c\ub294 \ud544\uc694\ub85c \ud558\uc9c0 \uc54a\ub294\ub2e4. \\n\\nKnative API Gateway \ub85c\uc11c Istio\uac00 \uc544\ub2cc Gloo\uac00 \uc870\uae08\ub354 \uacbd\ub7c9\ud654\ub41c \ub300\uc548\uc73c\ub85c \uacb0\uc815\ub418\uc5c8\uace0 Gloo\ub97c \ud1b5\ud574 Knative \uc124\uce58\uac00 \uac00\ub2a5\ud558\uac8c \ub418\uc5c8\ub2e4. \ub2e8, Knative Eventing \ucef4\ud3ec\ub10c\ud2b8\ub294 \ud604\uc7ac \uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294\ub2e4\uace0 \ud55c\ub2e4. \\n\\n## Install Knative with Gloo\\n\\n\ucc38\uace0: [Install with Gloo](https://github.com/knative/docs/blob/master/install/Knative-with-Gloo.md)\\n\\n\uac04\ub2e8\ud558\uac8c gloo\uc640 Knative \uc124\uce58\ub97c \ud574\ubcf4\uc790.\\n\\n### Requirements\\n* Kubernetes cluster v1.11 or newer \\n* Enable [MutatingAdmissionWebhook admission controller](https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/#how-do-i-turn-on-an-admission-controller)\\n* kubectl v1.10 or newer\\n* Bash in Mac or Linux\\n\\n### Install Glooctl\\n\\ngloo CLI (glooctl) Download  \\n[https://github.com/solo-io/gloo/releases](https://github.com/solo-io/gloo/releases)\\n\\n\ub610\ub294 \uc9c1\uc811 Download\\n```\\n$ curl -sL https://run.solo.io/gloo/install | sh\\nAttempting to download glooctl version v0.8.1\\nDownloading glooctl-darwin-amd64...\\nDownload complete!, validating checksum...\\nChecksum valid.\\nGloo was successfully installed \ud83c\udf89\\n\\nAdd the gloo CLI to your path with:\\n  export PATH=$HOME/.gloo/bin:$PATH\\n\\nNow run:\\n  glooctl install gateway     # install gloo\'s function gateway functionality into the \'gloo-system\' namespace\\n  glooctl install ingress     # install very basic Kubernetes Ingress support with Gloo into namespace gloo-system\\n  glooctl install knative     # install Knative serving with Gloo configured as the default cluster ingress\\nPlease see visit the Gloo Installation guides for more:  https://gloo.solo.io/installation/\\n```\\n\\nPATH \ub4f1\ub85d\\n```\\n$ export PATH=$HOME/.gloo/bin:$PATH\\n```\\n\\ngloo CLI \ud655\uc778\\n```\\n$ glooctl --version\\nglooctl version 0.8.1\\n```\\n\\nGCP \ubb34\ub8cc\ud50c\ub79c\uc73c\ub85c 3-node \ud074\ub7ec\uc2a4\ud130\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n```\\n$ gcloud container clusters create gloo \\\\\\n  --region=asia-east1-a \\\\\\n  --cluster-version=latest \\\\\\n  --machine-type=n1-standard-2 \\\\\\n  --enable-autorepair \\\\\\n  --num-nodes=3\\n```\\n\\ncluster \uc0dd\uc131\ub41c\uac83\uc744 \ud655\uc778\ud558\uace0 cluster-admin \uad8c\ud55c\uc744 \ud560\ub2f9\ud55c\ub2e4.\\n```\\n$ kubectl get nodes\\nNAME                                  STATUS    ROLES     AGE       VERSION\\ngke-gloo-default-pool-f6bcc479-f8v9   Ready     <none>    9m        v1.11.7-gke.6\\ngke-gloo-default-pool-f6bcc479-fl78   Ready     <none>    9m        v1.11.7-gke.6\\ngke-gloo-default-pool-f6bcc479-gfgw   Ready     <none>    9m        v1.11.7-gke.6\\n\\n$ kubectl create clusterrolebinding cluster-admin-binding \\\\\\n>   --clusterrole=cluster-admin \\\\\\n>   --user=$(gcloud config get-value core/account)\\nYour active configuration is: [cloudshell-25974]\\nclusterrolebinding.rbac.authorization.k8s.io \\"cluster-admin-binding\\" created\\n```\\n\\nGloo\uc640 Knative \uc124\uce58\ub97c \ud55c\ub2e4. \ubbf8\ub9ac `glooctl install knative --dry-run` \uc73c\ub85c \uc804\uccb4 manifest\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n```\\n$ glooctl install knative\\n```\\n\\n\uc704\uc5d0\uc11c \uc124\uce58 \uacfc\uc815\uc740 \uc0dd\ub7b5\ud588\uc9c0\ub9cc Istio\uc5d0 \ube44\ud574 CRD \uac1c\uc218\uac00 \uc801\uc740 \uac83\uc744 \uc54c\uc218\uc788\ub2e4. \ub610\ud55c \uc124\uce58\ub41c \ucef4\ud3ec\ub10c\ud2b8 \uc5ed\uc2dc Istio\uc5d0 \ube44\ud574\uc11c \uac04\uc18c\ud654\ub41c \uac83\uc744 \uc54c\uc218 \uc788\ub2e4. \\n```\\n$ kubectl get pods --namespace gloo-system                                                                                         \\nNAME                                   READY     STATUS    RESTARTS   AGE\\nclusteringress-proxy-59fd6fb56-dmwwm   1/1       Running   0          7m\\ndiscovery-779884d4cc-xlql2             1/1       Running   6          7m\\ngloo-844fc79445-f4zvg                  1/1       Running   6          7m\\ningress-7d75c99874-s4m76               1/1       Running   6          7m\\n\\n$ kubectl get pods --namespace knative-serving\\nNAME                          READY     STATUS    RESTARTS   AGE\\nactivator-746f6bb684-49tfh    1/1       Running   0          12m\\nautoscaler-955f679cd-tx5vw    1/1       Running   0          12m\\ncontroller-7fc84c6584-jbn69   1/1       Running   0          12m\\nwebhook-7797ffb6bf-6pgsw      1/1       Running   0          12m\\n```\\n\\n\uc774\uc804 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub3c4 \uc0ac\uc6a9\ud588\ub358 `gcr.io/knative-sample/helloworld-go` \uc774\ubbf8\uc9c0\ub97c \ud65c\uc6a9\ud558\uc5ec \uc0d8\ud50c\uc571 Knative Service\ub97c \ub9cc\ub4e0\ub2e4.\\n\\n#### service.yaml\\n```\\n$ vi service.yaml\\n\\napiVersion: serving.knative.dev/v1alpha1\\nkind: Service\\nmetadata:\\n  name: helloworld-go\\n  namespace: default\\nspec:\\n  runLatest:\\n    configuration:\\n      revisionTemplate:\\n        spec:\\n          container:\\n            image: gcr.io/knative-sample/helloworld-go\\n            env:\\n              - name: TARGET\\n                value: \\"Go Sample v1\\"\\n```\\n\\n```\\n$ kubectl apply --filename service.yaml\\nservice.serving.knative.dev \\"helloworld-go\\" created\\n```\\n\\n\uc55e\uc5d0\uc11c\ub3c4 \uc124\uba85\ud588\uc9c0\ub9cc `Automatic scaling up and down to zero` \uc73c\ub85c Cold Start\uac00 \ub418\uace0 \uc7a0\uc2dc\ud6c4\uc5d0 \uc544\ub798\uc640 \uac19\uc774 Knative Service\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n```\\n$ kubectl get ksvc helloworld-go -n default  --output=custom-columns=NAME:.metadata.name,DOMAIN:.status.domain]($ kubectl get ksvc helloworld-go -n default  --output=custom-columns=NAME:.metadata.name,DOMAIN:.status.d\\nomain\\nNAME            DOMAIN\\nhelloworld-go   helloworld-go.default.example.com\\n```\\n\\nGloo Ingress\ub97c \ud655\uc778\ud55c\ub2e4. GKE\uc5d0\uc11c \uc124\uce58\ud588\uae30 \ub54c\ubb38\uc5d0 \uc790\ub3d9\uc73c\ub85c LoadBalancer\uac00 \uc5f0\ub3d9\ub418\uc5b4 \uc788\ub294\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n```\\n$ kubectl get svc -n gloo-system\\nNAME                   TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE\\nclusteringress-proxy   LoadBalancer   10.3.244.54    34.**.**.54   80:30978/TCP,443:32448/TCP   39m\\ngloo                   ClusterIP      10.3.243.231   <none>        9977/TCP                     39m\\n\\n$ glooctl proxy url --name clusteringress-proxy\\nhttp://34.**.**.54:80\\n```\\n\\n\uc704\uc5d0\uc11c \uc5bb\uc740 \ub450\uac00\uc9c0 \uc815\ubcf4\ub85c \uc0dd\uc131\ub41c app\uc744 \ud14c\uc2a4\ud2b8\ud55c\ub2e4. Cold Start(default timeout 5\ubd84) \ub54c\ubb38\uc5d0 \uc751\ub2f5\uc774 \ub2a6\uc5b4\uc9c8 \uc218\ub3c4 \uc788\uc9c0\ub9cc \uc7a0\uc2dc \uae30\ub2e4\ub9ac\uba74 \uc751\ub2f5\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n```\\n$ curl -H \\"Host: helloworld-go.default.example.com\\" http://34.**.**.54:80\\nHello Go Sample v1!\\n```\\n\\n\ubb3c\ub860 `Revision`\uc774\ub098 `Route`\ub97c \ud65c\uc6a9\ud558\uc5ec Knative\uc758 \uae30\ub2a5\uc5d0 \ub300\ud574\uc11c\ub3c4 \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4.\\n\\n## \uc815\ub9ac\\nGloo\ub294 Knative ClusterIngress CRD\ub97c \uae30\ubc18\uc73c\ub85c \ub3d9\uc791\ud558\ub294 Istio\uc758 \ub300\uc548\uc73c\ub85c\uc11c \uac00\ub2a5\uc131\uc744 \ubcf4\uc5ec\uc8fc\uace0 \uc788\ub2e4. \uc774\uc678\uc5d0\ub3c4 The Service Mesh Orchestration Platform `SuperGloo`, Debugger for microservices `Squash` \ub4f1 \ub2e4\uc591\ud55c Mesh Layer\uae30\ubc18\uc758 \uc624\ud508\uc18c\uc2a4\ub4e4\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4. \ub610\ub2e4\ub978 \uc2a4\uccd0\uc9c0\ub098\uac08\uc218\ub3c4 \uc788\ub294 \uc624\ud508\uc18c\uc2a4\uc77c\uc218\ub3c4 \uc788\uaca0\uc9c0\ub9cc \ud604\uc7ac \uac1c\ubc1c\ub418\ub294 \ub85c\ub4dc\ub9f5(https://www.solo.io/)\uc744 \ubcf4\uba74 Knative\uac00 \uace0\ub3c4\ud654\ub418\ub294 \uc5ec\uc815\uc5d0 \uac19\uc774 \uac00\ub294 \ubaa8\uc2b5\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\nnext-generation API Gateway\ub85c\uc11c \ub2e4\uc591\ud55c \ud504\ub85c\ud1a0\ucf5c\uc744 \uc9c0\uc6d0\ud558\uae30 \ub54c\ubb38\uc5d0 (HTTP1, HTTP2, gRPC, REST/OpenAPISpec, SOAP, WebSockets, Lambda/Cloud Functions) \ub354\uc6b1\ub354 Microservices \ubc0f Serverless Workload\ub97c \uc218\ud589\ud558\uae30\uc5d0 \ub354\uc6b1 \uc801\ud569\ud55c \uc624\ud508\uc18c\uc2a4\ub85c \ubcf4\uc778\ub2e4. \\n\\n## \ub2e4\uc74c \uc8fc\uc81c\\n\ud604\uc7ac \ud574\ubcf4\uace0 \uc2f6\uc740\uac83\uc740 \ubca0\uc5b4\uba54\ud0c8 Kubernetes Cluster\uae30\ubc18 BGP\ub85c \ub3d9\uc791\ud558\ub294 [MetalLB](https://metallb.universe.tf/)\ub098 [Cillium on AWS](https://cilium.io/try-eks/) \uc778\ub370 \uc2dc\uac04\ub098\ub294 \ub300\ub85c \ud14c\uc2a4\ud2b8 \ud574\ubd10\uc57c \uaca0\ub2e4."},{"id":"kubernetes/knative-knctl/","metadata":{"permalink":"/kubernetes/knative-knctl/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-02-18-knative-knctl.md","source":"@site/blog/2019-02-18-knative-knctl.md","title":"Knative CLI - knctl","description":"Knative CLI tool knctl\uc5d0 \ub300\ud574 \uc54c\uc544\ubcf4\uc790","date":"2019-02-18T00:00:00.000Z","formattedDate":"February 18, 2019","tags":[{"label":"Knative","permalink":"/tags/knative"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"FaaS","permalink":"/tags/faa-s"},{"label":"Serverless","permalink":"/tags/serverless"},{"label":"CRDs","permalink":"/tags/cr-ds"},{"label":"CloudEvents","permalink":"/tags/cloud-events"},{"label":"Mesh","permalink":"/tags/mesh"},{"label":"knctl","permalink":"/tags/knctl"}],"readingTime":14.54,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Knative CLI - knctl","comments":true,"classes":"wide","description":"Knative CLI tool knctl\uc5d0 \ub300\ud574 \uc54c\uc544\ubcf4\uc790","slug":"kubernetes/knative-knctl/","date":"2019-02-18T00:00:00.000Z","categories":["Kubernetes"],"tags":["Knative","Kubernetes","FaaS","Serverless","CRDs","CloudEvents","Mesh","knctl"]},"prevItem":{"title":"Knative with Gloo","permalink":"/kubernetes/knative-using-gloo/"},"nextItem":{"title":"Hybrid Cloud","permalink":"/cloud/Hybrid/"}},"content":"## knctl\\n`knctl` \uc740 Knative CLI \ud234\ub85c \uac04\ub2e8\ud558\uac8c knative cluster\ub97c \ub9cc\ub4e4\uace0 Knative\ub97c \ucd94\uc0c1\ud654\ud574\uc11c \uc571\uae4c\uc9c0 \ubc30\ud3ec\ud560 \uc218 \uc788\ub294 \uc624\ud508\uc18c\uc2a4\uc774\ub2e4. \\n\\n#### \ucc38\uace0\\n* https://github.com/cppforlife/knctl  \\n* https://developer.ibm.com/blogs/2018/11/12/knctl-a-simpler-way-to-work-with-knative/  \\n* https://starkandwayne.com/blog/public-traffic-into-knative-on-gke/\\n\\n### Knative \ub2e4\uc2dc \uc0b4\ud3b4\ubcf4\uae30\\n\\n[\uc55e\uc120 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub3c4 \uc774\uc57c\uae30](https://ddii.dev/kubernetes/knative/) \ud588\uc9c0\ub9cc \uae30\uc874 FaaS(AWS Lambda, Google Cloud Funtions, Azure Function) \uacfc\ub294 \ub2e4\ub978 Serverless \uac1c\ub150\uc73c\ub85c \ubc1b\uc544\ub4e4\uc5b4\uc57c \ud55c\ub2e4.\\n\\n\ub2e4\uc2dc \ud55c\ubc88 \ud2b9\uc9d5\uc744 \ub098\uc5f4\ud574\ubcf4\uba74 \uc544\ub798\uc640 \uac19\ub2e4.\\n\\n- Serverless Container\uc758 \uc2e0\uc18d\ud55c \ubc30\uce58 \\n- Automatic scaling up and down to zero\\n- Istio\ub97c \ubc31\uc5d4\ub4dc\ub85c \ud65c\uc6a9\ud558\uc5ec Routing \uad6c\ud604\\n- \ubc30\ud3ec \ub41c \ucf54\ub4dc \ubc0f config\uc758 \ud2b9\uc815 \uc2dc\uc810 \uc2a4\ub0c5 \uc0f7\\n\\n\uadf8\ub9ac\uace0 \ub2e4\uc74c\uacfc \uac19\uc740 CRDs(Custom Resource Definitions)\ub85c \uad6c\uc131\ub41c \uc624\ube0c\uc81d\ud2b8\ub4e4\ub85c \uc815\uc758\ub41c\ub2e4.\\n\\n- `Route`\ub294 \uc0ac\uc6a9\uc790 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c HTTP endpoint\uc640 Routing\uc744 \uc81c\uacf5\ud55c\ub2e4.\\n- `Revisions`\uc740 code(function)\uc640 config\ub85c \uad6c\uc131\ub41c \ubd88\ubcc0\uc758 \uc2a4\ub0c5\uc0f7. Route\ub97c \ud1b5\ud574 endpoint\ub97c \ud560\ub2f9\ubc1b\uc9c0 \ubabb\ud55c Revision\uc740 \uc790\ub3d9\uc73c\ub85c kubernetes resource\uc5d0\uc11c \uc0ad\uc81c\ub428\\n- `Configuration`\uc740 \uc694\uad6c\ub418\ub294 Revision \ucd5c\uc2e0 \uc0c1\ud0dc\ub97c \uae30\ub85d\ud558\uace0 \uc0dd\uc131\ud558\uace0 \ucd94\uc801\ud560\uc218 \uc788\uc74c. \uc18c\uc2a4 \ud328\ud0a4\uc9c0(git repo\ub098 archive)\ub97c \ucee8\ud14c\uc774\ub108\ub85c \ubcc0\ud658\ud558\uae30 \uc704\ud55c \ub0b4\uc6a9\uc774\ub098 \uba54\ud0c0\ub370\uc774\ud130\ub4f1\uc744 \ud3ec\ud568\uc2dc\ud0ac\uc218 \uc788\uc74c. \\n- `Service`\ub294 `Routes`\uc640 `Configurations` \ub9ac\uc18c\uc2a4\uc758 \ucd94\uc0c1\ud654\ub41c \uc9d1\ud569\uccb4. \ubaa8\ub4e0 \uc6cc\ud06c\ub85c\ub4dc\uc758 lifecycle\uc744 \uad00\ub9ac\ud568. \ud2b8\ub798\ud53d\uc744 \ud56d\uc0c1 \ucd5c\uc2e0\uc758 Revision\uc73c\ub85c route\ub418\ub3c4\ub85d \uc815\uc758\ud560\uc218 \uc788\uc74c\\n\\n\ud558\ub098\uc529 \uc870\uae08 \uc790\uc138\ud788 \uc774\uc57c\uae30 \ud558\uba74 \uc544\ub798\ucc98\ub7fc \uc815\ub9ac \ud560\uc218 \uc788\ub2e4.\\n\\n### Route\\n**Route**\ub294 \uc0ac\uc6a9\uc790 \uc11c\ube44\uc2a4(Code\uc640 Configuration\uc758 Revision\uc815\ubcf4)\uc758 \ub124\ud2b8\uc6cc\ud06c Endpoint\ub97c \uc81c\uacf5\ud55c\ub2e4. kubernetes namespace\ub294 \uc5ec\ub7ec\uac1c\uc758 `Route`\ub97c \uac00\uc9c8\uc218 \uc788\ub2e4. `Route`\ub294 \ud558\ub098 \uc774\uc0c1\uc758 `Revisions`\uc744 \uac00\uc9c0\uba74\uc11c \uc218\uba85\uc774 \uae38\uace0 \uc548\uc815\uc801\uc778 HTTP Endpoint\ub97c \uc81c\uacf5\ud55c\ub2e4. \uae30\ubcf8\uad6c\uc131\uc740 `Route` \uac1d\uccb4\uac00 `Configuration`\uc5d0 \uc758\ud574 \uc0dd\uc131\ub41c \ucd5c\uc2e0\uc758 Revision\uc73c\ub85c \ud2b8\ub798\ud53d\uc744 \uc790\ub3d9\uc73c\ub85c \uc9c0\uc815\ud55c\ub2e4. \uc870\uae08\ub354 \ubcf5\uc7a1\ud55c \uacbd\uc6b0\ub85c\ub294 istio\uc758 \uae30\ub2a5\uc744 \ud65c\uc6a9\ud558\uc5ec \ud2b8\ub798\ud53d\uc744 \ubc31\ubd84\uc728 \uae30\uc900\uc73c\ub85c `Route`\ub97c \uc9c0\uc815\ud560 \uc218 \uc788\ub2e4. \\n\\n### Revision\\n**Revision**\uc740 Code\uc640 Configuration\uc758 \ubd88\ubcc0\uc758 \uc2a4\ub0c5\uc0f7\uc774\ub2e4. \ud558\ub098\uc758 `Revision`\uc740 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \ucc38\uc870\ud558\uace0 \uc120\ud0dd\uc801\uc73c\ub85c `Build`\ub97c \ucc38\uc870\ud560 \uc218 \uc788\ub2e4. `Revision`\uc740 **Configuration**\uc774 \uc5c5\ub370\uc774\ud2b8 \uc2dc \uc0dd\uc131\ub41c\ub2e4.  \\n`Route`\ub97c \ud1b5\ud574 http\uc8fc\uc18c \uc9c0\uc815\uc774 \ubd88\uac00\ub2a5\ud55c `Revision`\uc740 \ud3d0\uae30 \ub418\uace0 \uad00\ub828\ub41c kubernetes \ub9ac\uc18c\uc2a4\uac00 \uc0ad\uc81c\uac00 \ub41c\ub2e4. \uc2dc\uac04\uc774 \uc9c0\ub0a8\uc5d0 \ub530\ub77c `Configuration`\uc774 \uc0dd\uc131\ud55c `Revision` \ud788\uc2a4\ud1a0\ub9ac\uac00 \uc81c\uacf5\ub418\uace0 \uc0ac\uc6a9\uc790\ub294 \uc774\uc804 `Revision`\ub85c \uc27d\uac8c \ub864\ubc31 \ud560 \uc218 \uc788\ub2e4.  \\n\\n### Configuration\\n`Configuration`\uc740 \ucd5c\uc2e0\uc758 `Revision`\uc0c1\ud0dc\ub97c \uc124\uba85\ud558\uace0, \uc0dd\uc131\ud558\uace0, \uc6d0\ud558\ub294 \uc0c1\ud0dc\uac00 \uac31\uc2e0\ub420\ub54c `Revision`\uc758 \uc0c1\ud0dc\ub97c \ucd94\uc801\ud55c\ub2e4. `Configuration`\uc740 `Build`\ub97c \ucc38\uc870\ud558\uc5ec \uc18c\uc2a4(git repo \ub610\ub294 archive)\ub97c \ucee8\ud14c\uc774\ub108\ub85c \ubcc0\ud658\ud558\ub294 \ubc29\ubc95\uc5d0 \ub300\ud55c \uac00\uc774\ub4dc\uac00 \ud3ec\ud568\ub418\uc5b4 \uc788\uac70\ub098 \ub2e8\uc21c\ud788 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \ubc0f \uc218\uc815\uc5d0\uc11c \ud544\uc694\ud55c \uba54\ud0c0 \ub370\uc774\ud130 \ub9cc \ucc38\uc870 \ud560 \uc218 \uc788\ub2e4. \\n\\n### Product Integration\\n\\n2019\ub144 2\uc6d4 \ud604\uc7ac 0.3\uc774 \ub9b4\ub9ac\uc2a4\ub418\uace0 \uc788\uace0 \ubc8c\uc368 \uc5ec\ub7ec \uc81c\ud488\uc5d0 \ud1b5\ud569\uc774 \ub418\uace0 \uc788\ub2e4. \\n\\n\ucd5c\uadfc IBMthink 2019\uc5d0\uc11c Managed Knative (Experimental)\ub97c \ub0b4\ub193\uae30\ub3c4 \ud558\uc600\ub2e4.  \\nhttps://www.ibm.com/blogs/bluemix/2019/02/announcing-managed-knative-on-ibm-cloud-kubernetes-service-experimental/ \\n\\nIstio\ub97c \ud3ec\ud568\ud55c Knative \ub9c8\uc800\ub3c4 \ud488\ub294 \ubaa8\uc2b5\uc73c\ub85c managed kubernetes \uc601\uc5ed\uc5d0\uc11c \uae00\ub85c\ubc8c \ud50c\ub808\uc774\uc5b4\ub4e4 \ubaa8\ub450 \uc11c\ub85c \uce58\uace0\ub098\uac00\ub294 \ubaa8\uc2b5\ub4e4\uc744 \ubcfc\uc218 \uc788\ub2e4. \\n\\n\uc791\ub144 11\uc6d4\uc5d0\ub294 Gitlab \uc81c\ud488\uc548\uc5d0 serverless\ub77c\ub294 extension\ud615\ud0dc\uc758 \uc11c\ube44\uc2a4\uac00 \ucd94\uac00 \ub418\uae30\ub3c4 \ud558\uc600\uace0,  \\nhttps://about.gitlab.com/press/releases/2018-12-11-gitlab-and-triggermesh-announce-gitlab-serverless.html\\n\\ntriggermesh \ub77c\ub294 \uacf3\uc5d0\uc11c\ub294 serverless management platform\uc774\ub77c\ub294 \uc774\ub984\uc73c\ub85c knative \uae30\ubc18 \uba40\ud2f0 \uc11c\ubc84\ub9ac\uc2a4 \ud50c\ub7ab\ud3fc\uc744 \ucd9c\uc2dc\ud558\uae30\ub3c4 \ud558\uc600\ub2e4.  \\nhttps://triggermesh.com/serverless_management_platform/\\n\\nPivotal Function Service (PFS), Google GKE SERVERLESS ADD-ON \ub4f1\uc740 \uc544\uc9c1 early access \uc2e0\uccad\ub9cc \ubc1b\uace0 \uc788\ub294 \uc0c1\ud0dc\uc774\ub2e4.\\n\\n\uc624\ub298\uc740 \uac04\ub2e8\ud558\uac8c \ubc30\ud3ec\ud560\uc218 \uc788\ub294 \ud234 knctl\uacfc \uad00\ub828 use-case\ub97c \uc18c\uac1c\ud558\uace0\uc790 \ud55c\ub2e4.\\n\\n### Kubernetes Cluster \uc0dd\uc131\\n\\n\uc77c\ub2e8 GKE Free tier\uc5d0\uc11c Cluster\ub97c \ud558\ub098 \uc0dd\uc131\ud558\uc790.\\n\\n```\\ngcloud container clusters create knative \\\\\\n  --region=asia-east1-a \\\\\\n  --cluster-version=latest \\\\\\n  --machine-type=n1-standard-2 \\\\\\n  --enable-autoscaling --min-nodes=1 --max-nodes=5 \\\\\\n  --enable-autorepair \\\\\\n  --scopes=service-control,service-management,compute-rw,storage-ro,cloud-platform,logging-write,monitoring-write,pubsub,datastore \\\\  \\n  --num-nodes=3\\n```\\n\\ncluster \uc0dd\uc131\ub41c\uac83\uc744 \ud655\uc778\ud558\uace0 cluster-admin \uad8c\ud55c\uc744 \ud560\ub2f9\ud55c\ub2e4. \\n```\\n$ kubectl get nodes\\nNAME                                     STATUS    ROLES     AGE       VERSION\\ngke-knative-default-pool-d1a39347-5m5t   Ready     <none>    1m        v1.11.7-gke.4\\ngke-knative-default-pool-d1a39347-l6zh   Ready     <none>    1m        v1.11.7-gke.4\\ngke-knative-default-pool-d1a39347-qv5r   Ready     <none>    1m        v1.11.7-gke.4\\n\\n$ kubectl create clusterrolebinding cluster-admin-binding \\\\\\n  --clusterrole=cluster-admin \\\\\\n  --user=$(gcloud config get-value core/account)\\nYour active configuration is: [cloudshell-4728]\\nclusterrolebinding.rbac.authorization.k8s.io \\"cluster-admin-binding\\" created\\n```\\n\\n## knctl \uc124\uce58\\n\\n\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 Mac OS \uc124\uce58 \uae30\uc900\uc73c\ub85c \uc791\uc131\ud558\uc600\ub2e4.\\n\\n#### homebrew \uc124\uce58\\n```\\nbrew install starkandwayne/kubernetes/knctl\\n```\\n\\n#### binary\\nhttps://github.com/cppforlife/knctl/releases \\n```\\n$ wget https://github.com/cppforlife/knctl/releases/download/v0.1.0/knctl-darwin-amd64\\n$ mv knctl-* /usr/local/bin/knctl\\n$ chmod +x /usr/local/bin/knctl\\n```\\n\\n## knctl \ub85c Knative \ubc30\ud3ec\\n\\n\uc124\uce58\ud55c knctl\ub85c Knative \ubc30\ud3ec\ub97c \uc9c4\ud589\ud55c\ub2e4. \uc124\uce58\ub418\ub294 \ub0b4\uc6a9\uc744 \uc9c0\ucf1c\ubcf4\uace0 \uc788\uc73c\uba74 `istio`\ub97c \uba3c\uc800 \ubc30\ud3ec\ud558\uace0 \uadf8\ub2e4\uc74c\uc5d0 `Knative`\ub97c \uc124\uce58\ud558\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \ubc30\ud3ec\ub418\ub294 \ubaa8\ub4c8\ub4e4\uc758 \uc0c1\ud0dc\ub97c \ud558\ub098\ud558\ub098 \uccb4\ud06c\ud574\uc11c \ubc30\ud3ec\ud558\uae30 \ub54c\ubb38\uc5d0 \uc124\uce58\uc0c1\uc5d0 \uacfc\uc815\ub4e4\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```\\n$ knctl install --exclude-monitoring\\n```\\n\\n\ud14c\uc2a4\ud2b8\ub97c \uc704\ud55c namespace `hello-test`\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n```\\n$ kubectl create namespace hello-test\\nnamespace \\"hello-test\\" created\\n```\\n\\nknctl deploy \uba85\ub839\uc73c\ub85c \ucd5c\ucd08 revision\uc744 \ubc30\ud3ec\ud55c\ub2e4.  \\n\uc544\ub798 \uacb0\uacfc\ub97c \ubcf4\uba74 hello-00001 \uc774\ub77c\uace0 \ud558\ub294 \ucd5c\ucd08\uc758 revision\uc744 \uc791\uc131\ud558\uae30 \ub54c\ubb38\uc5d0 `latest` tag\ub97c \ub2ec\uace0 \ubc30\ud3ec\ub97c \ud558\uac8c \ub41c\ub2e4. \\n```\\n$ knctl deploy \\\\\\n      --namespace hello-test \\\\\\n      --service hello \\\\\\n      --image gcr.io/knative-samples/helloworld-go \\\\\\n      --env TARGET=Rev1\\n\\nName  hello\\n\\nWaiting for new revision to be created...\\n\\nTagging new revision \'hello-00001\' as \'latest\'\\n\\nTagging new revision \'hello-00001\' as \'previous\'\\n\\nAnnotating new revision \'hello-00001\'\\n\\nWaiting for new revision \'hello-00001\' to be ready for up to 5m0s (logs below)...\\n\\nhello-00001 > hello-00001-deployment-5cdbfc9bc9-hks6t | 2019/02/17 22:27:50 Hello world sample started.\\n\\nRevision \'hello-00001\' became ready\\n\\nContinuing to watch logs for 5s before exiting\\n\\nSucceeded\\n```\\n\\n```\\nkubectl get svc knative-ingressgateway -n istio-system\\nNAME                     TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)                                                                                                                   AGE\\nknative-ingressgateway   LoadBalancer   10.63.253.209   34.***.***.248   80:32380/TCP,443:32390/TCP,31400:32400/TCP,15011:30082/TCP,8060:31125/TCP,853:32009/TCP,15030:31102/TCP,15031:31631/TCP   6h\\n```\\n\\n\uc704\ucc98\ub7fc Knative\uac00 \ud504\ub85c\ube44\uc800\ub2dd \ub418\uba74\uc11c ingress-gateway\uac00 \ud558\ub098 \uc0dd\uc131\uc774 \ub418\uc5b4\uc788\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\uace0 knctl\ub85c\ub3c4 ingress\ub97c \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4.\\n```\\n$ knctl ingress list\\nIngresses\\n\\nName                    Addresses     Ports  Age\\nknative-ingressgateway  34.***.***.248  80     6h\\n                                        443\\n                                        31400\\n                                        15011\\n                                        8060\\n                                        853\\n                                        15030\\n                                        15031\\n\\n1 ingresses\\n\\nSucceeded\\n```\\n\\n## Knative custom domain \uc5f0\uacb0\\n\\nDomain\uc774 \ubcc4\ub3c4\ub85c \uc5c6\uae30 \ub54c\ubb38\uc5d0 Knative\ub294 \ub0b4\ubd80\uc801\uc73c\ub85c example.com\uc774\ub77c\uace0 \ud558\ub294 \uae30\ubcf8 domain\uc744 \uc0ac\uc6a9\ud55c\ub2e4. \uadf8\ub798\uc11c \uc2e4\uc81c `knctl curl` \uba85\ub839\uc740 \ub0b4\ubd80\uc801\uc73c\ub85c `hello.hello-test.example.com`\uc73c\ub85c curl\uc744 \uc2e4\ud589\ud558\uac8c \ub418\uace0 \ud574\ub2f9 \uacb0\uacfc\ub97c \uc544\ub798\uc640 \uac19\uc774 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```\\n$ knctl curl --service hello -n hello-test\\nRunning: curl \'-sS\' \'-H\' \'Host: hello.hello-test.example.com\' \'http://34.***.***.248:80\'\\n\\nHello Rev1!\\n\\nSucceeded\\n```\\n\\nkubernetes node\uac00 3\uac1c\uc774\ubbc0\ub85c 3\uac1c\uc758 pod\uac00 \uc0dd\uc131\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \uc77c\uc815\uc2dc\uac04(default:5\ubd84)\uc774 \uc9c0\ub098\uba74 `zero to scale` \uad00\uc810\uc5d0\uc11c pod\uac00 \uc885\ub8cc\ub418\ubbc0\ub85c \ub2e4\uc2dc \ud655\uc778\ud560\ub54c\ub294 \ub2e4\uc2dc curl \uba85\ub839\uc744 \ub0a0\ub9ac\uac8c \ub418\uba74 \ub2e4\uc2dc pod\uac00 \uc62c\ub77c\uc624\uac8c \ub41c\ub2e4. \ud574\ub2f9 \uac1c\ub150\uc740 FaaS\ub610\ub294 AWS Lambda\uc5d0\uc11c Cold-Start\uc640 \ub3d9\uc77c\ud55c \uac83\uc774\ub77c \ubcfc \uc218 \uc788\ub2e4.  \\n\\nAWS Cold Start \ucc38\uace0 : https://novemberde.github.io/aws/2018/02/02/Lambda_coldStart.html\\n```\\n$ kubectl get po\\nNAME                                      READY     STATUS    RESTARTS   AGE\\nhello-00001-deployment-5cdbfc9bc9-hks6t   3/3       Running   0          4m\\n```\\n\\n\uac00\uc9c0\uace0 \uc788\ub294 \ub3c4\uba54\uc778\uc774 \uc788\ub2e4\uba74 \uc704\uc5d0\uc11c \ub098\uc628 `34.***.***.248` IP\ub97c domain\uc5d0 \ub9e4\ud551\ud574\ubcf4\uc790.\\n\uc544\ub798\uc5d0\uc11c\ub294 \uae30\uc874 \ubcf4\uc720\uc911\uc778 skcloud.io \ub3c4\uba54\uc778\uc744 \uc5f0\uacb0\ud558\uc600\ub2e4.\\n```\\n$ dig knative.skcloud.io\\n;; ANSWER SECTION:\\nknative.skcloud.io.     603     IN      A       34.***.***.248\\n```\\n\\nknctl domain\uc744 \uc774\uc6a9\ud558\uc5ec default domain\uc744 `knative.skcloud.io`\ub85c \ubcc0\uacbd\ud55c\ub2e4.\\n```\\n$ knctl domain create -d knative.skcloud.io --default\\nSucceeded\\n```\\n\\nknctl routes \uba85\ub839\uc73c\ub85c \ud574\ub2f9 hello-test app\uc758 Endpoint \uc815\ubcf4\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n```\\n$ knctl routes list -n hello-test\\nRoutes in namespace \'hello-test\'\\n\\nName   Domain                               Traffic        Annotations  Conditions  Age\\nhello  hello.hello-test.knative.skcloud.io  100% -> hello  -            3 OK / 3    1h\\n\\n1 routes\\n\\nSucceeded\\n```\\n\\n5\ubd84\uc774\uc0c1 \uae30\ub2e4\ub838\ub2e4\uac00 curl\ub85c \ud655\uc778\ud558\uba74 Cold-Start \ub418\ub294 \uc2dc\uac04(\uba87\ucd08) \uc9c0\uc5f0\uc774 \ubc1c\uc0dd\ud558\uace0 \uacb0\uacfc\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\uc774\ud6c4\uc5d0\ub294 \ubc14\ub85c \uc751\ub2f5\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n```\\n$ curl http://hello.hello-test.knative.skcloud.io/\\nHello Rev1!\\n```\\n\\n## revision \ucd94\uac00\\n\\n\uc774\ubc88\uc5d0\ub294 revision\uc744 \ucd94\uac00\ud574\ubcf4\uc790. TARGET environment \ubcc0\uc218\ub97c `Rev2`\ub85c \uc218\uc815\ud558\uace0 \ubc30\ud3ec\ub97c \ud55c\ub2e4.\\n\uae30\uc874 hello-00002 revision\uc774 \ucd5c\uc2e0 revision\uc73c\ub85c \uac31\uc2e0\ub418\uc5b4 \ubc30\ud3ec\uac00 \ub418\ub294\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n```\\n$ knctl deploy --service hello \\\\\\n    --image gcr.io/knative-samples/helloworld-go \\\\\\n    --env TARGET=Rev2\\nName  hello\\n\\nWaiting for new revision (after revision \'hello-00001\') to be created...\\n\\nTagging new revision \'hello-00002\' as \'latest\'\\n\\nTagging older revision \'hello-00001\' as \'previous\'\\n\\nAnnotating new revision \'hello-00002\'\\n\\nWaiting for new revision \'hello-00002\' to be ready for up to 5m0s (logs below)...\\n\\nhello-00002 > hello-00002-deployment-6cf86bbfc7-sblz9 | 2019/02/17 23:25:43 Hello world sample started.\\n\\nRevision \'hello-00002\' became ready\\n\\nContinuing to watch logs for 5s before exiting\\n\\nSucceeded\\n```\\n\\n\uc2e0\uaddc `revision` \uc11c\ube44\uc2a4\ub97c \ucd94\uac00\ub41c\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \ub9c8\ucc2c\uac00\uc9c0\ub85c \uba87\ucd08\uac04\uc758 Cold-Start delay\uac00 \ubc1c\uc0dd\ud560 \uc218\ub3c4 \uc788\ub2e4. \\n```\\n$ curl http://hello.hello-test.knative.skcloud.io/\\nHello Rev2!\\n\\n$ knctl curl --service hello\\nRunning: curl \'-sS\' \'-H\' \'Host: hello.hello-test.knative.skcloud.io\' \'http://34.***.***.248:80\'\\n\\nHello Rev2!\\n\\nSucceeded\\n```\\n\\nrevision list\ub97c \ud655\uc778\ud574\ubcf4\uba74 \ud604\uc7ac latest, previous TAG\uc815\ubcf4\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n```\\n$ knctl revision list --service hello\\nRevisions for service \'hello\'\\n\\nName         Tags      Annotations  Conditions  Age  Traffic\\nhello-00002  latest    -            1 OK / 4    14m  100% -> hello.hello-test.knative.skcloud.io\\nhello-00001  previous  -            1 OK / 4    4h   -\\n\\n2 revisions\\n\\nSucceeded\\n```\\n\\n## Blue/Green \ubc30\ud3ec\\n\\nBlue/Green Deploy\ub294 knctl rollout \uba85\ub839\uc73c\ub85c \uc218\ud589\ud560\uc218 \uc788\ub2e4.  \\nrollout \ud560\ub54c `--managed-route=false` \uc635\uc158\uc744 \uc918\uc57c \ud2b9\uc815 \ube44\uc728\ub85c routing\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n\uc544\ub798 \uc608\uc2dc\ub294 TARGET environment \ubcc0\uc218\ub97c `blue`, `green`\uc73c\ub85c \ubc14\uafd4\uac00\uba74\uc11c \ubc30\ud3ec\ub97c \uc9c4\ud589\ud558\uc600\ub2e4.\\n```\\n$ knctl deploy --service hello \\\\\\n    --image gcr.io/knative-samples/helloworld-go \\\\\\n    --env TARGET=blue \\\\\\n    --managed-route=false\\nName  hello\\n\\nWaiting for new revision (after revision \'hello-00002\') to be created...\\n\\nTagging new revision \'hello-00003\' as \'latest\'\\n\\nTagging older revision \'hello-00002\' as \'previous\'\\n\\nAnnotating new revision \'hello-00003\'\\n\\nWaiting for new revision \'hello-00003\' to be ready for up to 5m0s (logs below)...\\n\\nRevision \'hello-00003\' became ready\\n\\nContinuing to watch logs for 5s before exiting\\n\\nhello-00003 > hello-00003-deployment-99478dcc5-jf267 | 2019/02/17 23:48:20 Hello world sample started.\\n\\nSucceeded\\n```\\n\\nrevision list\ub97c \ud655\uc778\ud558\uba74 \uc544\ub798\uc640 \uac19\uc774 `latest`\ub85c Traffic \uc804\uccb4\uac00 routing \ub418\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n```\\n$ knctl revision list --service hello\\nRevisions for service \'hello\'\\n\\nName         Tags      Annotations  Conditions  Age  Traffic\\nhello-00005  latest    -            4 OK / 4    44s  100% -> hello.hello-test.knative.skcloud.io\\nhello-00004  previous  -            4 OK / 4    2m   -\\nhello-00003  -         -            1 OK / 4    5m   -\\nhello-00002  -         -            1 OK / 4    28m  -\\nhello-00001  -         -            1 OK / 4    4h   -\\n\\n5 revisions\\n\\nSucceeded\\n```\\n\\n\uc774\ud6c4\uc5d0 rollout\uc744 \ud1b5\ud574 previous\ub85c 90%, latest\ub85c 10%\ub85c \ubcc0\uacbd\uc744 \ud558\uba74 \uc989\uc2dc \ubc18\uc601\uc774 \ub418\uace0 \uc2e4\uc81c \ud2b8\ub798\ud53d\ub3c4 \ubd84\uc0b0\ub418\uc5b4 \ub4e4\uc5b4\uc628\ub2e4. %\uac00 \ub0ae\uc740 \ucabd\uc73c\ub85c routing\uc774 \ub420 \uacbd\uc6b0 Cold-Start\uac00 \ubc1c\uc0dd\ud558\uac8c \ub418\uba74 delay\ub294 \ubc1c\uc0dd\ud558\uac8c \ub41c\ub2e4.\\n```\\n$ knctl rollout --route hello -p hello:latest=10% -p hello:previous=90%\\nSucceeded\\n\\n$ knctl revision list\\nRevisions\\n\\nService  Name         Tags      Annotations  Conditions  Age  Traffic\\nhello    hello-00005  latest    -            2 OK / 4    1h   10% -> hello.hello-test.knative.skcloud.io\\n~        hello-00004  previous  -            2 OK / 4    1h   90% -> hello.hello-test.knative.skcloud.io\\n~        hello-00003  -         -            1 OK / 4    1h   -\\n~        hello-00002  -         -            1 OK / 4    1h   -\\n~        hello-00001  -         -            1 OK / 4    5h   -\\n\\n5 revisions\\n\\nSucceeded\\n```\\n\\n\uac04\ub2e8\ud558\uac8c curl \ubc18\ubcf5\ubb38\uc744 \uc791\uc131\ud558\uc5ec \ub3cc\ub824\ubcf4\uc790. \\n```\\n#!/bin/sh\\nwhile true\\ndo\\ncurl -sS --max-time 3 http://hello.hello-test.knative.skcloud.io/\\ndone\\n```\\n\\n\uac04\ub2e8\ud558\uac8c \uc704 sh\uc744 \ub3cc\ub9ac\uba74 \uc544\ub798\uc640 \uac19\uc774 Cold-Start delay\uac00 \ubc1c\uc0dd\ud560\ub54c time out\uc774 \ubc1c\uc0dd\ud558\uace0 \uc774\ud6c4 green revision\uc73c\ub85c \uc811\uc18d\uc774 \ub418\ub294\uac83\uc744 \ubcfc \uc218 \uc788\ub2e4. \\n```\\n$ ./test.sh\\ncurl: (28) Operation timed out after 3002 milliseconds with 0 bytes received\\nHello blue!\\nHello blue!\\nHello blue!\\nHello blue!\\nHello blue!\\ncurl: (28) Operation timed out after 3003 milliseconds with 0 bytes received\\nHello blue!\\nHello blue!\\nHello blue!\\nHello blue!\\nHello blue!\\nHello blue!\\nHello green!\\nHello blue!\\nHello blue!\\nHello blue!\\n```\\n\\n## \uc815\ub9ac\\n\uc9c0\uae08\uae4c\uc9c0 `knctl`\uc744 \uc0ac\uc6a9\ud558\uc5ec \uac04\ub2e8\ud558\uac8c knative\ub97c \ubc30\ud3ec\ud558\uace0 custom domain\uc744 \uc5f0\uacb0\ud558\uc5ec blue-green \ubc30\ud3ec\uae4c\uc9c0 \ud574\ubd24\ub2e4. \\n\uc774\uc678\uc5d0\ub3c4 Knative Build\ub97c \ud65c\uc6a9\ud558\uc5ec Docker image \uc791\uc5c5\uc744 \ud558\uac70\ub098 \uc11c\ube44\uc2a4 \uce74\ud0c8\ub85c\uadf8 \ub4f1\uc744 \uc5f0\ub3d9\ud558\uc5ec \uc678\ubd80 DBaaS\ub97c \uc5f0\ub3d9\ud558\ub294 use-case\ub4f1\uc744 \ucc3e\uc544\ubcfc\uc218 \uc788\ub2e4.\\n\\n\uc544\uc9c1 \ucd08\uae30 \ub2e8\uacc4\uc774\uc9c0\ub9cc Knative\ub294 istio\uc640 \ud568\uaed8 IBM, Google, Pivotal\ub4f1 global player\ub4e4\uc758 \ucc28\uc138\ub300 \uc624\ud508\uc18c\uc2a4\ub85c \ubd80\uc0c1\ud558\uace0 \uc788\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4.  \\n\\n`Zero to scale` \uc774\ub77c\ub294 \uc2ac\ub85c\uac74\uc544\ub798 Serverless, FaaS \uc0ac\uc0c1\uc744 \uae30\ubc18\uc73c\ub85c build, serving, event, routing\uc774\ub77c\uace0 \ud558\ub294 Cloud Computing \ucd94\uc0c1\ud654\uc758 \ub05d\ud310\uc73c\ub85c \uc9c4\ud654\ud558\uace0 \uc788\ub2e4. \uc55e\uc73c\ub85c \uc5b4\ub5a4 \ubaa8\uc2b5\uc73c\ub85c \uc9c4\ud654\ub420\uc9c0 \uad81\uae08\ud558\uace0 \ub2e4\uc74c\ubc88\uc5d0\ub294 MQ\ub098 Pub/sub\ub97c \uc5f0\ub3d9\ud558\uac70\ub098 \uba40\ud2f0 \ud074\ub77c\uc6b0\ub4dc \ud658\uacbd\uc5d0\uc11c \ub3d9\uc791\ud558\ub294 \ubaa8\uc2b5\uc744 \ubcf4\uc5ec\uc8fc\ub294 \uac83\ub3c4 \uc88b\uc744\uac83 \uac19\ub2e4. \ud76c\ub9dd\uc0ac\ud56d\uc774\uc9c0\ub9cc \uc62c\ud574 OpenInfraDay\ub098 Kubernetes Day Korea \ud589\uc0ac\uc5d0\uc11c Hands-on\uc744 \uc9c4\ud589\ud574\ubcf4\ub294\uac83\ub3c4 \uc88b\uc9c0 \uc54a\uc744\uae4c?"},{"id":"cloud/Hybrid/","metadata":{"permalink":"/cloud/Hybrid/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-02-10-Hybrid.md","source":"@site/blog/2019-02-10-Hybrid.md","title":"Hybrid Cloud","description":"Hybrid Cloud","date":"2019-02-10T00:00:00.000Z","formattedDate":"February 10, 2019","tags":[{"label":"Hybrid","permalink":"/tags/hybrid"},{"label":"Multi","permalink":"/tags/multi"},{"label":"Outpost","permalink":"/tags/outpost"},{"label":"VMware","permalink":"/tags/v-mware"}],"readingTime":9.375,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Hybrid Cloud","comments":true,"classes":"wide","description":"Hybrid Cloud","slug":"cloud/Hybrid/","date":"2019-02-10T00:00:00.000Z","categories":["Cloud"],"tags":["Hybrid","Multi","Outpost","VMware"]},"prevItem":{"title":"Knative CLI - knctl","permalink":"/kubernetes/knative-knctl/"},"nextItem":{"title":"SRE (Site Reliablity Engineering)","permalink":"/job/SRE/"}},"content":"\uc624\ub298\ub3c4 \uae30\uc220\uc801\uc778 \uc774\uc57c\uae30\ubcf4\ub2e4\ub294 \ud654\ub450\uac00 \ub418\uace0 \uc788\ub294 \ud558\uc774\ube0c\ub9ac\ub4dc \ud074\ub77c\uc6b0\ub4dc \uc774\uc57c\uae30\ub97c \ud574\ubcf4\uace0\uc790 \ud55c\ub2e4.\\n\\n\uc5c5\uacc4 \uc0ac\ub78c\ub4e4\ub3c4 \ud558\uc774\ube0c\ub9ac\ub4dc, \uc5e3\uc9c0 \ud074\ub77c\uc6b0\ub4dc \uc11c\ube44\uc2a4\ub97c \uae0d\uc815\uc801\uc778 \uc2dc\uac01\uc73c\ub85c \ubcf4\uace0\uc788\uc9c0\ub9cc \uc131\uc219\ub3c4 \uce21\uba74\uc5d0\uc11c \ubb38\uc81c\uac00 \uc788\uc5b4 \ub3c4\uc785\uc744 \uaebc\ub824\uc654\ub358\uac8c \uc0ac\uc2e4\uc774\ub2e4. \ucd5c\uadfc \ub3d9\ud5a5\uc744 \ubd24\uc744\ub54c \ud37c\ube14\ub9ad \ud074\ub77c\uc6b0\ub4dc \uacf5\uae09\uc0ac\uc5d0\uc11c\ub3c4 \ud504\ub77c\uc774\ube57 \ud074\ub77c\uc6b0\ub4dc\ub97c \ud3ec\uc12d\ud574\uc57c\ud560 \ub300\uc0c1\uc73c\ub85c \uc778\uc815\ud558\uace0 \uacf5\uaca9\uc801\uc73c\ub85c \ud558\uc774\ube0c\ub9ac\ub4dc \ud074\ub77c\uc6b0\ub4dc \uc194\ub8e8\uc158\uc744 \uac1c\ubc1c\ud558\uc5ec \uc81c\uacf5\ud558\ub824\uace0 \ud558\ub294 \uc6c0\uc9c1\uc784\uc744 \ubcf4\uc774\uace0 \uc788\ub2e4.\\n\\n\uc5d4\ud130\ud504\ub77c\uc774\uc988\uc5d0\uc11c\ub294 \uc785\uc7a5\uc5d0\uc11c\ub294 Scale, DR\uce21\uba74\uc5d0\uc11c On-Prem \uc5d0\uc11c \ud37c\ube14\ub9ad\uc73c\ub85c \ud655\uc7a5\uc744 \ub3c4\ubaa8\ud558\uace0 \uc788\uace0 \uae00\ub85c\ubc8c\ud50c\ub808\uc774\uc5b4 \uc785\uc7a5\uc5d0\uc11c\ub294 \ud37c\ube14\ub9ad\uc5d0\uc11c On-Prem\uc73c\ub85c \uc804\uc774\ud558\ub294 \ubaa8\uc2b5\uc73c\ub85c \ube44\uc988\ub2c8\uc2a4\ub97c \uc9c4\ud589\ud558\uace0 \uc788\ub2e4. \ud558\uc9c0\ub9cc \uad6c\uae00\uc740 \ud2b9\ubcc4\ud558\uac8c \ucee8\ud14c\uc774\ub108 \uae30\ubc18\uc73c\ub85c \uc9c4\ud589\uc911\uc774\ub2e4. \ub204\uac00 \ub05d\uae4c\uc9c0 \uc0b4\uc544\ub0a8\uc544 \uc2b9\uc790\uac00 \ub420\uc9c0 \uc544\ubb34\ub3c4 \ubaa8\ub978\ub2e4. \\n\\n\uc55e\uc73c\ub85c \uc5f4\ub9b4 \uc2dc\uc7a5\uc740 \ud655\uc2e4\ud558\uace0 \uaf2d \ud544\uc694\ud558\ub2e4\ub294 \uac83\uc740 \uc54c\uc9c0\ub9cc \uae30\uc220\uc758 \uc131\uc219\ub3c4\uac00 \ub192\uc9c0 \uc54a\uace0 \ub118\uc5b4\uc57c\ud560 \ud5c8\ub4e4\uc774 \ub9ce\ub2e4. \uc544\uc9c1\uae4c\uc9c0 \uc5f0\uacc4 \uae30\uc220\uc774\ub098 \uc0dd\ud0dc\uacc4\uac00 \ube44\uc5b4 \uc788\ub294 \ubd80\ubd84\ub4e4\uc774 \uc874\uc7ac\ud558\uae30 \ub54c\ubb38\uc5d0 \uc62c\ud574 \ub9d0\ucbe4 \ub418\uba74 \uc5ec\ub7ec \uc0c1\ud488\ub4e4\uc774 \ucd9c\uc2dc\ub418\uba74\uc11c \uc815\ub9ac \ub418\uc9c0 \uc54a\uc744\uae4c \uc2f6\ub2e4. \\n\\nhttps://wikibon.com/aws-outposts-enables-hybrid-cloud/\\n\\n\uc704 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub3c4 2\uac00\uc9c0 \uc758\ubb38\uc810\uc744 \uc81c\uae30\ud55c\ub2e4.\\n\\n* Will a data egress charge be applied to data resident on the disks to other on-premise workloads?  \\n`\uc608\uc2dc) S3 \u2192 Outpost egress \ud2b8\ub798\ud53d(private n/w \uc774\uae34 \ud558\uc9c0\ub9cc aws\uac00 \ub3c8\uc744 \uc548 \ubc1b\uc744\uac83\uc778\uac00?, \uacb0\uad6d direct-link\ub294 \ud544\uc218\uc778\uac74\uc9c0?)`\\n\\n* Is the data on site under the legal control of AWS or the customer?  \\n`\ub370\uc774\ud130\uc758 \uc18c\uc720\uad8c \ubb38\uc81c(\uc774\uac8c \uc2ec\uac01\ud55c \ubb38\uc81c\uac00 \ub420\uc218 \uc788\ub2e4)`\\n\\n\uadf8\ub798\uc11c AWS\uac00 \uc791\ub144\uc5d0 \ub0b4\ub193\uc740 Outpost\uc758 \uccab\uadf8\ub9bc\uc740 [VMware on AWS](https://aws.amazon.com/ko/outposts/features/)\ub85c \uc791\ub144 reinvent\uc774\ud6c4 \ub9ce\uc740 \uad00\uc2ec\uc744 \ubc1b\uc558\ub358 \ud504\ub85c\uc81d\ud2b8\uc774\ub2e4. \\n\\n\uc774\uc678\uc5d0\ub3c4 \uba54\uc774\uc800 \uc0ac\ub4e4\ub3c4 [Azure Stack](https://azure.microsoft.com/ko-kr/overview/azure-stack/), [VMware on IBM Cloud](https://www.ibm.com/kr-ko/cloud/vmware), [VMware on Ncloud](https://www.ncloud.com/product/hybridPrivateCloud/vmwareOnNcloud)\uc640 \uac19\uc740 \ud558\uc774\ube0c\ub9ac\ub4dc \uc11c\ube44\uc2a4\ub97c \ub0b4\ub193\uace0 \uc788\ub2e4. \\n\\n### Product\ubcc4 \uae30\ubcf8 \uc804\ub7b5\\n#### Azure Stack\\n* \ud638\ud658\uc131 \uc778\uc99d\ubc1b\uc740 \uc11c\ubc84\ub97c On-prem\uc5d0 \uad6c\ub9e4/\uc124\uce58\ud558\uace0 Azure UI \ubc0f API\uc640 \ub3d9\uc77c\ud55c UI/UX\ub85c private cloud \uc0ac\uc6a9\\n\\n#### AWS Outpost\\n* \uace0\uac1d On-prem\uc5d0 EC2 cloud instances \uc81c\uacf5 (\uc804\uc6a9 HPC \ud558\ub4dc\uc6e8\uc5b4 - EC2 Nitro Platform)\\n\\n#### AWS Outpost(VMware based)\\n* baremetal \uc804\uc6a9 \ud50c\ub7ab\ud3fc\uc73c\ub85c VMware - software, AWS - hardware \uc5d0 \uc9d1\uc911\\n\\n#### Google Cloud\\n* K8s On-prem\uc804\ub7b5\uc744 \uae30\ubcf8\uc73c\ub85c Cisco\uc640 \ud558\uc774\ube0c\ub9ac\ub4dc \uc804\ub7b5 (based on Istio)\\n\\n#### IBM Cloud\\n* \uad6c\uae00\uacfc \uc720\uc0ac\ud558\uac8c Istio\ub97c \uae30\ubcf8\uc73c\ub85c \ud558\uc5ec \uba40\ud2f0, \ud558\uc774\ube0c\ub9ac\ub4dc \ud074\ub77c\uc6b0\ub4dc \uc81c\ud488 \ucd9c\uc2dc\\n* IKS on Vmware on IBM Cloud Baremetal \uc640 \uac19\uc740 \uc0c1\ud488\ub3c4 \ucd9c\uc2dc\\n\\n\\n\ub300\ubd80\ubd84 VMware \ud611\ub825\uc744 \uae30\ubc18\uc73c\ub85c \ud558\uc774\ube0c\ub9ac\ub4dc \ud074\ub77c\uc6b0\ub4dc \uc804\ub7b5\uc744 \uc804\uac1c\ud558\uace0 \uc788\uace0 \ub0b4\uba74\uc744 \ub4e4\uc5ec\ub2e4\ubcf4\uba74 \ubb3c\ub9ac\uc801\uc73c\ub85c \ub2e4\ub978\uacf3\uc5d0 \uc788\ub294 Overlay \ub124\ud2b8\uc6cc\ud06c\uc5d0 \ub300\ud55c \ud574\uacb0\uc774 \uac00\uc7a5 \ubb38\uc81c\uc774\uae30 \ub54c\ubb38\uc5d0 Direct-link\ub098 VPN\uc744 \ud1b5\ud574 \uc5f0\uacb0\ud558\ub294\uac83\ub3c4 \uacb0\uad6d \ud074\ub77c\uc6b0\ub4dc \uc0ac\uc5c5\uc790\uac00 \ub124\ud2b8\uc6cc\ud06c \ud2b8\ub798\ud53d \ube44\uc6a9\uc744 \uac00\uc838\uac00\uc9c0 \uc704\ud55c \uc804\ub7b5\uc73c\ub85c\uc11c \ubcf4\uc778\ub2e4. \\n\\n\uc2e4\uc81c \ud37c\ube14\ub9ad \ud074\ub77c\uc6b0\ub4dc \ubca4\ub354\uc758 Cash Cow\ub294 Compute \uc790\uc6d0\ubcf4\ub2e4\ub294 \ub124\ud2b8\uc6cc\ud06c \ube44\uc6a9\uacfc Blob Storage, API\uacfc\uae08 \ub4f1 \uc5d0 \ub300\ud55c \ub9e4\ucd9c\uc774 \ud070 \ube44\uc911\uc744 \ucc28\uc9c0\ud55c\ub2e4\uace0 \ubd10\uc57c \ud55c\ub2e4. \ud639\uc790\ub294 \uae00\ub85c\ubc8c \ub124\ud2b8\uc6cc\ud06c \uc804\uc6a9\uc120\uc5d0 \ub300\ud55c \ud22c\uc790\ub098 \uace0\uc131\ub2a5 HPC\ub3c4\uc785 \ud22c\uc790 \ube44\uc6a9\uc5d0 \ub300\ud55c \ub9d0\ub4e4\uc744 \ud558\uc9c0\ub9cc IBM\uac19\uc740 \uacbd\uc6b0 \uae00\ub85c\ubc8c \ub124\ud2b8\uc6cc\ud06c \ubb34\ub8cc \uc815\ucc45\uc744 \ud1b5\ud574 Market Share\ub97c \ud68d\ub4dd\ud558\uace0\uc790 \ud558\ub294 \ubd80\ubd84\ub4e4\uc744 \ubcf4\uba74 \ub124\ud2b8\uc6cc\ud06c\uac00 \uac00\uc7a5 \ud575\uc2ec\uc774 \uc544\ub2d0\uae4c \uc2f6\ub2e4.  \\n\\n\ud074\ub77c\uc6b0\ub4dc\ub97c \uc774\uc57c\uae30 \ud560\ub54c \uae30\uc220 \uc131\uc219\ub3c4\ub97c \ubcf4\uba74 Compute > Storage > Network \uc21c\uc73c\ub85c \uc804\uc774\uac00 \ub418\ub294\ub370 OpenStack\uc774\ub098 Kubernetes \ud504\ub85c\uc81d\ud2b8\uc640 \uac19\uc740 \uc624\ud508\uc18c\uc2a4\ub098 VMware NSX \ud50c\ub7ab\ud3fc\ub9cc \ubd10\ub3c4 \uc815\ub9d0 \ub124\ud2b8\uc6cc\ud06c\uac00 \uc911\uc694\ud55c \uc601\uc5ed\uc774 \ub418\uace0 \uc788\uc74c\uc744 \uc54c\uc218 \uc788\ub2e4. \\n\\n\uacb0\uad6d \ud575\uc2ec\uc801\uc73c\ub85c \ubd10\uc57c\ud558\ub294 \ubd80\ubd84\uc740 \ub124\ud2b8\uc6cc\ud06c\ub2e4. \ub124\ud2b8\uc6cc\ud06c \ubd80\ubd84\uc5d0\uc11c \uc544\uc8fc \uac15\ub825\ud55c \uc194\ub8e8\uc158\uc774 \ub098\uc640\uc57c \ud55c\ub2e4. \uacb0\uad6d \ud68c\uc120 \ube44\uc6a9\uc774 \ubb38\uc81c\uace0 \ucd5c\uadfc \ub137\ud50c\ub9ad\uc2a4\uc640 SKB\uc758 \uc18d\ub3c4 \ubd84\uc7c1\ub9cc \ubd10\ub3c4 \uacb0\uad6d \uac15\uc790\uc758 \ub17c\ub9ac\ub85c \ub124\ud2b8\uc6cc\ud06c \ubb38\uc81c\uac00 \ud574\uacb0\ub418\ub294 \uc2dc\ub300\uac00 \uc628 \uac83\uc774\ub2e4.\\n\\n### \uc815\ub9ac\\n\\n\ub0b4\uac00 \uc0dd\uac01\ud55c \uc11c\ube44\uc2a4 \uc0ac\uc6a9\uc790 \uce21\uba74\uc5d0\uc11c \uc6b0\ub9ac\uac00 \uace0\ub824\ud574\uc57c\ud560 \ud074\ub77c\uc6b0\ub4dc \uc635\uc158\ub4e4\uc744 \uc815\ub9ac\ud574\ubcf4\uba74 \uc544\ub798\uc640 \uac19\ub2e4.\\n\\n* \uba40\ud2f0 \ud074\ub77c\uc6b0\ub4dc : \ud37c\ube14\ub9ad \ud074\ub77c\uc6b0\ub4dc to \ud37c\ube14\ub9ad \ud074\ub77c\uc6b0\ub4dc \uc6b4\uc601 \uc194\ub8e8\uc158\uc73c\ub85c \ud504\ub77c\uc774\ube57 \ud074\ub77c\uc6b0\ub4dc \uc601\uc5ed\uc5d0\ub294 \uac70\uc758 \uad00\uc5ec\ub97c \uc548\ud558\uba70, \uc194\ub8e8\uc158\uc5d0 \ub530\ub77c \uc77c\ubd80 \uac00\uc0c1\ud654\ub41c Computing \uc790\uc6d0\uae4c\uc9c0 \ubaa8\ub2c8\ud130\ub9c1 \uc9c0\uc6d0\ud558\uae30\ub3c4 \ud568. \uba40\ud2f0 \ud074\ub77c\uc6b0\ub4dc \uc6b4\uc601 \ud50c\ub7ab\ud3fc\uc740 \uc8fc\ub85c \ud074\ub77c\uc6b0\ub4dc Brokerage Service \ud615\ud0dc\ub85c \uc81c\uacf5\ub418\uc5b4\uc57c \ud558\ubbc0\ub85c MSP\uc5ed\ud560\uc774 \uc911\uc694\ud574\uc9c8 \uac83 \uac19\ub2e4. \uba54\uac00\uc874, \ubca0\uc2a4\ud540\uae00\ub85c\ubc8c\uacfc \uac19\uc740\uacf3 \ubfd0\uc544\ub2c8\ub77c \uc790\uccb4\uc801\uc778 \ud074\ub77c\uc6b0\ub4dc\ub97c \uc6b4\uc601\ud558\ub294 \ub300\ud615 SI\ud68c\uc0ac\ub97c \ud3ec\ud568\ud55c \uae30\uc874 IaaS \uc6b4\uc601\uc870\uc9c1\uc758 \ubcc0\ud654\ub4e4\ub3c4 \ub208\uc5ec\uaca8 \ubd10\uc57c\ud560\uac83 \uac19\ub2e4. \ub9c8\uc9c4\uc728\uc774 \ub0ae\uc740 \ub808\ub4dc\uc624\uc158 \uc2f8\uc6c0\uc5d0\uc11c \ub204\uac00 \uc774\uae30\ub290\ub0d0\uac00 \uc911\uc694\ud558\uae30 \ubcf4\ub2e4\ub294 \ubbf8\ub798\ub97c \ubcf4\uace0 \ud22c\uc790\ud558\ub294 \uc790\uc138\uac00 \ud544\uc694\ud558\ub2e4\uace0 \ubcf8\ub2e4. \\n\\n* \ud504\ub77c\uc774\ube57 \ud074\ub77c\uc6b0\ub4dc : \ud504\ub77c\uc774\ube57 \ud074\ub77c\uc6b0\ub4dc \uc804\uc6a9 \uc194\ub8e8\uc158\uc73c\ub85c \ubca4\ub354 \ub610\ub294 \ud2b9\uc815 IaaS \uc11c\ube44\uc2a4\uc5d0 \ucd5c\uc801\ud654\ub41c \uacbd\uc6b0\uac00 \ub9ce\uc73c\ubbc0\ub85c VMware, OpenShift, OpenStack Managed \uc11c\ube44\uc2a4\ub4f1 \uae30\uc874 \uc81c\ud488\uc5d0\uc11c\uc758 \uc5f0\uc7a5\uc120\uc5d0\uc11c \uc5bc\ub9c8\ub098 \uc624\ud508\uc18c\uc2a4\ub97c \uc774\ud574\ud558\uace0 \ud504\ub85c\ub355\uc158\uc5d0 \uc801\uc6a9\ud560\uc218 \uc788\ub294 \uc5ed\ub7c9\uc744 \uae30\ub974\ub294\uac83\uc774 \uc911\uc694\ud558\ub2e4. \\n\\n* \ud558\uc774\ube0c\ub9ac\ub4dc \ud074\ub77c\uc6b0\ub4dc : \ud37c\ube14\ub9ad \ud074\ub77c\uc6b0\ub4dc to \ud504\ub77c\uc774\ube57 \ud074\ub77c\uc6b0\ub4dc \uc6b4\uc601 \uc194\ub8e8\uc158\uc73c\ub85c \ud504\ub77c\uc774\ube57 \ud074\ub77c\uc6b0\ub4dc\uc758 \uc778\ud504\ub77c\uc2a4\ud2b8\ub7ed\ucc98\uae4c\uc9c0 \uad00\uc5ec\ub97c \ud558\uba70, \ud37c\ube14\ub9ad \ud074\ub77c\uc6b0\ub4dc \uc601\uc5ed\uc740 \uc77c\ubc18\uc801\uc73c\ub85c IaaS \uc601\uc5ed\uacfc \uc77c\ubd80 PaaS / \ucee8\ud14c\uc774\ub108\uae4c\uc9c0 \uad6c\uc131, \ubaa8\ub2c8\ud130\ub9c1 \uc9c0\uc6d0\ud574\uc57c \ud558\uace0 \uc774\ub97c \uc704\ud55c 3rd Party \uc194\ub8e8\uc158\ub4e4\uc774 \ub4f1\uc7a5\ud558\uace0 \uc788\uace0 \uc810\ucc28 \uc601\uc5ed\uc744 \ud655\ub300\ud560\uac83\uc774\ub2e4. \uc774\uc5d0 \uc788\uc5b4 \ucee8\ud14c\uc774\ub108 \ud50c\ub7ab\ud3fc\uc744 \ub3c4\uc785\ud558\ub294\uac83\uc774 \uac00\uc7a5 \uae00\ub85c\ubc8c \ud50c\ub808\uc774\uc5b4\uc640 \uaca9\ucc28\ub97c \uc904\uc774\ub294\ub370 \ud6a8\uacfc\uc801\uc778 \ub3c4\uad6c\ub77c \uc0dd\uac01\ud55c\ub2e4. \uacb0\uad6d \ud558\uc774\ube0c\ub9ac\ub4dc \ud074\ub77c\uc6b0\ub4dc \uad6c\ud604\uc740 \uae30\uc874 Public\uacfc Local Cloud\uac04 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacc4\uac00 \uc911\uc694\ud55c \ud3ec\uc778\ud2b8\uc774\ub2e4.\\n\\n* \uac04\ub2e8\ud788 \uad6c\ud604\ud574 \ubcfc\uc218 \uc788\ub294 General Hybrid Kubernetes Architecture\ub97c \uac04\ub2e8\ud788 \uadf8\ub824\ubd24\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c StrongSwan VPN\uc744 \uac00\uc9c0\uace0 CI/CD\ub97c \uace0\ub824\ud55c DevOps\uad00\uc810\uc5d0\uc11c\uc758 \uad6c\uc131\ub3c4\uc774\ub2e4.\\n![hybrid-cloud](/img/hybrid-cloud.png)\\n\\n\uc704\uc5d0 \ub0b4\uc6a9\uacfc \ud568\uaed8 \ud558\uc774\ube0c\ub9ac\ub4dc \ud074\ub77c\uc6b0\ub4dc\ub97c \uace0\ub824\ud560\ub54c `\ub370\uc774\ud130 \uc18c\uc720\uad8c \uce21\uba74\uc5d0\uc11c\uc758 \uac70\ubc84\ub10c\uc2a4` \uc640 `overlay \ub124\ud2b8\uc6cc\ud06c`\uc5d0 \ub300\ud55c \uace0\ubbfc\uc774 \ub3d9\ud589\ub418\uc5c8\uc744\ub54c \uc131\uacf5\uc801\uc778 \ud558\uc774\ube0c\ub9ac\ub4dc \ud074\ub77c\uc6b0\ub4dc\ub97c \uad6c\ucd95\ud560\uc218 \uc788\ub2e4\ub77c\ub294 \ub098 \ud63c\uc790\ub9cc\uc758 \uc0dd\uac01\uc744 \uc815\ub9ac\ud574\ubd24\ub2e4."},{"id":"job/SRE/","metadata":{"permalink":"/job/SRE/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-01-30-SRE.md","source":"@site/blog/2019-01-30-SRE.md","title":"SRE (Site Reliablity Engineering)","description":"SRE \uc18c\uac1c","date":"2019-01-30T00:00:00.000Z","formattedDate":"January 30, 2019","tags":[{"label":"SRE","permalink":"/tags/sre"},{"label":"DevOps","permalink":"/tags/dev-ops"}],"readingTime":12.76,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"SRE (Site Reliablity Engineering)","comments":true,"classes":"wide","description":"SRE \uc18c\uac1c","slug":"job/SRE/","date":"2019-01-30T00:00:00.000Z","categories":["Job"],"tags":["SRE","DevOps"]},"prevItem":{"title":"Hybrid Cloud","permalink":"/cloud/Hybrid/"},"nextItem":{"title":"2018 Retrospective","permalink":"/retrospective/newyear-plan/"}},"content":"\uadf8\ub3d9\uc548 DevOps \ub2f4\ub2f9\uc790\ub77c\uace0 \ubd80\ub974\uc9d6\ub358 \uc0ac\ub78c\ub4e4\uc758 Role\uc774 \uc778\ud504\ub77c \ub2f4\ub2f9\uc790\uc778\uc9c0 \ud50c\ub7ab\ud3fc \ub2f4\ub2f9\uc790\uc778\uc9c0 \uc544\ub2c8\uba74 \uac1c\ubc1c\ud558\ub294 \uc6b4\uc601\uc790\uc778\uc9c0 \ud5f7\uac08\ub9b4\ub54c\uac00 \ub9ce\uc558\ub2e4.\\n\\n\uac11\uc790\uae30 \uad6d\ub0b4\uc5d0\uc11c\ub3c4 SRE \ucc44\uc6a9 \uacf5\uace0\uac00 \ub9ce\uc544\uc9c0\ub294\uac83\uc744 \ubcf4\uba74\uc11c \ub0b4 \uc790\uc2e0\ub3c4 \ud55c\ubc88 \uc815\ub9ac\ub97c \ud558\uace0 \uac00\uc57c\ud560\uac83 \uac19\uc740 \uc0dd\uac01\uc774 \ub4e4\uc5c8\ub2e4.\\n\\nhttps://docs.microsoft.com/ko-kr/learn/modules/intro-to-site-reliability-engineering/\\n\\n\uac1c\ub150\uc815\ub9ac \uce21\uba74\uc5d0\uc11c \uc704 MS Azure\uc758 \uc628\ub77c\uc778 \uad50\uc721\ub0b4\uc6a9\uc744 \uc815\ub9ac\ud574\ubd24\ub2e4.\\n\\n## SRE\\n\\nSRE(\uc0ac\uc774\ud2b8 \uc548\uc815\uc131 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1)\ub780 \uc870\uc9c1\uc774 \ud574\ub2f9 \uc2dc\uc2a4\ud15c, \uc11c\ube44\uc2a4 \ubc0f \uc81c\ud488\uc5d0\uc11c \uc801\uc808\ud55c \uc218\uc900\uc758 \uc548\uc815\uc131\uc744 \ub2ec\uc131\ud558\ub3c4\ub85d \uc9c0\uc6d0\ud558\ub294 \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1 \ubd84\uc57c\uc774\ub2e4. \\n\\n\ucd9c\ucc98 : https://landing.google.com/sre/sre-book/chapters/introduction/\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c \uc6b4\uc601\uacbd\ud5d8\uc774 \uc788\ub294 sysadmin, IT\uc804\ubb38\uac00, DevOps\uc2e4\ud589 \ub2f4\ub2f9\uc790 \ub4f1\uc774 \ub300\uc0c1\uc774 \ub420 \uc218 \uc788\ub2e4.\\n\\n\\n### \uc801\uc808\ud55c \uc218\uc900\uc758 \uc548\uc815\uc131\\n\uac00\uc7a5 \ud575\uc2ec\uc774 \ub418\ub294 \ub2e8\uc5b4\ub294 `\uc548\uc815\uc131`\uc774\ub2e4. \uc870\uc9c1\uc5d0\uc11c \ub9cc\ub4e0 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc774 \uc548\uc815\uc131\uc774 \ubd80\uc871\ud558\uc5ec \uc791\ub3d9\ud558\uc9c0 \uc54a\uac70\ub098 \ubd88\uc548\uc815\ud55c \uacbd\uc6b0 \uc2e4\uc81c \ube44\uc988\ub2c8\uc2a4\uc5d0 \ud53c\ud574\ub97c \uc904 \uc218 \uc788\ub2e4\ub294\uac74 \ub204\uad6c\ub098 \uc54c\uace0 \uc788\ub294 \ub2f9\uc5f0\ud55c \uc774\uc57c\uae30\uc774\uc9c0\ub9cc 100%\uc758 \uc548\uc815\uc801\uc778 \uc2dc\uc2a4\ud15c\uc740 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc73c\ubbc0\ub85c \uc801\uc808\ud55c \uc218\uc900(\uc815\ub7c9\uc801\uc73c\ub85c \uce21\uc815\ud558\uae34 \uc5b4\ub835\uc9c0\ub9cc \uc774\ud574\uad00\uacc4\uc790\ub4e4\uc774 \ub0a9\ub4e4\ud560\ub9cc\ud55c \uc218\uc900)\uc758 \uc548\uc815\uc131\uc744 \ub2ec\uc131\ud558\uae30 \uc704\ud55c \uc77c\ub828\uc758 \uc791\uc5c5\ub4e4\uc744 \uc218\ud589\ud558\ub294 \uac83\uc774 SRE\uc758 \uae30\ubcf8 \uc18d\uc131\uc774\ub77c\uace0 \ubcfc\uc218 \uc788\ub2e4. \\n\\nSRE\ub294 Google\uc5d0\uc11c 2003\ub144\ubd80\ud130 7\uba85\uc758 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \uc5d4\uc9c0\ub2c8\uc5b4\ub85c \uad6c\uc131\ub41c \ud300\uc5d0\uc11c \uc2dc\uc791\ub41c \uc774\ud6c4 (\uc790\uc138\ud55c \ub0b4\uc6a9\uc740 \uc704 \ub9c1\ud06c ebook \ucc38\uc870) Google \uc0ac\ub0b4\uc5d0 \ub110\ub9ac \ud655\uc0b0\ub418\uace0 \ub0b4\ubd80\uc801\uc778 \ubb38\ud654\ub85c \uc870\uc131\ub418\ub294 \uc911\uc5d0 \ubc16\uc5d0\uc11c\ub294 DevOps\ub77c\uace0 \ud558\ub294 \ubb38\ud654\uac00 \ub3d9\uc2dc\uc5d0 \ud655\uc0b0\ub418\uc5c8\ub2e4 \ud55c\ub2e4. \uacb0\uad6d \ub3d9\uc77c\ud55c \ubb38\uc81c\ub97c \ud574\uacb0\ud558\uae30 \uc704\ud55c \uce21\uba74\uc5d0\uc11c \ub450\uac1c\uc758 \ubc29\ubc95\ub860\uc740 \ub2e4\ub974\ub2e4\uace0 \ubd10\uc57c\ud55c\ub2e4. \\n\\n\\n### \ucc28\uc774\uc810\\n* SRE - \uc548\uc815\uc131\uc744 \uc704\ud55c \uc5d4\uc9c0\ub2c8\uc5b4\ub9c1, DevOps - \uac1c\ubc1c\uacfc \uc6b4\uc601\uc870\uc9c1 \uac01\uac01\uc758 \uc0ac\uc77c\ub85c\ub97c \ud574\uccb4\ud558\uae30 \uc704\ud55c \ubb38\ud654\uc801\uc778 \uc6c0\uc9c1\uc784\\n* SRE - \uc800\ub294 SRE \uc785\ub2c8\ub2e4, DevOps - \uc800\ub294 DevOps\ub97c \ud558\ub294 \uc6b4\uc601\uc790 \ub610\ub294 \uac1c\ubc1c\uc790 \uc785\ub2c8\ub2e4.\\n* SRE - \uaddc\ubc94\uc73c\ub85c \uc778\uc2dd, DevOps - \ubb38\ud654\ub85c \uc778\uc2dd\\n  \\n### \uacf5\ud1b5\uc810\\n* \ubaa8\ub2c8\ud130\ub9c1/\uc2dd\ubcc4 \uac00\ub2a5, \uc790\ub3d9\ud654\\n\\n\\n## \uc8fc\uc694 SRE\uc6d0\uce59 : \uc120\uc21c\ud658\\n\uc0c8\ub85c\uc6b4 \uc11c\ube44\uc2a4\uc758 \uc0c1\ud0dc\uc758 \uc9c0\ud45c\ub294 \uc5b4\ub5bb\uac8c \uc815\uc758\ud560\uae4c? \ubcf4\ud1b5\uc740 \ubb34\uc5c7\uc744 `SLI(\uc11c\ube44\uc2a4 \uc218\uc900 \uc9c0\ud45c)`\ub85c \uc0ac\uc6a9\ud560\uc9c0\ub97c \uc815\ud558\ub294\uac83\uc73c\ub85c \ubcf8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c \uc131\uacf5 \ubc0f \uc2e4\ud328 \uce21\uc815\uac12(200 OK,500 Error), \uc751\ub2f5\uc2dc\uac04(ms), \ucc98\ub9ac\ub7c9 \ub4f1\uc758 \uc870\ud569\uc73c\ub85c \uacb0\uc815\ub420 \uc218 \uc788\ub2e4. \ubcf4\ud1b5  \uce74\ub098\ub9ac\uc544 \ubd84\uc11d\uc744 \ud1b5\ud574 Scoring\uc744 \ud55c `SLI`\ub97c 200 OK\uc640 500 \ub610\ub294 \uc5d0\ub7ec\ucf54\ub4dc\uc758 \ube44\uc728\ub85c \uacb0\uc815\ud558\ub294 \ubc29\ubc95\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0\uac00 \ub9ce\ub2e4.\\n\\n\uc11c\ube44\uc2a4 \uc0c1\ud0dc\ub97c \uc2dd\ubcc4\ud558\ub294 \uc9c0\ud45c\ub97c \uc815\ud558\uace0 \ub098\uba74 \uace0\uac1d\uc774\ub098 \uc6b0\ub9ac\uac00 \uc6d0\ud558\ub294 \uc548\uc815\uc131 \uc218\uc900\uc744 \uacb0\uc815\ud574\uc57c \ud55c\ub2e4. \uac1c\ubc1c\ud300\uacfc \uc6b4\uc601\ud300\uc774 \uac19\uc774 \ub9cc\ub4e0 \uc6d0\ud558\ub294 \uc548\uc804\uc131 \uc218\uc900\uc744 `SLO(\uc11c\ube44\uc2a4 \uc218\uc900 \ubaa9\ud45c)`\ub77c\uace0 \ub9d0\ud558\uba74 \ub41c\ub2e4. \\n\\n`SLO`\ub294 Prometheus\ub098 Datadog\uacfc \uac19\uc740 \ubaa8\ub2c8\ud130\ub9c1 \uc2dc\uc2a4\ud15c\uc744 \ud65c\uc6a9\ud558\uc5ec \uc815\ud655\ud558\uac8c \uce21\uc815\ud558\uace0 \ud45c\uc2dc\ud574\uc57c \ud55c\ub2e4. \uc11c\ube44\uc2a4\uc758 \uc548\uc815\uc131\uc5d0 \ub300\ud574\uc11c \uba85\ud655\ud558\uac8c \uc774\ud574\ud560\uc218 \uc788\ub294 \ubaa9\ud45c\uc774\uae30\ub3c4 \ud558\ub2e4. \ubc18\ub4dc\uc2dc `SLO`\ub97c \ub9cc\uc871\ud558\ub294\uc9c0 \ubabb\ud558\ub294\uc9c0 \uba85\ud655\ud55c \uce21\uc815\uac12\uc73c\ub85c \ub370\uc774\ud130\uac00 \uc874\uc7ac\ud574\uc57c \ud558\uace0 `SLO`\ub97c \ucda9\uc871\ud558\uc9c0 \ubabb\ud558\uba74 \ubb38\uc81c\uac00 \uc788\ub294\uac83\uc73c\ub85c \ud310\ub2e8\ud558\uace0 \ubb38\uc81c\ub97c \ud574\uacb0\ud574\uc57c \ud55c\ub2e4. \\n\\n### \uc624\ub958 \uc608\uc0b0\\n\uc624\ub958 \uc608\uc0b0\uc774\ub77c\ub294 \ub9d0\uc744 \uba85\ud655\ud788 \uc774\ud574\ud558\ub824\uba74 \ud754\ud788 \uace0\uac1d\uacfc \uccb4\uacb0\ud558\ub294 \uacc4\uc57d\uc11c \uc0c1\uc758 \uba85\uc2dc\ub41c \uc11c\ube44\uc2a4 \uac00\ub3d9\uc728(SLA)\uc744 \uc0dd\uac01\ud558\uba74 \ub420 \uac83 \uac19\ub2e4. \ubcf4\ud1b5 99.9% \uc758 `SLO`\ub97c \uc815\ud55c\ub2e4\uace0 \ud55c\ub2e4\uba74 1\ub144\uc5d0 8\uc2dc\uac04 45\ubd84 57\ucd08\uc758 \uc11c\ube44\uc2a4 \ub2e4\uc6b4\ud0c0\uc784\uc744 \ud5c8\uc6a9\ud558\ub294 \uac83\uc774\ub2e4. \uc624\ub958 \uc608\uc0b0\uc740 \uc11c\ube44\uc2a4\uc758 \uc644\ubcbd\ud55c \uc548\uc815\uc131\uacfc \uc6d0\ud558\ub294 \uc548\uc815\uc131\uc758 \ucc28\uc774(100%-99.9%=0.01%)\ub97c \ub9d0\ud55c\ub2e4. 0.01%\ub85c \uc989 8\uc2dc\uac04\uc815\ub3c4\uc758 \uc624\ub958 \uc608\uc0b0\uc744 \uac00\uc9c0\ub294 \uac83\uc740 \uadf8 \uc2dc\uac04\uc744 \ubaa8\ub450 \uc0ac\uc6a9\ud560 \ub54c\uae4c\uc9c0 \ucd94\uac00 \ub9b4\ub9ac\uc2a4\ub098 \ud328\uce58\ub97c \uc9c4\ud589\ud560 \uc218 \uc788\ub2e4\ub294 \uc774\uc57c\uae30\uc640 \uac19\ub2e4. \uc5b4\ub5a4 \ud300\uc740 \ud574\ub2f9 \uc608\uc0b0\uc744 \uc2e0\uaddc \uae30\ub2a5\uc744 \ub9b4\ub9ac\uc2a4\ud558\ub294\ub370 \uc0ac\uc6a9\ud558\uae30\ub3c4 \ud558\uace0 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud588\uc744\ub54c \ubb38\uc81c\uc758 \uc6d0\uc778\uc744 \ubc1c\uacac\ud558\uace0 \uac1c\uc120\ud558\ub294\ub370 \uc0ac\uc6a9\ud558\uae30\ub3c4 \ud55c\ub2e4. \\n\\n\uc77c\ubc18\uc801\uc73c\ub85c \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \uc624\ub958 \uc608\uc0b0\uc774 \ubaa8\ub450 \uc0ac\uc6a9\ub418\uba74 \uc11c\ube44\uc2a4\uac00 \uc6d0\ud558\ub294 \uc548\uc815\uc131 \uc218\uc900\uc73c\ub85c \ub3cc\uc544\uac08\ub54c \uae4c\uc9c0 \ud574\ub2f9 \uc11c\ube44\uc2a4\uc758 \ucd94\uac00\uc801\uc778 \ub9b4\ub9ac\uc2a4\ub97c \ubcf4\ub958\ud558\ub294\uac8c \uc77c\ubc18\uc801\uc774\uae34 \ud558\uc9c0\ub9cc \ud2b9\uc815\uae30\uac04(\uc6d4 \ub610\ub294 \ubd84\uae30 \ub610\ub294 \uc5f0\uac04) \uae30\uc900\uc73c\ub85c \uacc4\uc0b0\ub418\uae30 \ub54c\ubb38\uc5d0 \uc11c\ube44\uc2a4 \uc548\uc815\uc131\uc774 \uc815\uc0c1 \uc0c1\ud0dc\ub77c\uba74 \uc624\ub958 \uc608\uc0b0\uc740 \ub2e4\uc2dc \uc8fc\uc5b4\uc9c0\uac8c \ub418\ubbc0\ub85c `\uc120\uc21c\ud658` \uad6c\uc870\ub97c \uac00\uc9c4\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4.\\n\\n### \ube44\ub09c \uc5c6\ub294 \uc7a5\uc560 \ud68c\uace0\\n\uc77c\ubc18\uc801\uc73c\ub85c \ube44\uc988\ub2c8\uc2a4\uc5d0 \ud06c\ub9ac\ud2f0\uceec\ud55c \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud588\uc744\ub54c \uc0ac\ud6c4 \ubd84\uc11d(\ud68c\uace0)\uc744 \ud558\uac8c \ub418\ub294\ub370 \uc774\ub54c\ub294 `\ube44\ub09c \uc5c6\ub294` \ubd84\uc11d\uc744 \ud574\uc57c\ud55c\ub2e4. \uc624\ub798\uc804 \uae30\uc5b5\uc774\uc9c0\ub9cc \uc608\uc804 \uc9c1\uc7a5 \ud2b9\uc815\ud300\uc5d0\uc11c\ub294 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud558\uba74 \uc720\uad00\uc790\ub4e4\uc774 \ubaa8\ub450 \uc5d4\uc9c0\ub2c8\uc5b4 \ucc45\uc0c1 \ub4a4\uc5d0 \uc11c\uc11c \ubaa8\ub4e0 \ud654\uc0b4\uacfc \ub208\ucd1d\uc744 \uc8fc\uae30 \ub54c\ubb38\uc5d0 \ub3c4\uc800\ud788 \uc77c\uc744 \ud560 \uc218 \uc5c6\uac8c \ub9cc\ub4e0 \uacbd\uc6b0\uac00 \ub9ce\uc558\uc5c8\ub2e4. \\n\\n\ud2b9\uc815 \uc6b4\uc601\uc790\uc758 \uc791\uc5c5 \uc2e4\uc218\ub85c \uc778\ud574 \uc7a5\uc560\uac00 \ubc1c\uc0dd\ud588\ub2e4 \ud558\ub354\ub77c\ub3c4 \ud574\ub2f9 \uc774\ubca4\ud2b8\uac00 \ubc1c\uc0dd\ud558\uac8c \ub41c \ud504\ub85c\uc138\uc2a4\ub098 \uae30\uc220\uae30\ubc18\uc5d0 \uc2e4\ud328 \uc6d0\uc778\uc744 \ud30c\uc545\ud558\ub294\ub370 \uc911\uc810\uc744 \ub450\uc5b4\uc57c \ud560\uac83\uc774\ub2e4.\\n\\n\uc2dc\uc2a4\ud15c\uc758 \uc548\uc815\uc131\uc744 \uc800\ud558\uc2dc\ud0a4\uace0 \uc11c\ube44\uc2a4\ub97c \uc911\ub2e8\uc2dc\ud0a8 \uc791\uc5c5(\ub9b4\ub9ac\uc2a4, \ud328\uce58 \ub4f1)\uc744 \uc0ac\uc720\ub85c \uac1c\uc778\uc5d0\uac8c \ud398\ub110\ud2f0\ub97c \uc8fc\uac70\ub098 \uace0\uacfc\uc5d0 \ubc18\uc601\ud558\ub294 \ubc29\ubc95\uc740 \uc7a5\uc560\ub85c \ubd80\ud130 \uad50\ud6c8\uc744 \uc5bb\uc744\uc218\uac00 \uc5c6\uace0 \ud574\ub2f9 \ub2f4\ub2f9\uc790\uc758 \ucda9\uc131\ub3c4\ub098 \uc0dd\uc0b0\uc131 \uc800\ud558\ub97c \uc720\ubc1c\ud558\ub294 \uc548\uc88b\uc740 \uc7a5\uce58\uac00 \ub420 \uc218 \uc788\ub2e4. \ub0b4 \uacbd\ud5d8\uc774\uae30\ub3c4 \ud558\uc9c0\ub9cc \ud55c\ub3d9\uc548 \ub450\ub824\uc6cc\uc11c \uc544\ubb34 \ubcc0\uacbd\ub3c4 \ud558\uc9c0 \ubabb\ud558\ub294 \uacbd\uc6b0\uac00 \uc885\uc885 \uc788\uc5c8\ub2e4. \\n\\n\ud68c\uc0ac\ub098 \uc870\uc9c1, \ud300\uc740 \uc2dc\uc2a4\ud15c \uc911\ub2e8\uc73c\ub85c\ubd80\ud130 \uad50\ud6c8\uc744 \uc5bb\uace0 \uc9c0\uc18d\uc801\uc73c\ub85c \uc2dc\uc2a4\ud15c\uc744 \uac1c\uc120\ud560\uc218 \uc788\ub2e4. \uc801\uc808\ud55c \ubd84\uc11d\uc744 \ud1b5\ud574 \ud6c4\uc18d\uc870\uce58\ub97c \uc218\ud589\ud568\uc73c\ub85c\uc368 \uc2e4\ud328\ub97c \uc218\uc6a9\ud558\ub294 \uac83\uc774 SRE\uc758 \ud575\uc2ec \uc6d0\uce59\uc774\ub2e4. \uc774\ub7ec\ud55c \ub0b4\uc6a9\uc744 \ubaa8\ub450\uc5d0\uac8c \uacf5\uc720\ud558\uace0 \ud0c0 \uc870\uc9c1\uc774\ub098 \ud300\uc5d0\uac8c \uc778\uc0ac\uc774\ud2b8\ub97c \uc81c\uacf5\ud558\ub294 \uc120\uc21c\ud658 \uad6c\uc870\ub97c \ub9cc\ub4dc\ub294\uac83 \ub610\ud55c SRE\uc758 \uae30\ubcf8 \uc6d0\uce59\uc774\ub77c\uace0 \ubcfc \uc218 \uc788\ub2e4.\\n\\n## \uc8fc\uc694 SRE\uc6d0\uce59 : \uc0ac\ub78c\uce21\uba74\\n### Toil(\uc218\uace0\uc2a4\ub7f0 \uc77c, \ubc88\uac70\ub85c\uc6b4 \uc791\uc5c5)\\n\ud56d\uc0c1 SRE\uc5d0\uc11c\ub294 Toil\uc5d0 \ucd08\uc810\uc744 \ub9de\ucdb0\uc57c \ud55c\ub2e4. Toil\uc740 \uc0ac\ub78c\uc774 \uc218\ud589\ud558\ub294 \uc6b4\uc601 \uc791\uc5c5 \uc911 \ud2b9\uc815\ud55c \ud328\ud134\uc774\ub098 \ud2b9\uc131\uc774 \uc788\ub294 \uc791\uc5c5\uc744 \ub9d0\ud55c\ub2e4. \uc885\uc885 \ubc18\ubcf5\uc801\uc774\uace0 \uc790\ub3d9\ud654 \ub420 \uc218 \uc788\ub294 \uc791\uc5c5\uc77c\uc9c0\ub77c\ub3c4 \ub300\ubd80\ubd84 \uc218\ub3d9\uc791\uc5c5\uc73c\ub85c \ucc98\ub9ac\ub97c \ud55c\ub2e4. \uc11c\ube44\uc2a4\uc758 \uaddc\ubaa8\uac00 \ucee4\uc9c0\uac70\ub098 \uace0\uac1d\uc774 \ub9ce\uc544\uc9c0\uac8c \ub418\uba74 \ubcf4\ud1b5 \uc6b0\ub9ac\uac00 \uc774\uc57c\uae30 \ud558\ub294 \ud2f0\ucf13(\ub610\ub294 SR)\uc758 \uc218\uac00 \ub9ce\uc544\uc9c0\uace0 \uacf5\uc218\uac00 \ub9ce\uc774 \ud544\uc694\ud558\uac8c \ub41c\ub2e4. \\n\\n\ubc30\ud3ec\ub54c\ub9c8\ub2e4 Config\ub97c \uc801\uc6a9\ud558\uac70\ub098 \uacc4\uc815 \ub4f1\ub85d, \ubcfc\ub968\uc774\ub098 \ub514\uc2a4\ud06c \ud504\ub85c\ube44\uc800\ub2dd \ub4f1 \uc218\ub3d9\uc73c\ub85c \ucc98\ub9ac\ud574\uc57c\ud558\ub294 \ubaa8\ub4e0 \uc791\uc5c5\uc774 \uc6b4\uc601\uc790\uc5d0\uac8c\ub294 \ubd80\ud558\ub85c \ub2e4\uac00\uc62c\uc218 \uc788\ub2e4. \uc774\ub7ec\ud55c \ubc18\ubcf5\uc801\uc778 \uc791\uc5c5\uc744 \ud2f0\ucf13\uc2dc\uc2a4\ud15c\uc744 \ud1b5\ud574 \ucc98\ub9ac\ub97c \ud558\uac8c \ub418\uba74 \ud2f0\ucf13 \uc0dd\uc131, \uc791\uc5c5\uacc4\ud68d\uc11c \uc791\uc131, \uac80\ud1a0, \uc2b9\uc778 \ub2e8\uacc4\ub97c \uadf8\ub54c \ub9c8\ub2e4 \ud574\uc57c\ud558\ub294 \uc544\uc8fc \ubc88\uac70\ub85c\uc6b4 \uc791\uc5c5(Toil)\uc744 \ud574\uc57c\ud55c\ub2e4.\\n\\nSRE\ub294 \ucd5c\ub300\ud55c \uc774\ub7ec\ud55c \ubc18\ubcf5\uc801\uc774\uace0 \ubc88\uac70\ub85c\uc6b4 \uc791\uc5c5\uc744 \uc81c\uac70\ud558\uae30 \uc704\ud574 \ub178\ub825\ud574\uc57c\ud558\uace0 \uc790\ub3d9\ud654\uc640 Self-Service\ub85c \uac1c\ubc1c\uc790\uac00 \ud3b8\ud558\uac8c \uc9c1\uc811 \uc0ac\uc6a9\ud560\uc218 \uc788\ub3c4\ub85d \ud658\uacbd\uc744 \uc81c\uacf5\ud574 \uc8fc\uc5b4\uc57c \ud55c\ub2e4. \uc774\ub7ec\ud55c \uc694\uccad\uc774\ub098 \ud2f0\ucf13\uc744 \uc790\ub3d9\uc73c\ub85c \ucc98\ub9ac\ud560 \uc218 \uc788\uc73c\uba74 \uc870\uae08 \ub354 \uc0dd\uc0b0\uc801\uc778 \uc77c\uc744 \uc218\ud589\ud560\uc218 \uc788\ub2e4. \\n\\n\uc704\uc5d0\uc11c \uc774\uc57c\uae30\ud55c \uc801\uc808\ud55c \uc548\uc815\uc131\uacfc \ube44\uc2b7\ud55c \ub9e5\ub77d\uc73c\ub85c \uc0dd\uac01\ud558\uba74 \ub420 \uac83 \uac19\ub2e4. \ubc88\uac70\ub85c\uc6b4 \uc791\uc5c5\uc744 \uc5c6\uc560\ub294\uac83\uc774 \ub2e4\ub978 \uc911\uc694\ud55c \uc791\uc5c5\ubcf4\ub2e4 \uc6b0\uc120\uc21c\uc704\uac00 \ub5a8\uc5b4\uc9c0\uae30\ub3c4 \ud558\uc9c0\ub9cc \uc11c\ube44\uc2a4 \uc0c1\uc5d0\uc11c Toil\uc744 \uc81c\uac70\ud558\ub294\uac83\ub3c4 SRE\uc758 \uc8fc\ub41c \uc5c5\ubb34\uc774\ub2e4.\\n\\n## \uc6b4\uc601\uc791\uc5c5\uc758 \ube44\uc728\\nToil\uc744 \uc81c\uac70\ud558\uac70\ub098 \uc11c\ube44\uc2a4/\uc2dc\uc2a4\ud15c \uc548\uc815\uc131\uc744 \uac1c\uc120\ud558\uae30 \uc704\ud574 SRE\ub294 \uc7a5\uc560\ub97c \ud574\uacb0\ud558\uace0 \ud2f0\ucf13\uc744 \ucc98\ub9ac\ud558\ub294 \uc2dc\uac04 \ube44\uc911\uc744 50%\ub97c \ub118\uaca8\uc11c\ub294 \uc548\ub41c\ub2e4. \ud2f0\ucf13\uc774 \ud544\uc694\ud558\uc9c0 \uc54a\ub3c4\ub85d \uac1c\ubc1c\uc790 Self-Service\ub97c \uad6c\uc131/\uc81c\uacf5\ud558\uace0 \ud6a8\uc728\uc131\uc744 \uc99d\ub300\uc2dc\ud0a4\uae30 \uc704\ud574\uc11c IaC\ub4f1(Shell, Ansible, Terraform)\uacfc \uac19\uc774 \uc790\ub3d9\ud654\ub97c \uc704\ud55c \ucf54\ub4dc\ub97c \ub9cc\ub4dc\ub294\ub370\uc5d0\ub3c4 \uc9d1\uc911\uc744 \ud574\uc57c\ud55c\ub2e4.\\n\\n## \uc815\ub9ac\\n\uc9c0\uae08\uae4c\uc9c0 SRE\uc5d0 \ub300\ud574\uc11c \uac04\ub2e8\ud558\uac8c \uc18c\uac1c\ud558\uace0 \uc774\ud574\ud558\ub294 \uce21\uba74\uc5d0\uc11c \uc815\ub9ac\ud574 \ubd24\ub2e4. \\n\\n[Service Reliability Hierarchy](https://landing.google.com/sre/sre-book/chapters/part3/)\\n\\n\\n![hierarchy](https://lh3.googleusercontent.com/3gX2qgys2I-9HnEIvXUA10ed3AILvg5MclnKWBquEkJKP3g5_kD6WR7Ptwp3TwAGla1DuSmHv64MdTtACNLlArFVq7BwbTrTVhigsA=s0)\\n\\n\uadf8\ub9bc\uacfc \uac19\uc774 \uc11c\ube44\uc2a4 \uc548\uc815\uc131 \uacc4\uce35 \uad6c\uc870\uc5d0\uc11c\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ubaa8\ub4e0 \uc11c\ube44\uc2a4\ub97c \ubaa8\ub2c8\ud130\ub9c1 \ud558\ub294 \uc2dc\uc2a4\ud15c\uc744 \uac16\ucd94\uc5b4\uc57c \ud55c\ub2e4\uace0 \ub9d0\ud55c\ub2e4. \ubaa8\ub2c8\ud130\ub9c1 \uc2dc\uc2a4\ud15c\uc774 \uc900\ube44\uac00 \ub418\uba74 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c SLI, SLO\ub97c \ub9cc\ub4e4\uace0 \ubaa8\ub2c8\ud130\ub9c1 \uc2dc\uc2a4\ud15c\uc5d0\uc11c \uad6c\ud604\ud558\ub294\uac83\uc774 \uccab\ubc88\uc9f8 SRE\ub97c \uc801\uc6a9\ud558\ub294 \ubc29\ubc95\uc774\ub77c\uace0 \ud560 \uc218 \uc788\uc744 \uac83\uc774\ub2e4.\\n\\n## \ucc38\uace0 \uc11c\uc801\\n* [Site Reliability Engineering: How Google Runs Production Systems(\u201cThe SRE Book\u201d)](http://shop.oreilly.com/product/0636920041528.do)\\n* [The Site Reliability Workbook: Practical Ways to Implement SRE(\u201cThe SRE Workbook\u201d)](http://landing.google.com/sre/workbook/toc/)\\n* [Seeking SRE: Conversations About Running Production Systems at Scale](http://shop.oreilly.com/product/0636920063964.do)"},{"id":"retrospective/newyear-plan/","metadata":{"permalink":"/retrospective/newyear-plan/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2019-01-03-newyear-plan.md","source":"@site/blog/2019-01-03-newyear-plan.md","title":"2018 Retrospective","description":"18\ub144\ub3c4\ub97c \ub3cc\uc544\ubcf4\uba70...","date":"2019-01-03T00:00:00.000Z","formattedDate":"January 3, 2019","tags":[{"label":"Retrospective","permalink":"/tags/retrospective"},{"label":"2018","permalink":"/tags/2018"},{"label":"Planning","permalink":"/tags/planning"},{"label":"Change","permalink":"/tags/change"}],"readingTime":5.32,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"2018 Retrospective","comments":true,"classes":"wide","description":"18\ub144\ub3c4\ub97c \ub3cc\uc544\ubcf4\uba70...","slug":"retrospective/newyear-plan/","date":"2019-01-03T00:00:00.000Z","categories":["Retrospective"],"tags":["Retrospective","2018","Planning","Change"]},"prevItem":{"title":"SRE (Site Reliablity Engineering)","permalink":"/job/SRE/"},"nextItem":{"title":"Cloud Enginner","permalink":"/cloud/cloud/"}},"content":"\ud55c\ud574\uac00 \ub610 \ud6c5 \uac00\ubc84\ub838\ub2e4. 18\ub144\ub3c4 Retrospective \uc2dc\uc791\ud55c\ub2e4.\\n\\n* Work\\n  * 17\ub144\uae4c\uc9c0 \ud300 \ub9c9\ub0b4\uc600\uc9c0\ub9cc \uc0c8\ub85c\uc6b4 \ubd80\uc11c\ub85c \uc774\ub3d9\ud558\uc5ec \uc11c\ube44\uc2a4\uac1c\ubc1c \ud30c\ud2b8\uc7a5\uc744 \ub9de\uac8c \ub418\uc5c8\uc74c. 17\ub144\ub3c4\uc5d0 \uac1c\ubc1c\uc774\ub77c\uace0\ub294 python\ub97c \uc0ac\uc6a9\ud558\uc5ec vmware vm\uc744 openstack instance\ub85c migration\ud558\ub294 \ud504\ub85c\uc81d\ud2b8 \ubc0f kubernetes \uae30\ubc18 tensorflow \ud50c\ub7ab\ud3fc\uc744 \uac1c\ubc1c\ud558\ub294 \ucd08\ubcf4\uac1c\ubc1c\uc790 \uc218\uc900\uc774\uc600\ub358 \ub0b4\uac00 \uc778\ud504\ub77c\uc640 \ud074\ub77c\uc6b0\ub4dc \ud50c\ub7ab\ud3fc(openstack, vsphere, kubernetes) \uacbd\ub825\uc774 \uc778\uc815\ub418\uc5b4 \uc11c\ube44\uc2a4 \uac1c\ubc1c \ud30c\ud2b8\ub97c \ub9e1\uac8c \ub418\uc5c8\ub2e4. \uc778\uc0dd\uc5d0\uc11c \uac00\uc7a5 \ud070 \ubcc0\ud601\uc911 \ud558\ub098\uc600\ub2e4\uace0 \uc0dd\uac01\ud558\uace0 \ud56d\uc0c1 \uac10\uc0ac\ud558\ub294 \ub9c8\uc74c\uc73c\ub85c \uc77c\uc744 \ud558\uace0 \uc788\ub2e4.  \\n    \\n  * CNCF OpenSource\ub4e4\uc744 \ud65c\uc6a9\ud558\uc5ec FaaS(Function as a Service), IaC(Infra as Code) \ud50c\ub7ab\ud3fc \uac1c\ubc1c\uc744 \uc9c4\ud589\ud558\uc600\ub2e4. \uc11c\ube44\uc2a4 \uae30\ud68d \ubc0f \ub450\uac1c \ud504\ub85c\uc81d\ud2b8\uc758 Scrum Master \uc5ed\ud560\uc744 \uc218\ud589\ud558\uc600\uace0 \uba54\uc778 \uc5c5\ubb34\ub294 SRE\uc5ed\ud560\ub85c Kubernetes \uc124\uacc4 \uad6c\ucd95, \ud074\ub7ec\uc2a4\ud130 \ubc0f \uc2a4\ud1a0\ub9ac\uc9c0 \uad00\ub9ac, LB, \uc778\uc99d\uc11c \ub4f1 \ud074\ub77c\uc6b0\ub4dc \uc778\ud504\ub77c \uc790\uc6d0\uad00\ub9ac \uc815\ub3c4\uc600\ub358\uac83 \uac19\ub2e4. \\n\\n* Tech.\\n  * Public Cloud : AWS, DigitalOcean, IBM Cloud, GCP, Azure, nCloud\\n  * Provisioning : Harbor, Ansible, Portus, Clair, Kubicorn, Terraform, Vault\\n  * Runtime : Rook, Minio, OpenEBS, Calico, REX-ray, WeaveNet, Cilium\\n  * Orchestration : Kubernetes, Envoy, etcd, gRPC, Kong, HAProxy, Istio, Kong, NGINX, Traefik\\n  * App : NATS, Helm, Kafka, Docker-compose, Draft, Gitlab, minikube, Operator, Jenkins, JenkisX, Packer, RabbitMQ, Spinnaker\\n  * Serverless : Dispatch, Fission, Knative, Nuclio, OpenWhisk, OpenFaas\\n  * Monitoring, Logging : Prometheus, Fluentd, Elastic, Grafana, influx, WeaveScope\\n  * \uae30\ud0c0 : Cert-Manager, Dex, Agones\\n\\n* Speak\\n  \uc4f0\ub2e4\ubcf4\ub2c8 \uc0ac\ub0b4\uc678 \ubc1c\ud45c\ub97c 10\ubc88\uc744 \ub118\uac8c \ud55c\uac70 \uac19\ub2e4.\\n  * 4\uc6d4 \uc0ac\ub0b4 Cloud Tech : \ucee8\ud14c\uc774\ub108 \uae30\ubc18 SaaS \uac1c\ubc1c\uc744 \uc704\ud55c \uace0\ub824\uc0ac\ud56d\\n  * 5\uc6d4 \uc0ac\ub0b4 DT \uc194\ub8e8\uc158 \ud589\uc0ac, \ud074\ub77c\uc6b0\ub4dc\uc0ac\uc5c5\ubd80 \uc138\uc158 : Advanced Cloud (Road to Serverless)\\n  * 5\uc6d4 \uc0ac\ub0b4 \ud1b5\uc2e0\uc0ac\uc5c5\ubd80\ubb38 Tech\uc138\uc158 : Road to Serverless (Functions as Applications)\\n  * 6\uc6d4 Open Infra Days Korea 2018 : [Provisioning Dedicated Game Server on Kubernetes Cluster](https://www.slideshare.net/JinwoongKim8/provisioning-dedicated-game-server-on-kubernetes-cluster)\\n  * 8\uc6d4 SK DNA 2018 : [Cloud Z \uc758 \uc624\ud508\uc18c\uc2a4 \uc11c\ube44\uc2a4 \uc18c\uac1c \ubc0f Serverless\ub85c \uac8c\uc784 \uac1c\ubc1c\ud558\uae30](https://www.slideshare.net/JinwoongKim8/cloud-z-serverless-118143924)\\n  * 10\uc6d4 DT Labs Meetup : [Continuous Delivery with Spinnaker on K8s(kubernetes) Cluster](https://www.slideshare.net/JinwoongKim8/continuous-delivery-with-spinnaker-on-k8skubernetes-cluster-118140930)\\n  * 10\uc6d4 NCsoft IO : [Cloud Native \uc624\ud508\uc18c\uc2a4 \uc11c\ube44\uc2a4 \uc18c\uac1c \ubc0f Serverless\ub85c \uc2e4\uc81c \uac8c\uc784 \uac1c\ubc1c\ud558\uae30](https://www.slideshare.net/JinwoongKim8/cloud-native-serverless/JinwoongKim8/cloud-native-serverless)\\n  * 11\uc6d4 IBM Developer Day : [Continuous Delivery using Spinnaker on Kubernetes Multi Cluster](http://public.dhe.ibm.com/software/kr/TrackB/B3.pdf)\\n  * 11\uc6d4 \\"Kubernetes Meetup\\" 1Day : [Spinnaker on Kubernetes](https://www.slideshare.net/JinwoongKim8/spinnaker-on-kubernetes-123752186)\\n\\n\\n\uc4f0\uace0\ub098\uc11c \ubcf4\ub2c8 2018\ub144\ub3c4 \ud68c\uace0\ub77c\uae30 \ubcf4\ub2e4 \uac70\uc758 \uac1c\ubc1c\uc5d0 \ud544\uc694\ud55c \uc7a1\uc77c(DevOps\ub77c\uace0 \ub450\ub454\ud558\uba74\uc11c)\uacfc \ubc1c\ud45c\ub9cc \ud55c\uac70 \uac19\ub124...\\n19\ub144\ub3c4 \ubd80\ud130\ub294 \ub2e4\ub978\uc5c5\ubb34\ub97c \ud558\uac8c \ub420\uac70 \uac19\uc740\ub370 \ucd08\uc2ec\uc744 \uc783\uc9c0 \ub9d0\uc544\uc57c \ud558\uaca0\ub2e4.\\n\\n\ucd5c\uadfc \ud654\ub450\uac00 \ub418\uc5c8\ub358 `\ub178\ub825\uc911\ub3c5` \uc774\uc600\ub358\uac83 \uac19\uc740 18\ub144\uc740 \ud138\uc5b4\ubc84\ub9ac\uace0\\n\ub0b4\uac00 \uc9c4\uc9dc\ub85c \uc88b\uc544\ud558\uace0 \ud558\uace0 \uc2f6\uc740 \uacf5\ubd80\uc640 \uc5c5\ubb34, \uadf8\ub9ac\uace0 \uac00\uc871\uc744 \uc704\ud574\uc11c \ub85c\ub4dc\ubc38\ub7f0\uc2f1 \ud558\uba74\uc11c \uc9c0\ub0b4\uc57c \ud558\uaca0\ub2e4. \\n\\n2006\ub144\uc5d0 \uc4f4 \ubbf8\ub798\uc758 \ub0b4 \ubaa8\uc2b5\uacfc \uc5b4\ub290\uc815\ub3c4 \uc77c\uce58\ud558\ub294\uac70 \uac19\uc9c0\ub9cc \ubaa9\ud45c\ub97c \uc880\ub354 \ub192\uc774 \uc7a1\uc544\uc57c\ud560\ub4ef \ud558\ub2e4.\\n\\n\ubc88\uc5ed\uc5d0 \ucc38\uc5ec\ud558\uac70\ub098 \ucc45\uc744 \uc368\ubcf8\ub2e4\ub358\uc9c0 \ucee4\ubba4\ub2c8\ud2f0 \ud65c\ub3d9\uc744 \uc880\ub354 \uc801\uadf9\uc801\uc73c\ub85c \ud574\ubcf4\uace0\\n\ud68c\uc0ac\uc5d0\uc11c \uc2dc\ud0a4\ub294 \ubc0b\uc5c5\uc774 \uc544\ub2cc \uc790\ubc1c\uc801\uc73c\ub85c \ucc38\uc5ec\ud558\ub294 \uc678\ubd80 \uac15\uc5f0\uc774\ub098 \ubc0b\uc5c5\uc744 \uc704\uc8fc\ub85c \ud574\ubd10\uc57c\uaca0\ub2e4. \\n\\n\ub610\ud55c \uc810\uc810 \uac1c\ubc1c\uc601\uc5ed\uacfc \uba40\uc5b4\uc9c0\ub294\uac70 \uac19\uc740 \ub0b4\ubaa8\uc2b5\uc774 \ub098\uc774\uac00 \ub4e4\uba74\uc11c \ub354 \uc2ec\ud654\ub420\uac70 \uac19\uc544\uc11c \uc9c0\uc778\ub4e4\uacfc \ubcc4\ub3c4\uc758 \uac1c\ubc1c \ud504\ub85c\uc81d\ud2b8\ub97c \uc9c4\ud589\ud574\ubcf4\ub824\uace0 \ud55c\ub2e4.\\n\\n\ub0b4 13\ub144\uac04 \uc9c1\uc7a5 \uc0dd\ud65c\uc911 \uac00\uc7a5 \ubc14\uc058\uace0 \ub2e4\uc774\ub0b4\ubbf9\ud558\uba74\uc11c \ubc14\ube74\ub358 \ud55c\ud574\uc774\uc790 \ub9ce\uc740 \uacbd\ud5d8\uacfc \uacf5\ubd80\uac00 \ub418\uc5c8\ub358 \uc77c\ub144\uc774\uc600\ub358\uac83 \uac19\ub2e4.\\n\\n\ub098\ub97c \ub561\uaca8\uc8fc\uc168\ub358 `June`, \ud56d\uc0c1 \ubd84\uc704\uae30\ub97c \ub9ac\ub4dc\ud588\ub358 `Joonbum`, \uc5b8\uc81c\ub098 \uc5f4\uc815\uac00\ub4dd\ud558\uace0 \ucd5c\uace0\uc758 DevOps \ud50c\ub808\uc774\uc5b4 `Jeongho`, \ub4e0\ub4e0\ud55c Backender `Donghun`, Excellent/Free/Kind(a.k.a EFK)\ud55c `Minyoung`, \ub0b4\uac00 \uc778\uc815\ud558\ub294 Frontier `Sanghun`, Best Rookie `Minsoo`, sorry because the hy `HyunSang`, Moontoring `Jinsoo`, Forever Mentor `Jaemoon`, Guru of CNI `Youngchae` \ubaa8\ub450\uc5d0\uac8c \uac10\uc0ac\uc758 \ub9d0\uc500\uc744 \uc804\ud558\uace0 \uc2f6\ub2e4. (\ubb34\uc2a8 \uc218\uc0c1\uc18c\uac10\ub3c4 \uc544\ub2c8\uace0 \u314b\u314b)\\n\\n19\ub144\uc5d0\ub3c4 \ub0a8\ub4e4\uc5d0\uac8c \uc874\uacbd\uc744 \ubc1b\ub294 \uc0ac\ub78c\ubcf4\ub2e4\ub294 \ubb34\uc2a8\uc77c\uc744 \ud558\ub4e0\uc9c0 \ub300\uc911\uc5d0\uac8c \uc695\uba39\uc9c0 \uc54a\uace0 \ud544\uc694\ud560\ub54c \ub3c4\uc6c0\uc744 \uc694\uccad\uc744 \ud560\uc218 \uc788\ub294 \uadf8\ub7f0 \ud3b8\ud55c \uc0ac\ub78c\uc774 \ub418\uc5b4\uc57c \uaca0\ub2e4."},{"id":"cloud/cloud/","metadata":{"permalink":"/cloud/cloud/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-12-25-cloud.md","source":"@site/blog/2018-12-25-cloud.md","title":"Cloud Enginner","description":"Cloud Enginner","date":"2018-12-25T00:00:00.000Z","formattedDate":"December 25, 2018","tags":[{"label":"Cloud","permalink":"/tags/cloud"},{"label":"Enginner","permalink":"/tags/enginner"}],"readingTime":4.055,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Cloud Enginner","comments":true,"classes":"wide","description":"Cloud Enginner","slug":"cloud/cloud/","date":"2018-12-25T00:00:00.000Z","categories":["Cloud"],"tags":["Cloud","Enginner"]},"prevItem":{"title":"2018 Retrospective","permalink":"/retrospective/newyear-plan/"},"nextItem":{"title":"Spinnaker on Kubernetes #3 (Kayenta)","permalink":"/kubernetes/spinnaker-advanced-3/"}},"content":"\uc624\ub298\uc740 \uc4f8\ub370\uc5c6\ub294 \uc774\uc57c\uae30\ub97c \uc8fc\uc800\ub9ac \uc801\uc5b4\ubcf8\ub2e4. \\n\\n\ud398\uce5c\ud55c\ubd84\uc774 \ub9d0\uc500\ud558\uc2e0 \uad6c\uc808\uc774 \ub5a0\uc624\ub978\ub2e4.\\n`\\"\uc5d4\uc9c0\ub2c8\uc5b4\ub77c\uace0 \ud574\uc11c \uc815\uce58\ub825\uc774 \ud544\uc694\uc5c6\ub294\uac83\uc774 \uc544\ub2c8\ub2e4. \uc624\ud788\ub824 \ud601\uc2e0\uc801\uc778 \uae30\uc220\uc740 \uc815\uce58\ub825, \uad8c\ub825\uc774 \uc5c6\uc73c\uba74 \uc801\uc6a9\ub420 \uc218 \uc5c6\ub2e4\\"` - \uc81c\ud504\ub9ac \ud398\ud37c\uad50\uc218\uc758 \\"\uad8c\ub825\uc758 \uae30\uc220\\"\\n\\n\ub098\uc774 40\uc744 \ub118\uae34 \uc5d4\uc9c0\ub2c8\uc5b4\ub85c\uc11c \ub098\ub294 \uc5b4\ub5a4 \uc704\uce58\uc778\uac00?\\n\\nCloud \uad00\ub828 \uc624\ud508\uc18c\uc2a4\ub85c \ube44\uc988\ub2c8\uc2a4\ub97c \uc9c4\ud589\ud558\uba74\uc11c \ud604 \uc9c1\uc7a5\uc5d0\uc11c 2\ub144\uc744 \ubcf4\ub0c8\ub2e4.\\n\ubcf4\ub78c\ub3c4 \uc788\uc5c8\uace0 \uc2e4\ud328\ub3c4 \uc788\uc5c8\ub2e4.  \\n\uc62c\ud574\ub294 \uae30\ud68d\ud55c \uc624\ud508\uc18c\uc2a4 \uae30\ubc18 \ud504\ub85c\uc81d\ud2b8\ub85c \uc5ec\ub7ec\uc0ac\ub78c\uc758 \ud798\uc744 \ud569\uccd0\uc11c \uc11c\ube44\uc2a4\ub97c \ub7f0\uce6d\ud558\uae30\ub3c4 \ud558\uc600\uc9c0\ub9cc \uba87\ub144\uac04 \uae00\ub85c\ubc8c \ud50c\ub808\uc774\uc5b4\ub4e4\uc744 \ubcf4\uba74\uc11c \ub290\ub080\uc810\uc740  \\n\\n\ud68c\uc0ac\uac00 \uae00\ub85c\ubc8c \ud50c\ub808\uc774\uc5b4\uac00 \ub418\uae30\uc704\ud574 \ub178\ub825\ud558\ub294 \ubc29\ubc95\uc740 \ub2e4\uc591\ud558\uc9c0\ub9cc  \\n\uacb0\uad6d \uc774\uc724\uc744 \ubaa9\uc801\uc73c\ub85c \ud68c\uc0ac\uc5d0\uc11c \ud5c8\uc6a9\ud558\uace0 \ud22c\uc790\ud558\ub294\uac83\uc774\uace0  \\n\uadf8\uac78\ub85c \ub3c8\uc744 \ubabb\ubc8c\uba74 \ubc14\ub85c \uccd0\ub0bc\uc218 \uc788\ub2e4\ub294 \uacbd\uc601\uce35\uc758 \uc0dd\uac01\uc740 \ubcc0\ud568\uc774 \uc5c6\uc744\uac83\uc774\ub2e4. \\n\\n\uc774\ub7f0 \ub9c8\uc74c\uac00\uc9d0\uc744 \ubcc0\ud654\uc2dc\ud0a4\uc9c0 \uc54a\ub294\ub2e4\uba74 \ud6cc\ub96d\ud55c \ud504\ub85c\uc81d\ud2b8\ub77c\ub3c4 \uc131\uacf5\uc774\ub4e0 \uc2e4\ud328\ub4e0 \ub05d\uae4c\uc9c0 \uac00\ub294\uac83\uc740 \uc5b4\ub835\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4. \\n\\n\ucc98\uc74c \ud074\ub77c\uc6b0\ub4dc \uad00\ub828 \uc5c5\ubb34\ub97c \uc2dc\uc791\ud560\ub54c\ub97c \uc0dd\uac01\ud574\ubcf8\ub2e4.\\n\\n* 2010\ub144  \\n\ud300\uc7a5: \ub108 \ud074\ub77c\uc6b0\ub4dc \ud560\ub798?  \\n\ub098 : \ubb34\uc2a8\uc77c\ud558\ub294\ub370\uc694?  \\n\ud300\uc7a5: \uac00\uc0c1\ud654 \ud504\ub85c\uc81d\ud2b8\ud558\ub294\ub370 \uac19\uc774 \ud55c\ubc88 \ube44\uc988\ub2c8\uc2a4 \ub9cc\ub4e4\uc5b4\ubcf4\uc790, \ub108\uac00 \ud558\uace0 \uc2f6\uc740\ub300\ub85c \uae30\ud68d\ud558\uace0 \ud574\ubd10~  \\n\ub098 : \ub124^^ \uc5f4\uc2ec\ud788 \ud558\uaca0\uc2b5\ub2c8\ub2e4.  \\n\\n* `\uac1c\uc778 \uc131\uacfc \ubc0f \ud300\uc758 \ubaa9\ud45c\ub294 \uc5b4\ub290\uc815\ub3c4 \ub2ec\uc131\ud558\uc600\uc73c\ub098 ROI \ub2ec\uc131\uc740 \uc27d\uc9c0 \uc54a\uc558\uc74c`\\n\\n* 2016\ub144  \\n\ud300\uc7a5: \ub108 \uc8fc\uac04\ubcf4\uace0 \ub611\ubc14\ub85c \uc548\ud574?, \uc9c0\ub09c\ubc88 \uc7a5\uc560\ubcf4\uace0\ub294 \uc5b4\ub5bb\uac8c \ub41c\uac70\uc57c?  \\n\ub098: \u3160\u3160  \\n\ud300\uc7a5: \uc6b0\ub9ac \ud300 \uc218\uce58\uac00 \uc774\uac8c \ubb50\ub0d0... \uc880 \uc798\uc880 \ud574\ubd10  \\n\ub098: \u3160\u3160  \\n  \\n* `\uacb0\uad6d \ud1f4\uc0ac`\\n  \\n* 2017\ub144  \\n\ud300\uc7a5: \ud558\uace0 \uc2f6\uc740\ub300\ub85c \ud574\ubd10\\n\ub098: \uc9c4\uc9dc\uc694? \ub69d\ub531\ub69d\ub531  \\n\ud68c\uc0ac: \uc218\uc775\ubaa8\ub378\uc774 \ubb50\uc9c0?  \\n\ub098: ...  \\n\\n* `\ucd9c\uc2dc\ud558\uae30\ub3c4 \uc804\uc5d0 \uc11c\ube44\uc2a4 \uc885\ub8cc`\\n\\n* 2018\ub144  \\n\ud300\uc7a5: \ud558\uace0 \uc2f6\uc740\uac70 \ud574\ubd10\uc694. \ub300\uc2e0 \ub3c8\ubc8c\uc5b4\uc640\uc57c\ud574  \\n\ub098: \uc9c4\uc9dc\uc694? \ub69d\ub531\ub69d\ub531  \\n\ud68c\uc0ac: \ud760 \uc880 \ubd80\uc871\ud558\uc9c0\ub9cc \uc55e\uc73c\ub85c \uc880\ub354 \uc798\ud574\uc8fc\uc138\uc694. \ub808\ud37c\ub7f0\uc2a4 \ud655\ubcf4\uc5d0 \ud798\uc368\uc8fc\uc138\uc694.  \\n\ub098: \uc11c\ube44\uc2a4 \uae30\ud68d\uc790\uac00 \ud544\uc694\ud569\ub2c8\ub2e4.  \\n\ud68c\uc0ac: ... \ubcf8\uc778\uc774 \ud574\uc57c\ud558\ub294\uac70 \uc544\ub2cc\uac00\uc694?  \\n\ub098: ...  \\n  \\n* `\uae30\ud68d\uc744 \ud574\uc57c\ud558\ub098 \uc544\uc9c1 \uae30\uc220\ub825\ub3c4 \ubd80\uc871\ud55c\ub370...`  \\n\\n\ubc8c\uc368 \uc9c1\uc7a5\uc0dd\ud65c 13\ub144\ucc28\uc5d0 \ub9c8\ud754\uc0b4\uc774 \ub118\uc5b4\uac00\uace0 \uc788\ub2e4. \\n\\n\uc5d4\uc9c0\ub2c8\uc5b4\ub85c \uc0b4\uc544\uc628\ub0a0\ubcf4\ub2e4 \uc0b4\uc544\uac00\uc57c\ud560\ub0a0\uc774 \uc801\uac8c \ub0a8\uc558\uace0 \uc5bc\ub9c8 \ub0a8\uc9c0 \uc54a\uc558\ub2e4\ub294 \uc0dd\uac01\uc774 \ub4dc\ub294 \uc6b0\uc6b8\ud55c \ud558\ub8e8\ub2e4. \\n10\ub144\uac04 \uacf5\ubd80\ud574\uc654\ub358 \uac83\ub4e4\ubcf4\ub2e4 2\ub144\ub3d9\uc548 \uacf5\ubd80\ud55c\uac8c \ub354 \ud30c\uaca9\uc801\uc774\uace0 \ub2e4\uc591\ud558\uace0 \ubcf5\uc7a1\ud588\ub2e4.\\n\\n\uc5ec\ub7ec\ubaa8\ub85c \uc544\uc26c\uc6b4 \ud55c\ud574\uc600\ub2e4...\\n\\n\uc55e\uc73c\ub85c \ub0b4\uac00 \ubd80\uc871\ud55c \ubd80\ubd84\uc744 \uae30\uc220\ub825\uc73c\ub85c \uba54\uafc0\uac83\uc774\ub0d0? \ud611\uc0c1\uacfc \uc815\uce58\ub825\uc73c\ub85c \uba54\uafc0\uac83\uc774\ub0d0?\\n\\n\uc7a0\uc774 \uc548\uc624\ub294 12\uc6d4\uc774\ub2e4."},{"id":"kubernetes/spinnaker-advanced-3/","metadata":{"permalink":"/kubernetes/spinnaker-advanced-3/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-12-04-spinnaker-advanced-3.md","source":"@site/blog/2018-12-04-spinnaker-advanced-3.md","title":"Spinnaker on Kubernetes #3 (Kayenta)","description":"Spinnaker\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4 #3 (Kayenta)","date":"2018-12-04T00:00:00.000Z","formattedDate":"December 4, 2018","tags":[{"label":"CI/CD","permalink":"/tags/ci-cd"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Spinnaker","permalink":"/tags/spinnaker"},{"label":"Continuous Delivery","permalink":"/tags/continuous-delivery"},{"label":"Continuous Deployment","permalink":"/tags/continuous-deployment"},{"label":"Pipeline","permalink":"/tags/pipeline"},{"label":"Canary","permalink":"/tags/canary"},{"label":"Canary analysis","permalink":"/tags/canary-analysis"},{"label":"Kayenta","permalink":"/tags/kayenta"},{"label":"Automated Canary Service","permalink":"/tags/automated-canary-service"}],"readingTime":14.66,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Spinnaker on Kubernetes #3 (Kayenta)","comments":true,"classes":"wide","description":"Spinnaker\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4 #3 (Kayenta)","slug":"kubernetes/spinnaker-advanced-3/","date":"2018-12-04T00:00:00.000Z","categories":["Kubernetes"],"tags":["CI/CD","Kubernetes","Spinnaker","Continuous Delivery","Continuous Deployment","Pipeline","Canary","Canary analysis","Kayenta","Automated Canary Service"]},"prevItem":{"title":"Cloud Enginner","permalink":"/cloud/cloud/"},"nextItem":{"title":"Spinnaker on Kubernetes #2","permalink":"/kubernetes/spinnaker-advanced-2/"}},"content":"3\ubc88\uc9f8 \ud3ec\uc2a4\ud305\uc774\ub2e4.\\n\\n11/23 \\"Kubernetes Meetup\\" 1Day\uc5d0\uc11c \ubc1c\ud45c\ud55c \uc774\uc57c\uae30 \uc5f0\uc7a5\uc120\uc73c\ub85c \uc791\uc131\ud55c\ub2e4.\\n\\n\uace0\uac1d\uc5d0\uac8c \uc624\ud37c\ub9c1\uc744 \uc704\ud574 \uc900\ube44\ud55c \ub0b4\uc6a9\uacfc Kubernetes monitoring\uacfc \uc5f0\uacc4\ud55c \ub0b4\uc6a9\uc5d0 \ub300\ud574\uc11c \uc801\uc5b4\ubcf4\ub824\uace0 \ud55c\ub2e4.\\n\ucd5c\uadfc \ubc1c\ud45c\ub97c \ub2e4\ub2c8\uba74\uc11c \ub9ce\uc774 \ubc1b\ub294 \uc9c8\ubb38\uc774 \uc2e4\uc81c \uc0ac\uc6a9\ud560\ub9cc \ud55c\uac00?\ub77c\ub294 \uc9c8\ubb38\uacfc \uc5b4\ub5bb\uac8c \ud65c\uc6a9\ud574\uc57c \ud558\ub294\uc9c0\uc5d0 \ub300\ud55c \uc9c8\ubb38\ub4e4\uc744 \ub9ce\uc774 \ubc1b\ub294\ub2e4.\\n\uc624\ub298 \ucd5c\uadfc Spinnaker Summit 2018\uc5d0\uc11c \uc911\uc694\ud558\uac8c \ub2e4\ub918\ub358 Kayenta \ud504\ub85c\uc81d\ud2b8\ub97c \uac00\uc9c0\uace0 \uc774\uc57c\uae30 \ud574\ubcf4\ub824\uace0 \ud55c\ub2e4. \\n\\n## Kayenta\\n\\nKayenta\ub294 \uc790\ub3d9 Canary \ubd84\uc11d \uc624\ud508\uc18c\uc2a4(Automated Canary Service(ACA))\ub85c Spinnaker\uc758 \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4\uc911 \ud558\ub098\ub85c \ub3d9\uc791\ud55c\ub2e4.  \\nAutomated Canary Deployments\uc5d0 \uc0ac\uc6a9\ub418\uace0 \uc790\uc138\ud55c \ub0b4\uc6a9\uc740 [canary documentation](https://www.spinnaker.io/guides/user/canary/stage/)\uc744 \ud655\uc778\ud558\uba74 \ub41c\ub2e4.  \\n\\n\\n\uc0c8 \uc885\ub958\uc758 \ud558\ub098\uc778 Canary\ub294 1\ucc28 \uc138\uacc4\ub300\uc804\uc911\uc5d0 \uc778\uac04\uc774 \ud574\ub97c \uc785\uae30 \uc804\uc5d0 \ub3c5\uc131\uac00\uc2a4\ub97c \ud0d0\uc9c0\ud558\ub294 \uc6a9\ub3c4\ub85c \uc0ac\uc6a9\ub418\uc5c8\ub2e4\uace0 \ud55c\ub2e4.\\nDevOps\uc5d0\uc11c\ub294 CD(Continuous Deployment) \ud504\ub85c\uc138\uc2a4\uc758 \uc77c\ubd80\ub85c \uc0ac\uc6a9\ub418\uba70 Canary \ub9b4\ub9ac\uc988\ub294 \uc0c8\ub85c\uc6b4 \ubc84\uc804\uc758 Software\ub97c Production\uc5d0 \ubc30\ud3ec\ud558\ub294 \uc704\ud5d8\uc744 \uc904\uc5ec\uc8fc\ub294 \uae30\uc220\uc774\ub77c\uace0 \uc0dd\uac01\ud558\uba74 \ub41c\ub2e4.\\n\\nCanary \uc2e0\uaddc \ubc84\uc804\uc758 Software\ub97c \uc548\uc815\uc801\uc778 \uae30\uc874 \ubc84\uc804\uacfc \ud568\uaed8 \ubc30\ud3ec\ud558\uace0 \ud2b9\uc815\uc0ac\uc6a9\uc790\ub098 \uc77c\ubd80 \ub300\uc0c1\uc5d0\uac8c \ud2b8\ub798\ud53d \uc77c\ubd80\ub97c \ud758\ub824 \uae30\uc874 \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc601\ud5a5\uc744 \ucd5c\uc18c\ud558\ud558\uace0 \uc0c8\ub85c\uc6b4 \ubc84\uc804\uc758 \ubb38\uc81c\ub97c \uc2e0\uc18d\ud558\uac8c \ubc1c\uacac\ud558\uace0 \uc774\uc804\uc758 \uc548\uc815\ub41c \ubc84\uc804\uc73c\ub85c \ud2b8\ub798\ud53d\uc744 \ub2e4\uc2dc \ub77c\uc6b0\ud305\uc2dc\ud0a4\ub294\uac83\uc774 \uc8fc\uc694 \uae30\ub2a5\uc774\ub77c\uace0 \ubcf4\uba74 \ub41c\ub2e4.  \\n\\n\ubcf4\ud1b5 \ud488\uc9c8 \ud14c\uc2a4\ud2b8 \uc6a9\ub3c4\ub85c \ud604\uc7ac \uc6b4\uc601 \ubc84\uc804\uacfc \uc2e0\uaddc \ubc84\uc804\uc758 \uc8fc\uc694\ud55c \uc9c0\ud45c(\uc8fc\ub85c Prometheus Metric)\ub97c \ube44\uad50\ud558\uc5ec \ud3c9\uac00\ub97c \uc9c4\ud589\ud558\ub294\ub370 \uc774\ub97c \ub2e8\uc704 \ud14c\uc2a4\ud2b8\ub098 \ud1b5\ud569 \ud14c\uc2a4\ud2b8\ub97c \ub300\uccb4\ud558\uc5ec \uc0ac\uc6a9\ud574\uc11c\ub294 \uc808\ub300 \uc548\ub41c\ub2e4.  \\n\uc704\uc5d0\uc11c \uc5b8\uae09\ud558\uc600\ub4ef\uc774 \uc608\uae30\uce58 \uc54a\uc740 \uc704\ud5d8\uc744 \ucd5c\uc18c\ud654 \ud558\uac70\ub098 \ubb38\uc81c\ub97c \uc2e0\uc18d\ud558\uac8c \ubc1c\uacac\ud558\ub294 \uac83\uc744 \uc8fc \ubaa9\uc801\uc73c\ub85c \ud558\uae30 \ub54c\ubb38\uc774\ub2e4.\\n\\nSpinnaker\uc5d0\uc11c\ub294 \uae30\ubcf8\uc801\uc73c\ub85c 3\uac00\uc9c0 Cluster(Logical Application Group)\ub97c \uc0ac\uc6a9\ud55c\ub2e4.\\n\\n* Production Cluster - \ud604\uc7ac \uc2e4\ud589\uc911\uc778 \uc6b4\uc601 \ubc84\uc804\uc73c\ub85c Replica\ub294 \uc784\uc758\ub85c \ubcc0\uacbd\ud560 \uc218 \uc788\ub2e4. \\n* Baseline Cluster - Production Cluster\uc640 \ub3d9\uc77c\ud55c \ubc84\uc804\uc73c\ub85c \uc2e4\ud589\ub428\\n* Canary Cluster - \ubcc0\uacbd\ub41c \uc2e0\uaddc \ubc84\uc804\uc758 Software\ub85c \uc2e4\ud589\ub428\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c \uc218\ub3d9\uc73c\ub85c \uc9c4\ud589\ud560 \uacbd\uc6b0\uc5d0\ub294 \ub85c\uadf8\uc640 \uc218\uc9d1\ub41c \uba54\ud2b8\ub9ad\uc744 \ubd84\uc11d\ud558\uace0 \uac1d\uad00\uc801\uc778 \uc9c0\ud45c\ub85c \ud3c9\uac00\ub97c \uc9c4\ud589\ud558\ub294\uac8c \uae30\ubcf8\uc774\ub2e4.\\n\ud558\uc9c0\ub9cc \uc9c1\uc811 \uc0ac\ub78c\uc774 \ud558\ub294 \uc77c\uc774\ub77c \uba54\ud2b8\ub9ad \ub370\uc774\ud130\ub97c \ubcf4\ub2e4 \ubcf4\uba74 \ud3b8\uacac\uacfc \ucc29\uc624\uac00 \ubc1c\uc0dd\ud560 \uc218 \ubc16\uc5d0 \uc5c6\ub2e4.\\n\\n\uadf8\ub798\uc11c Netflix\ub294 ACA(Automated Canary Service)\ub77c\uace0 \ud558\ub294 \uc790\ub3d9\ud654\ub41c \uc811\uadfc \ubc29\uc2dd\uc744 \ud1b5\ud574 \uce74\ub098\ub9ac \ubd84\uc11d\uc744 \uc9c4\ud589\ud558\uace0 \uc788\ub2e4.\\n\uc218\ub3d9\uc73c\ub85c \uacc4\uc0b0\ub41c \uc5ec\ub7ec\uac00\uc9c0 \uc9c0\ud45c\ub97c \uac00\uc911\uce58 \uae30\ubc18\uc73c\ub85c \uc810\uc218\ub97c \ub0b4\ub9ac\uace0 \uc6d0\ud558\ub294 \uc810\uc218\uc5d0 \ub3c4\ub2ec\ud558\uba74 \ubc30\ud3ec\ud558\ub294 \uc790\ub3d9\ud654\ub41c \ubc29\uc2dd\uc774\ub2e4.\\n\\n## Requirements\\n* spinnaker cluster - 1.8+ (1.9.3 \uc774\uc0c1 \ucd94\ucc9c)\\n* halyard - 1.0+\\n* kubernetes cluster - 1.9+\\n* metric services - datadog, prometheus, stackdriver, signalfx\\n* persistent storage - S3(or compatible S3), minio, GCS\\n\\n## Kayenta Service \ucd94\uac00\ud558\uae30\\n\uc774\ubc88 \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 \uc544\ub798 \ud658\uacbd\uc73c\ub85c \uc791\uc131\ud558\uc600\ub2e4.\\n* spinnaker cluster - 1.10.5\\n* halyard - 1.11\\n* kubernetes cluster - 1.9.7\\n* metric services - prometheus\\n* persistent storage - compatible S3(IBM Object Storage)\\n\\n\uc77c\ub2e8 \uae30\uc874 halyard config\ub97c \ubc31\uc5c5\ud558\uc790. \\n```\\n$ hal backup create\\n+ Create backup\\n  Success\\n+ Successfully created a backup at location:\\n/Users/ddii/halbackup-Wed_Nov_28_13-35-31_KST_2018.tar\\n```\\n\\n\ub098\uc911\uc5d0 \ubcf5\uad6c\ub294 \uc544\ub798\uc640 \uac19\uc774 \ud558\uba74 \ub41c\ub2e4. \\n```\\n$ hal backup restore --backup-path <backup-name>.tar\\n```\\n\\n\uae30\uc874 halyard config\ub97c \uc0b4\ud3b4\ubcf4\uba74 \uc544\ub798\uc640 \uac19\uc774 canary.enabled=false \ub85c \ub418\uc5b4\uc788\ub294 \uac83\uc744 \ud655\uc778 \ud560\uc218 \uc788\ub2e4.\\n```\\ncurrentDeployment: default\\ndeploymentConfigurations:\\n- name: default\\n  canary\\n    enabled: false\\n```\\n\\ncanary analysis\uc744 \ud65c\uc131\ud654 \ud55c\ub2e4.\\n\\n```\\n$ hal config canary enable\\n```\\n\\n\uadf8\ub9ac\uace0 default judgement algorithm\uc740 `NetflixACAJudge-v1.0` \ub85c \ub418\uc5b4\uc788\ub2e4 \ub2e4\ub978 \uac78 \uc774\uc6a9\ud558\ub824\uba74 \ub2e4\uc74c\uacfc \uac19\uc774 \uc124\uc815\ud560\uc218 \uc788\ub2e4. \\n```\\n$ hal config canary edit --default-judge CUSTOM_JUDGE\\n```\\n\\n\uba54\ud2b8\ub9ad \uc18c\uc2a4\ub85c prometheus\ub97c \uc124\uc815\ud55c\ub2e4. \ubb3c\ub860 \uae30\uc874\uc5d0 \uc0ac\uc6a9\uc911\uc778 prometheus endpoint url\uc774 \ud544\uc694\ud558\ub2e4.\\n```\\nhal config canary prometheus enable\\nhal config canary prometheus account add my-prometheus --base-url http://YOUR_PROMETHEUS_SERVER:PORT\\n```\\n\\n\uc5ec\uae30\uc11c\ub294 IBM Cloud Object Storage(S3 Compatible)\uc744 \uc0ac\uc6a9\ud558\uc600\uc9c0\ub9cc aws\ub85c \uc124\uc815\ud55c\ub2e4.\\n```\\n$ hal config canary aws enable\\n$ hal config canary aws account add my-s3 --bucket spin-bucket --endpoint \\\\\\n    s3.seo-ap-geo.objectstorage.service.networklayer.com --access-key-id ACCESS_ID \\\\\\n    --secret-access-key\\n$ hal config canary aws edit --s3-enabled=true\\n```\\n\\n\uc5ec\ub7ec\uac1c\uc758 \uba54\ud2b8\ub9ad\uc744 \ub3d9\uc2dc\uc5d0 \uc124\uc815 \ubc0f \uc218\uc9d1\uc774 \uac00\ub2a5\ud558\ubbc0\ub85c \uadf8\uc911 prometheus \ubc0f \uad00\ub828 account\ub97c \uae30\ubcf8\uc73c\ub85c \uc124\uc815\ud55c\ub2e4.\\n```\\n$ hal config canary edit --default-metrics-store prometheus\\n$ hal config canary edit --default-metrics-account my-prometheus\\n$ hal config canary edit --default-storage-account my-s3\\n```\\n\\n\ubaa8\ub4e0 spinnaker cluster\uac00 \uc900\ube44\ub41c \uc0c1\ud0dc\uc758 \ucee8\ud53c\uadf8\ub294 \uc544\ub798\uc640 \uac19\ub2e4. \\n```\\ncurrentDeployment: default\\ndeploymentConfigurations:\\n- name: default\\n  canary:\\n    enabled: true\\n    serviceIntegrations:\\n    - name: google\\n      enabled: false\\n      accounts: []\\n      gcsEnabled: false\\n      stackdriverEnabled: false\\n    - name: prometheus\\n      enabled: true\\n      accounts:\\n      - name: my-prometheus\\n        endpoint:\\n          baseUrl: http://YOUR_PROMETHEUS_SERVER:PORT\\n        supportedTypes:\\n        - METRICS_STORE\\n    - name: datadog\\n      enabled: false\\n      accounts: []\\n    - name: aws\\n      enabled: true\\n      accounts:\\n      - name: my-s3\\n        bucket: spin-bucket\\n        rootFolder: kayenta\\n        endpoint: s3.seo-ap-geo.objectstorage.service.networklayer.com\\n        accessKeyId: ACCESS_ID\\n        secretAccessKey: ACCESS_KEY\\n        supportedTypes:\\n        - OBJECT_STORE\\n        - CONFIGURATION_STORE\\n      s3Enabled: true\\n    reduxLoggerEnabled: true\\n    defaultMetricsAccount: my-prometheus\\n    defaultStorageAccount: my-s3\\n    defaultJudge: NetflixACAJudge-v1.0\\n    defaultMetricsStore: prometheus\\n    stagesEnabled: true\\n    templatesEnabled: true\\n    showAllConfigsEnabled: true\\n```\\n\\nSpinnaker Cluster\ub97c \uc7ac\ubc30\ud3ec\ud558\uac8c \ub418\uba74 \uc544\ub798\uc640 \uac19\uc774 spin-kayenta deployments\uac00 \ucd94\uac00\ub41c \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n```\\n$ hal deploy apply\\n\\n$ kubectl get pod\\nNAME                                READY     STATUS    RESTARTS   AGE\\nspin-clouddriver-555cfc9765-kvnl8   1/1       Running   0          6d\\nspin-deck-85845b5b48-49ncm          1/1       Running   0          6d\\nspin-echo-5f9dd4d8ff-mvt7g          1/1       Running   0          6d\\nspin-fiat-5b945645d8-s2qcq          1/1       Running   0          6d\\nspin-front50-5c57fcf587-tqz28       1/1       Running   0          6d\\nspin-gate-57576b8c45-w5v6r          1/1       Running   0          6d\\nspin-kayenta-6dcd7767d6-rgb9w       1/1       Running   0          6d\\nspin-orca-788df6b9cc-tk6lk          1/1       Running   0          6d\\nspin-redis-6c87c456fc-6qbl2         1/1       Running   0          6d\\nspin-rosco-f6f845d49-btjnd          1/1       Running   0          6d\\n```\\n\\n\uc774\ud6c4 Dashboard\uc5d0 \uc811\uc18d\ud558\uace0 application\uc911 \ud558\ub098\uc758 Config\uc5d0 \ub4e4\uc5b4\uac00\uba74 Features\uc5d0 Canary\uba54\ub274\uac00 \uc0dd\uae34\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \uc0ac\uc6a9\uc124\uc815\ud558\uace0 \uce90\uc2f1\ud558\ub294\ub370 \uc2dc\uac04\uc774 \ub2e4\uc18c \ud544\uc694\ud558\uace0 Tasks \uba54\ub274\uc5d0\uc11c \ud574\ub2f9 job\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4. \\n\\n![canary](/img/canary_config.png)\\n\\n\uc774\ud6c4 application delivery \uba54\ub274\ub97c \ubcf4\uba74 pipelines, canary configs, canary reports\ub77c\ub294 \uba54\ub274\uac00 \uc0dd\uae30\uac8c \ub41c\ub2e4. \\n\\n![delivery](/img/delivery.png)\\n\\n## simple deploy pipeline \ucd94\uac00\\n\\n<https://cloud.google.com/solutions/automated-canary-analysis-kubernetes-engine-spinnaker> \uac00\uc774\ub4dc \ucc98\ub7fc \uad6c\uc131\ud574\ubd10\ub3c4 \ub418\ub098 `stackdriver`\ub97c \uc368\uc57c\ud558\uace0 `prometheus metric`\uc744 \ud65c\uc6a9\ud55c \uac00\uc774\ub4dc\uac00 \ud544\uc694\ud574\uc11c \uc801\uc5b4\ubcf4\uace0\uc790 \ud55c\ub2e4.\\n\\n\uc0c8\ub85c \ud30c\uc774\ud504\ub77c\uc778\uc744 \ucd94\uac00\ud55c \ub2e4\uc74c \\n\\n![newpipe](/img/newpipe.png)\\n\\nPipeline Actions - Edit Pipeline JSON \uc5d0\uc11c \\n<https://raw.githubusercontent.com/ddiiwoong/canary-demo-spinnaker/master/simple-deploy.json> \uc744 \ucd94\uac00\ud574\uc900\ub2e4.  \\n\\n\ud574\ub2f9 json pipeline\uc744 \ucd94\uac00\ud558\uace0 \ub098\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \ud654\uba74\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4. \\n![pipe1](/img/samplepipe1.png)\\n![pipe2](/img/samplepipe2.png)\\n\\n\ubc18\ub4dc\uc2dc Deploy Config, Deploy Stage\uc5d0\uc11c \ubc30\ud3ec\ud560 Account \uc9c0\uc815\uc744 \ud574\uc57c\ud55c\ub2e4. \\n\\n`sampleapp image - ddiiwoong/canary-demo-spinnaker:latest`\\n\\n\ud574\ub2f9 pipeline\ub0b4\uc758 sampleapp\uc740 python flask \uae30\ubc18\uc73c\ub85c \uad6c\uc131\ub418\uc5b4 \uac04\ub2e8\ud788 internal 500 error\ub97c \uc6d0\ud558\ub294 \ube44\uc728\uc744 configmap \ubcc0\uc218\ub85c \uad6c\ud604\ud560 \uc218 \uc788\ub2e4. [prometheus python client](https://github.com/prometheus/client_python#counter)\ub97c \uc0ac\uc6a9\ud558\uc5ec Gauge, Counter, Metric \uc11c\ubc84\ub97c \uac04\ub2e8\ud558\uac8c \uad6c\uc131\uc744 \ud574\ubcf4\uc558\ub2e4. \uadf8\ub9ac\uace0 \ucf54\ub4dc\ub0b4\uc5d0\uc11c 500 error rate\ub97c \uad6c\ud55c \uc774\uc720\ub294 18\ub144 11\uc6d4 \uae30\uc900 spinnaker kayenta \ubc84\uc804\uc5d0\uc11c\ub294 PromQL(rate,irate\uc640 \uac19\uc740 \ud568\uc218) \uc9c0\uc6d0\uc774 \ub418\uc9c0 \uc54a\ub294\ub2e4. \uac1c\ubc1c\uc911\uc778 \ucf54\ub4dc\uc5d0 \ud3ec\ud568\uc774 \ub41c\uac83\uc744 \ud655\uc778\ud558\uc600\uace0 12\uc6d4 kubecon\ub54c \uc815\uc2dd \ub9b4\ub9ac\uc988\uc5d0 \ud3ec\ud568\ub420\uac70\ub77c \uc0dd\uac01\ud55c\ub2e4. \\n\\n```\\n#!/usr/bin/env python\\n\\nfrom random import randrange\\nfrom flask import Flask\\nfrom prometheus_client import start_http_server, Gauge, Counter\\nimport os\\n\\napp = Flask(\'kayenta-tester\')\\nc = Counter(\'requests\', \'Number of requests served, by http code\', [\'http_code\'])\\ng = Gauge(\'rate_requests\', \'Rate of success requests\')\\n\\nresponce_500 = 0\\nresponce_200 = 0\\nrate_responce = 0\\n\\n@app.route(\'/\')\\ndef hello():\\n    global responce_500\\n    global responce_200\\n    global rate_responce\\n    if randrange(1, 100) > int(os.environ[\'SUCCESS_RATE\']):\\n        c.labels(http_code=\'500\').inc()\\n        responce_500 = responce_500 + 1\\n        rate_responce = responce_500 / (responce_500+responce_200) * 100\\n        g.set(rate_responce)\\n        return \\"Internal Server Error\\\\n\\", 500\\n    else:\\n        c.labels(http_code = \'200\').inc()\\n        responce_200 = responce_200 + 1\\n        rate_responce = responce_500 / (responce_500+responce_200) * 100\\n        g.set(rate_responce)\\n        return \\"Hello World!\\\\n\\"\\n\\nstart_http_server(8000)\\napp.run(host = \'0.0.0.0\', port = 8080)\\n\\n```\\n\\n\ud574\ub2f9\uc571\uc744 Start Manual Execuction\uc744 \ud1b5\ud574 \ubc30\ud3ec\ud55c\ub2e4. Comfirm Execution\ucc3d\uc5d0\uc11c SUCCESS_RATE\ub97c \uc6d0\ud558\ub294 \uac12(\uc608:70%)\uc73c\ub85c \uc120\ud0dd\ud558\uace0 \ubc30\ud3ec\ub97c \ud558\uace0 \ub098\uba74 Infrastructure - Clusters \uba54\ub274\uc5d0\uc11c \ud574\ub2f9 \uc0d8\ud50c\uc571\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n![manaul deploy](/img/manual.png)\\n![success rate](/img/successrate.png)\\n![manaul deploy2](/img/manual2.png)\\n\\n\uc2e4\uc81c \ud574\ub2f9 \uc11c\ube44\uc2a4\ub97c \uc811\uc18d\ud574\ubcf4\uba74 \uc704\uc5d0 \uc124\uc815\ud55c SUCCESS_RATE \ube44\uc728\ub85c 200\ud654\uba74\uacfc 500\uc5d0\ub7ec\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n![flaskweb](/img/flaskweb.png)\\n![flaskweb2](/img/flaskweb2.png)\\n\\n\ud574\ub2f9 \uba54\ud2b8\ub9ad\uc758 \ud1b5\uacc4\ub97c \ud655\uc778\ud558\uae30 \uc704\ud574 curl\uc744 \ubc18\ubcf5\uc801\uc73c\ub85c \uc2e4\ud589\ud558\ub294 injection container \ub97c \uc2e4\ud589\ud55c\ub2e4.\\n\\n```\\nkubectl -n default run injector --image=alpine -- \\\\\\n    /bin/sh -c \\"apk add --no-cache --yes curl; \\\\\\n    while true; do curl -sS --max-time 3 \\\\\\n    http://sampleapp:8080/; done\\"\\n```\\n\\n5\ubd84\uc815\ub3c4 \ud6c4\uc5d0 Prometheus\ub85c \uc811\uc18d\ud558\uc5ec \ucf54\ub4dc\ub0b4 \uc791\uc131\ud55c rate_requests \uba54\ud2b8\ub9ad\uc744 \ud655\uc778\ud574\ubcf8\ub2e4.  \\nPromQL\uc740 \uc544\ub798 \ucffc\ub9ac\ub97c \uc2e4\ud589\ud558\uc600\ub2e4.  \\n```\\nrate_requests{app=\\"sampleapp\\",version=\\"prod\\"}\\n```\\n\\n\uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 4\uac1c\uc758 pod\uc5d0\uc11c 70% \uc815\ub3c4 200 OK, 30% \uc815\ub3c4 500 Error\uac00 \ubc1c\uc0dd\ud558\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n![500rate](/img/500rate.png)\\n\\n\uc774 \uba54\ud2b8\ub9ad\uc744 Spinnaker \uc5d0\uc11c \ud655\uc778\ud558\uae30 \uc704\ud574 Canary Pipeline\uc744 \ub9cc\ub4e4\uc790.\\n\\n<https://raw.githubusercontent.com/ddiiwoong/canary-demo-spinnaker/master/automated-canary.json>\ub97c JSON\uc73c\ub85c Pipeline\uc744 \uc0dd\uc131\ud55c\ub2e4. \\n\\n![canary_auto](/img/canary_auto.png)\\n\\nStage\ubcc4\ub85c \uc0b4\ud3b4 \ubcf4\uae30\uc804\uc5d0 \\n\\n* Prerequisite  \\n  Canary Config \uad6c\uc131\uc774 \uba3c\uc800 \ud544\uc694\ud558\ub2e4. Delivery - Canary Configs \uba54\ub274\uc5d0\uc11c \uc2e0\uaddc \ucee8\ud53c\uadf8\ub97c \uc791\uc131\ud55c\ub2e4. \\n     - Configuration Name - `kayenta-test`\\n     - Filter Templates \uba54\ub274\ub97c \uba3c\uc800 \uc0dd\uc131\ud55c\ub2e4. Canary, Baseline\uad6c\ubd84\uc744 \uc704\ud574 version \uc815\ubcf4\ub97c \uc120\ud0dd\ud558\uc600\ub2e4. \\n     - Metrics - Add Metric \uc740 \ubd84\uc11d\uc744 \uc704\ud55c Prometheus Metric\uc744 \uc124\uc815\ud558\ub294 \ub2e8\uacc4\ub85c `error_rate`\uac00 \uc99d\uac00(increase)\ud558\uba74 Pipeline\uc744 \uc911\ub2e8\uc2dc\ud0a4\uace0 Metric\uc740 \uc55e\uc5d0\uc11c \ud655\uc778\ud55c `rate_requests`\ub97c \uc9c0\uc815\ud55c\ub2e4. Filter Template\uc740 \uc704\uc5d0\uc11c \uc9c0\uc815\ud55c version\uc744 \uc120\ud0dd\ud55c\ub2e4. ![metric config](/img/metric_config.png)\\n     - SCORING - \uc5b4\uc9dc\ud53c \uc608\uc81c\ub294 \ud55c\uac00\uc9c0 Metric\ubd84\uc11d\uc73c\ub85c 0\uc810 \uc544\ub2c8\uba74 100\uc810\uc73c\ub85c \ub098\uc62c\uac83\uc774\ubbc0\ub85c Maginal 75, Pass 95\ub97c \uc124\uc815\ud55c\ub2e4.\\n\\n1. 1st Stage\\n    * Configuration - Pipeline \uc2e4\ud589\uc2dc \ucd08\uae30 \uc785\ub825\uac12(0-100, 10\ub2e8\uc704)\uc73c\ub85c \uc124\uc815\uac00\ub2a5\ud55c successRate \ub77c\ub294 Parameter\ub97c \uc124\uc815\ud55c\ub2e4. \\n2. 2nd Stage\\n    * Find Baseline - \uc704\uc5d0\uc11c \uc791\uc131\ud55c \uae30\ubcf8 Deploy Pipeline\uc774 \uc120\ud0dd\ub418\uc5c8\ub294\uc9c0\uc640 \ud655\uc778\ud55c\ub2e4.\\n    * Deploy Canary Config - \uc55e\uc5d0\uc11c \uc120\ud0dd\ud55c \uc0c8\ub85c\uc6b4 Parameter(successRate)\ub97c \uc2e0\uaddc \ubc30\ud3ec\ud560 Canary Pod ConfigMap\uc73c\ub85c \uc124\uc815\ud558\ub294 \ub2e8\uacc4\uc774\ub2e4.\\n3. 3rd Stage\\n    * Deploy Canary - yaml manifest\ub85c Canary \ubc84\uc804\uc744 \ubc30\ud3ec\ud55c\ub2e4. Replicas\ub294 1\ub85c \uc124\uc815\ud558\uc600\uace0 \ubc30\ud3ec\ub420 Account(K8s Cluster)\ub97c \uc9c0\uc815\ud55c\ub2e4. \\n    * Deploy Baseline - yaml manifest\ub85c Baseline \ubc84\uc804\uc744 \ubc30\ud3ec\ud55c\ub2e4. \uc704\uc640 \ub3d9\uc77c\ud558\uac8c Replicas\ub294 1\ub85c \uc124\uc815\ud558\uc600\uace0 \ubc30\ud3ec\ub420 Account(K8s Cluster)\ub97c \uc9c0\uc815\ud55c\ub2e4. \\n4. 4th Stage\\n    * Canary Analysis - \uc911\uc694\ud55c Canary \ubd84\uc11d \ub2e8\uacc4\ub85c \uc544\ub798\uc640 \uac19\uc774 \uc124\uc815\uc744 \ud655\uc778\ud55c\ub2e4. Prerequisite\uc5d0\uc11c \uc124\uc815\ud55c Config(`kayenta-test`)\ub97c \uc120\ud0dd\ud558\uace0 \uc9e7\uc740 \ubd84\uc11d\uc744 \uc704\ud574 1\ubd84(60\ucd08) \uac04\uaca9\uc73c\ub85c 3\ubc88 \uc218\ud589\uc744 \ud558\ub3c4\ub85d \ud55c\ub2e4.   Filter Template\uc5d0\uc11c \uc9c0\uc815\ud55c version(`version=\\"${scope}\\"`) \ubd84\uc11d\uc744 \uc704\ud574 Baseline, Canary \uc124\uc815\uc744 \ud558\uace0 Location\uc740 Namespaces\ub85c \uc0dd\uac01\ud558\uba74 \ub41c\ub2e4. ![aca config](/img/aca_config.png)\\n5. 5th Stage\\n    * Deploy to Production - Canary \ubd84\uc11d\uc774 \ud1b5\uacfc\ud558\uc600\uc744 \uacbd\uc6b0 \uc6b4\uc601\uc5d0 \ubc30\ud3ec\\n    * Delete Canary, Delete Baseline - \uc131\uacf5\uc774\ub358 \uc2e4\ud328\uc774\ub358 Canary, Baseline \ubc30\ud3ec\ubcf8\uc744 \uc0ad\uc81c \\n6. 6th Stage\\n    * Successful deployment - Canary \ubd84\uc11d\uc774 \ud1b5\uacfc\ud558\uc600\uc744 \uacbd\uc6b0 \ucd5c\uc885 \uc644\ub8cc \ud45c\uae30\ud558\ub294 \ub2e8\uacc4\\n\\n\uc124\uc815\uc774 \ub9c8\ubb34\ub9ac\uac00 \ub418\uba74 \uc800\uc7a5\uc744 \ud558\uace0 Canary \ubd84\uc11d\uc5d0 \ub4e4\uc5b4\uac04\ub2e4. \\n\ucd5c\ucd08\uc5d0 `successRate`\uc744 70\uc73c\ub85c \ubc30\ud3ec\ud588\ub2e4\uba74 \uadf8 \uc774\ud558\ub85c \uc124\uc815\ud588\uc744 \uacbd\uc6b0\uc5d0\ub294 \uc544\ub798\uc640 \uac19\uc774 Score 0\uc810\uc73c\ub85c \ubc30\ud3ec\uac00 \uc2e4\ud328\ud558\uace0 Pipeline\uc774 \uc885\ub8cc\ub41c\ub2e4.   \\n\\n![fail](/img/canary_fail.png)  \\n\\n70 \uc774\uc0c1\uc73c\ub85c \uc124\uc815\ud558\uac8c \ub418\uba74 Score 100\uc810\uc73c\ub85c \uc815\uc0c1 \ubc30\ud3ec\ub428\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n![success](/img/canary_success.png)  \\n\\n\\n## \uc815\ub9ac\\n\uac04\ub2e8\ud558\uac8c Spinnaker \uc640 Prometheus Metric\uc744 \ud65c\uc6a9\ud558\uc5ec Kayenta \uae30\ubc18 Canary \ubc30\ud3ec\ub97c \ud574\ubd24\ub2e4. \ud604\uc7ac Spinnaker 1.10\uc5d0\uc11c istio\uac00 \uc9c0\uc6d0\ub41c\ub2e4\uace0 \ud558\ub2c8 \ub2e4\uc2dc \ud55c\ubc88 \ud655\uc778\ud558\uace0 istio \uae30\ubc18 canary \ubc30\ud3ec\uc640 \ud568\uaed8 \uc0ac\uc6a9\ud558\ub294 \ubc29\ubc95\uc744 \ub354 \uc5f0\uad6c\ud574\ubd10\uc57c \ud560 \uac83 \uac19\ub2e4.  \\n\\n\uc62c\ud574 AWS re:invent \ub05d\ub098\uace0 \uc791\ub144\ubcf4\ub2e4 \ud070 \ud604\uc790\ud0c0\uc784\uc774 \uc654\ub2e4. \uc624\ud508\uc18c\uc2a4\ub85c \uba39\uace0\uc0ac\ub294 \uc0ac\ub78c\ub4e4\uc758 \uae30\ubd84\uc740 \ub2e4 \ube44\uc2b7\ud560\uac70 \uac19\ub2e4\uace0 \uc0dd\uac01\uc774 \ub4e0\ub2e4. 12\uc6d4 11\uc77c \ubd80\ud130 Kubecon\uc774 \uc5f4\ub9b0\ub2e4\uace0 \ud558\ub2c8 Kubernetes \uad00\ub828\ud55c \uc0c8\ub85c\uc6b4 \ud504\ub85c\uc81d\ud2b8\uc640 \uae30\ub2a5\ub4e4\uc5d0 \uc9d1\uc911\ud574\uc11c \ub0a8\ub4e4\ubcf4\ub2e4 \ud55c\ubc1c \ub098\uc544\uac00\uc57c\ud558\uc9c0 \uc54a\uc744\uae4c? \uc624\ud508\uc18c\uc2a4\ub85c \uba39\uace0\uc0ac\uc2dc\ub294 \ubd84\ub4e4 \ub2e4\ub4e4 \ud798\ub0c8\uc73c\uba74 \uc88b\uaca0\ub2e4."},{"id":"kubernetes/spinnaker-advanced-2/","metadata":{"permalink":"/kubernetes/spinnaker-advanced-2/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-09-27-spinnaker-advanced-2.md","source":"@site/blog/2018-09-27-spinnaker-advanced-2.md","title":"Spinnaker on Kubernetes #2","description":"Spinnaker\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4 #2","date":"2018-09-27T00:00:00.000Z","formattedDate":"September 27, 2018","tags":[{"label":"CI/CD","permalink":"/tags/ci-cd"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Spinnaker","permalink":"/tags/spinnaker"},{"label":"Continuous Delivery","permalink":"/tags/continuous-delivery"},{"label":"Continuous Deployment","permalink":"/tags/continuous-deployment"},{"label":"Pipeline","permalink":"/tags/pipeline"}],"readingTime":7.61,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Spinnaker on Kubernetes #2","comments":true,"classes":"wide","description":"Spinnaker\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4 #2","slug":"kubernetes/spinnaker-advanced-2/","date":"2018-09-27T00:00:00.000Z","categories":["Kubernetes"],"tags":["CI/CD","Kubernetes","Spinnaker","Continuous Delivery","Continuous Deployment","Pipeline"]},"prevItem":{"title":"Spinnaker on Kubernetes #3 (Kayenta)","permalink":"/kubernetes/spinnaker-advanced-3/"},"nextItem":{"title":"knative","permalink":"/kubernetes/knative/"}},"content":"\uc774\uc804 \ud3ec\uc2a4\ud305 [Spinnaker on Kubernetes #1](https://ddii.dev/kubernetes/spinnaker-advanced-1/)\uc5d0\uc11c \uac80\ud1a0\ud560\ub54c\ub294 \ub9ce\uc774 \uac1c\ub150\uc744 \uc774\ud574\ud558\uae30 \uc5b4\ub824\uc6e0\ub358\uac83 \uac19\uc9c0\ub9cc \uc5b4\ub290\uc815\ub3c4 \uc2dc\uac04\uc774 \uc9c0\ub0ac\uace0 \ub610 \uba87\uc77c \ud6c4\uc5d0 \ubc1c\ud45c\ub3c4 \uc788\uc5b4\uc11c \ub2e4\ub978 \uc774\uc57c\uae30\ub97c \ud574\ubcf4\uace0\uc790 \ud55c\ub2e4.  \\n\\n\uc9c0\ub09c \ud3ec\uc2a4\ud305\uc5d0 \ub300\ucda9 \uc9d1\uace0 \ub118\uc5b4\uac04 \uc6a9\uc5b4\ub4e4\uc5d0 \ub300\ud55c \uc815\ub9ac\ub97c \ub2e4\uc2dc \ud558\uace0 \uae30\ubcf8\uc801\uc778 \uc0ac\uc0c1\ub4e4\uc744 \uc815\ub9ac\ud574\ubcf4\uace0\uc790 \ud55c\ub2e4. \ud5c8\uc811\ud55c \ud50c\ub7ab\ud3fc \uc5d4\uc9c0\ub2c8\uc5b4 \uc0dd\uac01\uc774\ub2c8 \uc5b8\uc81c\ub4e0 \ub2e4\ub978 \uc758\uacac\uc744 \ud658\uc601\ud558\ub294 \ubc14\uc774\ub2e4. \\n\\n## What is spinnaker? (+History)\\n\ucd5c\uadfc \ud2b8\ub80c\ub4dc\uc778 \uba40\ud2f0 \ud074\ub77c\uc6b0\ub4dc\ub97c \uc9c0\ud5a5\ud558\ub294 \uc624\ud508\uc18c\uc2a4 \ud50c\ub7ab\ud3fc\uc774\ub2e4.  \\n2014\ub144 Netflix\uc758 Asgard\ub85c \uc2dc\uc791\ub418\uc5b4 2015\ub144\uc5d0 \uc624\ud508\uc18c\uc2a4\ud654 \ub418\uc5c8\ub2e4.  \\n\ube60\ub978 \uc18d\ub3c4\uc640 \uc2e0\ub8b0\ub3c4\uc788\ub294 \uc18c\ud504\ud2b8\uc6e8\uc5b4 \ub9b4\ub9ac\uc988\ub97c \uc704\ud574 \ub9cc\ub4e4\uc5b4\uc84c\uc73c\uba70 \ub300\ubd80\ubd84\uc758 \uba54\uc774\uc800 \ud074\ub77c\uc6b0\ub4dc \ud504\ub85c\ubc14\uc774\ub354\ub4e4\uc744 \uc9c0\uc6d0\ud55c\ub2e4.(AWS,GCP,Azure,openstack..)  \\n\ud604\uc7ac Netflix, Google, MS, Veritas\ub4f1\uc774 Contribution\uc744 \ud558\uace0 \uc788\ub2e4.\\n\\n## \uc65c Spinnaker\ub97c \uc368\uc57c\ud558\uc9c0?\\n\uc5ec\ub7ec\uac00\uc9c0 \uc774\uc720\uac00 \uc788\uaca0\uc9c0\ub9cc\\n* Multi-Cloud\uc6a9 Continuous Delivery/Deployment Platform \uc73c\ub85c \ub300\uccb4\uac00 \uac00\ub2a5\\n* \ub2e4\uc591\ud55c pipeline \ud615\ud0dc\ub85c \ubc30\ud3ec\uac00 \uac00\ub2a5\ud558\uace0 Rollback\uc774 \uc26c\uc6c0\\n* \ube60\ub978 \ubc30\ud3ec\uac00 \uac00\ub2a5\ud558\uace0 \uc5ec\ub7ec\ubc88 \ubc30\ud3ec\uac00 \uc6a9\uc774\ud568\\n* \uc720\uc5f0\ud55c pipeline management system\uc744 \uac00\uc9c0\uace0 \uc788\uc74c\\n* \ub2e4\uc591\ud55c \ubc30\ud3ec\uc804\ub7b5\uc744 \uac00\uc9c4\ub2e4(Blue-Green, Rolling Red/Black, Canary)\\n* community \ud65c\ub3d9 \ud65c\ubc1c (github, slack) - \ub2f5\uc740 \uc798 \uc548\ud574\uc90c \u3160\u3160\\n* VM\uacfc Container \ub3d9\uc2dc\uc5d0 \ud1b5\ud569\uad00\ub9ac \uac00\ub2a5\\n* CI\ud1b5\ud569 \uc6a9\uc774(Jenkins)\\n* CLI\ub97c \ud1b5\ud55c \uc124\uce58 \ubc0f \uad00\ub9ac(halyard)\\n* VM, Helm Packaging \uac00\ub2a5\\n* RBAC \uc9c0\uc6d0\\n* Notification - Email, Slack, Hipchat\ub4f1\\n* Safe Deployment - Judgement (\uc2b9\uc778\uae30\ub2a5)\\n* Chaos Monkey Built-in\\n\\n\uc774\uc815\ub3c4\uba74 \ubb34\uc870\uac74 \uc368\uc57c\ud558\uc9c0 \uc54a\uc744\uae4c?\\n\\n## Jenkins vs Spinnaker\\n\\n|Jenkins|Spinnaker|\\n|:----------:|:----------:|\\n|\uac15\ub825\ud55c \ube4c\ub4dc\uc11c\ubc84|\\t\ud074\ub77c\uc6b0\ub4dc \uc790\uc6d0\uc758 1\ucc28 \uc5f0\ub3d9|\\n|\uc644\uc804\ud55c deployment tool\uc774 \uc544\ub2d8|vm & deployments \uc548\uc5d0 \ube4c\ub4dc\ub418\uc5b4 \uc788\uc74c|\\n|\uc2a4\ud06c\ub9bd\ud305\uc774 \ub9ce\uc774 \ud544\uc694\ud568|\ubcc4\ub3c4\uc758 \uc2a4\ud06c\ub9bd\ud305\uc774 \ub9ce\uc774 \ud544\uc694\uc5c6\uc74c|\\n|\uae30\ub2a5\ub4e4\uc774 \ubaa8\ub450 \ud50c\ub7ec\uadf8\uc778 \ud615\ud0dc|CI tool\uc774 \uc544\ub2d8(CI tools\uc774 \ubc31\uc5d4\ub4dc\ub85c)|\\n\\n## Kubernetes vs Spinnaker\\n\\n|Kubernetes|Spinnaker|\\n|:----------:|:----------:|\\n|\ub9ac\uc18c\uc2a4 \uc0ac\uc6a9 \uc81c\ud55c|\uc815\uc758\ud55c \ud37c\uc13c\ud2b8\ub85c rollout|\\n|slow rollout|\uac01 \ub2e8\uacc4\ubcc4 \uac80\uc99d \uac00\ub2a5|\\n|High rollback cost|Fast rollbacks|\\n|Linear rollouts|resource \uc0ac\uc6a9\ub7c9\uc774 \ud07c|\\n|\uac80\uc99d\ub2e8\uacc4\uac00 \uc5c6\uc74c||\\n\\n## Deploy Pipeline\\n\\nSpinnaker\ub97c \uc0ac\uc6a9\ud560\ub54c \uae30\ubcf8\uc801\uc73c\ub85c \uc544\ub798\uc640 \uac19\uc740 \ud30c\uc774\ud504\ub77c\uc778\uc73c\ub85c \uad6c\uc131\ud55c\ub2e4.  \\n\uc218\ub3d9\uc73c\ub85c UI\ub098 API\ub85c \ud2b8\ub9ac\uac70\ub9c1\ud560\uc218 \uc788\uace0, \uc790\ub3d9\uc73c\ub85c Jenkins \ub4f1\uacfc \ud2b8\ub9ac\uac70 \uc5f0\ub3d9\ud558\uc5ec \ube4c\ub4dc\uc644\ub8cc\uc2dc \ubc30\ud3ec\ub418\ub3c4\ub85d \ud560\uc218 \uc788\ub2e4.\\n\\n![spinnaker-pipeline](/img/spinnaker-pipeline.png)\\n\\n## Deployment Strategies\\nSpinnaker\uc5d0\uc11c\uc758 \ubc30\ud3ec\uc804\ub7b5\uc740 \ub2e4\uc74c\uacfc \uac19\uc774 \uc81c\uacf5\ub41c\ub2e4.\\n\\n![deployment-strategies](https://www.spinnaker.io/concepts/deployment-strategies.png)\\n\\n### Red / Black (same as Blue / Green)\\n* \ub3d9\uc77c\ud55c \uc591\uc758 instance\ub85c \uc774\ub8e8\uc5b4\uc9c4 \uc0c8\ub85c\uc6b4 Server Group\uc744 \uc0dd\uc131\ud55c\ub2e4\\n* \uc2e0\uaddc Server Group\uc774 \uc815\uc0c1\uc0c1\ud0dc\uac00 \ub418\uba74 LB\ub294 \uc2e0\uaddc Server Group\uc5d0 \ud2b8\ub798\ud53d\uc744 \ubd84\uc0b0\ud55c\ub2e4. \\n  \\n### Rolling red/black\\n* \uc774\uc804\uacfc \ub3d9\uc77c\ud558\uc9c0\ub9cc \uc778\uc2a4\ud134\uc2a4\ubcc4 \ub610\ub294 \uadf8\ub8f9\ubcc4\ub85c rolling\\n  \\n### Canary\\n* \uac00\uc7a5 \uc791\uc740 \uac1c\uc218\uc758 \uc778\uc2a4\ud134\uc2a4\ub97c \uad50\uccb4\uc2dc\ud0a4\uace0\\n* \uc0c8\ub85c\uc6b4 \ubc84\uc804\uc73c\ub85c \ud2b8\ub798\ud53d\uc744 \ubd84\uc0b0\uc2dc\ud0a8\ub2e4 (1~5\ud504\ub85c)\\n* \uc0c8\ub85c\uc6b4 \ubc84\uc804\uc5d0 \uc774\uc288\uac00 \uc5c6\uc744\ub54c\uae4c\uc9c0 \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud558\uace0\\n* \ud2b9\uc815\uc2dc\uac04\uae4c\uc9c0 \uc774\uc288\uac00 \uc5c6\uc73c\uba74 \ubc30\ud3ec\ub97c \ub298\ub824\uac04\ub2e4. \\n\\n## \uc6a9\uc5b4\uc815\ub9ac 2\ud0c4\\n\\n\uc774\uc804 [post](https://ddiiwoong.github.io/2018/spinnaker-advanced-1/)\uc5d0\uc11c \uc815\ub9ac\ud55c\uac78 \ub2e4\uc2dc \ubcf5\uae30\ud558\uace0 \ucd94\uac00\uc801\uc778 \ub0b4\uc6a9\uc744\ub4e4 \uc801\uc5b4\ubd24\ub2e4.\\n\\n\uc0ac\uc6a9\ud558\uba74\uc11c \ud63c\ub3c8\uc774 \ub9ce\uc774 \uc0dd\uae30\ub294 \ubd80\ubd84\uc774\ub2e4 \uc774\uac8c GCE\ub098 EC2\ub97c \uc4f0\uba74 \uc6a9\uc5b4 \ub9e4\uce6d\uc774 \uc26c\uc6b4\ub370 k8s\ub97c \uc704\ud55c \ubcc4\ub3c4\uc758 \uba54\ub274\uac00 \uc544\ub2cc \uae30\ub2a5\uc744 \ud1b5\ud569\ud558\ub2e4\ubcf4\ub2c8 \uc6a9\uc5b4\uac00 \uc870\uae08 \ud63c\ub3d9\uc2a4\ub7fd\uac8c \uad6c\uc131\uc774 \ub418\uc5c8\ub2e4.  \\n\ud2b9\ud788 Load Balancer \ubd80\ubd84\uc740 Service\ub85c \ub9e4\ud551\ub418\uace0 \ud37c\ube14\ub9ad k8s\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Type LoadBalancer\ub294 \ubbf8\uc9c0\uc6d0\ud55c\ub2e4.  \\n\uadf8\ub9ac\uace0 \ubaa8\ub4e0 Resource\ub4e4\uc740 Deploy, Delete, Scale, Rollout(Undo, Pause, Resume)\uc744 \uc9c0\uc6d0\ud558\uba70 Versioning\uc774 \uc9c0\uc6d0\ub41c\ub2e4.  Versioning\uc740 [\uc5ec\uae30](https://www.spinnaker.io/reference/providers/kubernetes-v2/#strategy)\uc5d0 \uc124\uba85\ub41c \ub300\ub85c ```strategy.spinnaker.io/versioned``` annotation\uc744 \ud1b5\ud574 manifest\ubcc4\ub85c \uc7ac\uc815\uc758\uac00 \uac00\ub2a5\ud558\ub2e4.\\n\\n| Spinnaker | Kubernetes | \ube44\uace0 |\\n|:----------:|:----------:|:-----------:|\\n| Server Group | [Workloads](https://www.spinnaker.io/reference/providers/kubernetes-v2/#workloads) | [CRD\uc758 \uacbd\uc6b0 \ubcc4\ub3c4 Build](https://www.spinnaker.io/guides/developer/crd-extensions/) |\\n| Clusters | Logical Server Group\\t |  |\\n| Load Balancer | Services | LoadBalancer(k8s) \ubbf8\uc9c0\uc6d0 |\\n| Firewall | NetworkPolicies |  |\\n\\n### Application Management\\nSpinnaker\uc5d0\uc11c Application \uc774\ub780 \ubc30\ud3ec\ud558\ub824\ub294 \uc11c\ube44\uc2a4\ub97c \ub098\ud0c0\ub0b4\ub294 \uad6c\uc870\ub77c \uc0dd\uac01\ud558\uba74 \ub41c\ub2e4.  \\n* pipeline\\n* Clusters, Server Group\uc758 \uc9d1\ud569\uc774\uba70, firewall\uacfc loadbalancer\ub97c \ud3ec\ud568\ud55c\ub2e4.\\n* Canary Config\\n\\n### Cluster\\nKubernetes\uc758 Cluster\uac00 \uc544\ub2c8\ub77c Spinnaker\uc5d0\uc11c Server Group\uc758 \ub17c\ub9ac\uc801\uc778 \uadf8\ub8f9\\n\\n### Server Group\\n\uae30\ubcf8\uc790\uc6d0\uc778 \uc11c\ubc84\uadf8\ub8f9\uc740 \ubc30\ud3ec\ud560\uc218 \uc788\ub294 artifacts(vm image, docker image, source)\uc640 \uc778\uc2a4\ud134\uc2a4(pod) \uc218, Auto-Scaling, metadata \ub4f1 \uae30\ubcf8 \uad6c\uc131\ub4f1\uc744 \uac00\uc9c0\uace0 \uc788\ub2e4.  \\n\uc11c\ubc84\uadf8\ub8f9\uc740 LoadBalacer\ub098 Firewall \ub3c4 \uc120\ud0dd\uc801\uc73c\ub85c \uc5f0\uacb0\ub418\uace0, vm\uc774\ub098 pod \ud615\ud0dc\ub85c \ubc30\ud3ec\ub41c application\uc758 \uc9d1\ud569\uccb4\ub77c \ubcfc\uc218 \uc788\ub2e4.\\n\\n### Cloud Provider\\n* IaaS - AWS, GCP, Azure, Oracle, Openstack\\n* PaaS -  Google App Engine\\n* Orchestrator - K8s, DC/OS\\n* Docker v2 Registry\\n\\n### Account\\nCloud Provider\uc5d0 \uc778\uc99d\ud558\uae30 \uc704\ud55c Spinnaker\uc5d0\uc11c\ub9cc \uc0ac\uc6a9\ud558\ub294 Account Name\\n\\n### Pipeline\\nPipeline\uc740 \uc8fc\uc694 \ubc30\ud3ec \uad00\ub9ac\ub3c4\uad6c\ub85c \uc0ac\uc6a9\ub41c\ub2e4. \\nStage\ub77c\uace0\ud558\ub294 \uc77c\ub828\uc758 Action\uc73c\ub85c \uad6c\uc131\ub418\uba70 \ud30c\uc774\ud504\ub77c\uc778\uc744 \ub530\ub77c Stage\uac04 \ub9e4\uac1c\ubcc0\uc218 \uc804\ub2ec\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n\uc218\ub3d9\uc73c\ub85c \uc2dc\uc791\ud558\uac70\ub098, Jenkins \uc791\uc5c5\uc644\ub8cc, Docker Registry \uc2e0\uaddc Docker \uc774\ubbf8\uc9c0, Cron\uc77c\uc815 \ub610\ub294 \ub2e4\ub978 Stage\uc640 \uac19\uc740 \uc774\ubca4\ud2b8\uc5d0 \uc758\ud574 \uc790\ub3d9\uc73c\ub85c \ud2b8\ub9ac\uac70\ub9c1\ub418\ub3c4\ub85d \uad6c\uc131\ud560\uc218 \uc788\ub2e4.  \\nPipeline \uc2e4\ud589\uc911\uc5d0(\uc2dc\uc791/\uc644\ub8cc/\uc2e4\ud328) mail, slack, hipchat(\uc0ac\ub77c\uc9d0)\uc744 \ud1b5\ud574 Alert\uac00 \uac00\ub2a5\ud558\ub2e4.\\n\\n![pipeline](https://www.spinnaker.io/concepts/pipelines.png)\\n\\n### Stage (atomic building block)\\nPipeline\uc774 \uc218\ud589\ud560 \ub3d9\uc791\uc744 \ub9d0\ud55c\ub2e4.  \\nDeploy, Resize, Disable, Manual Judgement \ub4f1\uc744 \uc218\ud589\ud560\uc218 \uc788\ub2e4.\\n\\n![stage](https://www.spinnaker.io/concepts/pipelines/pipeline-tasks.png)\\n\\n* Stage - Multiple steps\\n* Step - \uc9c4\ud589\ub418\uae30\uc804\uc5d0 \uad50\uc815/\ud3f4\ub9c1\uc774 \ud544\uc694\ud55c tasks\\n* Task - \ud2b9\uc815 Cloud Platform\uc73c\ub85c \ub3d9\uc2dc\uc5d0 \uc5ec\ub7ec API\ud638\ucd9c\\n* Operation - \ub2e8\uc704 API\\n\\n## \uc815\ub9ac\\n\\n\uc6a9\uc5b4\ub098 \uac1c\ub150\uc740 \uc5b4\ub290\uc815\ub3c4 \uc815\ub9ac\ub41c\ub4ef \ud558\uace0 \ub2e4\uc74c \ud3ec\uc2a4\ud305\uc5d0\uc11c\ub294 \uc2e4\uc81c multi cluster \ud658\uacbd\uc5d0\uc11c deploy\ud558\uace0 pipeline\uc744 \uc0ac\uc6a9\ud558\ub294 \ub0b4\uc6a9\uc744 \uc801\uc5b4\ubcfc \uc608\uc815\uc774\ub2e4."},{"id":"kubernetes/knative/","metadata":{"permalink":"/kubernetes/knative/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-08-01-knative.md","source":"@site/blog/2018-08-01-knative.md","title":"knative","description":"knative \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","date":"2018-08-01T00:00:00.000Z","formattedDate":"August 1, 2018","tags":[{"label":"Knative","permalink":"/tags/knative"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"FaaS","permalink":"/tags/faa-s"},{"label":"Serverless","permalink":"/tags/serverless"},{"label":"CRDs","permalink":"/tags/cr-ds"},{"label":"CloudEvents","permalink":"/tags/cloud-events"},{"label":"Mesh","permalink":"/tags/mesh"}],"readingTime":8.77,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"knative","comments":true,"classes":"wide","description":"knative \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","slug":"kubernetes/knative/","date":"2018-08-01T00:00:00.000Z","categories":["Kubernetes"],"tags":["Knative","Kubernetes","FaaS","Serverless","CRDs","CloudEvents","Mesh"]},"prevItem":{"title":"Spinnaker on Kubernetes #2","permalink":"/kubernetes/spinnaker-advanced-2/"},"nextItem":{"title":"Dex","permalink":"/kubernetes/dex/"}},"content":"## Knative\\n\\n\ubbf8\uce5c\ub188\ub4e4 \ubaa8\uc5ec\uc11c \ubbf8\uce5c\uac83\uc744 \ub9cc\ub4e4\uc5c8\uad70.. \u314e\u314e \\n\uc608\uc0c1\ud588\ub358 \ub0b4\uc6a9\ub4e4\uc744 \ud604\uc2e4\ub85c \ub9cc\ub4dc\ub294 \ud074\ub77c\uc2a4\\n\\nKubernetes \uad00\ub828 \ube44\uc9c0\ub2c8\uc2a4\ub97c \ud558\uace0 \uc788\ub294 \uc785\uc7a5\uc5d0\uc11c \ubd10\ub3c4 \ub180\ub784\uc77c\uc774\uc9c0\ub9cc\\n\uc778\ud504\ub77c \uc601\uc5ed\ubd80\ud130 \uac1c\ubc1c\uc790 \uc601\uc5ed\uae4c\uc9c0 \ubaa8\ub450\ub97c \ucd94\uc0c1\ud654\uc2dc\ud0a4\ub294 \ud074\ub77c\uc6b0\ub4dc \ub124\uc774\ud2f0\ube0c\uc758 \ud798\uc774\ub780 \ucc38 \ub300\ub2e8\ud558\ub2e4.\\n\\n\uc624\ub298\uc740 knative\uc5d0\uc11c \uc8fc\uc694\uae30\ub2a5\ub4e4\uc744 \ub458\ub7ec\ubcf4\uace0\uc790 \ud55c\ub2e4.\\n\\n\uac1c\uc778\uc801\uc778 \uc0dd\uac01\uc740 Kubernetes \uc9c4\uc601\uc774\ub77c\uace0 \ud574\uc57c\ud558\ub098 CNCF \uc9c4\uc601\uc774\ub77c\uace0 \ud574\uc57c\ud558\ub098..\\n\uadf8\ub3d9\uc548 \ub178\ub798\ub97c \ubd80\ub974\uace0 \uc8fc\ubaa9\ud588\ub358 CRDs, Operators, Serverless Workload, CloudEvents, Mesh Layer \uac1c\ub150\uacfc \uc601\uc5ed\uc744 \ud761\uc218\ud574\uc11c \uadf8 \uae30\ubc18\uc73c\ub85c \ud655\uc7a5\uc2dc\ud0a4\uace0 \uc788\ub2e4. \\n\\n```\\nkubectl apply -f https://storage.googleapis.com/knative-releases/serving/latest/release.yaml\\n```\\n\\n\uc704 \ucf54\ub4dc \ub0b4\uc6a9\uc744 \uc0c1\uc138\ud558\uac8c \ubcf4\uace0\uc788\uc9c0\ub9cc \ub2f4\uc740\uac83\ub4e4\uc774 \uc815\ub9d0 \ub9ce\ub2e4. \uadf8\ub798\ub3c4 \ub2e4 \uc774\ud574\ud558\ub824\uba74 \ud558\ub098\ud558\ub098 \ucc59\uaca8\ubd10\uc57c \ud55c\ub2e4.\\n\\n\uc624\ub298\uc740 \uc77c\ub2e8 \ucf54\uc5b4 \uae30\ub2a5\ub9cc \uc0b4\ud3b4\ubcf8\ub2e4.\\n\\n## Build\\n\\n`build`\ub294 Knative\uc758 \uc8fc\uc694 `custom resource`\uc774\uace0 \uc774\ub97c \uc774\uc6a9\ud558\uc5ec fetch, build, package\ub97c \uc218\ud589\ud55c\ub2e4. repo\uc758 \uc18c\uc2a4\ub97c \ube4c\ub4dc\ud558\uace0 \ucee8\ud14c\uc774\ub108\ub85c \uc774\ubbf8\uc9c0\ub85c \ub9cc\ub4e4\uace0 \uadf8\ub2e4\uc74c\uc5d0 Knative `Serving`\uc73c\ub85c \ubcf4\ub0b8\ub2e4\uace0 \ud55c\ub2e4. \\n\\n\\n### Build \uc6a9\uc5b4\\n- `Build`\ub294 \uc5ec\ub7ec `steps`\uc744 \ud3ec\ud568\ud558\uace0 `Builder`\ub85c \uad6c\uccb4\ud654\ub41c\ub2e4\\n- `Builder`\ub294 \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0 \uc720\ud615\\n- `Build`\ub0b4 `steps`\uc740 repository\uc5d0 push\ub97c \ud560 \uc218 \uc788\uc74c\\n- `BuildTemplate` \ub294 \uc7ac\ud65c\uc6a9\uac00\ub2a5\ud55c \ud15c\ud50c\ub9bf\\n- `Build`\ub0b4 `source`\ub294 kubernetes Volume\uc73c\ub85c mount\ub418\ub294 \ub370\uc774\ud130\ub97c \uc815\uc758\ud560\uc218 \uc788\uace0 git, Google Cloud Storage, \ucee8\ud14c\uc774\ub108 \uc774\ubbf8\uc9c0\ub97c \uc9c0\uc6d0\ud568.\\n- kubernetes Secret\uc744 \uc0ac\uc6a9\ud558\uc5ec `ServiceAccount`\ub85c \uc778\uc99d\ud568\\n\\n## Serving\\n\\nKnative `Serving`\uc740 Kubernetes\uc640 Istio\ub97c \uae30\ubc18\uc73c\ub85c Serverless Workload\uac00 \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc791\ub3d9\ud558\ub294 \ubc29\uc2dd\uc744 \uc815\uc758\ud558\uace0 \uc81c\uc5b4\ud558\ub294\ub370 \uc0ac\uc6a9\ub41c\ub2e4\uace0 \ud558\uc9c0\ub9cc \uc5c4\uc5f0\ud788 Public FaaS(AWS Lambda\ub4f1)\uc640\ub294 \uad6c\ubcc4\ub418\uc5b4\uc57c \ud55c\ub2e4\uace0 \uc0dd\uac01\ud55c\ub2e4.\\n\\nServerless \ub77c\uace0 \ud558\ub294 \uc6a9\uc5b4\ub97c \uc27d\uac8c \uc0dd\uac01\ud558\ub294 \uc0ac\ub78c\ub4e4\uc774 \ub9ce\uc740\ub370 \uacb0\uad6d \ub098\uc911\uc5d0\ub294 \uac04\ub2e8\ud55c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\ub4e4\uc740 \ub2e4 Serverless \uc2a4\ud0c0\uc77c\ub85c \uc804\ud658\ub420\uac83\uc774\ub77c\ub294 \uc0ac\uc0c1\uc744 \uc11c\ube44\uc2a4\ub098 \ud50c\ub7ab\ud3fc\uc5d0 \ub123\uace0 \uc788\ub294 \ucd94\uc138\ub2e4. \\n\\nCNCF \uc9c4\ud615\uc758 Cloud Event\ub77c\uace0 \ud558\ub294 \uc774\ubca4\ud2b8 \uadf8\ub9ac\ub4dc\ubc29\uc2dd\uc758 \ud45c\uc900\ud654\ub97c \ub530\ub77c \uac00\ub294\uac83\uc778\uc9c0 \uc544\ub2c8\uba74 \uc0c8\ub85c\uc6b4 \uc2a4\ud0c0\uc77c\uc744 \uc815\uc758\ud558\ub824\uace0 \ud558\ub294\uac83\uc778\uc9c0\ub294 \uadf8\ub4e4\uc758 \ud5a5\ud6c4 Cloud Native \ub85c\ub4dc\ub9f5\uc5d0 \ub2ec\ub824\uc788\ub2e4 \ud574\ub3c4 \ubb34\ubc29\ud560\uac83 \uac19\ub2e4. \\n\\n- Serverless Container\uc758 \uc2e0\uc18d\ud55c \ubc30\uce58\uac00 \uac00\ub2a5\\n- Automatic scaling up and down to zero\\n- Istio Component\\n- \ubc30\ud3ec \ub41c \ucf54\ub4dc \ubc0f config\uc758 \ud2b9\uc815 \uc2dc\uc810 \uc2a4\ub0c5 \uc0f7\\n\\n### `Serving` Resources\\nCRDs\ub85c \uc815\uc758\ud55c Objects \uc9d1\ud569\uccb4, \uc774\ub7ec\ud55c Object\ub4e4\uc740 Serverless \uc6cc\ud06c\ub85c\ub4dc \ud615\ud0dc\ub85c \uc815\uc758\ub418\uace0 \uc0ac\uc6a9\ub41c\ub2e4. \\n\uac00\uc7a5 \uc778\uc0c1\uae4a\uace0 \uc911\uc694\ud55c \ubb38\uad6c\ub294 `Request-driven compute that can scale to zero` \uc778 \uac83 \uac19\ub2e4.\\n\\n\ud55c\ub3d9\uc548 \uc720\ud589\ud588\ub358 OpenPaaS, CF\uae30\ubc18\uc758 PaaS \ud50c\ub7ab\ud3fc\uc744 \ub6f0\uc5b4\ub118\ub294 \uad6c\ucd95\ud615 \uadf8\uac83\ub3c4 \uc2a4\ud504\ub9c1\ubd80\ud2b8 \uc601\uc5ed\uae4c\uc9c0\ub3c4 kubernetes \uae30\ubc18 \uc774\ubca4\ud2b8 \ub4dc\ub9ac\ube10 \uc11c\ubc84\ub9ac\uc2a4\ub85c \uac04\ub2e4\ub294 \uc774\uc57c\uae30...\\n\\n\uc774\ubbf8 \ud37c\ube14\ub9ad\uc73c\ub85c\ub294 [GA](https://cloud.spring.io/spring-cloud-function/)\ub3c4 \ub418\uc5c8\ub2e4.\\n\\n\uc6b0\ub9ac \ud300\uc6d0\ub4e4\uacfc \ud568\uaed8 \uc5f4\uc2ec\ud788 vmware dispatch framework\uc73c\ub85c \uac1c\ubc1c\ud558\uace0 \uc788\uc9c0\ub9cc \uacb0\uad6d pivotal\uacfc vmware\ub294 \uac70\uc758 \ud55c\ubab8\uc774\uae30\uc5d0 \ub354\uc6b1 \ub354 \ubcc0\ud654\uac00 \ud544\uc694\ud55c \uc21c\uac04\uc774\ub2e4.\\n\\n![serving](https://github.com/knative/serving/raw/master/docs/spec/img/object_model.png)\\n\\n- `Route`\ub294 \uc0ac\uc6a9\uc790 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c HTTP endpoint\ub97c \uc81c\uacf5.\\n- `Revisions`\uc740 code(function)\uc640 config\ub85c \uad6c\uc131\ub41c \ubd88\ubcc0\uc758 \uc2a4\ub0c5\uc0f7. Route\ub97c \ud1b5\ud574 endpoint\ub97c \ud560\ub2f9\ubc1b\uc9c0 \ubabb\ud55c Revision\uc740 \uc790\ub3d9\uc73c\ub85c kubernetes resource\uc5d0\uc11c \uc0ad\uc81c\ub428\\n- `Configuration`\uc740 \uc694\uad6c\ub418\ub294 Revision \ucd5c\uc2e0 \uc0c1\ud0dc\ub97c \uae30\ub85d\ud558\uace0 \uc0dd\uc131\ud558\uace0 \ucd94\uc801\ud560\uc218 \uc788\uc74c. \uc18c\uc2a4 \ud328\ud0a4\uc9c0(git repo\ub098 archive)\ub97c \ucee8\ud14c\uc774\ub108\ub85c \ubcc0\ud658\ud558\uae30 \uc704\ud55c \ub0b4\uc6a9\uc774\ub098 \uba54\ud0c0\ub370\uc774\ud130\ub4f1\uc744 \ud3ec\ud568\uc2dc\ud0ac\uc218 \uc788\uc74c. \\n- `Service`\ub294 `Routes`\uc640 `Configurations` \ub9ac\uc18c\uc2a4\uc758 \ucd94\uc0c1\ud654\ub41c \uc9d1\ud569\uccb4. \ubaa8\ub4e0 \uc6cc\ud06c\ub85c\ub4dc\uc758 lifecycle\uc744 \uad00\ub9ac\ud568. \ud2b8\ub798\ud53d\uc744 \ud56d\uc0c1 \ucd5c\uc2e0\uc758 revision\uc73c\ub85c route\ub418\ub3c4\ub85d \uc815\uc758\ud560\uc218 \uc788\uc74c\\n\\n\\n\\n## Events\\n\\nCNCF\uc758 [CloudEvent Spec.](https://www.cncf.io/events/) \uae30\ubc18\uc73c\ub85c \ud558\ub294 \uc774\ubca4\ud2b8\ub97c produce/comsume \ud558\ub294 \ubc29\ubc95\uc744 \uc81c\uacf5\ud55c\ub2e4. \ud50c\ub7ec\uadf8\uc778 \ud615\ud0dc\ub85c \uc774\ubca4\ud2b8\ub97c \uc218\uc2e0\ud560\uc218 \uc788\uace0 \ub2e4\uc591\ud55c pub/sub \uc2a4\ud0c0\uc77c\uc758 broker service\ub97c \ud1b5\ud574 \uc81c\uacf5\ub420\uc218 \uc788\ub2e4. \\n\\nAzure\ub294 \uc774\ubbf8 [EventGrid\uc11c\ube44\uc2a4](https://azure.microsoft.com/ko-kr/services/event-grid/)\ub97c GA\ub97c \ud55c \uc0c1\ud669\uc774\uace0 [Pivotal](https://pivotal.io/kr/knative) \uc9c4\uc601\ub3c4 Serverless Workload\ub294 `Knative`\uae30\ubc18\uc73c\ub85c \ub118\uc5b4\uac04\ub2e4\uace0 \ud588\uc73c\ub2c8 [Dispatch](https://github.com/vmware/dispatch) \ub3c4 \uacb0\uad6d \ub530\ub77c\uac00\uc9c0 \uc54a\uc744\uae4c \uc0dd\uac01\ud574\ubcf8\ub2e4. \\n\\n![eventing_concept](https://github.com/knative/docs/raw/master/eventing/concepts.png)\\n\\n### Bus\\nKafka\ub098 Nats\uc640 \uac19\uc740 \uba54\uc2dc\uc9c0 Bus\ub97c \ud1b5\ud574 K8s\uae30\ubc18\uc758 pub/sub\uc744 \uc81c\uacf5\ud558\ub294 \uac1c\ub150. \uc774\ubca4\ud2b8\ub294 Channel\uc5d0 \uc758\ud574 \uac8c\uc2dc\ub418\uace0 \uad00\uc2ec\uc788\ub294 \uc0ac\ub78c\uc5d0\uac8c \ub77c\uc6b0\ud305\ub428.\\n\\n- Channel : \uc5ec\uae30\uc11c \uc774\uc57c\uae30 \ud558\ub294 \ucc44\ub110\uc740 \ud2b9\uc815 bus\uc5d0 \uc0ac\uc6a9\ub418\ub294 \uc774\ubca4\ud2b8\ub97c \ubc1b\uae30 \uc704\ud55c \ub124\ud2b8\uc6cc\ud06c \uae30\ubc18 \uc5d4\ub4dc\ud3ec\uc778\ud2b8\\n- Subscription : Channel\uc5d0\uc11c \uc218\uc2e0\ud55c \uc774\ubca4\ud2b8\ub97c \uad00\uc2ec\uc788\ub294 target, DNS\uc774\ub984\uc73c\ub85c \ud45c\ud604\ub418\ub294 \uc774\ubca4\ud2b8\uc5d0 \uc5f0\uacb0\ud568\\n- Bus : (kafka topic\uc5d0 \uc774\ubca4\ud2b8\uac00 \uc804\ub2ec\ub418\ub294\uac83 \ucc98\ub7fc) \ud2b9\uc815 \uc9c0\uc18d\uc131 \uc804\ub7b5\uc744 \uc0ac\uc6a9\ud558\uc5ec Channel\uacfc Subscription\uc744 \uad6c\ud604\ud558\ub294\ub370 \ud544\uc694\ud55c \uc801\uc6a9 \uacc4\uce35\uc744 \uc815\uc758\ud568\\n\\n\\n\ud604\uc7ac 3\uac00\uc9c0\uc758 Bus\uac00 \uc81c\uacf5\ub428 ([Kafka](https://github.com/knative/eventing/tree/master/pkg/buses/kafka), [Stub](https://github.com/knative/eventing/tree/master/pkg/buses/stub), [GCP PubSub](https://github.com/knative/eventing/tree/master/pkg/buses/gcppubsub))\\n\\n\\n### Sources\\n\\nSource\ub294 K8s \uc678\ubd80\uc758 \ub370\uc774\ud130 \uc18c\uc2a4\ub97c \ud504\ub85c\ube44\uc800\ub2dd\ud558\uace0 \uc774\ub97c \ud074\ub7ec\uc2a4\ud130\ub85c \ub77c\uc6b0\ud305\ud558\uae30 \uc704\ud55c \ucd94\uc0c1\ud654 \ub808\uc774\uc5b4\ub97c \uc81c\uacf5\ud568. \uc544\ub798\uc640 \uac19\uc740 \uc18c\uc2a4\ub4e4\uc744 \uc81c\uacf5\ud558\uace0 \uc788\uc74c\\n\\n- Feed : EventType\uacfc Action (CloudEvents \ud638\ud658 HTTP endpoint)\uac04\uc758 \uc5f0\uacb0\uc744 \uc815\uc758\ud558\ub294 \uae30\ubcf8 \uac1d\uccb4\\n- EventType and ClusterEventType : EventSource\uc5d0\uc11c \ubd84\ub9ac\ub418\ub294 \uacf5\ud1b5\uc2a4\ud0a4\ub9c8\ub85c \ud2b9\uc815 \uc774\ubca4\ud2b8\uc758 \uc9d1\ud569, EventType\uc740 Namespace \ubc94\uc704\ub0b4\uc5d0\uc11c \uc0ac\uc6a9\ub418\uace0 ClusterEventType\uc740 \ubaa8\ub4e0 Namespace\uc5d0\uc11c \uc0ac\uc6a9\ub420\uc218 \uc788\ub3c4\ub85d \uad00\ub9ac\uc790\uc5d0 \uc758\ud574 \uc124\uce58\ub428\\n- EventSource and ClusterEventSource : \ud558\ub098 \uc774\uc0c1\uc758 EventTypes\ub97c \uc0dd\uc131 \ud560 \uc218\uc788\ub294 \uc678\ubd80 \uc2dc\uc2a4\ud15c\uc744 \uae30\uc220\ud568\\n\\n\ud604\uc7ac 3\uac00\uc9c0 Sources\ub97c \uc81c\uacf5\ud568\\n- K8sevents : [Kubernetes Events](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.10/#event-v1-core)\ub97c \uc218\uc9d1\ud558\uace0 CloudEvents \ud0c0\uc785\uc73c\ub85c \ud45c\uc2dc\ud568\\n- Github : PR(pull request) notification\uc744 \uc218\uc9d1\ud558\uace0 CloudEvents \ud0c0\uc785\uc73c\ub85c \ud45c\uc2dc\ud568\\n- GCP PubSub : GCP PubSub topic\uc73c\ub85c publish\ub41c \uc774\ubca4\ud2b8\ub97c \uc218\uc9d1\ud558\uace0 CloudEvents \ud0c0\uc785\uc73c\ub85c \ud45c\uc2dc\ud568\\n\\n### Flows\\n\\n\ub9c8\uc9c0\ub9c9\uc73c\ub85c Source\uc5d0\uc11c Endpoint\uae4c\uc9c0 \ubb36\uc5b4\uc8fc\ub294 Flow\ub77c\uace0 \ubd80\ub974\ub294 \ub192\uc740 \uc218\uc900\uc758 \ucd94\uc0c1\ud654\uac00 \uc788\ub2e4.\\nSpec\uc73c\ub85c \uc774\ubca4\ud2b8\uac00 \ub77c\uc6b0\ud305\ub41c Channel\uacfc Bus\ub97c \uae30\uc7ac\ud558\uc5ec \uc0ac\uc6a9\ud560 \uc218 \uc788\ub2e4.\\nFlow\ub294 Eventing\uc5d0\uc11c \ucd5c\uc0c1\uc704 \uac1c\ub150\uc73c\ub85c \uc0ac\uc6a9\uc790\uac00 \uc120\ud0dd\ud560\uc218 \uc788\uace0, \uc678\ubd80 Source \uc774\ubca4\ud2b8\uc5d0\uc11c \ubaa9\uc801\uc9c0\uae4c\uc9c0 \uc6d0\ud558\ub294 \uacbd\ub85c\ub97c \uae30\uc220\ud560\uc218 \uc788\ub2e4.\\n\\n# \uc815\ub9ac\\n\uc6cc\ub099 \ubc29\ub300\ud55c \uc591\uc744 \uac00\uc9c0\uace0 \uc788\uace0 \uc774\ud574\ud558\ub824\uace0 \ub178\ub825\ud558\uba74\uc11c \uc801\ub2e4\ubcf4\ub2c8 \ubc88\uc5ed\uc704\uc8fc\ub85c \ub418\uc5b4\ubc84\ub838\ub2e4. \\n\uc6d0\ub798 \ub2e4\uc74c\ubc88\uc5d0 Nats Streaming\uc744 \ub2e4\ub8f0 \uc608\uc815\uc774\uc600\uc73c\ub098, \\n\ub2f9\ubd84\uac04\uc740 knative \uad6c\uc131\uc694\uc18c\ub97c \uc774\ud574\ud558\uace0 \uc801\uc6a9\ud558\ub294 \uc704\uc8fc\ub85c \ud3ec\uc2a4\ud305\uc744 \ud560 \uc608\uc815\uc774\ub2e4. \uc544\ub9c8\ub3c4 \ubaa8\ub4c8\ubcc4(Serving, Building, Eventing) \uc2dc\ub9ac\uc988\uac00 \ub420 \ub4ef \ud558\ub2e4."},{"id":"kubernetes/dex/","metadata":{"permalink":"/kubernetes/dex/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-07-26-dex.md","source":"@site/blog/2018-07-26-dex.md","title":"Dex","description":"Dex \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","date":"2018-07-26T00:00:00.000Z","formattedDate":"July 26, 2018","tags":[{"label":"dex","permalink":"/tags/dex"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"identity service","permalink":"/tags/identity-service"},{"label":"OIDC","permalink":"/tags/oidc"},{"label":"connectors","permalink":"/tags/connectors"}],"readingTime":9.39,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Dex","comments":true,"classes":"wide","description":"Dex \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","slug":"kubernetes/dex/","date":"2018-07-26T00:00:00.000Z","categories":["Kubernetes"],"tags":["dex","Kubernetes","identity service","OIDC","connectors"]},"prevItem":{"title":"knative","permalink":"/kubernetes/knative/"},"nextItem":{"title":"Cert-manager","permalink":"/kubernetes/cert-manager/"}},"content":"## Dex - A federated OpenID Connect provider\\n----\\n### dex\ub294 \uae30\ubcf8\uc801\uc73c\ub85c OpenID Connect\ub97c \uc0ac\uc6a9\ud558\uc5ec \ub2e4\ub978 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc758 \uc778\uc99d\uc744 \ud558\uac8c \ud574\uc8fc\ub294 identity \uc11c\ube44\uc2a4\ub2e4.  \\nhttps://github.com/coreos/dex\\n\\n\\nDex\ub294 \\"connectors\\"\ub97c \ud1b5\ud574 \ub2e4\ub978 identity provider\uc758 \ud3ec\ud138(\uac8c\uc774\ud2b8\uc6e8\uc774, \uc911\uacc4\uc790) \uc5ed\ud560\uc744 \ud55c\ub2e4. \uc774\ub97c \ud1b5\ud574 LDAP, SAML\ub610\ub294 GitHub, Google, AD(Active Directory)\uc640 \uac19\uc740 \uae30\uc874 \uc778\uc99d\uc744 dex\uc5d0\uac8c \uc704\uc784\ud560 \uc218 \uc788\ub2e4. \ud074\ub77c\uc774\uc5b8\ud2b8\ub294 \uc77c\ub2e8 \uc778\uc99d \ub85c\uc9c1\uc744 \uc791\uc131\ud558\uc5ec dex\uc640 \ud1b5\uc2e0\ud558\uba74 dex\ub294 \uc8fc\uc5b4\uc9c4 \ubc31\uc5d4\ub4dc(\uc5ec\uae30\uc11c\ub294 \uc608\uc2dc\ub85c kubernetes \ud074\ub7ec\uc2a4\ud130)\uc5d0 \ub300\ud55c \ud504\ub85c\ud1a0\ucf5c\uc744 \ucc98\ub9ac\ud558\uac8c \ub41c\ub2e4. \\n\\n\ud558\uc9c0\ub9cc \ud5a5\ud6c4 Cloud Native \uc778\uc99d \uce74\ud0c8\ub85c\uadf8 \uc911 \ud558\ub098\ub85c\uc11c \uc0dd\uac01\ud558\uace0 \uc788\ub294 \uc624\ud508\uc18c\uc2a4\uc774\ub2e4 \ubcf4\ub2c8 \ud14c\uc2a4\ud2b8\ub294 \uc9c4\ud589\ud574\ubd10\uc57c \ud560 \uac83 \uac19\ub2e4.\\n\\n### OpenID Connect\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c Dex\ub294 OIDC(OpenID Connect)\ub97c \uc0ac\uc6a9\ud55c\ub2e4.  \\n\uadf8\ub7ec\ubbc0\ub85c [kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0ac\uc6a9\uc790 \uc778\uc99d\uc6a9\ub3c4](https://kubernetes.io/docs/reference/access-authn-authz/authentication/#using-kubectl)\ub85c Dex\ub97c \ubd99\uc77c\uc218 \uc788\ub294 \uac83\uc774\ub2e4.  \\n\ub610\ud55c \uc704\uc5d0\uc11c \ub9d0\ud55c\uac83\uacfc \uac19\uc774 \ub2e4\ub978 identity provider\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc0ac\uc6a9\uc790\ub97c \uc778\uc99d\ud558\ub294\ub370 \uc544\ub798 \uadf8\ub9bc\uacfc \uac19\uc774 [connectors](https://github.com/coreos/dex#connectors)\ub97c \uc0ac\uc6a9\ud55c\ub2e4. \\n\\n![dex_image](/img/dex-flow.png)\\n\\n\uc704 \uadf8\ub9bc\uacfc \uac19\uc774 \\"connectors\\"\ub294 \ub2e4\ub978 identity provider\ub97c \ud1b5\ud574 \uc0ac\uc6a9\uc790\ub97c \uc778\uc99d\ud558\uae30 \uc704\ud574 dex\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \uae30\ubcf8 \ub3c4\uad6c\ub2e4. \uacb0\uad6d Dex\ub294 \uae30\uc874\uc5d0 \ud65c\uc6a9\ud558\ub358 GitHub, LinkedIn \ubc0f Microsoft AD\uc640 \uac19\uc740 \ubca4\ub354 \ud50c\ub7ab\ud3fc\uc774\ub098 LDAP \ubc0f SAML\uacfc \uac19\uc740 \uae30\uc874 \ud504\ub85c\ud1a0\ucf5c \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uc5ec kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0ac\uc6a9\uc790 \uc778\uc99d\uc744 \uc27d\uac8c \uad6c\ud604\ud560 \uc218 \uc788\ub294 \uac83\uc774\ub2e4. \ud070 \ud68c\uc0ac??\ub4e4\uc740 OpenLDAP\uc774\ub098 Microsoft Active Directory\uc640 \uac19\uc740 \uc0ac\ub0b4 \ub514\ub809\ud1a0\ub9ac \uc11c\ube44\uc2a4\ub97c \uc6b4\uc6a9\ud558\uac70\ub098 \ub0b4\uac00 \uc788\ub294 \uc791\uc740 \uaddc\ubaa8\uc758 \ud300\ub4e4\uc740 \ub300\ubd80\ubd84 Github\uc774\ub098 Google \uacc4\uc815\uc740 \uac00\uc9c0\uace0 \uc788\uc744 \uac83\uc774\uae30 \ub54c\ubb38\uc5d0 Dex\uc640 \uac19\uc740 \uc624\ud508\uc18c\uc2a4\ub97c \uc0ac\uc6a9\ud568\uc73c\ub85c\uc368 \uae30\uc874 identity provider \uc640 kubernetes\ub97c \uc27d\uac8c \ud1b5\ud569\ud560 \uc218 \uc788\ub2e4\uace0 \ubcf8\ub2e4.\\n\\n![dex_kube](/img/dex_architect.png)\\n\\n### Kubernetes OIDC\\n\\n\uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc Identity Provider \uc704\uce58\uc5d0 Dex\ub97c \uad6c\uc131\ud558\uba74 \ub41c\ub2e4.\\n\\n![kube_openid](https://d33wubrfki0l68.cloudfront.net/d65bee40cabcf886c89d1015334555540d38f12e/c6a46/img/docs/admin/k8s_oidc_login.svg)\\n\\npublic managed kubernetes \ud658\uacbd\uc5d0\uc11c\ub294 \ud604\uc2e4\uc801\uc73c\ub85c kubeapi-server\ub97c \ucee8\ud2b8\ub864\ud558\uae30 \uc5b4\ub835\uae30 \ub54c\ubb38\uc5d0 \uc77c\ub2e8 Native \ud074\ub7ec\uc2a4\ud130\uc5d0 \uad6c\uc131\uc744 \ud558\ub3c4\ub85d \ud55c\ub2e4.\\n\\n### Github \uc5f0\ub3d9\ud558\uae30\\n\ud14c\uc2a4\ud2b8\ub85c Github\uc744 \uc5f0\ub3d9\ud574\ubcf4\uc790. \uc77c\ub2e8 \uc544\ub798\uc640 \uac19\uc774 \uc778\uc99d\uc11c\ub97c \uc0dd\uc131\ud558\ub294 \uc2a4\ud06c\ub9bd\ud2b8\ub97c \ud558\ub098\ub9cc\ub4e0\ub2e4.  \\n\uc544\ub798\uc5d0\uc11c DNS.1 \ubd80\ubd84\uc740 /etc/hosts\ub85c \ud14c\uc2a4\ud2b8\ub85c \ub4f1\ub85d\ud560 \ub3c4\uba54\uc778\uc73c\ub85c \uac00\uc0c1\uc73c\ub85c \ub9cc\ub4e4\uc5c8\ub2e4. (generator.sh)\\n\\n```\\n#!/bin/bash\\n\\nmkdir -p ssl\\n\\ncat << EOF > ssl/req.cnf\\n[req]\\nreq_extensions = v3_req\\ndistinguished_name = req_distinguished_name\\n[req_distinguished_name]\\n[ v3_req ]\\nbasicConstraints = CA:FALSE\\nkeyUsage = nonRepudiation, digitalSignature, keyEncipherment\\nsubjectAltName = @alt_names\\n[alt_names]\\nDNS.1 = dex.newtech.academy\\nEOF\\n\\nopenssl genrsa -out ssl/ca-key.pem 2048\\nopenssl req -x509 -new -nodes -key ssl/ca-key.pem -days 10 -out ssl/ca.pem -subj \\"/CN=kube-ca\\"\\n\\nopenssl genrsa -out ssl/key.pem 2048\\nopenssl req -new -key ssl/key.pem -out ssl/csr.pem -subj \\"/CN=kube-ca\\" -config ssl/req.cnf\\nopenssl x509 -req -in ssl/csr.pem -CA ssl/ca.pem -CAkey ssl/ca-key.pem -CAcreateserial -out ssl/cert.pem -days 10 -extensions v3_req -extfile ssl/req.cnf\\n```\\n\\nNamespace\ub3c4 \ud558\ub098 \ub9cc\ub4e4\uc790. (dex-ns.yaml)\\n\\n```\\napiVersion: v1\\nkind: Namespace\\nmetadata:\\n  name: dex\\n```\\n\\n\\nkubernetest \ud074\ub7ec\uc2a4\ud130\uc6a9 \uc778\uc99d\uc11c\ub97c \uc0dd\uc131\ud55c\ub2e4.\\n```\\n$ ./generator.sh\\n$ kubectl create -f dex-ns.yaml\\n$ kubectl create secret tls dex.newtech.academy.tls -n dex --cert=ssl/cert.pem --key=ssl/key.pem\\n$ mkdir pki\\n$ cp ssl/ca.pem pki/openid-ca.pem\\n```\\n\\nGithub\uc5d0 \uac00\uc11c \uc544\ub798\uc640 \uac19\uc774 Org OAuth App.\uc744 \uc2e0\uaddc\ub85c \uc0dd\uc131\ud55c\ub2e4.  \\n\\n![github](/img/dex_github.png)\\n\\n\ub9cc\ub4e0 \uc704 \uc571\uc815\ubcf4\ub85c Github-Client Secret\uc744 \ub9cc\ub4e0\ub2e4.\\n\\n```\\n$ export GITHUB_CLIENT_ID=<Client ID>\\n$ export GITHUB_CLIENT_SECRET=<Client Secret>\\n\\n$ kubectl create secret \\\\\\n    generic github-client \\\\\\n    -n dex \\\\\\n    --from-literal=client-id=$GITHUB_CLIENT_ID \\\\\\n    --from-literal=client-secret=$GITHUB_CLIENT_SECRET\\n\\n$ kubectl get secret\\nNAME                  TYPE                                  DATA      AGE\\ndefault-token-f29fb   kubernetes.io/service-account-token   3         27m\\ndex.newtech.academy.tls    kubernetes.io/tls                     2         27m\\ngithub-client         Opaque                                2         6s\\n\\n$ kubectl get secret github-client -o yaml\\napiVersion: v1\\ndata:\\n  client-id: xxxxx\\n  client-secret: xxxxxxx\\nkind: Secret\\nmetadata:\\n  creationTimestamp: 2018-07-24T15:14:29Z\\n  name: github-client\\n  namespace: dex\\n  resourceVersion: \\"7044721\\"\\n  selfLink: /api/v1/namespaces/dex/secrets/github-client\\n  uid: 42dfa0e9-8f54-11e8-8d6d-2aaad36eb114\\ntype: Opaque\\n```\\n\uc704\uc5d0\uc11c \uc774\uc57c\uae30 \ud588\uc9c0\ub9cc \uc5ec\uae30\uae4c\uc9c0 \uc544\ubb34\uc0dd\uac01\uc5c6\uc774 \ud37c\ube14\ub9ad\uc5d0\uc11c \uad6c\uc131\ud558\ub2e4\uac00 \uc0dd\uac01\ud574\ubcf4\ub2c8 kube-apiserver\ub97c \ubcc0\uacbd\ud558\ub824\uba74 \uc9c1\uc811 \ud074\ub7ec\uc2a4\ud130\ub97c \uc368\uc57c\ud55c\ub2e4\ub294 \uc774\ub7f0 \ubc14\ubcf4\uac19\uc740 \uc2e4\uc218\ub97c \ub610 \uc800\uc9c0\ub974\uace0 \ub9d0\uc558\ub2e4. \uadf8\ub798\uc11c \ub2e4\uc2dc VM\uc5d0 \uc7ac\uad6c\uc131\uc744 \u315c\u315c\\n\\n\uadf8\ub9ac\uace0 kube-apiserver manifest \ud30c\uc77c\uc5d0 \uc544\ub798 \ub0b4\uc6a9\uc744 \ucd94\uac00\ud55c\ub2e4.  \\n/etc/kubernetes/manifests/kube-apiserver.manifest\\n\\n```\\n    - --oidc-issuer-url=https://dex.newtech.academy:32000\\n    - --oidc-client-id=example-app\\n    - --oidc-ca-file=/pki/openid-ca.pem\\n    - --oidc-username-claim=email\\n    - --oidc-groups-claim=groups\\n```\\n\\n\uadf8\ub9ac\uace0 kubelet \uc7ac\uc2dc\uc791\uc744 \ud55c\ub2e4. \\n```\\n$ systemctl restart kubelet\\n```\\n\\n\ud14c\uc2a4\ud2b8\ub97c \uc704\ud574 dex sample app\uc744 \ube4c\ub4dc\ud558\uace0 \ub9cc\ub4e0 \uc778\uc99d\uc11c\uc640 \ud568\uaed8 \uc2e4\ud589\ud558\uac8c \ub418\uba74 \uc544\ub798\uc640 \uac19\uc774 \uc0d8\ud50c\ud398\uc774\uc9c0\ub97c \ubcfc\uc218 \uc788\ub2e4. \\n```\\n$ sudo apt-get install make golang-1.9\\n$ git clone https://github.com/coreos/dex.git\\n$ cd dex\\n$ git checkout v2.10.0\\n$ export PATH=$PATH:/usr/lib/go-1.9/bin\\n$ go get github.com/coreos/dex\\n$ make bin/example-app\\n$ export MY_IP=$(curl -s ifconfig.co)\\n$ ./bin/example-app --issuer https://dex.newtech.academy:32000 --issuer-root-ca /pki/openid-ca.pem --listen http://${MY_IP}:5555 --redirect-uri http://${MY_IP}:5555/callback\\n2018/07/25 14:37:52 listening on http://169.56.94.55:5555\\n```\\n![dex_sample](/img/dex_sample.png)\\n\\n\uadf8\ub9ac\uace0 \ub85c\uadf8\uc778\uc744 \ud558\uac8c \ub418\uba74 \uc544\ub798\uc640 \uac19\uc774 Github \uc778\uc99d\uc744 \ud1b5\ud574 kubernetes \ud074\ub7ec\uc2a4\ud130\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub824\uace0 \ud558\ub294 Token\uc744 \ud68d\ub4dd\ud560 \uc218 \uc788\ub2e4.\\n\\n![kube_dex](/img/kube_dex.png)\\n\\n\\n\\n![dex_token](/img/dex_token.png)\\n\\n\\n\ub2e4\uc74c\uc73c\ub85c \uc704\uc5d0\uc11c \ub9cc\ub4e0 token\uc744 \uc0ac\uc6a9\ud558\uae30 \uc704\ud574\uc11c Role, RoleBinding\uacfc \uc2e4\uc81c \ub85c\uadf8\uc778\ud560 github \uacc4\uc815\uc744 User\ub85c \uc0ac\uc6a9\ud558\ub3c4\ub85d \uc544\ub798\uc640 \uac19\uc774 \uc791\uc131\ud55c\ub2e4.\\n\\n```\\napiVersion: rbac.authorization.k8s.io/v1beta1\\nkind: Role\\nmetadata:\\n  name: exampleUser\\n  namespace: default\\nrules:\\n- apiGroups: [\\"\\"] # \\"\\" indicates the core API group\\n  resources: [\\"pods\\"]\\n  verbs: [\\"get\\", \\"watch\\", \\"list\\"]\\n---\\napiVersion: rbac.authorization.k8s.io/v1beta1\\nkind: RoleBinding\\nmetadata:\\n  name: exampleUser\\nroleRef:\\n  apiGroup: rbac.authorization.k8s.io\\n  kind: Role\\n  name: exampleUser\\nsubjects:\\n- kind: User\\n  name: ddiiwoong@gmail.com\\n  namespace: default\\n```\\n\\n\uacc4\uc815\uc0dd\uc131\uc744 \ud558\uace0 \uc704\uc5d0\uc11c \ub9cc\ub4e0 token\uc744 \uac00\uc9c0\uace0 developer \uc0ac\uc6a9\uc790\ub97c \uc124\uc815\ud558\uace0 context\uc124\uc815\ub85c dev-default\ub85c \uc0dd\uc131\ud55c\ub2e4.\\n\\n```\\n$ kubectl create -f user.yaml\\nrole.rbac.authorization.k8s.io \\"exampleUser\\" created\\nrolebinding.rbac.authorization.k8s.io \\"exampleUser\\" created\\n\\n$ export TOKEN=<dex_sample_app_token>\\n\\n$ kubectl config set-credentials developer --auth-provider=oidc --auth-provider-arg=idp-issuer-url=https://dex.newtech.academy:32000 --auth-provider-arg=client-id=example-app --auth-provider-arg=idp-certificate-authority=/pki/openid-ca.pem  --auth-provider-arg=id-token=${TOKEN}\\nUser \\"developer\\" set.\\n\\n$ kubectl config set-context dev-default --cluster=kubernetes --namespace=default --user=developer\\nContext \\"dev-default\\" created.\\n```\\n\\n\uc704\ucc98\ub7fc \ub9cc\ub4e4\uace0 \ub098\uba74 \ud604\uc7ac \ud074\ub7ec\uc2a4\ud130\uc758 context\ub4e4\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4. \ud655\uc778\ud6c4\uc5d0 context\ub97c dev-default\ub85c \ubc14\uafd4\ubcf4\uc790.  \\n\uc0c8\ub85c\uc6b4 context\ub97c \ud655\uc778\ud560\uc218 \uc788\ub2e4. \\n\\n```\\n$ kubectl config get-contexts\\nCURRENT   NAME                  CLUSTER         AUTHINFO              NAMESPACE\\n*         admin-cluster.local   cluster.local   admin-cluster.local   \\n          dev-default           kubernetes      developer             default\\n\\n$ kubectl config use-context dev-default\\nSwitched to context \\"dev-default\\".\\n\\n$ kubectl config get-contexts\\nCURRENT   NAME                  CLUSTER         AUTHINFO              NAMESPACE\\n          admin-cluster.local   cluster.local   admin-cluster.local   \\n*         dev-default           kubernetes      developer             default\\n\\n$ kubectl get pod --all-namespaces\\nNAMESPACE     NAME                                    READY     STATUS    RESTARTS   AGE\\ndex           dex-64c4fb5b44-42d44                    1/1       Running   0          1h\\ndex           dex-64c4fb5b44-r9p9d                    1/1       Running   0          1h\\ndex           dex-64c4fb5b44-w5s2m                    1/1       Running   0          1h\\nkube-system   calico-node-2bqll                       1/1       Running   0          13h\\nkube-system   calico-node-cljb2                       1/1       Running   0          13h\\nkube-system   calico-node-svh5n                       1/1       Running   0          13h\\nkube-system   kube-apiserver-node1                    1/1       Running   0          1h\\nkube-system   kube-controller-manager-node1           1/1       Running   2          13h\\nkube-system   kube-dns-7bd4d5fbb6-7bb2j               3/3       Running   0          13h\\nkube-system   kube-dns-7bd4d5fbb6-g8lz8               3/3       Running   0          13h\\nkube-system   kube-proxy-node1                        1/1       Running   0          13h\\nkube-system   kube-proxy-node2                        1/1       Running   0          13h\\nkube-system   kube-proxy-node3                        1/1       Running   0          13h\\nkube-system   kube-scheduler-node1                    1/1       Running   2          13h\\nkube-system   kubedns-autoscaler-679b8b455-qxlvw      1/1       Running   0          13h\\nkube-system   kubernetes-dashboard-55fdfd74b4-mbkm8   1/1       Running   0          13h\\nkube-system   nginx-proxy-node2                       1/1       Running   0          13h\\nkube-system   nginx-proxy-node3                       1/1       Running   0          13h\\nkube-system   tiller-deploy-5c688d5f9b-52tls          1/1       Running   0          13h\\n```\\n\\n### \uc815\ub9ac\\n\ucc98\uc74c\uc5d0\ub3c4 \uc5b8\uae09\ud588\ub4ef\uc774 kubernetes \uc778\uc99d\uc744 \uc704\ud574 \ubb34\uac70\uc6b4 keycloak\uc744 \uc0ac\uc6a9\uc744 \ud558\ub294 \uacbd\uc6b0\ub4e4\uc774 \ub9ce\uc740\ub370 \uac04\ub2e8\ud558\uac8c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 dex\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc5ec\ub7ec\uac00\uc9c0 identity provider\uc758 connector \uc5ed\ud560\ub85c \uc0ac\uc6a9\ud558\uae30\uc5d0\ub294 \ubb34\ub09c\ud55c\uac83 \uac19\ub2e4.  \\n\uacb0\uad6d Dex\ub97c \uc774\uc6a9\ud558\uba74 GitHub\ub97c \ube44\ub86f\ud574 \ub2e4\uc591\ud55c OpenID, OAuth 2.0 \uc778\uc99d \uc11c\ube44\uc2a4\uc640 Kubernetes \ud074\ub7ec\uc2a4\ud130\ub97c \uc5ee\uae30 \uc26c\uc6b8\uc218 \uc788\ub2e4.  \\n\ub2e8, \ucd5c\uadfc commit\uc774 3-4\ub2ec\uc804\uc774\ub77c\ub294\uac83\uacfc \ucc98\uc74c stable helm\uc5d0 \ub4f1\ub85d\ub41c \ud6c4 \uc5c5\ub370\uc774\ud2b8\uac00 \uc5c6\uc5c8\ub2e4\ub294 \uc810\uc774 \uac71\uc815\ub418\ub294 \ubd80\ubd84\uc774\uae34 \ud558\ub2e4. (\ubb18\ud558\uac8c Redhat\uacfc \ud569\ubcd1 \uc77c\uc815\uc774 \uc624\ubc84\ub7a9 \ub418\uae34\ud55c\ub2e4...)\\n\\n\\n\uac70\uc758 2\uc8fc\ub9cc\uc5d0 \ud3ec\uc2a4\ud305\uc778\ub370 \'18 Google Next \ud0a4\ub178\ud2b8\uc5d0\uc11c [knative](https://github.com/knative/)\ub77c\ub294 \ud604\uc7ac \uac1c\ubc1c\uc911\uc778 \ud504\ub85c\uc81d\ud2b8\uc640 \uc720\uc0ac\ud55c \uc624\ud508\uc18c\uc2a4\uac00 \uacf5\uac1c\ub418\uc5c8\ub2e4. \ub2e4\uc74c\ubc88\uc5d4 knative\ub3c4 \ud55c\ubc88 \ud14c\uc2a4\ud2b8\ub97c \ud574\ubd10\uc57c \ud560\ub4ef \ud558\ub2e4. \\n\\n\ud37c\ube14\ub9ad\uacfc \ud504\ub77c\uc774\ube57 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub300\ud55c \uace0\ubbfc\uc774 \uc0dd\uae30\uae30 \uc2dc\uc791\ud55c\ub2e4. \ub2e4\uc2dc\uae08 \uc624\ud508\uc18c\uc2a4 \ud50c\ub7ab\ud3fc\uc5d0 \uc9d1\uc911\ud558\uae30 \uc704\ud574 \ud504\ub77c\uc774\ube57\uc73c\ub85c \ub3cc\uc544\uac00\uc57c \ud558\ub098\ub77c\ub294 \uace0\ubbfc\uc5d0\ub3c4 \ube60\uc838\uc788\ub294 \uc0c1\ud0dc\uc5d0\uc11c knative, GKE on Premise \uac19\uc740 \uc5d4\ud130\ud504\ub77c\uc774\uc988\uc5d0\uc11c \ud504\ub77c\uc774\ube57 \uad6c\ucd95\uc744 \uc704\ud55c \uac83\ub4e4\ub3c4 \ub098\uc624\uace0 \uc788\uc5b4\uc11c \ub354\ub354\uc6b1 \uace0\ubbfc\uc5d0 \ube60\uc9c4 \uc694\uc998\uc774\ub2e4..."},{"id":"kubernetes/cert-manager/","metadata":{"permalink":"/kubernetes/cert-manager/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-07-13-cert-manager.md","source":"@site/blog/2018-07-13-cert-manager.md","title":"Cert-manager","description":"Cert-manager\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","date":"2018-07-13T00:00:00.000Z","formattedDate":"July 13, 2018","tags":[{"label":"Cert-manager","permalink":"/tags/cert-manager"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"TLS","permalink":"/tags/tls"},{"label":"Manage TLS Certificates","permalink":"/tags/manage-tls-certificates"},{"label":"Security","permalink":"/tags/security"},{"label":"HTTPS","permalink":"/tags/https"}],"readingTime":8.14,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Cert-manager","comments":true,"classes":"wide","description":"Cert-manager\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","slug":"kubernetes/cert-manager/","date":"2018-07-13T00:00:00.000Z","categories":["Kubernetes"],"tags":["Cert-manager","Kubernetes","TLS","Manage TLS Certificates","Security","HTTPS"]},"prevItem":{"title":"Dex","permalink":"/kubernetes/dex/"},"nextItem":{"title":"Operators & CRDs(CustomResourceDefinitions) on Kubernetes","permalink":"/kubernetes/operator/"}},"content":"## TLS \uc778\uc99d\uc11c\\n\\n\uc81c\ud55c\ub41c \uc608\uc0b0\uacfc \uc2dc\uac04, \uc778\ub825\uc73c\ub85c \uc11c\ube44\uc2a4\ub97c \ub9cc\ub4e4\ub2e4 \ubcf4\ub2c8 \uc5b4\ub824\uc6b4 \uc810\ub4e4\uc774 \ucc38 \ub9ce\ub2e4. \ud2b9\ud788\ub098 TLS \uc778\uc99d\uc11c \uac19\uc740 \uacbd\uc6b0 \uad00\ub9ac\ud558\ub294\uac83\uc774 \uc740\uadfc\ud788 \uadc0\ucc2e\ub2e4. \uc778\uc99d\uc11c \ub9cc\ub8cc\uc77c \uad00\ub9ac\ud558\ub294\uac83 \ubd80\ud130 \uc5b4\ub290 \ud398\uc774\uc9c0\uae4c\uc9c0\ub97c \ud3c9\ubb38\uc73c\ub85c\ub9cc \ub450\uc5b4\uc57c \ud558\ub294\uc9c0\ub3c4... \uadf8\ub7f0\ub370 \ubc14\ubcf4\uac19\uc740 \uc774\uc288\ub97c \uc800\uc9c0\ub974\uace0 \ub9d0\uc558\ub2e4. \ub3c4\uba54\uc778\uc744 \uc2e0\uccad\ud558\uace0 fanout, Name based virtual hosting \ubc29\uc2dd\uc911\uc5d0 \uace0\ubbfc\ud558\ub2e4\uac00 \uc124\uacc4\ub97c virtual host\ub85c \ud558\uc600\ub2e4.  \\n\\n\uadf8\ub7f0\ub370 \ubb38\uc81c\ub294 \uc5b4\uc774\uc5c6\ub294\uacf3\uc5d0\uc11c \ub098\uc654\ub2e4. *.xxxxx.io \ub77c\uace0 wildcard SSL \uc778\uc99d\uc11c\ub97c \uc2e0\uccad\ud558\uc600\ub294\ub370 virtual host\ubc29\uc2dd\uc73c\ub85c 2\ucc28 subdomin (\uc608, api.stg.xxxxx.io)\uc73c\ub85c ingress\ub97c \ub9c8\uad6c\uc7a1\uc774\ub85c \uc0dd\uc131\ud558\uace0 \uc778\uc99d\uc11c\ub97c \uc801\uc6a9\uc744 \ud588\ub2e4. \ud558\uc9c0\ub9cc \uc778\uc99d\uc11c \uc624\ub958 \u314b\u314b\\n\\n\uc778\ud130\ub137 \ube44\uc9c0\ub2c8\uc2a4\ub97c \uac70\uc758 \ud574\ubcf4\uc9c0 \uc54a\uc544\uc11c \uc778\uc9c0, \uc774\ub7f0 \uae30\ubcf8\uc801\uc778 \ub0b4\uc6a9\ub3c4 \uac04\uacfc\ud558\uace0 \uc11c\ube44\uc2a4\ub97c \uad6c\uc0c1\ud55c \ub0b4\uac00 \ubaa8\ub4e0\uac78 \ucc45\uc784\uc838\uc57c\ud558\ub294 \uc0c1\ud669\uc774 \uc640\ubc84\ub838\ub2e4. \\n\\n\uc124\uacc4\ub97c \uc774\uc0c1\ud558\uac8c \ud574\uc11c wildcard \ub3c4\uba54\uc778\uc744 \uba87\uc2ed\uac1c\ub97c \uc2e0\uaddc\ub85c \uacc4\uc57d\ud574\uc57c\ud558\ub294 \uc4f8\ub370\uc5c6\ub294 \ube44\uc6a9\uc744 \ub4e4\uc5b4\uc57c\ud558\ub294 \ucc98\uc9c0\uac00 \ub418\uc5c8\ub2e4. \ud558\uc9c0\ub9cc \uadf8\ub0e5 \uc8fd\uc73c\ub780 \ubc95\uc740 \uc5c6\ub294\uac8c \uc0ac\ub78c\uc0ac\ub294 \uc138\uc0c1\uc774\uace0 \uc774\ub7f0 \uace0\ubbfc\ub4e4\uc744 \ubd84\uba85 \ub2e4\ub978\uc0ac\ub78c\ub4e4\ub3c4 \ud588\uc744\uac70\uc57c\ub77c\uace0 \uc0dd\uac01\ud558\uba74\uc11c \ub5a0\uc624\ub978\uac8c let\'s encrypt \uc600\uace0 \ucc3e\uc544\ubcf4\ub2c8 \uc774\uac78 \ub610 kubernetes\uc5d0\uc11c \ubc1c\uae09\ubd80\ud130 \uac31\uc2e0\uae4c\uc9c0 \ud574\uc8fc\ub294 \uc624\ud508\uc18c\uc2a4\ub97c \ucc3e\uc544 \uc801\uc6a9\uae4c\uc9c0 \ud558\uace0 \uc774\ub807\uac8c \ud3ec\uc2a4\ud305\uc744 \ud55c\ub2e4. \\n\\n\\n### Cert-manager\\n\\n\uc778\uc99d\uc11c \uc5c6\uc774 \uad6c\uc131\ud560\uc218\ub3c4 \uc788\uc9c0\ub9cc \uae30\ubcf8\uc801\uc73c\ub85c kubernetes \ub294 secret\uacfc ingress\uc758 \uac04\ub2e8\ud55c \uc124\uc815\ub9cc\uc73c\ub85c TLS\ub97c \uad6c\uc131\ud560 \uc218 \uc788\ub2e4.  \\n\\n\\n* Cert-manager : K8s \ud074\ub7ec\uc2a4\ud130\ub0b4\uc5d0\uc11c TLS\uc778\uc99d\uc11c\ub97c \uc790\ub3d9\uc73c\ub85c \ud504\ub85c\ube44\uc800\ub2dd \ubc0f \uad00\ub9ac\ud558\ub294 \uc624\ud508\uc18c\uc2a4\\n* Let\u2019s Encrypt :  \uc790\uc728\uc801\uc73c\ub85c \uc791\ub3d9\ud558\ub294 \uac1c\ubc29\ub41c CA(Certificate authority-\uc778\uc99d\uae30\uad00)\uc73c\ub85c \uacf5\uacf5\uc131(\uacf5\uacf5\uc758 \uc774\uc775)\uc744 \uc704\ud574\uc11c \uc6b4\uc601\ub418\ub294 \uc624\ud508\uc18c\uc2a4\\n\\n\\n\\n[Cert-manager](http://docs.cert-manager.io/en/latest/)\ub294 AWS\uc758 Certificate Manager\uc640 \uc720\uc0ac\ud558\uac8c \uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud558\uace0 \uc124\uc815\ud560\uc218 \uc788\ub2e4. 3\uac1c\uc6d4 \uc720\ud6a8\uae30\uac04\uc744 \uac00\uc9c0\ub294 [let\'s encrypt](https://letsencrypt.org/)\ub97c \uc0ac\uc6a9\ud558\uae30\uc5d0 \uc778\uc99d\uc11c \ub9cc\ub8cc\uc2dc \ubb38\uc81c\uac00 \ub420\uac70\ub77c \uc0dd\uac01\ud588\uc9c0\ub9cc \uc774\uac83\ub3c4 \uc790\ub3d9\uc73c\ub85c \uac31\uc2e0\uc744 \ud574\uc8fc\ub294 \uad00\ub9ac app.\uc744 \uac19\uc774 \ubc30\ud3ec\ud558\uae30 \ub54c\ubb38\uc5d0 \uc778\uc99d\uc11c \uad00\ub9ac\uc5d0 \ub300\ud55c \ubd80\ub2f4\uc744 \ub35c\uc218 \uc788\ub2e4.  \\n\\n\uae30\ubcf8\uc801\uc73c\ub85c Cert-manager\ub294 [let\'s encrypt](https://letsencrypt.org/), [Vault](https://www.vaultproject.io/) \uac19\uc740 \uac83\uc744\ub4e4 \uc0ac\uc6a9\ud558\uc5ec \uc778\uc99d\uc11c \ubc1c\uae09\uc744 \ud560 \uc218 \uc788\ub2e4. \uc778\uc99d\uc11c \ubc1c\uae09\ud6c4\uc5d0\ub3c4 \ub9cc\ub8cc\uac00 \ub418\uae30 \uc804\uc5d0 \ubc14\ub85c \uac31\uc2e0\uc744 \uc790\ub3d9\uc73c\ub85c \ud55c\ub2e4. \\n\\n\\n### \uad6c\uc131\\n![certmanager](http://docs.cert-manager.io/en/latest/_images/high-level-overview.png)\\n\\n### \uc0ac\uc804\uc900\ube44\uc0ac\ud56d\\n* [helm](https://docs.helm.sh/using_helm/#installing-helm-client)\\n* k8s cluster (1.7+) - CRD \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud574\uc57c\ud568\\n\\n### \uc124\uce58\\n```\\n$ helm install --name cert-manager --version v0.3.1 \\\\\\n    --namespace kube-system stable/cert-manager\\n\\n$ helm status cert-manager\\nLAST DEPLOYED: Fri Jun 15 10:02:45 2018\\nNAMESPACE: kube-system\\nSTATUS: DEPLOYED\\n\\nRESOURCES:\\n==> v1/Pod(related)\\nNAME                                        READY  STATUS   RESTARTS  AGE\\ncert-manager-cert-manager-5f76b676b4-5tdh8  1/1    Running  0         2d\\n\\n==> v1/ServiceAccount\\nNAME                       SECRETS  AGE\\ncert-manager-cert-manager  1        28d\\n\\n==> v1beta1/CustomResourceDefinition\\nNAME                               AGE\\ncertificates.certmanager.k8s.io    28d\\nclusterissuers.certmanager.k8s.io  28d\\nissuers.certmanager.k8s.io         28d\\n\\n==> v1beta1/ClusterRole\\ncert-manager-cert-manager  28d\\n\\n==> v1beta1/ClusterRoleBinding\\nNAME                       AGE\\ncert-manager-cert-manager  28d\\n\\n==> v1beta1/Deployment\\nNAME                       DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE\\ncert-manager-cert-manager  1        1        1           1          28d\\n\\n\\nNOTES:\\ncert-manager has been deployed successfully!\\n\\nIn order to begin issuing certificates, you will need to set up a ClusterIssuer\\nor Issuer resource (for example, by creating a \'letsencrypt-staging\' issuer).\\n\\nMore information on the different types of issuers and how to configure them\\ncan be found in our documentation:\\n\\nhttps://cert-manager.readthedocs.io/en/latest/reference/issuers.html\\n\\nFor information on how to configure cert-manager to automatically provision\\nCertificates for Ingress resources, take a look at the `ingress-shim`\\ndocumentation:\\n\\nhttps://cert-manager.readthedocs.io/en/latest/reference/ingress-shim.html\\n```\\n\\n### \uc778\uc99d\uc11c \uc124\uc815 \ubc0f \ubc30\ud3ec\\n\\n\uc778\uc99d\uc11c \ub4f1\ub85d \ubc0f \ub9cc\ub8cc\uc2dc noti\ub97c \ubc1b\uae30 \uc704\ud55c \ubcc0\uc218 \uc124\uc815\uc744 \ud55c\ub2e4.\\n```\\n$ export EMAIL=zaction@sk.com\\n```\\n\uadf8\ub9ac\uace0 issuer manifest\ub97c \ubc30\ud3ec\ud55c\ub2e4.  \\n(letsencrypt-issuer.yaml)\\n```\\n# Copyright 2018 Google Inc.\\n#\\n# Licensed under the Apache License, Version 2.0 (the \\"License\\");\\n# you may not use this file except in compliance with the License.\\n# You may obtain a copy of the License at\\n#\\n#     https://www.apache.org/licenses/LICENSE-2.0\\n#\\n# Unless required by applicable law or agreed to in writing, software\\n# distributed under the License is distributed on an \\"AS IS\\" BASIS,\\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\\n# See the License for the specific language governing permissions and\\n# limitations under the License.\\napiVersion: certmanager.k8s.io/v1alpha1\\nkind: ClusterIssuer\\nmetadata:\\n  name: letsencrypt-staging\\nspec:\\n  acme:\\n    server: https://acme-staging-v02.api.letsencrypt.org/directory\\n    email: \'\'\\n    privateKeySecretRef:\\n      name: letsencrypt-staging\\n    http01: {}\\n---\\napiVersion: certmanager.k8s.io/v1alpha1\\nkind: ClusterIssuer\\nmetadata:\\n  name: letsencrypt-prod\\nspec:\\n  acme:\\n    server: https://acme-v02.api.letsencrypt.org/directory\\n    email: \'\'\\n    privateKeySecretRef:\\n      name: letsencrypt-prod\\n    http01: {}\\n```\\n\\n\ub450\uac1c\uc758 endpoint\ub97c \uc0dd\uc131\ud55c\ub2e4. (Staging, Prod)\\n\\n```\\n$ sed -e \\"s/email: \'\'/email: $EMAIL/g\\" letsencrypt-issuer.yaml | \\\\\\n    kubectl apply -f-\\nclusterissuer \\"letsencrypt-staging\\" created\\nclusterissuer \\"letsencrypt-prod\\" created\\n```\\n\\nWeb App\uc744 HTTP Ingress \ud615\ud0dc\ub85c \ubc30\ud3ec\ud55c\ub2e4. TLS\ubc1c\uae09\uc804\uc5d0 \ubbf8\ub9ac HTTP(80) Ingress\ub97c \ubc30\ud3ec\ud574\uc57c \ud55c\ub2e4. \uc774\ud6c4 Let\'s encrypt TLS\ubc30\ud3ec \ud6c4 TLS spec\uc744 \ucd94\uac00\ud558\uace0 \uc7ac\ubc30\ud3ec\ub97c \ud574\uc57c\ud55c\ub2e4. \\n\\n```\\napiVersion: extensions/v1beta1\\nkind: Ingress\\nmetadata:\\n  name: auth-ingress\\nspec:\\n  rules:\\n  - host: auth.dev.action.cloudz.co.kr\\n    http:\\n      paths:\\n      - backend:\\n          serviceName: faas-auth-service\\n          servicePort: 8081\\n        path: /\\n``` \\n\\n### TLS \uc778\uc99d\uc11c \ubc1c\uae09\\n\uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud560\ub54c\ub294 \uc704\uc5d0\uc11c \ub9cc\ub4e0 Ingress\ub85c \uc0dd\uc131\ud558\uace0namespace\ubcc4 \uc0dd\uc131\uc774 \ud544\uc694\ud558\ub2e4.\\n\\n```\\napiVersion: certmanager.k8s.io/v1alpha1\\nkind: Certificate\\nmetadata:\\n  name: auth-dev-tls\\n  namespace: auth #### namespace\ubcc4 \uc0dd\uc131\\nspec:\\n  secretName: auth-dev-tls\\n  issuerRef:\\n    name: letsencrypt-prod\\n    kind: ClusterIssuer\\n  commonName: auth.dev.action.cloudz.co.kr\\n  dnsNames:\\n  - auth.dev.action.cloudz.co.kr\\n  acme:\\n    config:\\n    - http01:\\n        ingress: auth-ingress ### \uae30\uc874\uc5d0 \ub9cc\ub4e0 HTTP ingress \uba85\\n      domains:\\n      - auth.dev.action.cloudz.co.kr\\n```\\n\\n```\\n$ kubectl apply -f auth-dev-tls.yaml\\ncertificate \\"auth-dev-tls\\" created\\n```\\n\\n\uc774\ud6c4 TLS \uc0dd\uc131 \uc0c1\ud0dc\ub97c \ud655\uc778\ud55c\ub2e4. \uc774\\u0010\ub54c Message\uc5d0\uc11c ```Normal   CeritifcateIssued     Certificated issued successfully``` \ubb38\uad6c\uac00 \ud655\uc778\ub418\uba74 \uc778\uc99d\uc11c \ubc1c\uae09\uc774 \uc815\uc0c1\uc801\uc73c\ub85c \ub418\uc5c8\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4.  \\n\uc774\ub54c \ubc1c\uae09\ub418\ub294 \uc2dc\uac04\uc774 \ub124\ud2b8\uc6cc\ud06c \ud658\uacbd\uc5d0 \ub530\ub77c 1~5\ubd84\uc815\ub3c4 \uc18c\uc694\ub420\ub54c\ub85c \uc788\ub294\uac83\uc73c\ub85c \ubcf4\uc778\ub2e4. \\n``` \\n$ kubectl describe -f auth-dev-tls.yaml\\n...\\nType     Reason                Message\\n----     ------                -------\\nWarning  ErrorCheckCertificate Error checking existing TLS certificate: secret \\"auth-dev-tls\\" not found\\nNormal   PrepareCertificate    Preparing certificate with issuer\\nNormal   PresentChallenge      Presenting http-01 challenge for domain foo.kubernetes.tips\\nNormal   SelfCheck             Performing self-check for domain auth.dev.action.cloudz.co.kr\\nNormal   ObtainAuthorization   Obtained authorization for domain auth.dev.action.cloudz.co.kr\\nNormal   IssueCertificate      Issuing certificate...\\nNormal   CeritifcateIssued     Certificated issued successfully\\n```\\n\\nsecret\uc774 \uc0dd\uc131\ub41c\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n\\n```\\n$ kubectl get secret | grep tls\\nauth-dev-tls                 kubernetes.io/tls                     2         3h\\n```\\n\\n\uc774\ud6c4 \uc704\uc5d0\uc11c \ub9cc\ub4e0 Ingress\uc5d0 TLS\ub97c \uc801\uc6a9\ud55c\ub2e4.\\n```\\napiVersion: extensions/v1beta1\\nkind: Ingress\\nmetadata:\\n  name: auth-ingress\\n  annotations:\\n      ingress.bluemix.net/hsts: enabled=true maxAge=<31536000> includeSubdomains=true\\n      ingress.bluemix.net/redirect-to-https: \\"True\\"\\nspec:\\n  rules:\\n  - host: auth.dev.action.cloudz.co.kr\\n    http:\\n      paths:\\n      - backend:\\n          serviceName: faas-auth-service\\n          servicePort: 8081\\n        path: /\\n  tls:\\n  - hosts:\\n    - auth.dev.action.cloudz.co.kr\\n    secretName: auth-dev-tls\\n```\\n\\n\uc704 \uc124\uc815\uc744 \uc801\uc6a9\ud558\uace0 \uc0c1\ud0dc\ub97c \ud655\uc778\ud55c\ub2e4.\\n```\\n$ kubectl apply -f auth-tls-ingress.yaml\\n\\n$ kubectl get ing\\nNAME           HOSTS                          ADDRESS         PORTS     AGE\\nauth-ingress   auth.dev.action.cloudz.co.kr   10.1.1.182   80, 443   14h\\n```\\n\\n![cert-tls](/img/cert-tls.png)\\n\\n## \uc815\ub9ac\\n\uc124\uacc4\uc758 \uc2e4\uc218\ub85c \uc2dc\uc791\ub418\uc5c8\uc9c0\ub9cc \uc815\ub9ac\ud558\ub2e4\ubcf4\ub2c8 \uc778\uc99d\uc11c \uac31\uc2e0\uc774 \uc790\ub3d9\uc744 \ub41c\ub2e4\ub294 \uc810\uacfc \ub610\ud55c Kubernetes\ud658\uacbd\uc5d0\uc11c TLS\uad00\ub9ac\uac00 \uac04\ud3b8\ud558\ub2e4\ub294\uac83\uc744 \uc54c\uac8c \ub418\uc5c8\ub2e4. \uc778\uc99d\uc11c \ube44\uc6a9\uc744 \uc544\ub080\uac83\ub3c4 \ud558\ub098\uc758 \uc131\uacfc\uc774\uae30\ub3c4 \ud558\ub2e4. \uc778\uc99d\uc11c\ub294 \uc368\uc57c\ud558\uaca0\uace0 \uc815\ub9d0 \ub9ce\uc740 \uc560\ud50c\ub9ac\ucf00\uc774\uc158\ub4e4\uc744 \uc0dd\uc131/\uc0ad\uc81c\ub97c \uc0c1\uc2dc \ud574\uc57c\ud558\ub294 \ud658\uacbd\uc774\ub77c\uba74 \ud55c\ubc88 \uc801\uc6a9\ud574\ubcfc\ub9cc\ud55c \uac00\uce58\uac00 \uc788\ub294\uac83 \uac19\ub2e4."},{"id":"kubernetes/operator/","metadata":{"permalink":"/kubernetes/operator/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-07-09-operator.md","source":"@site/blog/2018-07-09-operator.md","title":"Operators & CRDs(CustomResourceDefinitions) on Kubernetes","description":"Operators, CRD(Custom Resource Definitions)\uc5d0 \ub300\ud574\uc11c \uc54c \uc218 \uc788\ub2e4.","date":"2018-07-09T00:00:00.000Z","formattedDate":"July 9, 2018","tags":[{"label":"Operators","permalink":"/tags/operators"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"CRDs","permalink":"/tags/cr-ds"},{"label":"CustomResourceDefinitions","permalink":"/tags/custom-resource-definitions"}],"readingTime":10.355,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Operators & CRDs(CustomResourceDefinitions) on Kubernetes","comments":true,"classes":"wide","description":"Operators, CRD(Custom Resource Definitions)\uc5d0 \ub300\ud574\uc11c \uc54c \uc218 \uc788\ub2e4.","slug":"kubernetes/operator/","date":"2018-07-09T00:00:00.000Z","categories":["Kubernetes"],"tags":["Operators","Kubernetes","CRDs","CustomResourceDefinitions"]},"prevItem":{"title":"Cert-manager","permalink":"/kubernetes/cert-manager/"},"nextItem":{"title":"Cilium","permalink":"/kubernetes/cilium-1/"}},"content":"## Operators in Kubernetes\\n### Operators \ub780?\\n\\n\uc815\uc758([Definition](https://coreos.com/operators/)) : Kubernetes Application \uc744 \ud328\ud0a4\uc9d5, \ubc30\ud3ec, \uad00\ub9ac\ud558\ub294 \ubc29\ubc95. Helm\uacfc\ub294 \uc870\uae08 \ub2ec\ub77c \ub530\ub85c \uc774\uc57c\uae30 \ud574\ubcf4\uace0\uc790 \ud55c\ub2e4.\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c Kubernetest Application\uc740 kubernetes\uc5d0 \uc758\ud574 \ubc30\ud3ec\ub418\uace0 kubect\uacfc kube-API\ub97c \uc0ac\uc6a9\ud558\uc5ec \uad00\ub9ac\ud55c\ub2e4.\\n\\n\uacb0\ub860\uc801\uc73c\ub85c \ub9d0\ud558\uba74 Kubernetes\uc5d0 \ub0b4\uac00 \ub9cc\ub4e0 application\uc744 \uc11c\ube44\uc2a4\ud558\uace0 \uad00\ub9ac\ud558\ub824\uba74 \uacb0\uad6d Kubernetes\uc758 API\ub4e4\uc744 \ubaa8\ub450 \uc774\ud574\ud558\uace0 \uc0ac\uc6a9\ud560\uc218 \uc788\uc5b4\uc57c \ud55c\ub2e4. \uc77c\ubc18\uc801\uc778 \uac1c\ubc1c\uc790\uc5d0\uac8c \uc9c4\uc785\uc7a5\ubcbd\uc774 \uc5b4\ub290\uc815\ub3c4 \uc788\ub2e4\uace0 \ubcf4\uc5ec\uc9c0\uba70 \uc774\ub97c \ubaa8\ub450 \uc774\ud574\uc2dc\ud0a4\ub294\uac83\ub3c4 \uc870\uc9c1\uc801\uc778 \uce21\uba74\uc5d0\uc11c\ub294 \ub0ad\ube44\uc77c\uc218 \ub3c4 \uc788\ub2e4. \uadf8\ub798\uc11c Helm\ub4f1\uc744 \ud1b5\ud55c application\ubc30\ud3ec \uc804\ub7b5\uc744 \uc138\uc6b0\uae30\ub3c4 \ud558\uc9c0\ub9cc \uc774\uac83\ub3c4 \ud55c\uacc4\uac00 \uc788\uc744\uc218 \uc788\ub2e4. \uadf8\ub798\uc11c Operator\ub294 Kubernetes\uc0c1\uc5d0\uc11c application\uc744 \uad00\ub9ac\ud558\ub294 \ub7f0\ud0c0\uc784\uc774\ub77c\uace0 \uc0dd\uac01\ud558\ub294\uac8c \ub9de\ub294\uac83 \uac19\ub2e4.\\n\\n![etcd](https://coreos.com/sites/default/files/inline-images/Overview-etcd_0.png)\\n\\n## Operators\\n\\nOperators\ub294 application\ub9c8\ub2e4 \uc6b4\uc601\uc815\ubcf4\ub97c \ub123\uc744\uc218 \uc788\ub2e4.\\n\\nKubernetes \uc5d0 \ubc30\ud3ec\ub41c \uc751\uc6a9\ud504\ub85c\uadf8\ub7a8\uc758 \ubaa8\ub4e0 \ud2b9\uc131\uc744 \uc54c \ud544\uc694\uac00 \uc5c6\uace0 \uc774\ub97c \ud1b5\ud574 \uc0ac\uc6a9\uc790\ub294 \ub9e4\ub2c8\uc9c0\ub4dc \ud074\ub77c\uc6b0\ub4dc \uc11c\ube44\uc2a4 \uacbd\ud5d8(\uae30\uc874 IaaS/PaaS\uad00\ub9ac\uc640 \uc720\uc0ac)\uacfc \uc720\uc0ac\ud558\uac8c \uc6b4\uc601\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n\\nOperator\uac00 \ubc30\ud3ec\ub418\uba74 Kubernetes API\ud655\uc7a5 \uac1c\ub150\uc778 CRDs(Custom\\nResource Definitions)\uc744 \uc0ac\uc6a9\ud558\uc5ec \uad00\ub9ac\ud560\uc218 \uc788\ub2e4.\\nKubernetes\uc5d0 Stateful \uc11c\ube44\uc2a4\ub97c \ubc30\ud3ec\ud558\ub294 \ub2e8\uc21c\ud558\uace0 \uc88b\uc740 \ubc29\ubc95\uc774 \ub420\uc218 \uc788\ub2e4.  \\n\\n\uc608\ub97c \ub4e4\uba74, Postgres \ud074\ub7ec\uc2a4\ud130, Prometheus \ud074\ub7ec\uc2a4\ud130, Etcd \ud074\ub7ec\uc2a4\ud130 \uac19\uc774 \uc6b4\uc601\uce21\uba74\uc758 application\ub4e4\uc744 \uc720\uc9c0, \uc6b4\uc601\ud558\ub294\ub370 \uc4f0\uc77c\uc218 \uc788\ub2e4. (\uc790\uc138\ud55c\uac74 \ub4a4\ucabd \uc608\uc2dc\ub85c \uc124\uba85\ud558\uaca0\ub2e4)\\n\\n\uadf8\ub7ec\uba74 \uba3c\uc800 CRDs(Custom Resource Definitions)\uc5d0 \ub300\ud574\uc11c \uba3c\uc800 \uc54c\uc544\ubcf8\ub2e4. CRDs\uc5d0 \ub300\ud574\uc11c\ub294 \ubcc4\ub3c4\ub85c \uc815\ub9ac\ud558\ub824 \ud558\ub2e4\uac00 \ub0b4\uc6a9\uc774 \ub9ce\uc774 \uc54a\uc544 \ud575\uc2ec\uc801\uc778 \ub0b4\uc6a9\ub9cc \uac19\uc774 \uc801\uc5b4\ubcf8\ub2e4.\\n\\n* Custom Resource Definitions(a.k.a CRDs)\\n* k8s Object\ub97c \ud655\uc7a5\ud574\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uac00\uc7a5 \uac04\ub2e8\ud55c \ubc29\ubc95\\n* CRDs\ub294 Kubernetes\uc758 \ud655\uc7a5 \uae30\ub2a5\\n* Kubernetes \uc0ac\uc6a9\uc790\uac00 \ud074\ub7ec\uc2a4\ud130\ub0b4\uc5d0\uc11c \uc9c1\uc811 custom Object\ub97c yaml\ud615\ud0dc\ub85c \uc0dd\uc131, \uc218\uc815, \uc0ad\uc81c, \uc0ac\uc6a9\ud560\uc218 \uc788\ub3c4\ub85d \ud558\ub294 \uae30\ub2a5  \\n  * K8s database(etcd)\uc640 API\ub97c \uadf8\ub300\ub85c \ud65c\uc6a9\ud560 \uc218 \uc788\uc74c)\\n  * CRUD \uac00\ub2a5 (Create, Read, Update, Delete)\\n* \ubaa8\ub4e0 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ub3d9\uc801\uc73c\ub85c resource \ub4f1\ub85d/\uc0ad\uc81c \uac00\ub2a5\\n* Operators\ub294 CRDs\ub97c \ud3ec\ud568\ud558\uace0 \uc788\uc74c\\n  * Operator\ub97c \ucd94\uac00\ud558\uba74 CRDs\uac00 \ub4f1\ub85d\ub428\\n* Resource \ub2f9 \ud558\ub098\uc758 API \ubc84\uc804\ub9cc \uc9c0\uc6d0(~1.10\ubc84\uc804, 1.11\ubc84\uc804 \uc774\ud6c4 \uac1c\uc218 \uc81c\ud55c \uc5c6\uc5b4\uc9d0)\\n* 1.8+ \uc774\ud6c4\ubd80\ud130 JSON \uc2a4\ud0a4\ub9c8 \uc720\ud6a8\uc131 \uac80\uc99d \uac00\ub2a5\\n** *\uc8fc\uc758\uc0ac\ud56d : etcd\uac00 \ubcc4\ub3c4 \ubd84\ub9ac\ub41c managed\uc11c\ube44\uc2a4\ub098 etcd \uc778\uc2a4\ud134\uc2a4\uac00 \ubd84\ub9ac\ub41c \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9\uad8c\uace0**\\n\\n### \uc8fc\uc694 \ud65c\uc6a9\uc6a9\ub3c4\\n* Operators\\n* Application \uc815\ubcf4 \uc800\uc7a5\\n* RouteRule on istio\\n* GameServer on Agones\\n\\n## CRDs \uad00\ub828 \ubc1c\ud45c\uc790\ub8cc\\nhttps://ddiiwoong.github.io/2018/openinfraday18/\\n\\n### Operators example\\n[etcd](https://coreos.com/operators/etcd/docs/latest), [Rook](https://github.com/rook/rook), [Prometheus](https://coreos.com/operators/prometheus/docs/latest), [Vault](https://www.vaultproject.io/), [MySQL](https://github.com/oracle/mysql-operator), [Postgres](https://github.com/CrunchyData/postgres-operator), [Redis](https://github.com/spotahome/redis-operator), [kafka-\ube44\uacf5\uc2dd](https://github.com/nbogojevic/kafka-operator) \ub4f1 Operator\ub85c \ubc30\ud3ec\ub420\uc218 \uc788\ub294 \uc608\uc2dc\ub4e4\uc740 \ud574\ub2f9 \ub9c1\ud06c\ub97c \ubcf4\uba74 \uc790\uc138\ud788 \ud655\uc778\ud560 \uc218 \uc788\ub2e4. (\uc624\ub77c\ud074\uc774 \uacf5\uaca9\uc801\uc73c\ub85c K8s\ube44\uc9c0\ub2c8\uc2a4\ub85c \ub6f0\uc5b4\ub4dc\ub294\ub4ef\ud55c \uadf8\ub9bc\uc774\ub2e4\u2026)  \\n\\n\uc8fc\ub85c \uc800\uc7a5\uc18c\ub098 \ud0a4-\ubc38\ub958 \uc2a4\ud1a0\uc5b4, RDB\ub4f1\uc758 \uc6b4\uc601\uc548\uc815\uc131\uc744 \uc704\ud55c \ud074\ub7ec\uc2a4\ud130 \uad6c\uc131\uc744 \uc704\ud55c\uac83\ub4e4\uc774 \ub300\ubd80\ubd84\uc774\uba70 \uc810\uc810 \ub3c4\uc785\uc744 \ud574\ub098\uac00\ub294 \ucd94\uc138\uc774\uae34\uac83 \uac19\uae34 \ud558\ub2e4. \uc774\ubc88\uc5d0 \uc9c4\ud589\ud574\ubcf4\uace0\uc790 \ud558\ub294\uac74 \ubd84\uc0b0 \ud0a4-\ubc38\ub958 \uc2a4\ud1a0\uc5b4\uc774\uc790 kubernetes\uc758 \uba54\uc778\uc800\uc7a5\uc18c\ub85c \uc4f0\uc774\ub294 etcd \uc774\ub2e4.\\n\\n\uae30\ubcf8\uc801\uc73c\ub85c etcd cluster objects\ub294 CRDs\ub85c \uc0dd\uc131\ud55c\ub2e4. Kubernetes \uae30\ubcf8 resource\uac00 \uc544\ub2cc CRDs \uc774\uae30 \ub54c\ubb38\uc5d0 \uc548\uc815\uc131 \uce21\uba74\uc5d0\uc11c \ubd88\uc548\ud558\ub2e4\uace0 \uc0dd\uac01\ud560\uc218\ub3c4 \uc788\ub2e4. \ud558\uc9c0\ub9cc [User Aggregated API Servers](https://github.com/kubernetes/community/blob/master/contributors/design-proposals/api-machinery/aggregated-api-servers.md) \ub97c \uc801\uc6a9\ud558\uc5ec \uc548\uc815\uc131, \uc720\ud6a8\uc131 \uac80\uc0ac \ubc0f \ubc84\uc804 \uad00\ub9ac\uac00 \uac1c\uc120\ub418\uc5c8\ub2e4\uace0 \ud55c\ub2e4. Aggregated API\ub97c \uc0ac\uc6a9\ud558\uba74 \uc0ac\uc6a9\uc790\uc5d0\uac8c \ucd5c\uc18c\ud55c\uc758 \uc601\ud5a5\uc744 \uc8fc\uba74\uc11c Kubernetes objects\uac00 \uc0dd\uc131\ub418\uac70\ub098 \uc0ac\uc6a9\uc790\uac00 etcd operator\ub97c \ubc30\ud3ec,\uad00\ub9ac\ud560\uc218 \uc788\ub2e4. (\ub9d0\uc774 \uae38\uc5b4\uc11c \uadf8\ub807\uc9c0 \uadf8\ub0e5 etcd \ud074\ub7ec\uc2a4\ud130 \uad6c\uc131)\\n\\n\ud604\uc7ac \ud504\ub85c\uc81d\ud2b8\ub294 \ubca0\ud0c0\ub85c 0.9.2\uae4c\uc9c0 \ub098\uc640 \uc788\uc73c\uba70 RedHat\uc774 CoreOS\ub97c \ud569\ubcd1\ud558\ub294 \ubc14\ub78c\uc5d0 \ubb38\uc11c\ub4e4\uc774 \uc5c5\ub370\uc774\ud2b8\uac00 \ub2a6\uc5b4\uc9c0\ub294\uac83 \uac19\uae34\ud558\uc9c0\ub9cc \uc870\ub9cc\uac04\uc5d0 1.0\uc774 \ub098\uc62c\uac83 \uac19\uae34 \ud558\ub2e4.\\n\\n### [etcd-operator](https://github.com/coreos/etcd-operator/#overview)\\netcd operator\ub294 \uae30\ubcf8\uc801\uc73c\ub85c \ub2e4\uc74c\uacfc \uac19\uc740 \uae30\ub2a5\uc744 \ud55c\ub2e4.\\n\\n* Create and Destroy\\n* Resize\\n* Failover\\n* Rolling upgrade\\n* Backup and Restore\\n\\n#### Requirements\\n* Kubernetes 1.8+\\n* etcd 3.2.13+\\n\\n### Installation guide\\n\uc124\uce58\ub294 \ub2e8\uc21c\ud558\ub2e4. \uba3c\uc800 RBAC\uc124\uc815\uc744 \ud55c\ub2e4.\\n```\\n$ git clone https://github.com/coreos/etcd-operator.git\\n$ cd etcd-operator\\n$ example/rbac/create_role.sh\\n```\\n\uadf8\ub9ac\uace0 etcd-operator \ubc30\ud3ec\\n\\n```\\n$ kubectl create -f example/deployment.yaml\\napiVersion: extensions/v1beta1\\nkind: Deployment\\nmetadata:\\n  name: etcd-operator\\nspec:\\n  replicas: 1\\n  template:\\n    metadata:\\n      labels:\\n        name: etcd-operator\\n    spec:\\n      containers:\\n      - name: etcd-operator\\n        image: quay.io/coreos/etcd-operator:v0.9.2\\n        command:\\n        - etcd-operator\\n        # Uncomment to act for resources in all namespaces. More information in doc/clusterwide.md\\n        #- -cluster-wide\\n        env:\\n        - name: MY_POD_NAMESPACE\\n          valueFrom:\\n            fieldRef:\\n              fieldPath: metadata.namespace\\n        - name: MY_POD_NAME\\n          valueFrom:\\n            fieldRef:\\n              fieldPath: metadata.name\\n```\\ndeployment.yaml \ub0b4\uc6a9\uc744 \ubcf4\uba74 CustomResourceDefinition\uc774 \uc874\uc7ac\ud558\uc9c0 \uc54a\ub294\ub2e4.\\netcd-operator\uac00 \uc790\ub3d9\uc73c\ub85c CRD\ub97c \uc0dd\uc131\ud558\uae30 \ub54c\ubb38\uc5d0 \uc544\ub798\uc640 \uac19\uc774 CRD\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```\\n$ kubectl get customresourcedefinitions\\nNAME                                    KIND\\netcdclusters.etcd.database.coreos.com   CustomResourceDefinition.v1beta1.apiextensions.k8s.io\\n```\\n\\n### etcd cluster create/resize/failover/upgrade\\noperator\ub97c \uc774\uc6a9\ud558\uc5ec etc cluster\ub97c \uad6c\uc131\ud55c\ub2e4. operator\ub97c \ud1b5\ud55c \ud074\ub7ec\uc2a4\ud130 \uad6c\uc131\ub0b4\uc6a9\uc744 \ud655\uc778\ud558\uba74 \uc544\uc8fc \ub2e8\uc21c\ud558\ub2e4. \ubc84\uc804\uacfc \uc0ac\uc774\uc988\ubfd0\uc774\ub2e4.\\n```\\n$ cat example/example-etcd-cluster.yaml\\napiVersion: \\"etcd.database.coreos.com/v1beta2\\"\\nkind: \\"EtcdCluster\\"\\nmetadata:\\n  name: \\"example-etcd-cluster\\"\\n  ## Adding this annotation make this cluster managed by clusterwide operators\\n  ## namespaced operators ignore it\\n  # annotations:\\n  #   etcd.database.coreos.com/scope: clusterwide\\nspec:\\n  size: 3\\n  version: \\"3.2.13\\"\\n$ kubectl create -f example/example-etcd-cluster.yaml\\netcdcluster.etcd.database.coreos.com/example-etcd-cluster created\\n```\\n\\n\uc21c\ucc28\uc801\uc73c\ub85c etcd cluster\uac00 \uad6c\uc131\ub418\ub294\uac83\uc744 \ubcfc\uc218 \uc788\ub2e4.\\n\\n```\\n$ kubectl get pods\\nNAME                              READY     STATUS    RESTARTS   AGE\\netcd-operator-69b559656f-wrhxz    1/1       Running   0          3h\\nexample-etcd-cluster-2kd4t667j5   1/1       Running   0          1m\\nexample-etcd-cluster-k4lxm96v7h   1/1       Running   0          1m\\nexample-etcd-cluster-lm7mkhvldw   1/1       Running   0          1m\\n```\\n\\n\uc774\ubc88\uc5d0\ub294 scale-out \ud14c\uc2a4\ud2b8\ub97c \uc9c4\ud589\ud55c\ub2e4.  \\nexample/example-etcd-cluster.yaml \ub0b4\uc6a9\uc5d0\uc11c ```size: 3``` \uc744 ```size: 5``` \ub85c \ubcc0\uacbd\ud558\uace0 \ub2e4\uc2dc \uc801\uc6a9\ud558\uba74 2 node\uac00 \ucd94\uac00\ub85c \uc0dd\uc131\ub41c\ub2e4.\\n\\n```\\n$ kubectl apply -f example/example-etcd-cluster.yaml\\n$ kubectl get pods\\nNAME                              READY     STATUS    RESTARTS   AGE\\netcd-operator-69b559656f-wrhxz    1/1       Running   0          3h\\nexample-etcd-cluster-2kd4t667j5   1/1       Running   0          9m\\nexample-etcd-cluster-2pwm84lrf4   1/1       Running   0          34s\\nexample-etcd-cluster-97qk6gs4sp   1/1       Running   0          50s\\nexample-etcd-cluster-k4lxm96v7h   1/1       Running   0          9m\\nexample-etcd-cluster-lm7mkhvldw   1/1       Running   0          8m\\n```\\n\\n\ubc18\ub300\ub85c \uc904\uc774\ub294\uac83\ub3c4 \ub3d9\uc77c\ud558\ub2e4.\\n\\nfailover \ud14c\uc2a4\ud2b8\uc758 \uacbd\uc6b0\uc5d0\ub3c4 \uadf8\ub0e5 pod\ub97c \uc0ad\uc81c\ud558\uac70\ub098 worker\ub97c \ub0a0\ub9ac\ub294\uac83\uc73c\ub85c\ub3c4 \ub3d9\uc77c\ud558\uac8c spec\uc744 \uc720\uc9c0\ud558\ub294 kubernetes resource \ud2b9\uc131\uc73c\ub85c \uc778\ud574 \ubc14\ub85c \uc0dd\uc131\uc774 \ub418\ub294\uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4.\\n\\n\uc774\ubc88\uc5d0\ub294 operator\ub9cc \ub0a0\ub824\ubcf4\uaca0\ub2e4. \uc544\ub798\ucc98\ub7fc operator deployment\ub9cc \uc0ad\uc81c\ub97c \ud574\ub3c4 pods\ub294 \ub0a8\uc544\uc788\ub294\uac83\uc744 \ubcfc\uc218 \uc788\ub2e4.\\n\\n```\\n$ kubectl delete -f example/deployment.yaml\\ndeployment \\"etcd-operator\\" deleted\\ndeployment.extensions \\"etcd-operator\\" deleted\\n$ kubectl get pod\\nNAME                              READY     STATUS    RESTARTS   AGE\\nexample-etcd-cluster-2kd4t667j5   1/1       Running   0          14m\\nexample-etcd-cluster-2pwm84lrf4   1/1       Running   0          5m\\nexample-etcd-cluster-97qk6gs4sp   1/1       Running   0          5m\\nexample-etcd-cluster-k4lxm96v7h   1/1       Running   0          14m\\nexample-etcd-cluster-lm7mkhvldw   1/1       Running   0          13m\\n```\\n\\netcd pod \ud558\ub098\ub97c \ub0a0\ub824\ubcf8\ub2e4. 4\uac1c pod\ub9cc \ub0a8\uc740\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```\\n$ kubectl delete pod example-etcd-cluster-2kd4t667j5 --now\\npod \\"example-etcd-cluster-2kd4t667j5\\" deleted\\n$ kubectl get pod\\nNAME                              READY     STATUS    RESTARTS   AGE\\nexample-etcd-cluster-2pwm84lrf4   1/1       Running   0          9m\\nexample-etcd-cluster-97qk6gs4sp   1/1       Running   0          9m\\nexample-etcd-cluster-k4lxm96v7h   1/1       Running   0          18m\\nexample-etcd-cluster-lm7mkhvldw   1/1       Running   0          17m\\n```\\n\\n\ub2e4\uc2dc\ud55c\ubc88 operator\ub97c \ubc30\ud3ec\ud558\uac8c \ub418\uba74 \uc7a0\uc2dc\ud6c4\uc5d0 5\uac1c\ub85c \ub2e4\uc2dc pod\uac00 \ubcf5\uc6d0\ub41c\uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4.\\n\\n```\\n$ kubectl create -f example/deployment.yaml\\ndeployment.extensions/etcd-operator created\\n$ kubectl get pod\\nNAME                              READY     STATUS    RESTARTS   AGE\\netcd-operator-69b559656f-8ks8m    1/1       Running   0          44s\\nexample-etcd-cluster-2pwm84lrf4   1/1       Running   0          11m\\nexample-etcd-cluster-97qk6gs4sp   1/1       Running   0          11m\\nexample-etcd-cluster-k4lxm96v7h   1/1       Running   0          20m\\nexample-etcd-cluster-kskgvlbsm9   1/1       Running   0          10s\\nexample-etcd-cluster-lm7mkhvldw   1/1       Running   0          19m\\n```\\n\\n\uc5c5\uadf8\ub808\uc774\ub4dc\uc758 \uacbd\uc6b0\ub3c4 \ub2e4\ub978 resource\uc640 \ub3d9\uc77c\ud558\uac8c version \ubd80\ubd84\uc744 \ubcc0\uacbd\ud558\uc5ec rollout\uc774 \uac00\ub2a5\ud558\ub2e4.\\n\\n## \uc815\ub9ac\\n\ub2e4\uc74c \uc18c\uc2a4\ub97c \ud1b5\ud574 \uc9c1\uc811 operator\ub97c \uac1c\ubc1c\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n(Source: https://coreos.com/operators/)\\n\\nOperator SDK\ub97c \uc0ac\uc6a9\ud558\uba74 Kubernetes API \uc0c1\uc138\uc2a4\ud399\uc744 \ubc30\uc6b0\uc9c0 \uc54a\uace0\ub3c4 \uc27d\uac8c operator \ube4c\ub4dc\uac00 \uac00\ub2a5\ud558\ub2e4.\\n\ub610\ud55c \uad00\ub9ac\ub97c \uc704\ud55c Operator Lifecycle Manager\ub098 Operator Metering \uac19\uc740 \uae30\ub2a5\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc880\ub354 \uad00\ub9ac\uce21\uba74\uc5d0\uc11c \uac15\ud654\ud558\uace0\uc790 \ud558\ub294 CoreOS\uc9c4\uc601\uc758 \ub178\ub825\uc774 \ubcf4\uc774\ub294\ub4ef \ud558\ub2e4.\\n\\n\uc544\uc9c1 alpha, beta\ub2e8\uacc4\uc758 operator \ud504\ub85c\uc81d\ud2b8\ub4e4\uc774 \ub300\ubd80\ubd84\uc774\uc9c0\ub9cc helm\ucc28\ud2b8\uc640 \uac19\uc774 kubernetes API \uc2a4\ud399\uc744 \uc774\ud574\ud558\uace0 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\uace0\ub3c4 \uc27d\uac8c \uc6b4\uc601\uc790\uac00 \uae30\ubc18 \uc5b4\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uad00\ub9ac \ud560\uc218 \uc788\ub2e4\ub294\uac83\uc73c\ub85c \ubcf4\uc544 \ud5a5\ud6c4 RedHat\uc774\ub098 Oracle \uc9c4\uc601\uc5d0\uc11c \ubcf8\uc778\ub4e4 kubernetes \uad00\ub828 \uc81c\ud488\ub4e4\uc744 \ud64d\ubcf4\ud558\uace0 \uc11c\ube44\uc2a4\ub77c\uc778\uc5d0 \ud3ec\ud568\uc2dc\ud0a4\ub294 \ubc29\ud5a5\uc73c\ub85c \uc801\uadf9\uc801\uc73c\ub85c \uac1c\ubc1c\uc744 \ud558\uace0 \uc788\ub294\uac83\uc73c\ub85c \ubcf4\uc778\ub2e4. \uc55e\uc73c\ub85c mysql, redis, kakfa \ub4f1\uc744 operator\ub85c \ubc30\ud3ec\ud558\uace0 \uad00\ub9ac\ud558\ub294 \uc77c\uc774 \ub354 \ub9ce\uc544 \uc9c8\uac83 \uac19\ub2e4."},{"id":"kubernetes/cilium-1/","metadata":{"permalink":"/kubernetes/cilium-1/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-07-06-cilium-1.md","source":"@site/blog/2018-07-06-cilium-1.md","title":"Cilium","description":"Cilium\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","date":"2018-07-06T00:00:00.000Z","formattedDate":"July 6, 2018","tags":[{"label":"Cilium","permalink":"/tags/cilium"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"network policy","permalink":"/tags/network-policy"},{"label":"Istio","permalink":"/tags/istio"},{"label":"BPF","permalink":"/tags/bpf"},{"label":"CNI","permalink":"/tags/cni"}],"readingTime":16.09,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Cilium","comments":true,"classes":"wide","description":"Cilium\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","slug":"kubernetes/cilium-1/","date":"2018-07-06T00:00:00.000Z","categories":["Kubernetes"],"tags":["Cilium","Kubernetes","network policy","Istio","BPF","CNI"]},"prevItem":{"title":"Operators & CRDs(CustomResourceDefinitions) on Kubernetes","permalink":"/kubernetes/operator/"},"nextItem":{"title":"Spinnaker on Kubernetes #1","permalink":"/kubernetes/spinnaker-advanced-1/"}},"content":"## Cilium \ub204\uad6c\ub0d0 \ub10c?\\n\ucc98\uc74c\uc5d0 \ub180\ub790\ub2e4. \ubc88\uc5ed\ud558\uba74 \'\uc790\uad81\', \'\uc12c\ubaa8\', \'\uc18d\ub208\uc379\'\ub4f1 \uc775\uc219\uce58 \uc54a\uc740 \ub2e8\uc5b4\ub77c\uc11c \ub180\ub790\uc9c0\ub9cc \ucc28\uadfc\ud788 \ubcf4\ub2e4\ubcf4\ub2c8 \uacb0\uad6d OS\ub0b4\ubd80(\ub9ac\ub205\uc2a4 \ucee4\ub110)\uc5d0\uc11c\ubd80\ud130 \ucee8\ud14c\uc774\ub108\uac04 \ub610\ub294 \uc678\ubd80\uc640\uc758 \uc5f0\uacb0\uc744 \ubcf4\ud638\ud558\ub294 \uc5ed\ud560\uc774\ub77c\uace0 \ud558\ub2c8 \uc774\ud574\uac00 \ub418\ub294 \uac83 \uac19\ub2e4.\\n\\n\ud648\ud398\uc774\uc9c0\uc5d0 \uc815\uc758\ub41c \ub0b4\uc6a9\uc744 \ubcf4\uba74 \uc544\ub798 \ub0b4\uc6a9\uacfc \uac19\ub2e4. \\n\\n>[Cilium](https://cilium.readthedocs.io/en/v1.1/intro/#what-is-cilium) - Docker \ubc0f Kubernetes\uc640 \uac19\uc740 Linux \ucee8\ud14c\uc774\ub108 \uad00\ub9ac \ud50c\ub7ab\ud3fc\uc744 \uc0ac\uc6a9\ud558\uc5ec \ubc30\ud3ec\ub41c \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8 \uc11c\ube44\uc2a4 \uac04\uc758 \ub124\ud2b8\uc6cc\ud06c \uc5f0\uacb0\uc744 \ubcf4\ud638\ud558\ub294 \uc624\ud508 \uc18c\uc2a4 \uc18c\ud504\ud2b8\uc6e8\uc5b4\\n\\n\ud398\ubd81\uc5d0 [\ud55c\uad6d \ub9ac\ub205\uc2a4 \uc0ac\uc6a9\uc790 \uadf8\ub8f9](https://www.facebook.com/groups/korelnxuser/)\uc5d0\uc11c\ub3c4 [Tommy Lee](https://www.facebook.com/tommy.lee.98229)\ub2d8\uc774\ub098 [\uc1a1\ucc3d\uc548](https://www.facebook.com/changan.song)\ub2d8\uc774 \uba87\uba87 \uac8c\uc2dc\ubb3c\uc744 \uc62c\ub824\uc8fc\uc154\uc11c \uad00\uc2ec\uc788\uac8c \ubcf4\ub358\uc911\uc5d0 \uc544\ub798\uc640 \uac19\uc740 \ub0b4\uc6a9\uc744 \ubcf4\uace0 \uc774\uac70\ub2e4 \ud558\uace0 \ud30c\ubcf4\uae30 \uc2dc\uc791\ud588\ub2e4.\\n\\n>Cilium\uc740 Docker \ubc0f Kubernetes\uc640 \uac19\uc740 \ub9ac\ub205\uc2a4 \ucee8\ud14c\uc774\ub108 \ud504\ub808\uc784 \uc6cc\ud06c\uc5d0 API \uae30\ubc18\uc758 \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548 \ud544\ud130\ub9c1\uc744 \uc81c\uacf5\ud558\uba70, \\n\ub610\ud55c, BPF\ub77c\ub294 \uc0c8\ub85c\uc6b4 Linux \ucee4\ub110 \uae30\uc220\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucee8\ud14c\uc774\ub108/POD ID\ub97c \uae30\ubc18\uc73c\ub85c \ub124\ud2b8\uc6cc\ud06c \uacc4\uce35 \ubc0f \uc751\uc6a9 \ud504\ub85c\uadf8\ub7a8 \uacc4\uce35 \ubcf4\uc548 \uc815\ucc45\uc744 \uc815\uc758 \ubc0f \uc801\uc6a9\ud558\ub294 \uac83\uc5d0 \uc788\uc5b4\uc11c \uac04\ub2e8\ud558\uba74\uc11c \ud6a8\uc728\uc801\uc778 \ubc29\ubc95\uc744 \uc81c\uacf5\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4.\\n\\n\uc717\ubd84\ub4e4\ucc98\ub7fc \ucee4\ub110 \uc790\uccb4\ub97c \ubd84\uc11d\ud558\uace0 \uacf5\ubd80\ud558\uace0 \uae30\uc5ec\ud558\ub824\uba74 \uc18c\uc694\ub418\ub294 \uc2dc\uac04\uc774 \ub354 \uac78\ub9b4\uac70 \uac19\uace0 \uc11c\ube44\uc2a4\ub97c \uc6b4\uc601\ud558\uace0 \uac1c\ubc1c\ud558\ub294 \uc785\uc7a5\uc5d0\uc11c\ub294 \ub0b4 \ud504\ub85c\uc81d\ud2b8\uc5d0 \uc801\uc6a9 \uac00\ub2a5\uc131\uc744 \uac80\uc99d\ud558\ub294\uac83\uc774 \ub098\uc744\uac83 \uac19\uc544 \uc815\ub9ac\ub97c \ud574\ubcf8\ub2e4.\\n\\niptables\uc744 \uae30\ubc18\uc73c\ub85c IP\uc640 Port\uae30\ubc18\uc758 \uc804\ud1b5\uc801\uc778 \ud3ec\uc6cc\ub529 \uae30\uc220\uc740 \ubc8c\uc368 20\ub144\uc774\ub77c\ub294 \uc138\uc6d4\ub3d9\uc548 \ub110\ub9ac \uc0ac\uc6a9\ub418\uc5b4 \uc654\ub2e4. \ud2b9\ud788 \ud37c\ube14\ub9ad/\ud504\ub77c\uc774\ube57 \ud074\ub77c\uc6b0\ub4dc \uc81c\ud488\uad70\ub4e4 \ubaa8\ub450 iptables\uae30\ubc18\uc758 Security Group\ub4f1\uc744 \uae30\ubcf8\uc73c\ub85c \uc81c\uacf5\ud558\uace0 \uc788\uace0 Kubernetes \ub9c8\uc800\ub3c4 CNI \ud575\uc2ec\uc73c\ub85c iptables\uc744 \ud65c\uc6a9\ud558\uace0 \uc788\ub2e4.  \\n\\n\ub3d9\uc801\uc73c\ub85c \ubcc0\ud654\ud558\uace0 \ub9e4\uc6b0 \ubcf5\uc7a1\ud55c \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\ub294 \uc2dc\ub300\uc5d0 \uc804\ud1b5\uc801\uc778 \ubc29\uc2dd\uc758 IP, Port\uad00\ub9ac\ub294 \ube44\ud6a8\uc728\uc801\uc778 \uce21\uba74\uc774 \uc5c6\uc9c0 \uc54a\ub2e4. BPF(\uc544\ub798\uc778\uc6a9)\uc744 \ud65c\uc6a9\ud558\uc5ec \ub9ac\ub205\uc2a4 \ucee4\ub110\ub0b4\uc5d0\uc11c \ub370\uc774\ud130 \ud3ec\uc6cc\ub529\uc744 \ud560 \uc218 \uc788\uace0 Kubernetes Service\uae30\ubc18 Load Balancing\uc774\ub098 istio\uc640 \uac19\uc740 Service Mesh\ub97c \uc704\ud55c Proxy Injection \uc744 \ud1b5\ud574 \uc5ec\ub7ec \ud65c\uc6a9\uc744 \ud560 \uc218 \uc788\uc744\uac70\ub77c\uace0 Cilium \ud504\ub85c\uc81d\ud2b8\ub294 \uc774\uc57c\uae30 \ud558\uace0 \uc788\ub2e4. \\n\\n> \ubc84\ud074\ub9ac \ud328\ud0b7 \ud544\ud130(Berkeley Packet Filter, BPF)\\n> \\n>BPF\ub294 \ubc84\ud074\ub9ac \ud328\ud0b7 \ud544\ud130(Berkeley Packet Filter)\uc758 \uc904\uc784\ub9d0\uc774\ub2e4. \uc774\ub984 \uadf8\ub300\ub85c \ud328\ud0b7\uc744 \uac78\ub7ec\ub0b4\ub294 \ud544\ud130\uc774\ub2e4. \uadf8\ub7f0\ub370 BSD\uc5d0\uc11c\uc758 BPF\ub294 \ub124\ud2b8\uc6cc\ud06c \ud0ed(\ub9ac\ub205\uc2a4\uc758 PF_PACKET)\uae4c\uc9c0 \uc544\uc6b0\ub974\ub294 \uac1c\ub150\uc774\ub2e4. \uc61b\ub0a0 \uc61b\uc801\uc5d0 \uc720\ub2c9\uc2a4\uc5d0\ub294 CSPF(CMU/Stanford Packet Filter)\ub77c\ub294 \uac8c \uc788\uc5c8\ub294\ub370 BPF\ub77c\ub294 \uc0c8 \uad6c\uc870\uac00 \uc774\ub97c \ub300\uccb4\ud588\ub2e4. \uc774\ud6c4 \ub9ac\ub205\uc2a4\uc5d0\uc11c\ub294 \ub124\ud2b8\uc6cc\ud06c \ud0ed\uc744 \ub098\ub984\uc758 \ubc29\uc2dd\uc73c\ub85c \uad6c\ud604\ud558\uace0 \ud328\ud0b7 \ud544\ud130 \ubd80\ubd84\ub9cc \uac00\uc838\uc654\ub2e4. \ub9ac\ub205\uc2a4\uc758 \ud328\ud0b7 \ud544\ud130\ub97c \ub9ac\ub205\uc2a4 \uc18c\ucf13 \ud544\ud130\ub9c1(LSF: Linux Socket Filtering)\uc774\ub77c\uace0\ub3c4 \ud55c\ub2e4.  \\n(\ubc1c\ucdcc) https://wariua.github.io/facility/extended-bpf.html \\n\\nCilium\uc740 Dockercon 2017\uc5d0\uc11c \ucd5c\ucd08 [announce](https://www.youtube.com/watch?v=ilKlmTDdFgk)\ub97c \ud558\uc600\uace0 2018\ub144 4\uc6d4 24\uc77c\uc5d0 1.0\uc774 \uc815\uc2dd Release\ub41c \uc774\ud6c4 \ub9ce\uc740 \uad00\uc2ec\uc744 \ubc1b\uc744\uac83\uc73c\ub85c \uc608\uc0c1\ub418\uc5b4 \uc2e4\uc81c \uc11c\ube44\uc2a4\uc5d0 \uc801\uc6a9\ud574\ubcfc \ud544\uc694\uac00 \uc788\uc744\uac70 \uac19\uc544 minikube\ub85c \ud14c\uc2a4\ud2b8\ud55c \ub0b4\uc6a9\uc744 \ub044\uc839\uc5ec \ubcf8\ub2e4. \\n\\n## Cilium Architecture\\n![Cilium Architecture](/img/cilium_arch.png)\\n\\n## Main Feature\\n* \uace0\ud6a8\uc728 BPF Datapath  \\n  * \ubaa8\ub4e0 \ub370\uc774\ud130 \uacbd\ub85c\uac00 \ud074\ub7ec\uc2a4\ud130 \uc804\uccb4\uc5d0 \uc644\uc804 \ubd84\uc0b0\\n  * Envoy\uac19\uc740 proxy injection \uc81c\uacf5, \ucd94\ud6c4 sidecar proxy \ud615\ud0dc \uc81c\uacf5\uc608\uc815\\n* CNI, CMM plugins  \\n  * Kubernetes, Mesos, Docker\uc5d0 \uc27d\uac8c \ud1b5\ud569\uac00\ub2a5\\n* Packet, API \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548  \\n  \ud328\ud0b7\uae30\ubc18 \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548\uacfc API \uc778\uc99d\uc744 \uacb0\ud569\ud558\uc5ec \uc804\ud1b5\uc801\uc778 \ud328\ud0b7\uae30\ubc18 \ub124\ud2b8\uc6cc\ud06c \ubcf4\uc548\uacfc \ub9c8\uc774\ud06c\ub85c\uc11c\ube44\uc2a4 \uc544\ud0a4\ud14d\ucc98 \ubaa8\ub450\uc5d0\uac8c \ubcf4\uc548 \uc81c\uacf5\uac00\ub2a5  \\n  * [ID\uae30\ubc18](http://docs.cilium.io/en/doc-1.0/concepts/#arch-id-security) - Source IP\uc5d0\ub9cc \uc758\uc874\ud558\uc9c0 \uc54a\uace0 \ubaa8\ub4e0\ud328\ud0b7\uc5d0 workload identity\ub97c encoding\ud558\uc5ec \uc2dd\ubcc4\uc131 \uac15\ud654  \\n  * [IP/CIDR\uae30\ubc18](http://docs.cilium.io/en/doc-1.0/policy/language/#ip-cidr-based)\uc774\uc678\uc5d0\ub3c4 [Kubernetes Service\uae30\ubc18](http://docs.cilium.io/en/doc-1.0/policy/language/#services-based)\uc73c\ub85c \uc815\ucc45 \uc124\uc815\uac00\ub2a5\\n  * L7\uae30\ubc18 [API\ubcf4\uc548](http://docs.cilium.io/en/doc-1.0/policy/language/#layer-7-examples) \uc801\uc6a9\uac00\ub2a5\\n* \ubd84\uc0b0,\ud655\uc7a5\uac00\ub2a5\ud55c Load Balacing\\n  BPF\ub97c \uc0ac\uc6a9\ud55c \uace0\uc131\ub2a5 L3,L4 Load Balancer \uc81c\uacf5\\n  (Hasing, Weighted round-robin)\\n  * kube-proxy \ub300\uccb4 - Kubernetes ClusterIP\uac00 \uc0dd\uc131\ub420\ub54c BPF\uae30\ubc18\uc73c\ub85c \uc790\ub3d9\uc73c\ub85c \uc801\uc6a9\ub428 \\n  * [API driven](http://docs.cilium.io/en/doc-1.0/api/) - \uc9c1\uc811 API\ub97c \ud65c\uc6a9\ud558\uc5ec \ud655\uc7a5\uac00\ub2a5\\n* \ub2e8\uc21c\ud654\ub41c \ub124\ud2b8\uc6cc\ud06c \ubaa8\ub378  \\n  Overlay/VXLAN, Direct/Native Routing \uc9c0\uc6d0\\n* \uac00\uc2dc\uc131  \\n   * [Microscope](https://github.com/cilium/microscope) - \ud074\ub7ec\uc2a4\ud130 \ub808\ubca8\uc5d0\uc11c \ubaa8\ub4e0 \uc774\ubca4\ud2b8 \ud544\ud130\ub9c1 \uac00\ub2a5\\n   * API\uae30\ubc18 \uac00\uc2dc\uc131 \uc81c\uacf5\\n* \uc6b4\uc601\\n  * \ud074\ub7ec\uc2a4\ud130 \ud5ec\uc2a4\uccb4\ud06c - HTTP, ICMP\uae30\uc900 \ud074\ub7ec\uc2a4\ud130 latency \uccb4\ud06c\uac00\ub2a5\\n  * Prometheus \ud1b5\ud569 - \ubaa8\ub4e0 \uba54\ud2b8\ub9ad\uc744 Prometheus\ub85c \uc804\ub2ec\uac00\ub2a5\\n  * \ud074\ub7ec\uc2a4\ud130 \ubd84\uc11d \ubc0f [\ub9ac\ud3ec\ud2b8\ud234](http://docs.cilium.io/en/doc-1.0/troubleshooting/#cluster-diagnosis-tool) \\n\\n## Requirement\\n- kubectl >= 1.7.0\\n- minikube >= 0.22.3\\n\\n[kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/) \uc124\uce58\uc640 [minikube](https://github.com/kubernetes/minikube/releases) \uad6c\uc131\uc740 \ubcc4\ub3c4\ub85c \ud574\uc57c\ud55c\ub2e4.\\n\\n## Start minikube\\n\ub109\ub109\ud558\uac8c 4GB \uc774\uc0c1 \uba54\ubaa8\ub9ac\ub85c minikube\ub97c \uad6c\ub3d9\ud55c\ub2e4.\\n```\\n$ minikube start --kubernetes-version v1.9.0 --network-plugin=cni --extra-config=kubelet.network-plugin=cni --memory=5120 \\n```\\n\\n## Check minikube cluster status\\nminikube\uad6c\uc131\uc774 \uc644\ub8cc\ub418\uba74 \uc544\ub798\uc640 \uac19\uc774 \ud074\ub7ec\uc2a4\ud130 \uc0c1\ud0dc\ub97c \ud655\uc778\ud560\uc218 \uc788\ub2e4. \\n```\\n$ kubectl get cs\\nNAME                 STATUS    MESSAGE              ERROR\\ncontroller-manager   Healthy   ok\\nscheduler            Healthy   ok\\netcd-0               Healthy   {\\"health\\": \\"true\\"}\\n```\\n\\n## Install etcd (dependency of cilium)\\ncilium \uc758\uc874\uc131\uc744 \uc704\ud574 etcd\ub97c \ubcc4\ub3c4\ub85c \ubc30\ud3ec\ud55c\ub2e4. \\n```\\n$ kubectl create -n kube-system -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/kubernetes/addons/etcd/standalone-etcd.yaml  \\nservice \\"etcd-cilium\\" created\\nstatefulset.apps \\"etcd-cilium\\" created\\n```\\n\\n## Check all pods (etcd)\\n\ubaa8\ub4e0 pod\uac00 ```Running``` \uc0c1\ud0dc\uc778\uc9c0 \ud655\uc778\ud55c\ub2e4.\\n```\\n$ kubectl get pods --all-namespaces\\nNAMESPACE     NAME                               READY     STATUS    RESTARTS   AGE\\nkube-system   etcd-cilium-0                      1/1       Running   0          1m\\nkube-system   etcd-minikube                      1/1       Running   0          3m\\nkube-system   kube-addon-manager-minikube        1/1       Running   0          4m\\nkube-system   kube-apiserver-minikube            1/1       Running   0          3m\\nkube-system   kube-controller-manager-minikube   1/1       Running   0          3m\\nkube-system   kube-dns-86f4d74b45-lhzfv          3/3       Running   0          4m\\nkube-system   kube-proxy-tcd7h                   1/1       Running   0          4m\\nkube-system   kube-scheduler-minikube            1/1       Running   0          4m\\nkube-system   storage-provisioner                1/1       Running   0          4m\\n```\\n\\n## Install Cilium\\nKubernetes \ud074\ub7ec\uc2a4\ud130\uc5d0 Cilium\uc744 \uc778\uc2a4\ud1a8\ud55c\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c DaemonSet \ud615\ud0dc\ub85c \ubc30\ud3ec\ub418\uae30 \ub54c\ubb38\uc5d0 Node\ub2f9 \ud55c\uac1c\uc758 Cilium Pod\ub97c \ubcfc \uc218 \uc788\ub2e4. Cilium\uc740 ```kube-system``` namespace\uc5d0\uc11c \uc2e4\ud589\ub41c\ub2e4.\\n```\\n$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/kubernetes/1.9/cilium.yaml\\nconfigmap \\"cilium-config\\" created\\nsecret \\"cilium-etcd-secrets\\" created\\ndaemonset.extensions \\"cilium\\" created\\nclusterrolebinding.rbac.authorization.k8s.io \\"cilium\\" created\\nclusterrole.rbac.authorization.k8s.io \\"cilium\\" created\\nserviceaccount \\"cilium\\" created\\n```\\nkube-system namespace\uc5d0 RBAC\uc124\uc815\uacfc \ud568\uaed8 Cilium\uc774 \ubc30\ud3ec\ub418\uace0, ConfigMap, DaemonSet \ud615\ud0dc\ub85c \ubc30\ud3ec\uac00 \ub41c\ub2e4. \\n\\n## Check deployment\\n\\nCilium Deployment\uac00 ```READY``` \uc0c1\ud0dc\ub85c \ubc14\ub014\ub54c\uae4c\uc9c0 \uae30\ub2e4\ub9b0\ub2e4.\\n\\n\\n```\\n$ kubectl get daemonsets -n kube-system\\nNAME      DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\\ncilium    1         1         1         1            0           <none>          2m\\n```\\n\\n## Deploy Demo App.\\n\\n\uc544\ub798 \ub370\ubaa8\uadf8\ub9bc\uc744 \ubcf4\uba74 \uc2a4\ud0c0\uc6cc\uc988\uc758 \uc601\uac10\uc744 \ubc1b\uc544\uc11c\uc778\uc9c0 deathstar, xwing \ub4f1\uc73c\ub85c \uad6c\ubd84\ud55c\uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4. deathstar deployments\uc758 \uacbd\uc6b0 80\ud3ec\ud2b8\ub85c http \uc6f9\uc11c\ubc84\uac00 2\uac1c\uc758 pod replica\ub85c Load Balancing\ub418\uace0 \uc788\ub2e4. deathstar \uc11c\ube44\uc2a4\ub294 \uc6b0\uc8fc\uc120\uc774 \ucc29\ub959\ud560\uc218 \uc788\ub3c4\ub85d \ud65c\uc8fc\ub85c\ub97c \uc11c\ube44\uc2a4\ud558\uace0 \uc788\ub2e4. \ud558\uc9c0\ub9cc \uc81c\uad6d\uad70\uc758 tiefighter \ub9cc \ucc29\ub959\ud558\ub3c4\ub85d \ud574\uc57c\ud558\ubbc0\ub85c \ubcf4\uc548\uc124\uc815\uc744 \ud574\uc57c\ud558\ub294 \uc0c1\ud669\uc774\ub2e4. \\n\\n![starwars](https://cilium.readthedocs.io/en/v1.1/_images/cilium_http_gsg.png)\\n\\n\uc544\ub798 ```http-sw-app.yaml``` \uc740 \uc138\uac00\uc9c0 deployment\ub97c \uac00\uc9c0\uace0 \uc788\uace0 \uac01\uac01\uc758 deployment\ub294 ```(org=empire, class=deathstar)```, ```(org=empire, class=tiefighter)```, ```(org=alliance, class=xwing)```\uc640 \uac19\uc774 label \uc815\ubcf4\ub97c \uac00\uc9c4\ub2e4. deathstar Service\ub294 ```(org=empire, class=deathstar)``` label\uc744 \uac00\uc9c0\uace0 Load Balancing\uc744 \ud55c\ub2e4. \\n\\n```\\n$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/http-sw-app.yaml\\nservice \\"deathstar\\" created\\ndeployment \\"deathstar\\" created\\ndeployment \\"tiefighter\\" created\\ndeployment \\"xwing\\" created\\n```\\n\\n\ucd1d 4\uac1c\uc758 pod\uc640 1\uac1c\uc758 \uc11c\ube44\uc2a4\ub97c \ud655\uc778\ud560\uc218 \uc788\ub2e4.\\n```\\n$ kubectl get pods,svc\\nNAME                             READY     STATUS    RESTARTS   AGE\\npod/deathstar-566c89f458-mqgfs   1/1       Running   0          1h\\npod/deathstar-566c89f458-wlc4c   1/1       Running   0          1h\\npod/tiefighter                   1/1       Running   0          1h\\npod/xwing                        1/1       Running   0          1h\\n\\nNAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE\\nservice/deathstar    ClusterIP   10.109.80.174   <none>        80/TCP    1h\\nservice/kubernetes   ClusterIP   10.96.0.1       <none>        443/TCP   4h\\n```\\n\\n\uac01\uac01\uc758 pod\ub294 Cilium\uc5d0\uc11c\ub294 [Endpoints](https://cilium.readthedocs.io/en/v1.1/concepts/#endpoint)\ud615\ud0dc\ub85c \ud45c\ud604\ub41c\ub2e4. \uc544\ub798\uc640 \uac19\uc774 ingress, egress policy\ub97c \ud655\uc778\ud560\uc218 \uc788\uace0 \uc544\uc9c1 \uc544\ubb34\ub7f0 network policy \uc801\uc6a9\uc744 \ud558\uc9c0 \uc54a\uc558\uae30 \ub54c\ubb38\uc5d0 \ubaa8\ub450 ```Disabled``` \uc0c1\ud0dc\ub85c \ubcf4\uc778\ub2e4.\\n\\n```\\n$ kubectl -n kube-system get pods -l k8s-app=cilium\\nNAME           READY     STATUS    RESTARTS   AGE\\ncilium-jmxk2   1/1       Running   0          4h\\n\\n$ kubectl -n kube-system exec cilium-jmxk2 -- cilium endpoint list\\nENDPOINT   POLICY (ingress)   POLICY (egress)   IDENTITY   LABELS (source:key[=value])                                                    IPv6                 IPv4            STATUS\\n           ENFORCEMENT        ENFORCEMENT\\n5023       Disabled           Disabled          2008       k8s:io.cilium.k8s.policy.serviceaccount=istio-ingress-service-account          f00d::a0f:0:0:139f   10.15.170.241   ready\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n                                                           k8s:istio=ingress\\n7415       Disabled           Disabled          9270       k8s:class=deathstar                                                            f00d::a0f:0:0:1cf7   10.15.16.224    ready\\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default\\n                                                           k8s:io.kubernetes.pod.namespace=default\\n                                                           k8s:org=empire\\n7979       Disabled           Disabled          4          reserved:health                                                                f00d::a0f:0:0:1f2b   10.15.96.215    ready\\n17917      Disabled           Disabled          60941      k8s:class=tiefighter                                                           f00d::a0f:0:0:45fd   10.15.58.61     ready\\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default\\n                                                           k8s:io.kubernetes.pod.namespace=default\\n                                                           k8s:org=empire\\n22602      Disabled           Disabled          53004      k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:584a   10.15.190.2     ready\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n                                                           k8s:istio-mixer-type=telemetry\\n                                                           k8s:istio=mixer\\n31992      Disabled           Disabled          33709      k8s:io.cilium.k8s.policy.serviceaccount=istio-egressgateway-service-account    f00d::a0f:0:0:7cf8   10.15.85.192    ready\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n                                                           k8s:istio=egressgateway\\n33958      Disabled           Disabled          64389      k8s:io.cilium.k8s.policy.serviceaccount=istio-citadel-service-account          f00d::a0f:0:0:84a6   10.15.59.151    ready\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n                                                           k8s:istio=citadel\\n49215      Disabled           Disabled          40629      k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:c03f   10.15.48.171    ready\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n                                                           k8s:istio-mixer-type=policy\\n                                                           k8s:istio=mixer\\n55129      Disabled           Disabled          9270       k8s:class=deathstar                                                            f00d::a0f:0:0:d759   10.15.17.253    ready\\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default\\n                                                           k8s:io.kubernetes.pod.namespace=default\\n                                                           k8s:org=empire\\n55930      Disabled           Disabled          46893      k8s:app=prometheus                                                             f00d::a0f:0:0:da7a   10.15.196.220   ready\\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=prometheus\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n57491      Disabled           Disabled          775        k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:e093   10.15.253.210   ready\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n                                                           k8s:istio=statsd-prom-bridge\\n57651      Disabled           Disabled          44171      k8s:io.cilium.k8s.policy.serviceaccount=istio-ingressgateway-service-account   f00d::a0f:0:0:e133   10.15.74.164    ready\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n                                                           k8s:istio=ingressgateway\\n61352      Disabled           Disabled          888        k8s:io.cilium.k8s.policy.serviceaccount=istio-pilot-service-account            f00d::a0f:0:0:efa8   10.15.118.68    ready\\n                                                           k8s:io.kubernetes.pod.namespace=istio-system\\n                                                           k8s:istio=pilot\\n61355      Disabled           Disabled          36797      k8s:class=xwing                                                                f00d::a0f:0:0:efab   10.15.56.79     ready\\n                                                           k8s:io.cilium.k8s.policy.serviceaccount=default\\n                                                           k8s:io.kubernetes.pod.namespace=default\\n                                                           k8s:org=alliance\\n```\\n\\n\ud604\uc7ac \uc0c1\ud0dc\uc5d0\uc11c\ub294 \ubaa8\ub4e0 \uc6b0\uc8fc\uc120\uc774 deathstar\uc5d0 \ucc29\ub959\uc774 \uac00\ub2a5\ud558\ub2e4.\\n```\\n$ kubectl exec xwing -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\\nShip landed\\n\\n$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\\nShip landed\\n```\\n\\n## L3/L4 Policy \uc801\uc6a9\\n\\n\uacb0\uad6d \ud558\uace0 \uc2f6\uc740\uac74 \uc81c\uad6d\uad70 \uc6b0\uc8fc\uc120 \uc989, tiefighter\ub9cc \uc811\uadfc\uc774 \uac00\ub2a5\ud574\uc57c \ud558\ubbc0\ub85c \uc544\ub798\ucc98\ub7fc \uc815\ucc45\uc744 \uc124\uc815\ud55c\ub2e4. \\n\\n\uc815\ucc45\uc740 \uc9c1\uad00\uc801\uc73c\ub85c \uc124\uc815\uc774 \uac00\ub2a5\ud558\ub2e4.\\n\\n```org=empire, class=deathstar``` label\uc744 \uac00\uc9c4 endpoint\ub85c\uc758 ingress \ubc29\ud5a5\uc758 80\ud3ec\ud2b8 \uc811\uadfc\uc740 ```org=empire``` label\uc744 \uac00\uc9c4 pod\ub9cc \uac00\ub2a5\ud558\ub3c4\ub85d \ud55c\ub2e4\ub294 \uc758\ubbf8\uc774\ub2e4. \\n\\n```\\napiVersion: \\"cilium.io/v2\\"\\nkind: CiliumNetworkPolicy\\ndescription: \\"L3-L4 policy to restrict deathstar access to empire ships only\\"\\nmetadata:\\n  name: \\"rule1\\"\\nspec:\\n  endpointSelector:\\n    matchLabels:\\n      org: empire\\n      class: deathstar\\n  ingress:\\n  - fromEndpoints:\\n    - matchLabels:\\n        org: empire\\n    toPorts:\\n    - ports:\\n      - port: \\"80\\"\\n        protocol: TCP\\n```\\n\\n\ub610\ub294 \\n```\\n$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/sw_l3_l4_policy.yaml\\n```\\n\\n\uc704\uc640 \uac19\uc774 \uc124\uc815\ud558\uace0 \ub098\uc11c tiefighter\ub97c \ucc29\ub959\uc2dc\ucf1c\ubcf4\uc790.\\n```\\n$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\\nShip landed\\n```\\n\uc815\uc0c1\ucc29\ub959!  \\n\uc774\ubc88\uc5d0\ub294 xwing \ucc28\ub840\\n```\\n$ kubectl exec xwing -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\\n\\n```\\n\ucc29\ub959\uc2e4\ud328!\\n\\n\uc774\uc5b4\uc11c \uc815\ucc45\uc744 \ub2e4\uc2dc \ud655\uc778\ud574\ubcf4\uba74 Enabled\ub85c \ubcc0\ud55c \uc815\ucc45 2\uac1c\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4.  \\n(pod\uac00 2\uac1c\uc774\ubbc0\ub85c 2\uac1c\uc758 \uc815\ucc45\uc744 \ubcfc \uc218 \uc788\ub2e4)\\n```\\n$ kubectl -n kube-system exec cilium-jmxk2 -- cilium endpoint list\\n```\\n\\n\uc0c1\uc138 \uc815\ucc45 \ud655\uc778 (Very Simple!!)\\n```\\n$ kubectl get cnp\\nNAME            AGE\\nistio-sidecar   2h\\nrule1           5m\\n\\n$  kubectl describe cnp rule1\\nName:         rule1\\nNamespace:    default\\nLabels:       <none>\\nAnnotations:  <none>\\nAPI Version:  cilium.io/v2\\nKind:         CiliumNetworkPolicy\\nMetadata:\\n  Cluster Name:\\n  Creation Timestamp:  2018-07-06T07:25:15Z\\n  Generation:          0\\n  Resource Version:    30312\\n  Self Link:           /apis/cilium.io/v2/namespaces/default/ciliumnetworkpolicies/rule1\\n  UID:                 ba0d7964-80ed-11e8-8077-080027b1075c\\nSpec:\\n  Endpoint Selector:\\n    Match Labels:\\n      Any : Class:  deathstar\\n      Any : Org:    empire\\n  Ingress:\\n    From Endpoints:\\n      Match Labels:\\n        Any : Org:  empire\\n    To Ports:\\n      Ports:\\n        Port:      80\\n        Protocol:  TCP\\nStatus:\\n  Nodes:\\n    Minikube:\\n      Enforcing:              true\\n      Last Updated:           0001-01-01T00:00:00Z\\n      Local Policy Revision:  65\\n      Ok:                     true\\nEvents:                       <none>\\n```\\n\\n## L7 \uc815\ucc45 \uc801\uc6a9\\n\ub9c8\uc9c0\ub9c9\uc73c\ub85c deathstar API\ub97c \ud638\ucd9c\ud558\ub294 \uc11c\ube44\uc2a4\uc5d0 \ub300\ud55c \uc815\ucc45\uc744 \uc81c\uc5b4\ud558\ub294\uac83\uc744 \ud14c\uc2a4\ud2b8\ud574\ubcf8\ub2e4.\\n\\n\\n\uc544\ub798 \uc608\uc2dc\ucc98\ub7fc exhaust-port API(\ud3ec\ud2b8\ub97c \uc18c\uc9c4\uc2dc\ud0a4\ub294 API)\ub97c \uc218\ud589\ud558\uba74 \ud2b9\uc815 pod\uac00 \uc5d0\ub7ec\uac00 \ub098\uace0 \uc7ac\uae30\ub3d9 \ub418\ub294\uac83\uc744 \ud655\uc778\ud560\uc218 \uc788\ub2e4. \\n```\\n$ kubectl exec tiefighter -- curl -s -XPUT deathstar.default.svc.cluster.local/v1/exhaust-port\\n\\nPanic: deathstar exploded\\n\\ngoroutine 1 [running]:\\nmain.HandleGarbage(0x2080c3f50, 0x2, 0x4, 0x425c0, 0x5, 0xa)\\n        /code/src/github.com/empire/deathstar/\\n        temp/main.go:9 +0x64\\nmain.main()\\n        /code/src/github.com/empire/deathstar/\\n        temp/main.go:5 +0x85\\n\\n$ kubectl get pod\\nNAME                         READY     STATUS    RESTARTS   AGE\\ndeathstar-566c89f458-mqgfs   0/1       Error     0          1h\\ndeathstar-566c89f458-wlc4c   1/1       Running   0          1h\\ntiefighter                   1/1       Running   0          1h\\nxwing                        1/1       Running   0          1h\\n\\n$ kubectl get pod\\nNAME                         READY     STATUS    RESTARTS   AGE\\ndeathstar-566c89f458-mqgfs   1/1       Running   1          1h\\ndeathstar-566c89f458-wlc4c   1/1       Running   0          1h\\ntiefighter                   1/1       Running   0          1h\\nxwing                        1/1       Running   0          1h\\n```\\n\\n\uadf8\ub798\uc11c \uc774\ubc88\uc5d0\ub294 exhaust-port API\ub294 \ucc28\ub2e8\ud558\uace0 request-landing API\ub9cc \ud5c8\uc6a9\ud558\ub294 \uc815\ucc45\uc744 \ud14c\uc2a4\ud2b8\ud574\ubcf8\ub2e4.\\n```\\napiVersion: \\"cilium.io/v2\\"\\nkind: CiliumNetworkPolicy\\ndescription: \\"L7 policy to restrict access to specific HTTP call\\"\\nmetadata:\\n  name: \\"rule1\\"\\nspec:\\n  endpointSelector:\\n    matchLabels:\\n      org: empire\\n      class: deathstar\\n  ingress:\\n  - fromEndpoints:\\n    - matchLabels:\\n        org: empire\\n    toPorts:\\n    - ports:\\n      - port: \\"80\\"\\n        protocol: TCP\\n      rules:\\n        http:\\n        - method: \\"POST\\"\\n          path: \\"/v1/request-landing\\"\\n```\\n\ub610\ub294\\n```\\n$ kubectl apply -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/sw_l3_l4_l7_policy.yaml\\n\\nciliumnetworkpolicy.cilium.io/rule1 configured\\n```\\n\\n\uc774\ud6c4 \ub3d9\uc77c\ud55c \ud14c\uc2a4\ud2b8\ub97c \ud574\ubcf4\uba74 \ub2e4\ub978 \uacb0\uacfc\ub97c \ud655\uc778\ud560 \uc218 \uc788\ub2e4. \\n```\\n$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing\\nShip landed\\n\\n$ kubectl exec tiefighter -- curl -s -XPUT deathstar.default.svc.cluster.local/v1/exhaust-port\\nAccess denied\\n```\\n\\n\ub2e4\uc2dc\ud55c\ubc88 \uc0c1\uc138 \uc815\ucc45 \ud655\uc778\uc744 \ud574\ubcf4\uba74 ingress POST \ud5c8\uc6a9\uc815\ucc45\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n```\\n$ kubectl describe ciliumnetworkpolicies rule1\\nName:         rule1\\nNamespace:    default\\nLabels:       <none>\\nAnnotations:  kubectl.kubernetes.io/last-applied-configuration={\\"apiVersion\\":\\"cilium.io/v2\\",\\"description\\":\\"L7 policy to restrict access to specific HTTP call\\",\\"kind\\":\\"CiliumNetworkPolicy\\",\\"metadata\\":{\\"annotations\\":...\\nAPI Version:  cilium.io/v2\\nKind:         CiliumNetworkPolicy\\nMetadata:\\n  Cluster Name:\\n  Creation Timestamp:  2018-07-06T07:25:15Z\\n  Generation:          0\\n  Resource Version:    32814\\n  Self Link:           /apis/cilium.io/v2/namespaces/default/ciliumnetworkpolicies/rule1\\n  UID:                 ba0d7964-80ed-11e8-8077-080027b1075c\\nSpec:\\n  Endpoint Selector:\\n    Match Labels:\\n      Any : Class:  deathstar\\n      Any : Org:    empire\\n  Ingress:\\n    From Endpoints:\\n      Match Labels:\\n        Any : Org:  empire\\n    To Ports:\\n      Ports:\\n        Port:      80\\n        Protocol:  TCP\\n      Rules:\\n        Http:\\n          Method:  POST\\n          Path:    /v1/request-landing\\nStatus:\\n  Nodes:\\n    Minikube:\\n      Annotations:\\n        Kubectl . Kubernetes . Io / Last - Applied - Configuration:  {\\"apiVersion\\":\\"cilium.io/v2\\",\\"description\\":\\"L7 policy to restrict access to specific HTTP call\\",\\"kind\\":\\"CiliumNetworkPolicy\\",\\"metadata\\":{\\"annotations\\":{},\\"name\\":\\"rule1\\",\\"namespace\\":\\"default\\"},\\"spec\\":{\\"endpointSelector\\":{\\"matchLabels\\":{\\"class\\":\\"deathstar\\",\\"org\\":\\"empire\\"}},\\"ingress\\":[{\\"fromEndpoints\\":[{\\"matchLabels\\":{\\"org\\":\\"empire\\"}}],\\"toPorts\\":[{\\"ports\\":[{\\"port\\":\\"80\\",\\"protocol\\":\\"TCP\\"}],\\"rules\\":{\\"http\\":[{\\"method\\":\\"POST\\",\\"path\\":\\"/v1/request-landing\\"}]}}]}]}}\\n\\n      Enforcing:              true\\n      Last Updated:           0001-01-01T00:00:00Z\\n      Local Policy Revision:  70\\n      Ok:                     true\\nEvents:                       <none>\\n```\\n\\ncilium CLI\ub85c\ub3c4 \ud655\uc778\uc774 \uac00\ub2a5\ud558\ub2e4.\\n```\\n\ue0b0 kubectl -n kube-system exec cilium-jmxk2 cilium policy get\\n[\\n  {\\n    \\"endpointSelector\\": {\\n      \\"matchLabels\\": {\\n        \\"reserved:init\\": \\"\\"\\n      }\\n    },\\n    \\"ingress\\": [\\n      {\\n        \\"fromEntities\\": [\\n          \\"host\\"\\n        ]\\n      }\\n    ],\\n    \\"egress\\": [\\n      {\\n        \\"toPorts\\": [\\n          {\\n            \\"ports\\": [\\n              {\\n                \\"port\\": \\"53\\",\\n                \\"protocol\\": \\"UDP\\"\\n              }\\n            ]\\n          }\\n        ],\\n        \\"toEntities\\": [\\n          \\"all\\"\\n        ]\\n      },\\n      {\\n        \\"toEndpoints\\": [\\n          {\\n            \\"matchLabels\\": {\\n              \\"k8s:io.kubernetes.pod.namespace\\": \\"istio-system\\"\\n            }\\n          }\\n        ]\\n      }\\n    ],\\n    \\"labels\\": [\\n      {\\n        \\"key\\": \\"io.cilium.k8s.policy.name\\",\\n        \\"value\\": \\"istio-sidecar\\",\\n        \\"source\\": \\"k8s\\"\\n      },\\n      {\\n        \\"key\\": \\"io.cilium.k8s.policy.namespace\\",\\n        \\"value\\": \\"default\\",\\n        \\"source\\": \\"k8s\\"\\n      }\\n    ]\\n  },\\n  {\\n    \\"endpointSelector\\": {\\n      \\"matchLabels\\": {\\n        \\"any:class\\": \\"deathstar\\",\\n        \\"any:org\\": \\"empire\\",\\n        \\"k8s:io.kubernetes.pod.namespace\\": \\"default\\"\\n      }\\n    },\\n    \\"ingress\\": [\\n      {\\n        \\"fromEndpoints\\": [\\n          {\\n            \\"matchLabels\\": {\\n              \\"any:org\\": \\"empire\\",\\n              \\"k8s:io.kubernetes.pod.namespace\\": \\"default\\"\\n            }\\n          }\\n        ],\\n        \\"toPorts\\": [\\n          {\\n            \\"ports\\": [\\n              {\\n                \\"port\\": \\"80\\",\\n                \\"protocol\\": \\"TCP\\"\\n              }\\n            ],\\n            \\"rules\\": {\\n              \\"http\\": [\\n                {\\n                  \\"path\\": \\"/v1/request-landing\\",\\n                  \\"method\\": \\"POST\\"\\n                }\\n              ]\\n            }\\n          }\\n        ]\\n      }\\n    ],\\n    \\"labels\\": [\\n      {\\n        \\"key\\": \\"io.cilium.k8s.policy.name\\",\\n        \\"value\\": \\"rule1\\",\\n        \\"source\\": \\"k8s\\"\\n      },\\n      {\\n        \\"key\\": \\"io.cilium.k8s.policy.namespace\\",\\n        \\"value\\": \\"default\\",\\n        \\"source\\": \\"k8s\\"\\n      }\\n    ]\\n  }\\n]\\nRevision: 71\\n```\\n\\n\uc774\uc678\uc5d0\ub3c4 Cilium Metric\uc744 Prometheus\uc5d0\uc11c \ud655\uc778\ud558\ub294\uac83\ub3c4 \uac04\ub2e8\ud558\uac8c \ud560\uc218 \uc788\ub2e4\uace0 \ud55c\ub2e4. \\n\\n\uc5ec\uae30\uae4c\uc9c0\uac00 \uae30\ubcf8\uc801\uc73c\ub85c L3/L4, L7 \uae30\ubc18 network policy\ub97c \uc801\uc6a9\ud574\ubcf8\uac83\uc774\uace0 \ub2e4\uc74c\ubc88\uc5d0\ub294 istio\uc640 \uc5f0\uacc4 \ubd80\ubd84\uc774\ub098 \uc2e4\uc81c Cluster \uad6c\uc131\ubc29\ubc95\uc5d0 \ub300\ud574\uc11c \ub2e4\ub904\ubcf4\ub3c4\ub85d \ud558\uaca0\ub2e4."},{"id":"kubernetes/spinnaker-advanced-1/","metadata":{"permalink":"/kubernetes/spinnaker-advanced-1/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-07-03-spinnaker-advanced-1.md","source":"@site/blog/2018-07-03-spinnaker-advanced-1.md","title":"Spinnaker on Kubernetes #1","description":"Spinnaker\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4 #1","date":"2018-07-03T00:00:00.000Z","formattedDate":"July 3, 2018","tags":[{"label":"CI/CD","permalink":"/tags/ci-cd"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Spinnaker","permalink":"/tags/spinnaker"}],"readingTime":3.725,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Spinnaker on Kubernetes #1","comments":true,"classes":"wide","description":"Spinnaker\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4 #1","slug":"kubernetes/spinnaker-advanced-1/","date":"2018-07-03T00:00:00.000Z","categories":["Kubernetes"],"tags":["CI/CD","Kubernetes","Spinnaker"]},"prevItem":{"title":"Cilium","permalink":"/kubernetes/cilium-1/"},"nextItem":{"title":"Provisioning Dedicated Game Server on Kubernetes Cluster","permalink":"/kubernetes/openinfraday18/"}},"content":"\uc9c0\ub09c\ubc88 [OpenInfraDay\ubc1c\ud45c](https://www.slideshare.net/openstack_kr/openinfra-days-korea-2018-track-4-provisioning-dedicated-game-server-on-kubernetes-cluster)\ub54c \uc9c8\ubb38\uc744 \ud574\uc8fc\uc168\ub294\ub370 \uc694\uc998 Spinnaker\ub97c \ub9ce\uc774\ub4e4 \uc4f0\uac70\ub098 \uac80\ud1a0\ub97c \ub9ce\uc774 \ud558\ub294\uac83\uc73c\ub85c \uc54c\uace0 \uc788\ub2e4.  \\n\\nSpinnaker\ub97c \uc124\uce58\ud558\ub294 \ub0b4\uc6a9\uc740 \ub9ce\uc774 \uc788\uc73c\ub2c8 \uc544\ub798 halyard\ub85c \uc124\uce58\ud558\ub294 \ud3ec\uc2a4\ud2b8\ub97c \ucc38\uace0\ud558\uba74 \ub41c\ub2e4.\\n\\n[\uc724\uc0c1\uc900\uc758 \uae30\uc220 \ube14\ub85c\uadf8 - Spinnaker \uc124\uce58\ud558\uae30](https://yunsangjun.github.io/blog/spinnaker/2018/06/03/installing-spinnaker.html)\\n\\n\uc774\ubc88\uc5d0 \uc774\uc57c\uae30\ud558\uace0\uc790 \ud558\ub294 \ubd80\ubd84\uc740 \uc2e4\uc81c Spinnaker\ub97c \uc124\uce58\ud558\uace0 \ub09c \ud6c4 \uc6b4\uc601\uc0c1\uc5d0 \uace0\ub824\ud574\uc57c\ud560 \ubd80\ubd84\ub4e4\uacfc \ud301\ub4e4\uc744 \uacf5\uc720\ud574\ubcf4\ub824\uace0 \ud55c\ub2e4.\\n\\n\uc0ac\uc2e4 Spinnaker\ub97c \uad6c\uc131\ud558\uba74\uc11c \uac00\uc7a5 \uc5b4\ub824\uc6e0\ub358 \ubd80\ubd84\ub4e4\uc740 \uc6a9\uc5b4, halyard config \uad00\ub9ac\uc640 custom resourse \uc778\uc2dd\ubd80\ubd84 \uc774\uc600\ub2e4. \ub098\uba38\uc9c0\ub4e4\uc740 \ubb50 \ud29c\ud1a0\ub9ac\uc5bc\uc744 \ub530\ub77c\uac00\uba74 \ubcc4\ub85c \uc5b4\ub835\uc9c4 \uc54a\uc73c\ub2c8 \uc544\ub798 \ub0b4\uc6a9\uc744 \ucc28\uadfc\ucc28\uadfc \ub530\ub77c\uac00\uba74\uc11c \uc774\ud574\ud558\uba74 \ub420\uac83 \uac19\ub2e4. \\n\\n## \uc6a9\uc5b4\ub4e4\\n\\n\uc0ac\uc6a9\ud558\uba74\uc11c \ud63c\ub3c8\uc774 \ub9ce\uc774 \uc0dd\uae30\ub294 \ubd80\ubd84\uc774\ub2e4 \uc774\uac8c GCE\ub098 EC2\ub97c \uc4f0\uba74 \uc6a9\uc5b4 \ub9e4\uce6d\uc774 \uc26c\uc6b4\ub370 k8s\ub97c \uc704\ud55c \ubcc4\ub3c4\uc758 \uba54\ub274\uac00 \uc544\ub2cc \uae30\ub2a5\uc744 \ud1b5\ud569\ud558\ub2e4\ubcf4\ub2c8 \uc6a9\uc5b4\uac00 \uc870\uae08 \ud63c\ub3d9\uc2a4\ub7fd\uac8c \uad6c\uc131\uc774 \ub418\uc5c8\ub2e4.  \\n\ud2b9\ud788 Load Balancer \ubd80\ubd84\uc740 Service\ub85c \ub9e4\ud551\ub418\uace0 \ud37c\ube14\ub9ad k8s\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 Type LoadBalancer\ub294 \ubbf8\uc9c0\uc6d0\ud55c\ub2e4.  \\n\uadf8\ub9ac\uace0 \ubaa8\ub4e0 Resource\ub4e4\uc740 Deploy, Delete, Scale, Rollout(Undo, Pause, Resume)\uc744 \uc9c0\uc6d0\ud558\uba70 Versioning\uc774 \uc9c0\uc6d0\ub41c\ub2e4.  Versioning\uc740 [\uc5ec\uae30](https://www.spinnaker.io/reference/providers/kubernetes-v2/#strategy)\uc5d0 \uc124\uba85\ub41c \ub300\ub85c ```strategy.spinnaker.io/versioned``` annotation\uc744 \ud1b5\ud574 manifest\ubcc4\ub85c \uc7ac\uc815\uc758\uac00 \uac00\ub2a5\ud558\ub2e4.\\n\\n| Spinnaker | Kubernetes | \ube44\uace0 |\\n|:----------:|:----------:|:-----------:|\\n| Server Group | [Workloads](https://www.spinnaker.io/reference/providers/kubernetes-v2/#workloads) | [CRD\uc758 \uacbd\uc6b0 \ubcc4\ub3c4 Build](https://www.spinnaker.io/guides/developer/crd-extensions/) |\\n| Clusters | Logical Server Group\\t |  |\\n| Load Balancer | Services | LoadBalancer(k8s) \ubbf8\uc9c0\uc6d0 |\\n| Firewall | NetworkPolicies |  |\\n\\n\\nSpinnaker Server Group\uc73c\ub85c \ubd84\ub958 \ub41c \ud56d\ubaa9\uc740 \ubaa8\ub450 Spinnaker\uc758 \ud074\ub7ec\uc2a4\ud130 \ud0ed\uc5d0 \ud45c\uc2dc\uac00 \ub41c\ub2e4. \uac00\ub2a5\ud55c \uacbd\uc6b0 \ubaa8\ub4e0 \ud3ec\ub4dc\uac00 \ud45c\uae30\ub418\uc9c0\ub9cc, \ud574\ub2f9 [Workloads](https://www.spinnaker.io/reference/providers/kubernetes-v2/#workloads) \uc774\uc678\uc758 CRD(Custom Resource Definition)\ub294 halconfig\uc5d0\uc11c \uc544\ub798\uc640 \uac19\uc774 customResources config\ub97c \ucd94\uac00\ud558\uba74 deploy\ub294 \uac00\ub2a5\ud558\ub098 Spinnaker UI\uc5d0\uc11c \ubcf4\uc774\uc9c0\ub294 \uc54a\ub294\ub2e4.  \\n\\n```\\nkubernetes:\\n      enabled: true\\n      accounts:\\n      - name: my-k8s-account\\n        customResources:\\n        - kubernetesKind: GameServer\\n```\\n\\n\uc774\uc720\ub294 \ubc14\ub85c \ub2e4\uc74c \ub9c1\ud06c\ucc98\ub7fc [(CRD\uc758 \uacbd\uc6b0 \ubcc4\ub3c4 Build\ud544\uc694)](https://www.spinnaker.io/guides/developer/crd-extensions/) \\n\ubcc4\ub3c4\ub85c Java\ub97c \ube4c\ub4dc\ud574\uc57c \ud55c\ub2e4. Spinnaker Slack\uc5d0 \ubb38\uc758\ub97c \uba87\ubc88\ud588\ub294\ub370 \uc9c8\ubb38\ud558\ub294 \uc0ac\ub78c\ub9cc \uc788\uace0 \ub2f5\uc740 \uc544\ubb34\ub3c4 \uc548\ud574\uc900\ub2e4\ub294...  \\nhttps://spinnakerteam.slack.com/\\n\\n\\n\\n## Jenkins \uc5f0\ub3d9\\n\\n[Spinnaker, Jenkins integration \uc0c1\uc138\ub0b4\uc6a9 \uacf5\uc2dd\ubb38\uc11c ](https://www.spinnaker.io/setup/ci/jenkins/)\\n\\nJenkins\uc640 \uc5f0\ub3d9\ud558\uba74\uc11c \uac00\uc7a5 \uc5b4\uc774\uc5c6\uc774 \ud5e4\ub9e8\ubd80\ubd84\uc740 \uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc \ub418\uc5b4\uc788\uc5b4\uc57c \ud558\ub294\ub370 Security Realm\uc744 Jenkins Default admin \uacc4\uc815\ub9cc\uc744 \uac00\uc9c0\uace0 integration \ud558\ub824\ub2e4\uac00 \uacc4\uc18d \uc2e4\ud328\ud558\uc600\ub2e4. Delegate to servlet container \ub9d0\uace0 Jenkins \uc790\uccb4 \uc0ac\uc6a9\uc790 DB\ub85c \ubcc4\ub3c4 \uacc4\uc815\uc744 \uc0dd\uc131\ud558\uace0 \uc544\ub798 \uadf8\ub9bc\ucc98\ub7fc \uc124\uc815\uc744 \ud574\uc57c\ud55c\ub2e4.\\n\\n![Jenkins Config](/img/jenkins_config.png)\\n\\n\uc704 \uc124\uc815 \uc774\ud6c4 \uc544\ub798\uc640 \uac19\uc774 Spinnaker UI\uc5d0\uc11c Jenkins API\uc5f0\ub3d9\uc774 \uac00\ub2a5\ud558\ub2e4.  \\n\\n![Spinnaker Jenkins](/img/spin_jenkins.png)\\n\\n\\n\uc624\ub298\uc740 \uc5ec\uae30\uae4c\uc9c0\ub9cc \ud558\uace0 \ub2e4\uc74c\uae00\uc5d0\uc11c\ub294 \ubc30\ud3ec\uc804\ub7b5\uc774\ub098 Network Policy \uc5f0\ub3d9\ub4f1\uc744 \uc0c1\uc138\ud788 \uc801\uc5b4\ubcfc \uc608\uc815\uc774\ub2e4."},{"id":"kubernetes/openinfraday18/","metadata":{"permalink":"/kubernetes/openinfraday18/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-07-01-openinfraday18.md","source":"@site/blog/2018-07-01-openinfraday18.md","title":"Provisioning Dedicated Game Server on Kubernetes Cluster","description":"Provisioning Dedicated Game Server on Kubernetes Cluster","date":"2018-07-01T00:00:00.000Z","formattedDate":"July 1, 2018","tags":[{"label":"CI/CD","permalink":"/tags/ci-cd"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Agones","permalink":"/tags/agones"},{"label":"Spinnaker","permalink":"/tags/spinnaker"}],"readingTime":0.2,"truncated":false,"authors":[],"frontMatter":{"layout":"single","title":"Provisioning Dedicated Game Server on Kubernetes Cluster","comments":true,"classes":"wide","description":"Provisioning Dedicated Game Server on Kubernetes Cluster","slug":"kubernetes/openinfraday18/","date":"2018-07-01T00:00:00.000Z","categories":["Kubernetes"],"tags":["CI/CD","Kubernetes","Agones","Spinnaker"]},"prevItem":{"title":"Spinnaker on Kubernetes #1","permalink":"/kubernetes/spinnaker-advanced-1/"},"nextItem":{"title":"Mutating Webhook","permalink":"/kubernetes/mutating-web-hook/"}},"content":"6\uc6d4 28\uc77c\uc5d0 Openinfraday\uc5d0\uc11c \ubc1c\ud45c\ud55c \ub0b4\uc6a9\\n\\n[![Slideshare](https://image.slidesharecdn.com/43dgs06270307-180628163517/95/openinfra-days-korea-2018-track-4-provisioning-dedicated-game-server-on-kubernetes-cluster-1-638.jpg?cb=1530203766)\\n](https://www.slideshare.net/openstack_kr/openinfra-days-korea-2018-track-4-provisioning-dedicated-game-server-on-kubernetes-cluster)\\n\\n\\n## \ubc1c\ud45c \uc601\uc0c1\\n  \\n[![Video](http://img.youtube.com/vi/LtGGzKBoVZQ/0.jpg)](https://youtu.be/LtGGzKBoVZQ?t=0s)\\n\\nCustom Resource \uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc740 \uc0c1\uc138\ud558\uac8c \ub354 \uc815\ub9ac\ud574\uc57c\uaca0\ub2e4."},{"id":"kubernetes/mutating-web-hook/","metadata":{"permalink":"/kubernetes/mutating-web-hook/","editUrl":"https://github.com/ddiiwoong/newblog/tree/main/blog/2018-06-27-mutating-web-hook.md","source":"@site/blog/2018-06-27-mutating-web-hook.md","title":"Mutating Webhook","description":"Mutating Webhook\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","date":"2018-06-27T00:00:00.000Z","formattedDate":"June 27, 2018","tags":[{"label":"Mutating Webhook","permalink":"/tags/mutating-webhook"},{"label":"Kubernetes","permalink":"/tags/kubernetes"},{"label":"Admission Controller","permalink":"/tags/admission-controller"},{"label":"Istio","permalink":"/tags/istio"},{"label":"Agones","permalink":"/tags/agones"}],"readingTime":8.435,"truncated":false,"authors":[],"frontMatter":{"layout":"single","classes":"wide","title":"Mutating Webhook","description":"Mutating Webhook\uc5d0 \ub300\ud574 \uc54c\uc544\ubd05\ub2c8\ub2e4","slug":"kubernetes/mutating-web-hook/","date":"2018-06-27T00:00:00.000Z","categories":["Kubernetes"],"tags":["Mutating Webhook","Kubernetes","Admission Controller","Istio","Agones"]},"prevItem":{"title":"Provisioning Dedicated Game Server on Kubernetes Cluster","permalink":"/kubernetes/openinfraday18/"}},"content":"## Admission controller \ud655\uc7a5\\n\\nKubernetes(\uc774\ud558 k8s)\uae30\ubc18 \uac1c\ubc1c \uacfc\uc81c\ub97c \uc218\ud589\ud558\ub2e4\ubcf4\ub2c8 Custom Resource\ub97c \uc0ac\uc6a9\ud560\uc218 \ubc16\uc5d0 \uc5c6\ub294 \uc0c1\ud669\ub4e4\uc774 \ubc1c\uc0dd\ud558\uc600\ub2e4.  \\n\uadf8\ub7f0 \uc640\uc911\uc5d0 istio\uc640 \uac19\uc740 Service Mesh Layer\ub97c \ub9ac\uc11c\uce58\ud558\ub358 \uc911\uc5d0 \ud280\uc5b4\ub098\uc628 MutatingAdmissionWebhook \uc6a9\uc5b4\ub97c \uc774\ud574\ud558\uae30 \uc704\uc5d0 \uc870\uc0ac\ud55c \ub0b4\uc6a9\uc744 \uc815\ub9ac\ud574\ubcf8\ub2e4.\\n\\n<https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/>\\n\\n\\nAdmission controller\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4 api-server\uc758 \uc624\ube0c\uc81d\ud2b8(Pod,\ub4f1) \uc0dd\uc131 \uc694\uccad\uc744 \uac00\ub85c\uccb4\uc5b4 \uc81c\uc5b4\ub97c \ud560 \uc218 \uc788\ub294 \ud655\uc7a5 \uae30\ub2a5\uc73c\ub85c \ud50c\ub7ec\uadf8\uc778 \ud615\ud0dc\ub85c \uc0ac\uc6a9\uc790\uac00 \ucd94\uac00 \ud560 \uc218 \uc788\ub2e4.   \\n\uc880\ub354 \uc790\uc138\ud788 \ud655\uc778\ud574\ubcf4\uc790 \\n- \ud074\ub7ec\uc2a4\ud130 \uad00\ub9ac\uc790\uac00 kube-api\ub97c \uc9c1\uc811 \ucef4\ud30c\uc77c \ud558\uace0 \uad6c\uc131\ud574\uc57c \ud558\uae30 \ub54c\ubb38\uc5d0 \uc720\uc5f0\ud558\uac8c \uc0ac\uc6a9\ud558\uae30 \uc5b4\ub824\uc6c0\\n- 1.7 \ubc84\uc804 \uc774\ud6c4\ubd80\ud130\ub294 \uc774\ub7ec\ud55c \uc81c\ud55c\uc0ac\ud56d\uc744 \ud574\uacb0\ud558\uae30 \uc704\ud574 alpha feature\ub85c  [Initializers](https://v1-9.docs.kubernetes.io/docs/admin/extensible-admission-controllers/#initializers) \uc640 [External Admission Webhooks](https://v1-9.docs.kubernetes.io/docs/admin/extensible-admission-controllers/#external-admission-webhooks) \uae30\ub2a5\uc774 \ub3c4\uc785\ub428\\n- External Admission Webhooks \ub294 k8s \ub9ac\uc18c\uc2a4\uc758 \uc720\ud6a8\uc131 \uac80\uc0ac\ub97c \ud558\ub294\ub370 \ud65c\uc6a9, \uc720\ud6a8\uc131 \uac80\uc0ac\ub97c \ud1b5\uacfc \ud558\uc9c0 \ubabb\ud558\uba74 \ud574 \ub2f9 \ub9ac\uc18c\uc2a4\ub294 \ucfe0\ubc84\ub124\ud2f0\uc2a4\uc5d0\uc11c \uc0dd\uc131\ub418\uc9c8 \uc54a\uac8c \ud560 \uc218 \uc788\uc74c.\\n- 1.9 \ubc84\uc804\uc5d0\uc11c\ub294 External Admission Webhooks \uc740 beta\ub85c \uc2b9\uaca9\ub418\uc5b4 MutatingAdmissionWebhook \ubc0f ValidatingAdmissionWebhook\uc73c\ub85c \ub098\ub220\uc84c\uc9c0\ub9cc Initializers \ub294 alpha \ub85c \uc720\uc9c0\ub428\\n- MutatingAdmissionWebhook \uc740 \uc720\ud6a8\uc131 \uac80\uc0ac \uc774\uc678\uc5d0\ub3c4 \uc2b9\uc778 \uacfc\uc815\uc2dc k8s object\uc5d0 \ubcc0\uacbd\uc744 \ud560\uc218 \uc788\uc74c\\n  - \uc608\ub97c \ub4e4\uba74 resource quota\ub97c \ubcc0\uacbd\ud55c\ub2e4\ub358\uc9c0  Agones \ubc0f istio\uc640 \uac19\uc740 Custom Resource \ub97c \uc218\uc815\ud558\uc5ec object\ub97c \uc0dd\uc131\uc774 \uac00\ub2a5\ud568\\n  - Webhook \ubc29\uc2dd\uc740 gRPC \ud504\ub85c\ud1a0\ucf5c\uc744 \uc0ac\uc6a9\ud558\ub294 \ub370 \uac1c\ubc1c\uc5b8\uc5b4\uc5d0 \uad6c\uc560 \ubc1b\uc9c0 \uc54a\uace0 \ud655\uc7a5\uc744 \ud560 \uc218 \uc788\ub2e4\ub294 \uc7a5\uc810\uc774 \uc788\uc74c\\n\\n\\n## Webhook\uc744 \uc5b8\uc81c \uc4f0\ub294\uac00?\\nWebhook\uc744 \uc0ac\uc6a9\ud558\uc5ec k8s cluster-admin\uc774 api-server\ub97c \ub2e4\uc2dc \ucef4\ud30c\uc77c\ud558\uc9c0 \uc54a\uace0\ub3c4 object\uc0dd\uc131 \uc694\uccad\uc2dc mutating(\ubcc0\uacbd) \ubc0f validation(\uc720\ud6a8\uc131\uac80\uc99d) \uc744 \ud558\ub294 \ud50c\ub7ec\uadf8\uc778\uc744 \ub9cc\ub4e4 \uc218 \uc788\ub2e4. \\n\\n\uc774\ub97c \ud1b5\ud574 \uac1c\ubc1c\uc790\ub294 \ubaa8\ub4e0 resource \uc5d0\uc11c \uc5ec\ub7ec \uc791\uc5c5 ( \\"CREATE\\", \\"UPDATE\\", \\"DELETE\\"...)\uc5d0 \ub300\ud55c \uc2b9\uc778 \ub85c\uc9c1\uc5d0 \ub300\ud574 \uc0ac\uc6a9\uc790 \uc815\uc758 \ud560 \uc218\uc788\ub294 \uc720\uc5f0\uc131\uc744 \uc81c\uacf5\ubc1b\ub294\ub2e4.\\n\\n\\n## Use-Case\\n- resource\ub97c \uc0dd\uc131\ud558\uae30 \uc804\uc5d0 \ubcc0\uacbd  \\n(\uc608, Istio \uc5d0\uc11c \ucc98\ub7fc traffic management \uc640 policy enforcement \uc744 \uc704\ud574 Envoy sidecar container\ub97c injection)\\n- StorageClass Provisioning \uc790\ub3d9\ud654  \\n(PersistentVolumeClaim object \uc0dd\uc131\uc744 \ubaa8\ub2c8\ud130\ub9c1\ud558\uace0 \ubbf8\ub9ac \uc815\uc758 \ub41c \uc815\ucc45\uc5d0 \ub530\ub77c \uac1d\uccb4\uc5d0 storage\ub97c \uc790\ub3d9\uc73c\ub85c \ucd94\uac00. \uc0ac\uc6a9\uc790\ub294 StorageClass \uc0dd\uc131 \uc5d0 \uc2e0\uacbd \uc4f8 \ud544\uc694\uac00 \uc5c6\uc74c)\\n- \ubcf5\uc7a1\ud55c custom resource \uac80\uc99d (Agones\uc640 \uac19\uc740)namespace \uc81c\ud55c  \\n\uba40\ud2f0 \ud14c\ub10c\ud2b8 \uc2dc\uc2a4\ud15c\uc5d0\uc11c\ub294 reserved namespace\uc5d0 resource\uc0dd\uc131\uc744 \uae08\uc9c0\uc2dc\ud0ac\ub54c \uc0ac\uc6a9\ud560\uc218 \uc788\uc74c\\n\\n- \ucc38\uace0 \uc608\uc2dc  \\n<https://github.com/kelseyhightower/denyenv-validating-admission-webhook>\\n\\n\\n\\n## \uc5b4\ub5bb\uac8c \ub3d9\uc791\ud558\ub294\uac00?\\nMutatingWebhookConfiguration \ub0b4\uc5d0 \uc815\uc758\ub41c \ub8f0\uc5d0 \ub530\ub77c etcd\ub85c \uc804\ub2ec\ub418\uae30 \uc804\uc5d0 request\ub97c intercept\ud55c\ub2e4.  \\nwebhook \uc11c\ubc84\uc5d0 \uc2b9\uc778 \uc694\uccad\uc744 \uc804\uc1a1\ud558\uc5ec \ubcc0\uc774\ub97c \uc2e4\ud589\ud55c\ub2e4.  \\nwebhook \uc11c\ubc84\ub294 API\ub97c \uc900\uc218\ud558\ub294 \ub2e8\uc21c\ud55c http\uc11c\ubc84.\\n\\n![Alt text](/img/mutating.jpg)\\n\\n## \ud29c\ud1a0\ub9ac\uc5bc\\n<https://github.com/morvencao/kube-mutating-webhook-tutorial>  \\n\\n\uc704 \ud29c\ud1a0\ub9ac\uc5bc\uc740 object\uac00 \uc0dd\uc131\ub418\uae30 \uc804\uc5d0 pod\uc5d0 nginx sidecar container\ub97c inject\ud558\ub294 MutatingAdmissionWebhook\uc744 \ubc30\ud3ec\ud558\ub294 \ub0b4\uc6a9\uc744 \ub2f4\uace0 \uc788\ub2e4.\\n\\n\uc6b0\uc120 admissionregistration.k8s.io/v1beta1 API\ub97c \uc0ac\uc6a9\ud560\uc218 \uc788\ub294 k8s 1.9+ \uc774\uc0c1\uc758 \ud074\ub7ec\uc2a4\ud130\uac00 \ud544\uc694\ud558\ub2e4.  \\n\\n## \ud655\uc778\ubc29\ubc95\\n```\\n$ kubectl api-versions | grep admissionregistration.k8s.io/v1beta1\\n```\\n\uc544\ub798\uc640 \uac19\uc740 \uacb0\uacfc\uac00 \ub098\uc640\uc57c\ud568\\n```\\nadmissionregistration.k8s.io/v1beta1\\n```\\n\\n## Build\ud558\uae30\\n\\n\uc77c\ub2e8 Go\uac00 \uc124\uce58\ub418\uc5b4 \uc788\uc5b4\uc57c \ud55c\ub2e4.\\n```~/go/src``` \uc544\ub798\uc5d0 clone\uc744 \ud558\uc600\uc74c.\\n\\n```\\n$ cd ~/go/src\\n$ git clone https://github.com/morvencao/kube-mutating-webhook-tutorial.git\\n```\\n\\n\uc758\uc874\uc131 \uad00\ub9ac\ub97c \uc704\ud574 repo\ub294 dep\ub97c \uc0ac\uc6a9\ud568\\n```\\n$ cd kube-mutating-webhook-tutorial\\n$ go get -u github.com/golang/dep/cmd/dep\\n```\\n\\nbuild \ud30c\uc77c \ud655\uc778\ud558\uace0 registry \uc704\uce58\ub97c \ubc14\uafc8\\n```\\ndep ensure\\nCGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o kube-mutating-webhook-tutorial .\\ndocker build --no-cache -t registry.*****.io/agones/sidecar-injector:v1 .\\nrm -rf kube-mutating-webhook-tutorial\\n\\ndocker push registry.*****.io/agones/sidecar-injector:v1\\n```\\n\\nbuild\ud558\uace0 docker image push\\n```\\n$ ./build\\nSending build context to Docker daemon  44.29MB\\nStep 1/3 : FROM alpine:latest\\n ---\x3e 3fd9065eaf02\\nStep 2/3 : ADD kube-mutating-webhook-tutorial /kube-mutating-webhook-tutorial\\n ---\x3e 8679ccbab536\\nStep 3/3 : ENTRYPOINT [\\"./kube-mutating-webhook-tutorial\\"]\\n ---\x3e Running in 7699ff5c0885\\nRemoving intermediate container 7699ff5c0885\\n ---\x3e 2014100d460e\\nSuccessfully built 2014100d460e\\nSuccessfully tagged registry.*****.io/agones/sidecar-injector:v1\\nThe push refers to repository [registry.*****.io/agones/sidecar-injector]\\n2456c1309a51: Pushed\\ncd7100a72410: Layer already exists\\nv1: digest: sha256:15c335daeba40ddcbfbc3631ab6daa7cf623b63420f0ae8b657755322ef0582d size: 739\\n```\\n\\n\\nsidecar deployment\uc5d0 \uc0ac\uc6a9\ub418\ub294 secret(cert/key)\uc744 \uc0dd\uc131\ud55c\ub2e4.\\n```\\n./deployment/webhook-create-signed-cert.sh \\\\\\n    --service sidecar-injector-webhook-svc \\\\\\n    --secret sidecar-injector-webhook-certs \\\\\\n    --namespace default\\n```\\n\\n\uc704\uc5d0\uc11c \uc0dd\uc131\ub41c \ud074\ub7ec\uc2a4\ud130\uc758 caBundle\uac12\uc744 \uac00\uc9c0\uace0 MutatingWebhookConfiguration \uc0dd\uc131\ud55c\ub2e4.\\n```\\ncat deployment/mutatingwebhook.yaml | \\\\\\n    deployment/webhook-patch-ca-bundle.sh > \\\\\\n    deployment/mutatingwebhook-ca-bundle.yaml\\n```\\n\\nresource\ub4e4 deploy\\n```\\n$ kubectl create -f deployment/nginxconfigmap.yaml\\nkubectl create -f deployment/configmap.yaml\\nkubectl create -f deployment/deployment.yaml\\nkubectl create -f deployment/service.yaml\\nkubectl create -f deployment/mutatingwebhook-ca-bundle.yaml\\n\\nconfigmap \\"nginx-configmap\\" created\\nconfigmap \\"sidecar-injector-webhook-configmap\\" created\\ndeployment.extensions \\"sidecar-injector-webhook-deployment\\" created\\nservice \\"sidecar-injector-webhook-svc\\" created\\nmutatingwebhookconfiguration.admissionregistration.k8s.io \\"sidecar-injector-webhook-cfg\\" created\\n```\\n\\nwebhook deployment \ud655\uc778\\n\\n```\\n$ kubectl get pods\\nNAME                                                   READY     STATUS    RESTARTS   AGE\\nsidecar-injector-webhook-deployment-796955558f-js6bb   1/1       Running   0          3m\\n\\n$ kubectl get deployment\\nNAME                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\\nsidecar-injector-webhook-deployment   1         1         1            1           3m\\n```\\n\\ndefault \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 sidecar-injector \ub77c\ubca8\ub9c1\uc744 \ud55c\ub2e4. \uc774\ub807\uac8c \ud558\uba74 \ud574\ub2f9 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\uc5d0 \uc0dd\uc131\ub418\ub294 \ubaa8\ub4e0 app\uc5d0 \uc790\ub3d9\uc73c\ub85c injection\ud558\uac8c \ub428\\n```\\n$ kubectl get namespace -L sidecar-injector\\nNAME             STATUS    AGE       SIDECAR-INJECTOR\\nagones-system    Active    1d\\ndefault          Active    19d       enabled\\nibm-cert-store   Active    19d\\nibm-system       Active    19d\\ningress-test     Active    6d\\nkube-public      Active    19d\\nkube-system      Active    19d\\nspinnaker        Active    12d\\nxonotic          Active    1d\\n```\\n\\n\uc0d8\ud50c\uc571\uc744 \ub514\ud50c\ub85c\uc774 \ud574\ubcf4\uc790\\n```\\n$ cat <<EOF | kubectl create -f -\\napiVersion: extensions/v1beta1\\nkind: Deployment\\nmetadata:\\n  name: sleep\\nspec:\\n  replicas: 1\\n  template:\\n    metadata:\\n      annotations:\\n        sidecar-injector-webhook.morven.me/inject: \\"yes\\"\\n      labels:\\n        app: sleep\\n    spec:\\n      containers:\\n      - name: sleep\\n        image: tutum/curl\\n        command: [\\"/bin/sleep\\",\\"infinity\\"]\\n        imagePullPolicy:\\nEOF\\ndeployment.extensions \\"sleep\\" created\\n```\\n\\nsidecar container injection \ud655\uc778  \\n\uc544\ub798 \uacb0\uacfc\ub97c \ubcf4\uba74 \ud558\ub098\uc758 deployment \ud558\ub098\uc758 container \uc0dd\uc131\uc744 \uc694\uccad\ud588\uc9c0\ub9cc nginx sidecar \ucee8\ud14c\uc774\ub108\uac00 injection \ub41c\uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4.\\n\\n```\\n$ kubectl get pod\\nNAME                                                   READY     STATUS    RESTARTS   AGE\\nsidecar-injector-webhook-deployment-796955558f-js6bb   1/1       Running   0          2h\\nsleep-74b46f8bd7-r9l7f                                 2/2       Running   0          42s\\n\\n$ kubectl describe pod sleep-74b46f8bd7-r9l7f\\nName:           sleep-74b46f8bd7-r9l7f\\nNamespace:      default\\nNode:           10.178.188.16/10.178.188.16\\nStart Time:     Wed, 27 Jun 2018 13:12:47 +0900\\nLabels:         app=sleep\\n                pod-template-hash=3060294683\\nAnnotations:    kubernetes.io/psp=ibm-privileged-psp\\n                sidecar-injector-webhook.morven.me/inject=yes\\n                sidecar-injector-webhook.morven.me/status=injected\\nStatus:         Running\\nIP:             172.30.169.30\\nControlled By:  ReplicaSet/sleep-74b46f8bd7\\nContainers:\\n  sleep:\\n    Container ID:  docker://728ca7f8e741ad29369312bc006c79683e7e605f3b04586df2477e233f93e451\\n    Image:         tutum/curl\\n    Image ID:      docker-pullable://tutum/curl@sha256:b6f16e88387acd4e6326176b212b3dae63f5b2134e69560d0b0673cfb0fb976f\\n    Port:          <none>\\n    Host Port:     <none>\\n    Command:\\n      /bin/sleep\\n      infinity\\n    State:          Running\\n      Started:      Wed, 27 Jun 2018 13:13:01 +0900\\n    Ready:          True\\n    Restart Count:  0\\n    Environment:    <none>\\n    Mounts:\\n      /var/run/secrets/kubernetes.io/serviceaccount from default-token-czzpj (ro)\\n  sidecar-nginx:\\n    Container ID:   docker://94fd41a0e153de6d5639873ccbd6b6325cee1ea8351dd02ab4a48ab4004d0b58\\n    Image:          nginx:1.12.2\\n    Image ID:       docker-pullable://nginx@sha256:72daaf46f11cc753c4eab981cbf869919bd1fee3d2170a2adeac12400f494728\\n    Port:           80/TCP\\n    Host Port:      0/TCP\\n    State:          Running\\n      Started:      Wed, 27 Jun 2018 13:13:08 +0900\\n    Ready:          True\\n    Restart Count:  0\\n    Environment:    <none>\\n    Mounts:\\n      /etc/nginx from nginx-conf (rw)\\nConditions:\\n  Type           Status\\n  Initialized    True\\n  Ready          True\\n  PodScheduled   True\\nVolumes:\\n  default-token-czzpj:\\n    Type:        Secret (a volume populated by a Secret)\\n    SecretName:  default-token-czzpj\\n    Optional:    false\\n  nginx-conf:\\n    Type:        ConfigMap (a volume populated by a ConfigMap)\\n    Name:        nginx-configmap\\n    Optional:    false\\nQoS Class:       BestEffort\\nNode-Selectors:  <none>\\nTolerations:     node.kubernetes.io/not-ready:NoExecute for 300s\\n                 node.kubernetes.io/unreachable:NoExecute for 300s\\nEvents:\\n  Type    Reason                 Age   From                    Message\\n  ----    ------                 ----  ----                    -------\\n  Normal  Scheduled              1m    default-scheduler       Successfully assigned sleep-74b46f8bd7-r9l7f to 10.178.188.16\\n  Normal  SuccessfulMountVolume  1m    kubelet, 10.178.188.16  MountVolume.SetUp succeeded for volume \\"nginx-conf\\"\\n  Normal  SuccessfulMountVolume  1m    kubelet, 10.178.188.16  MountVolume.SetUp succeeded for volume \\"default-token-czzpj\\"\\n  Normal  Pulling                1m    kubelet, 10.178.188.16  pulling image \\"tutum/curl\\"\\n  Normal  Pulled                 55s   kubelet, 10.178.188.16  Successfully pulled image \\"tutum/curl\\"\\n  Normal  Created                55s   kubelet, 10.178.188.16  Created container\\n  Normal  Started                55s   kubelet, 10.178.188.16  Started container\\n  Normal  Pulling                55s   kubelet, 10.178.188.16  pulling image \\"nginx:1.12.2\\"\\n  Normal  Pulled                 48s   kubelet, 10.178.188.16  Successfully pulled image \\"nginx:1.12.2\\"\\n  Normal  Created                48s   kubelet, 10.178.188.16  Created container\\n  Normal  Started                48s   kubelet, 10.178.188.16  Started container\\n```\\n\\n## \uc815\ub9ac\\n\uacb0\uad6d \uc704\uc5d0\uc11c \uc5b8\uae09\ud55c\uac83 \ucc98\ub7fc MutationWebhook\uc740 istio RouteRule\uac19\uc740 \ubcc4\ub3c4\uc758 CustomResource\ub4f1\uc744 injection \ud558\uac70\ub098 agones \ub4f1\uacfc \uac19\uc774 \uac8c\uc784\uc11c\ubc84\uc678\uc5d0 client sdk \ud1b5\uc2e0\uc744 \uc704\ud55c injection \ud615\ud0dc\ub85c \uae30\uc874 resource\uc5d0 \ucd94\uac00\uc801\uc778 \ubcc0\uacbd(mutation) \ub610\ub294 \uac80\uc99d(validation)\ub4f1\uc758 \ucd94\uac00\uc801\uc778 \uc791\uc5c5\uc744 kube-api\uc758 \ucef4\ud30c\uc77c\uc5c6\uc774 \uac00\ub2a5\ud558\ub2e4\ub294\ub370 \ubaa9\uc801\uc774 \uc788\ub2e4\uace0 \ubcfc \uc218 \uc788\ub2e4. \ucd94\uac00\uc801\uc73c\ub85c \uae30\ub2a5\uc5d0 \ub300\ud55c \ub0b4\uc6a9\uc740 \uc774\ud6c4 \ub2e4\uc2dc \uc815\ub9ac\ud574\ubcfc \uc608\uc815\uc774\ub2e4."}]}')}}]);