<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Act as a catalyst RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Act as a catalyst Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Act as a catalyst JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-4ZT898XDT2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4ZT898XDT2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4ZT898XDT2",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Cloud Catalyst" href="/opensearch.xml">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4362752107119680" crossorigin="anonymous"></script><title data-rh="true">Cloud Catalyst | Cloud Catalyst</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ddii.dev/page/6/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="naver-site-verification" content="cbcc03783e5594725d3951f4e7f16ede80e69881"><meta data-rh="true" property="og:title" content="Cloud Catalyst | Cloud Catalyst"><meta data-rh="true" name="description" content="My little thought may as a catalyst in other engineer&#x27;s career"><meta data-rh="true" property="og:description" content="My little thought may as a catalyst in other engineer&#x27;s career"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ddii.dev/page/6/"><link data-rh="true" rel="alternate" href="https://ddii.dev/page/6/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ddii.dev/page/6/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UTLA0DRN66-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.1e7a31ee.css">
<link rel="preload" href="/assets/js/runtime~main.0de6f75a.js" as="script">
<link rel="preload" href="/assets/js/main.df906855.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-catalyst.svg" alt="Cloud Catalyst" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo-catalyst.svg" alt="Cloud Catalyst" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Cloud Catalyst</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Posts</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="introduction" href="/docs/prometheus/introduction/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/prometheus/introduction/">Prometheus</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/tags/">Tags</a><a class="navbar__item navbar__link" href="/presentation/">Presentation</a><a class="navbar__item navbar__link" href="/archive/">Archive</a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/pang4u/">Pang4u</a><a href="https://github.com/ddiiwoong/newblog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/kernelhardening/">커널 강화 도구 사용하기</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/readinessandprobe/">파드 Readiness &amp; Probe</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/k6-prometheus/">prometheus grafana 스택으로 k6 테스트 결과 확인하기</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/kyverno/">kyverno를 활용한 Kubernetes 정책 엔진 적용</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/argo-rollout-advanced/">Advanced Argo Rollout</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/kubernetes/knative-knctl/">Knative CLI - knctl</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-02-18T00:00:00.000Z" itemprop="datePublished">February 18, 2019</time> · <!-- -->15 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="knctl">knctl<a class="hash-link" href="#knctl" title="Direct link to heading">​</a></h2><p><code>knctl</code> 은 Knative CLI 툴로 간단하게 knative cluster를 만들고 Knative를 추상화해서 앱까지 배포할 수 있는 오픈소스이다. </p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="참고">참고<a class="hash-link" href="#참고" title="Direct link to heading">​</a></h4><ul><li><a href="https://github.com/cppforlife/knctl" target="_blank" rel="noopener noreferrer">https://github.com/cppforlife/knctl</a>  </li><li><a href="https://developer.ibm.com/blogs/2018/11/12/knctl-a-simpler-way-to-work-with-knative/" target="_blank" rel="noopener noreferrer">https://developer.ibm.com/blogs/2018/11/12/knctl-a-simpler-way-to-work-with-knative/</a>  </li><li><a href="https://starkandwayne.com/blog/public-traffic-into-knative-on-gke/" target="_blank" rel="noopener noreferrer">https://starkandwayne.com/blog/public-traffic-into-knative-on-gke/</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="knative-다시-살펴보기">Knative 다시 살펴보기<a class="hash-link" href="#knative-다시-살펴보기" title="Direct link to heading">​</a></h3><p><a href="https://ddii.dev/kubernetes/knative/" target="_blank" rel="noopener noreferrer">앞선 포스팅에서도 이야기</a> 했지만 기존 FaaS(AWS Lambda, Google Cloud Funtions, Azure Function) 과는 다른 Serverless 개념으로 받아들어야 한다.</p><p>다시 한번 특징을 나열해보면 아래와 같다.</p><ul><li>Serverless Container의 신속한 배치 </li><li>Automatic scaling up and down to zero</li><li>Istio를 백엔드로 활용하여 Routing 구현</li><li>배포 된 코드 및 config의 특정 시점 스냅 샷</li></ul><p>그리고 다음과 같은 CRDs(Custom Resource Definitions)로 구성된 오브젝트들로 정의된다.</p><ul><li><code>Route</code>는 사용자 서비스에 대한 HTTP endpoint와 Routing을 제공한다.</li><li><code>Revisions</code>은 code(function)와 config로 구성된 불변의 스냅샷. Route를 통해 endpoint를 할당받지 못한 Revision은 자동으로 kubernetes resource에서 삭제됨</li><li><code>Configuration</code>은 요구되는 Revision 최신 상태를 기록하고 생성하고 추적할수 있음. 소스 패키지(git repo나 archive)를 컨테이너로 변환하기 위한 내용이나 메타데이터등을 포함시킬수 있음. </li><li><code>Service</code>는 <code>Routes</code>와 <code>Configurations</code> 리소스의 추상화된 집합체. 모든 워크로드의 lifecycle을 관리함. 트래픽을 항상 최신의 Revision으로 route되도록 정의할수 있음</li></ul><p>하나씩 조금 자세히 이야기 하면 아래처럼 정리 할수 있다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="route">Route<a class="hash-link" href="#route" title="Direct link to heading">​</a></h3><p><strong>Route</strong>는 사용자 서비스(Code와 Configuration의 Revision정보)의 네트워크 Endpoint를 제공한다. kubernetes namespace는 여러개의 <code>Route</code>를 가질수 있다. <code>Route</code>는 하나 이상의 <code>Revisions</code>을 가지면서 수명이 길고 안정적인 HTTP Endpoint를 제공한다. 기본구성은 <code>Route</code> 객체가 <code>Configuration</code>에 의해 생성된 최신의 Revision으로 트래픽을 자동으로 지정한다. 조금더 복잡한 경우로는 istio의 기능을 활용하여 트래픽을 백분율 기준으로 <code>Route</code>를 지정할 수 있다. </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="revision">Revision<a class="hash-link" href="#revision" title="Direct link to heading">​</a></h3><p><strong>Revision</strong>은 Code와 Configuration의 불변의 스냅샷이다. 하나의 <code>Revision</code>은 컨테이너 이미지를 참조하고 선택적으로 <code>Build</code>를 참조할 수 있다. <code>Revision</code>은 <strong>Configuration</strong>이 업데이트 시 생성된다.<br>
<code>Route</code>를 통해 http주소 지정이 불가능한 <code>Revision</code>은 폐기 되고 관련된 kubernetes 리소스가 삭제가 된다. 시간이 지남에 따라 <code>Configuration</code>이 생성한 <code>Revision</code> 히스토리가 제공되고 사용자는 이전 <code>Revision</code>로 쉽게 롤백 할 수 있다.  </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="configuration">Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">​</a></h3><p><code>Configuration</code>은 최신의 <code>Revision</code>상태를 설명하고, 생성하고, 원하는 상태가 갱신될때 <code>Revision</code>의 상태를 추적한다. <code>Configuration</code>은 <code>Build</code>를 참조하여 소스(git repo 또는 archive)를 컨테이너로 변환하는 방법에 대한 가이드가 포함되어 있거나 단순히 컨테이너 이미지 및 수정에서 필요한 메타 데이터 만 참조 할 수 있다. </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="product-integration">Product Integration<a class="hash-link" href="#product-integration" title="Direct link to heading">​</a></h3><p>2019년 2월 현재 0.3이 릴리스되고 있고 벌써 여러 제품에 통합이 되고 있다. </p><p>최근 IBMthink 2019에서 Managed Knative (Experimental)를 내놓기도 하였다.<br>
<a href="https://www.ibm.com/blogs/bluemix/2019/02/announcing-managed-knative-on-ibm-cloud-kubernetes-service-experimental/" target="_blank" rel="noopener noreferrer">https://www.ibm.com/blogs/bluemix/2019/02/announcing-managed-knative-on-ibm-cloud-kubernetes-service-experimental/</a> </p><p>Istio를 포함한 Knative 마저도 품는 모습으로 managed kubernetes 영역에서 글로벌 플레이어들 모두 서로 치고나가는 모습들을 볼수 있다. </p><p>작년 11월에는 Gitlab 제품안에 serverless라는 extension형태의 서비스가 추가 되기도 하였고,<br>
<a href="https://about.gitlab.com/press/releases/2018-12-11-gitlab-and-triggermesh-announce-gitlab-serverless.html" target="_blank" rel="noopener noreferrer">https://about.gitlab.com/press/releases/2018-12-11-gitlab-and-triggermesh-announce-gitlab-serverless.html</a></p><p>triggermesh 라는 곳에서는 serverless management platform이라는 이름으로 knative 기반 멀티 서버리스 플랫폼을 출시하기도 하였다.<br>
<a href="https://triggermesh.com/serverless_management_platform/" target="_blank" rel="noopener noreferrer">https://triggermesh.com/serverless_management_platform/</a></p><p>Pivotal Function Service (PFS), Google GKE SERVERLESS ADD-ON 등은 아직 early access 신청만 받고 있는 상태이다.</p><p>오늘은 간단하게 배포할수 있는 툴 knctl과 관련 use-case를 소개하고자 한다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="kubernetes-cluster-생성">Kubernetes Cluster 생성<a class="hash-link" href="#kubernetes-cluster-생성" title="Direct link to heading">​</a></h3><p>일단 GKE Free tier에서 Cluster를 하나 생성하자.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create knative \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region=asia-east1-a \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cluster-version=latest \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --machine-type=n1-standard-2 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-autoscaling --min-nodes=1 --max-nodes=5 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-autorepair \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --scopes=service-control,service-management,compute-rw,storage-ro,cloud-platform,logging-write,monitoring-write,pubsub,datastore \  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --num-nodes=3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>cluster 생성된것을 확인하고 cluster-admin 권한을 할당한다. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                     STATUS    ROLES     AGE       VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gke-knative-default-pool-d1a39347-5m5t   Ready     &lt;none&gt;    1m        v1.11.7-gke.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gke-knative-default-pool-d1a39347-l6zh   Ready     &lt;none&gt;    1m        v1.11.7-gke.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gke-knative-default-pool-d1a39347-qv5r   Ready     &lt;none&gt;    1m        v1.11.7-gke.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create clusterrolebinding cluster-admin-binding \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --clusterrole=cluster-admin \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --user=$(gcloud config get-value core/account)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your active configuration is: [cloudshell-4728]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io &quot;cluster-admin-binding&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="knctl-설치">knctl 설치<a class="hash-link" href="#knctl-설치" title="Direct link to heading">​</a></h2><p>이번 포스팅에서는 Mac OS 설치 기준으로 작성하였다.</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="homebrew-설치">homebrew 설치<a class="hash-link" href="#homebrew-설치" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">brew install starkandwayne/kubernetes/knctl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="binary">binary<a class="hash-link" href="#binary" title="Direct link to heading">​</a></h4><p><a href="https://github.com/cppforlife/knctl/releases" target="_blank" rel="noopener noreferrer">https://github.com/cppforlife/knctl/releases</a> </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ wget https://github.com/cppforlife/knctl/releases/download/v0.1.0/knctl-darwin-amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ mv knctl-* /usr/local/bin/knctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ chmod +x /usr/local/bin/knctl</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="knctl-로-knative-배포">knctl 로 Knative 배포<a class="hash-link" href="#knctl-로-knative-배포" title="Direct link to heading">​</a></h2><p>설치한 knctl로 Knative 배포를 진행한다. 설치되는 내용을 지켜보고 있으면 <code>istio</code>를 먼저 배포하고 그다음에 <code>Knative</code>를 설치하는 것을 확인할 수 있다. 배포되는 모듈들의 상태를 하나하나 체크해서 배포하기 때문에 설치상에 과정들을 확인할 수 있다. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl install --exclude-monitoring</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>테스트를 위한 namespace <code>hello-test</code>를 생성한다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create namespace hello-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace &quot;hello-test&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>knctl deploy 명령으로 최초 revision을 배포한다.<br>
<!-- -->아래 결과를 보면 hello-00001 이라고 하는 최초의 revision을 작성하기 때문에 <code>latest</code> tag를 달고 배포를 하게 된다. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl deploy \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --namespace hello-test \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --service hello \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --image gcr.io/knative-samples/helloworld-go \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --env TARGET=Rev1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name  hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting for new revision to be created...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tagging new revision &#x27;hello-00001&#x27; as &#x27;latest&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tagging new revision &#x27;hello-00001&#x27; as &#x27;previous&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotating new revision &#x27;hello-00001&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting for new revision &#x27;hello-00001&#x27; to be ready for up to 5m0s (logs below)...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00001 &gt; hello-00001-deployment-5cdbfc9bc9-hks6t | 2019/02/17 22:27:50 Hello world sample started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Revision &#x27;hello-00001&#x27; became ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Continuing to watch logs for 5s before exiting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get svc knative-ingressgateway -n istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                     TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)                                                                                                                   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">knative-ingressgateway   LoadBalancer   10.63.253.209   34.***.***.248   80:32380/TCP,443:32390/TCP,31400:32400/TCP,15011:30082/TCP,8060:31125/TCP,853:32009/TCP,15030:31102/TCP,15031:31631/TCP   6h</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>위처럼 Knative가 프로비저닝 되면서 ingress-gateway가 하나 생성이 되어있는 것을 확인할 수 있고 knctl로도 ingress를 확인이 가능하다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl ingress list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ingresses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                    Addresses     Ports  Age</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">knative-ingressgateway  34.***.***.248  80     6h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        31400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        15011</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        8060</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        853</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        15030</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        15031</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 ingresses</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="knative-custom-domain-연결">Knative custom domain 연결<a class="hash-link" href="#knative-custom-domain-연결" title="Direct link to heading">​</a></h2><p>Domain이 별도로 없기 때문에 Knative는 내부적으로 example.com이라고 하는 기본 domain을 사용한다. 그래서 실제 <code>knctl curl</code> 명령은 내부적으로 <code>hello.hello-test.example.com</code>으로 curl을 실행하게 되고 해당 결과를 아래와 같이 확인할 수 있다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl curl --service hello -n hello-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Running: curl &#x27;-sS&#x27; &#x27;-H&#x27; &#x27;Host: hello.hello-test.example.com&#x27; &#x27;http://34.***.***.248:80&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello Rev1!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>kubernetes node가 3개이므로 3개의 pod가 생성된 것을 확인할 수 있다. 일정시간(default:5분)이 지나면 <code>zero to scale</code> 관점에서 pod가 종료되므로 다시 확인할때는 다시 curl 명령을 날리게 되면 다시 pod가 올라오게 된다. 해당 개념은 FaaS또는 AWS Lambda에서 Cold-Start와 동일한 것이라 볼 수 있다.  </p><p>AWS Cold Start 참고 : <a href="https://novemberde.github.io/aws/2018/02/02/Lambda_coldStart.html" target="_blank" rel="noopener noreferrer">https://novemberde.github.io/aws/2018/02/02/Lambda_coldStart.html</a></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get po</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                      READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00001-deployment-5cdbfc9bc9-hks6t   3/3       Running   0          4m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>가지고 있는 도메인이 있다면 위에서 나온 <code>34.***.***.248</code> IP를 domain에 매핑해보자.
아래에서는 기존 보유중인 skcloud.io 도메인을 연결하였다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ dig knative.skcloud.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">;; ANSWER SECTION:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">knative.skcloud.io.     603     IN      A       34.***.***.248</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>knctl domain을 이용하여 default domain을 <code>knative.skcloud.io</code>로 변경한다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl domain create -d knative.skcloud.io --default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>knctl routes 명령으로 해당 hello-test app의 Endpoint 정보를 확인할 수 있다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl routes list -n hello-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Routes in namespace &#x27;hello-test&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name   Domain                               Traffic        Annotations  Conditions  Age</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello  hello.hello-test.knative.skcloud.io  100% -&gt; hello  -            3 OK / 3    1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 routes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>5분이상 기다렸다가 curl로 확인하면 Cold-Start 되는 시간(몇초) 지연이 발생하고 결과를 확인할 수 있다.
이후에는 바로 응답을 확인할 수 있다. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl http://hello.hello-test.knative.skcloud.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello Rev1!</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="revision-추가">revision 추가<a class="hash-link" href="#revision-추가" title="Direct link to heading">​</a></h2><p>이번에는 revision을 추가해보자. TARGET environment 변수를 <code>Rev2</code>로 수정하고 배포를 한다.
기존 hello-00002 revision이 최신 revision으로 갱신되어 배포가 되는것을 확인할 수 있다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl deploy --service hello \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image gcr.io/knative-samples/helloworld-go \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env TARGET=Rev2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name  hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting for new revision (after revision &#x27;hello-00001&#x27;) to be created...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tagging new revision &#x27;hello-00002&#x27; as &#x27;latest&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tagging older revision &#x27;hello-00001&#x27; as &#x27;previous&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotating new revision &#x27;hello-00002&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting for new revision &#x27;hello-00002&#x27; to be ready for up to 5m0s (logs below)...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00002 &gt; hello-00002-deployment-6cf86bbfc7-sblz9 | 2019/02/17 23:25:43 Hello world sample started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Revision &#x27;hello-00002&#x27; became ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Continuing to watch logs for 5s before exiting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>신규 <code>revision</code> 서비스를 추가된것을 확인할 수 있다. 마찬가지로 몇초간의 Cold-Start delay가 발생할 수도 있다. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ curl http://hello.hello-test.knative.skcloud.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello Rev2!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl curl --service hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Running: curl &#x27;-sS&#x27; &#x27;-H&#x27; &#x27;Host: hello.hello-test.knative.skcloud.io&#x27; &#x27;http://34.***.***.248:80&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello Rev2!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>revision list를 확인해보면 현재 latest, previous TAG정보를 확인할 수 있다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl revision list --service hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Revisions for service &#x27;hello&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         Tags      Annotations  Conditions  Age  Traffic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00002  latest    -            1 OK / 4    14m  100% -&gt; hello.hello-test.knative.skcloud.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00001  previous  -            1 OK / 4    4h   -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 revisions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="bluegreen-배포">Blue/Green 배포<a class="hash-link" href="#bluegreen-배포" title="Direct link to heading">​</a></h2><p>Blue/Green Deploy는 knctl rollout 명령으로 수행할수 있다.<br>
<!-- -->rollout 할때 <code>--managed-route=false</code> 옵션을 줘야 특정 비율로 routing이 가능하다.<br>
<!-- -->아래 예시는 TARGET environment 변수를 <code>blue</code>, <code>green</code>으로 바꿔가면서 배포를 진행하였다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl deploy --service hello \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image gcr.io/knative-samples/helloworld-go \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --env TARGET=blue \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --managed-route=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name  hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting for new revision (after revision &#x27;hello-00002&#x27;) to be created...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tagging new revision &#x27;hello-00003&#x27; as &#x27;latest&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tagging older revision &#x27;hello-00002&#x27; as &#x27;previous&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotating new revision &#x27;hello-00003&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waiting for new revision &#x27;hello-00003&#x27; to be ready for up to 5m0s (logs below)...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Revision &#x27;hello-00003&#x27; became ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Continuing to watch logs for 5s before exiting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00003 &gt; hello-00003-deployment-99478dcc5-jf267 | 2019/02/17 23:48:20 Hello world sample started.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>revision list를 확인하면 아래와 같이 <code>latest</code>로 Traffic 전체가 routing 되는 것을 확인할 수 있다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl revision list --service hello</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Revisions for service &#x27;hello&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name         Tags      Annotations  Conditions  Age  Traffic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00005  latest    -            4 OK / 4    44s  100% -&gt; hello.hello-test.knative.skcloud.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00004  previous  -            4 OK / 4    2m   -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00003  -         -            1 OK / 4    5m   -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00002  -         -            1 OK / 4    28m  -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello-00001  -         -            1 OK / 4    4h   -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 revisions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>이후에 rollout을 통해 previous로 90%, latest로 10%로 변경을 하면 즉시 반영이 되고 실제 트래픽도 분산되어 들어온다. %가 낮은 쪽으로 routing이 될 경우 Cold-Start가 발생하게 되면 delay는 발생하게 된다.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl rollout --route hello -p hello:latest=10% -p hello:previous=90%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ knctl revision list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Revisions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Service  Name         Tags      Annotations  Conditions  Age  Traffic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hello    hello-00005  latest    -            2 OK / 4    1h   10% -&gt; hello.hello-test.knative.skcloud.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~        hello-00004  previous  -            2 OK / 4    1h   90% -&gt; hello.hello-test.knative.skcloud.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~        hello-00003  -         -            1 OK / 4    1h   -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~        hello-00002  -         -            1 OK / 4    1h   -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~        hello-00001  -         -            1 OK / 4    5h   -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 revisions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Succeeded</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>간단하게 curl 반복문을 작성하여 돌려보자. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sS --max-time 3 http://hello.hello-test.knative.skcloud.io/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>간단하게 위 sh을 돌리면 아래와 같이 Cold-Start delay가 발생할때 time out이 발생하고 이후 green revision으로 접속이 되는것을 볼 수 있다. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./test.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl: (28) Operation timed out after 3002 milliseconds with 0 bytes received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl: (28) Operation timed out after 3003 milliseconds with 0 bytes received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello green!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Hello blue!</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="정리">정리<a class="hash-link" href="#정리" title="Direct link to heading">​</a></h2><p>지금까지 <code>knctl</code>을 사용하여 간단하게 knative를 배포하고 custom domain을 연결하여 blue-green 배포까지 해봤다.
이외에도 Knative Build를 활용하여 Docker image 작업을 하거나 서비스 카탈로그 등을 연동하여 외부 DBaaS를 연동하는 use-case등을 찾아볼수 있다.</p><p>아직 초기 단계이지만 Knative는 istio와 함께 IBM, Google, Pivotal등 global player들의 차세대 오픈소스로 부상하고 있다고 볼 수 있다.  </p><p><code>Zero to scale</code> 이라는 슬로건아래 Serverless, FaaS 사상을 기반으로 build, serving, event, routing이라고 하는 Cloud Computing 추상화의 끝판으로 진화하고 있다. 앞으로 어떤 모습으로 진화될지 궁금하고 다음번에는 MQ나 Pub/sub를 연동하거나 멀티 클라우드 환경에서 동작하는 모습을 보여주는 것도 좋을것 같다. 희망사항이지만 올해 OpenInfraDay나 Kubernetes Day Korea 행사에서 Hands-on을 진행해보는것도 좋지 않을까?</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/knative/">Knative</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kubernetes/">Kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/faa-s/">FaaS</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/serverless/">Serverless</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/cr-ds/">CRDs</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/cloud-events/">CloudEvents</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/mesh/">Mesh</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/knctl/">knctl</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/cloud/Hybrid/">Hybrid Cloud</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-02-10T00:00:00.000Z" itemprop="datePublished">February 10, 2019</time> · <!-- -->10 min read</div></header><div class="markdown" itemprop="articleBody"><p>오늘도 기술적인 이야기보다는 화두가 되고 있는 하이브리드 클라우드 이야기를 해보고자 한다.</p><p>업계 사람들도 하이브리드, 엣지 클라우드 서비스를 긍정적인 시각으로 보고있지만 성숙도 측면에서 문제가 있어 도입을 꺼려왔던게 사실이다. 최근 동향을 봤을때 퍼블릭 클라우드 공급사에서도 프라이빗 클라우드를 포섭해야할 대상으로 인정하고 공격적으로 하이브리드 클라우드 솔루션을 개발하여 제공하려고 하는 움직임을 보이고 있다.</p><p>엔터프라이즈에서는 입장에서는 Scale, DR측면에서 On-Prem 에서 퍼블릭으로 확장을 도모하고 있고 글로벌플레이어 입장에서는 퍼블릭에서 On-Prem으로 전이하는 모습으로 비즈니스를 진행하고 있다. 하지만 구글은 특별하게 컨테이너 기반으로 진행중이다. 누가 끝까지 살아남아 승자가 될지 아무도 모른다. </p><p>앞으로 열릴 시장은 확실하고 꼭 필요하다는 것은 알지만 기술의 성숙도가 높지 않고 넘어야할 허들이 많다. 아직까지 연계 기술이나 생태계가 비어 있는 부분들이 존재하기 때문에 올해 말쯤 되면 여러 상품들이 출시되면서 정리 되지 않을까 싶다. </p><p><a href="https://wikibon.com/aws-outposts-enables-hybrid-cloud/" target="_blank" rel="noopener noreferrer">https://wikibon.com/aws-outposts-enables-hybrid-cloud/</a></p><p>위 포스팅에서도 2가지 의문점을 제기한다.</p><ul><li><p>Will a data egress charge be applied to data resident on the disks to other on-premise workloads?<br>
<code>예시) S3 → Outpost egress 트래픽(private n/w 이긴 하지만 aws가 돈을 안 받을것인가?, 결국 direct-link는 필수인건지?)</code></p></li><li><p>Is the data on site under the legal control of AWS or the customer?<br>
<code>데이터의 소유권 문제(이게 심각한 문제가 될수 있다)</code></p></li></ul><p>그래서 AWS가 작년에 내놓은 Outpost의 첫그림은 <a href="https://aws.amazon.com/ko/outposts/features/" target="_blank" rel="noopener noreferrer">VMware on AWS</a>로 작년 reinvent이후 많은 관심을 받았던 프로젝트이다. </p><p>이외에도 메이저 사들도 <a href="https://azure.microsoft.com/ko-kr/overview/azure-stack/" target="_blank" rel="noopener noreferrer">Azure Stack</a>, <a href="https://www.ibm.com/kr-ko/cloud/vmware" target="_blank" rel="noopener noreferrer">VMware on IBM Cloud</a>, <a href="https://www.ncloud.com/product/hybridPrivateCloud/vmwareOnNcloud" target="_blank" rel="noopener noreferrer">VMware on Ncloud</a>와 같은 하이브리드 서비스를 내놓고 있다. </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="product별-기본-전략">Product별 기본 전략<a class="hash-link" href="#product별-기본-전략" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="azure-stack">Azure Stack<a class="hash-link" href="#azure-stack" title="Direct link to heading">​</a></h4><ul><li>호환성 인증받은 서버를 On-prem에 구매/설치하고 Azure UI 및 API와 동일한 UI/UX로 private cloud 사용</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="aws-outpost">AWS Outpost<a class="hash-link" href="#aws-outpost" title="Direct link to heading">​</a></h4><ul><li>고객 On-prem에 EC2 cloud instances 제공 (전용 HPC 하드웨어 - EC2 Nitro Platform)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="aws-outpostvmware-based">AWS Outpost(VMware based)<a class="hash-link" href="#aws-outpostvmware-based" title="Direct link to heading">​</a></h4><ul><li>baremetal 전용 플랫폼으로 VMware - software, AWS - hardware 에 집중</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="google-cloud">Google Cloud<a class="hash-link" href="#google-cloud" title="Direct link to heading">​</a></h4><ul><li>K8s On-prem전략을 기본으로 Cisco와 하이브리드 전략 (based on Istio)</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ibm-cloud">IBM Cloud<a class="hash-link" href="#ibm-cloud" title="Direct link to heading">​</a></h4><ul><li>구글과 유사하게 Istio를 기본으로 하여 멀티, 하이브리드 클라우드 제품 출시</li><li>IKS on Vmware on IBM Cloud Baremetal 와 같은 상품도 출시</li></ul><p>대부분 VMware 협력을 기반으로 하이브리드 클라우드 전략을 전개하고 있고 내면을 들여다보면 물리적으로 다른곳에 있는 Overlay 네트워크에 대한 해결이 가장 문제이기 때문에 Direct-link나 VPN을 통해 연결하는것도 결국 클라우드 사업자가 네트워크 트래픽 비용을 가져가지 위한 전략으로서 보인다. </p><p>실제 퍼블릭 클라우드 벤더의 Cash Cow는 Compute 자원보다는 네트워크 비용과 Blob Storage, API과금 등 에 대한 매출이 큰 비중을 차지한다고 봐야 한다. 혹자는 글로벌 네트워크 전용선에 대한 투자나 고성능 HPC도입 투자 비용에 대한 말들을 하지만 IBM같은 경우 글로벌 네트워크 무료 정책을 통해 Market Share를 획득하고자 하는 부분들을 보면 네트워크가 가장 핵심이 아닐까 싶다.  </p><p>클라우드를 이야기 할때 기술 성숙도를 보면 Compute &gt; Storage &gt; Network 순으로 전이가 되는데 OpenStack이나 Kubernetes 프로젝트와 같은 오픈소스나 VMware NSX 플랫폼만 봐도 정말 네트워크가 중요한 영역이 되고 있음을 알수 있다. </p><p>결국 핵심적으로 봐야하는 부분은 네트워크다. 네트워크 부분에서 아주 강력한 솔루션이 나와야 한다. 결국 회선 비용이 문제고 최근 넷플릭스와 SKB의 속도 분쟁만 봐도 결국 강자의 논리로 네트워크 문제가 해결되는 시대가 온 것이다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="정리">정리<a class="hash-link" href="#정리" title="Direct link to heading">​</a></h3><p>내가 생각한 서비스 사용자 측면에서 우리가 고려해야할 클라우드 옵션들을 정리해보면 아래와 같다.</p><ul><li><p>멀티 클라우드 : 퍼블릭 클라우드 to 퍼블릭 클라우드 운영 솔루션으로 프라이빗 클라우드 영역에는 거의 관여를 안하며, 솔루션에 따라 일부 가상화된 Computing 자원까지 모니터링 지원하기도 함. 멀티 클라우드 운영 플랫폼은 주로 클라우드 Brokerage Service 형태로 제공되어야 하므로 MSP역할이 중요해질 것 같다. 메가존, 베스핀글로벌과 같은곳 뿐아니라 자체적인 클라우드를 운영하는 대형 SI회사를 포함한 기존 IaaS 운영조직의 변화들도 눈여겨 봐야할것 같다. 마진율이 낮은 레드오션 싸움에서 누가 이기느냐가 중요하기 보다는 미래를 보고 투자하는 자세가 필요하다고 본다. </p></li><li><p>프라이빗 클라우드 : 프라이빗 클라우드 전용 솔루션으로 벤더 또는 특정 IaaS 서비스에 최적화된 경우가 많으므로 VMware, OpenShift, OpenStack Managed 서비스등 기존 제품에서의 연장선에서 얼마나 오픈소스를 이해하고 프로덕션에 적용할수 있는 역량을 기르는것이 중요하다. </p></li><li><p>하이브리드 클라우드 : 퍼블릭 클라우드 to 프라이빗 클라우드 운영 솔루션으로 프라이빗 클라우드의 인프라스트럭처까지 관여를 하며, 퍼블릭 클라우드 영역은 일반적으로 IaaS 영역과 일부 PaaS / 컨테이너까지 구성, 모니터링 지원해야 하고 이를 위한 3rd Party 솔루션들이 등장하고 있고 점차 영역을 확대할것이다. 이에 있어 컨테이너 플랫폼을 도입하는것이 가장 글로벌 플레이어와 격차를 줄이는데 효과적인 도구라 생각한다. 결국 하이브리드 클라우드 구현은 기존 Public과 Local Cloud간 네트워크 연계가 중요한 포인트이다.</p></li><li><p>간단히 구현해 볼수 있는 General Hybrid Kubernetes Architecture를 간단히 그려봤다. 기본적으로 StrongSwan VPN을 가지고 CI/CD를 고려한 DevOps관점에서의 구성도이다.
<img loading="lazy" alt="hybrid-cloud" src="/assets/images/hybrid-cloud-b89fa6a20fd326ec117dbdf490a43f37.png" width="791" height="799" class="img_E7b_"></p></li></ul><p>위에 내용과 함께 하이브리드 클라우드를 고려할때 <code>데이터 소유권 측면에서의 거버넌스</code> 와 <code>overlay 네트워크</code>에 대한 고민이 동행되었을때 성공적인 하이브리드 클라우드를 구축할수 있다라는 나 혼자만의 생각을 정리해봤다.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/hybrid/">Hybrid</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/multi/">Multi</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/outpost/">Outpost</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/v-mware/">VMware</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/job/SRE/">SRE (Site Reliablity Engineering)</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-01-30T00:00:00.000Z" itemprop="datePublished">January 30, 2019</time> · <!-- -->13 min read</div></header><div class="markdown" itemprop="articleBody"><p>그동안 DevOps 담당자라고 부르짖던 사람들의 Role이 인프라 담당자인지 플랫폼 담당자인지 아니면 개발하는 운영자인지 헷갈릴때가 많았다.</p><p>갑자기 국내에서도 SRE 채용 공고가 많아지는것을 보면서 내 자신도 한번 정리를 하고 가야할것 같은 생각이 들었다.</p><p><a href="https://docs.microsoft.com/ko-kr/learn/modules/intro-to-site-reliability-engineering/" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/ko-kr/learn/modules/intro-to-site-reliability-engineering/</a></p><p>개념정리 측면에서 위 MS Azure의 온라인 교육내용을 정리해봤다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="sre">SRE<a class="hash-link" href="#sre" title="Direct link to heading">​</a></h2><p>SRE(사이트 안정성 엔지니어링)란 조직이 해당 시스템, 서비스 및 제품에서 적절한 수준의 안정성을 달성하도록 지원하는 엔지니어링 분야이다. </p><p>출처 : <a href="https://landing.google.com/sre/sre-book/chapters/introduction/" target="_blank" rel="noopener noreferrer">https://landing.google.com/sre/sre-book/chapters/introduction/</a></p><p>기본적으로 운영경험이 있는 sysadmin, IT전문가, DevOps실행 담당자 등이 대상이 될 수 있다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="적절한-수준의-안정성">적절한 수준의 안정성<a class="hash-link" href="#적절한-수준의-안정성" title="Direct link to heading">​</a></h3><p>가장 핵심이 되는 단어는 <code>안정성</code>이다. 조직에서 만든 애플리케이션이 안정성이 부족하여 작동하지 않거나 불안정한 경우 실제 비즈니스에 피해를 줄 수 있다는건 누구나 알고 있는 당연한 이야기이지만 100%의 안정적인 시스템은 존재하지 않으므로 적절한 수준(정량적으로 측정하긴 어렵지만 이해관계자들이 납들할만한 수준)의 안정성을 달성하기 위한 일련의 작업들을 수행하는 것이 SRE의 기본 속성이라고 볼수 있다. </p><p>SRE는 Google에서 2003년부터 7명의 소프트웨어 엔지니어로 구성된 팀에서 시작된 이후 (자세한 내용은 위 링크 ebook 참조) Google 사내에 널리 확산되고 내부적인 문화로 조성되는 중에 밖에서는 DevOps라고 하는 문화가 동시에 확산되었다 한다. 결국 동일한 문제를 해결하기 위한 측면에서 두개의 방법론은 다르다고 봐야한다. </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="차이점">차이점<a class="hash-link" href="#차이점" title="Direct link to heading">​</a></h3><ul><li>SRE - 안정성을 위한 엔지니어링, DevOps - 개발과 운영조직 각각의 사일로를 해체하기 위한 문화적인 움직임</li><li>SRE - 저는 SRE 입니다, DevOps - 저는 DevOps를 하는 운영자 또는 개발자 입니다.</li><li>SRE - 규범으로 인식, DevOps - 문화로 인식</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="공통점">공통점<a class="hash-link" href="#공통점" title="Direct link to heading">​</a></h3><ul><li>모니터링/식별 가능, 자동화</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="주요-sre원칙--선순환">주요 SRE원칙 : 선순환<a class="hash-link" href="#주요-sre원칙--선순환" title="Direct link to heading">​</a></h2><p>새로운 서비스의 상태의 지표는 어떻게 정의할까? 보통은 무엇을 <code>SLI(서비스 수준 지표)</code>로 사용할지를 정하는것으로 본다. 일반적으로 성공 및 실패 측정값(200 OK,500 Error), 응답시간(ms), 처리량 등의 조합으로 결정될 수 있다. 보통  카나리아 분석을 통해 Scoring을 한 <code>SLI</code>를 200 OK와 500 또는 에러코드의 비율로 결정하는 방법을 사용하는 경우가 많다.</p><p>서비스 상태를 식별하는 지표를 정하고 나면 고객이나 우리가 원하는 안정성 수준을 결정해야 한다. 개발팀과 운영팀이 같이 만든 원하는 안전성 수준을 <code>SLO(서비스 수준 목표)</code>라고 말하면 된다. </p><p><code>SLO</code>는 Prometheus나 Datadog과 같은 모니터링 시스템을 활용하여 정확하게 측정하고 표시해야 한다. 서비스의 안정성에 대해서 명확하게 이해할수 있는 목표이기도 하다. 반드시 <code>SLO</code>를 만족하는지 못하는지 명확한 측정값으로 데이터가 존재해야 하고 <code>SLO</code>를 충족하지 못하면 문제가 있는것으로 판단하고 문제를 해결해야 한다. </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="오류-예산">오류 예산<a class="hash-link" href="#오류-예산" title="Direct link to heading">​</a></h3><p>오류 예산이라는 말을 명확히 이해하려면 흔히 고객과 체결하는 계약서 상의 명시된 서비스 가동율(SLA)을 생각하면 될 것 같다. 보통 99.9% 의 <code>SLO</code>를 정한다고 한다면 1년에 8시간 45분 57초의 서비스 다운타임을 허용하는 것이다. 오류 예산은 서비스의 완벽한 안정성과 원하는 안정성의 차이(100%-99.9%=0.01%)를 말한다. 0.01%로 즉 8시간정도의 오류 예산을 가지는 것은 그 시간을 모두 사용할 때까지 추가 릴리스나 패치를 진행할 수 있다는 이야기와 같다. 어떤 팀은 해당 예산을 신규 기능을 릴리스하는데 사용하기도 하고 장애가 발생했을때 문제의 원인을 발견하고 개선하는데 사용하기도 한다. </p><p>일반적으로 서비스에 대한 오류 예산이 모두 사용되면 서비스가 원하는 안정성 수준으로 돌아갈때 까지 해당 서비스의 추가적인 릴리스를 보류하는게 일반적이긴 하지만 특정기간(월 또는 분기 또는 연간) 기준으로 계산되기 때문에 서비스 안정성이 정상 상태라면 오류 예산은 다시 주어지게 되므로 <code>선순환</code> 구조를 가진다고 볼 수 있다.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="비난-없는-장애-회고">비난 없는 장애 회고<a class="hash-link" href="#비난-없는-장애-회고" title="Direct link to heading">​</a></h3><p>일반적으로 비즈니스에 크리티컬한 장애가 발생했을때 사후 분석(회고)을 하게 되는데 이때는 <code>비난 없는</code> 분석을 해야한다. 오래전 기억이지만 예전 직장 특정팀에서는 장애가 발생하면 유관자들이 모두 엔지니어 책상 뒤에 서서 모든 화살과 눈총을 주기 때문에 도저히 일을 할 수 없게 만든 경우가 많았었다. </p><p>특정 운영자의 작업 실수로 인해 장애가 발생했다 하더라도 해당 이벤트가 발생하게 된 프로세스나 기술기반에 실패 원인을 파악하는데 중점을 두어야 할것이다.</p><p>시스템의 안정성을 저하시키고 서비스를 중단시킨 작업(릴리스, 패치 등)을 사유로 개인에게 페널티를 주거나 고과에 반영하는 방법은 장애로 부터 교훈을 얻을수가 없고 해당 담당자의 충성도나 생산성 저하를 유발하는 안좋은 장치가 될 수 있다. 내 경험이기도 하지만 한동안 두려워서 아무 변경도 하지 못하는 경우가 종종 있었다. </p><p>회사나 조직, 팀은 시스템 중단으로부터 교훈을 얻고 지속적으로 시스템을 개선할수 있다. 적절한 분석을 통해 후속조치를 수행함으로써 실패를 수용하는 것이 SRE의 핵심 원칙이다. 이러한 내용을 모두에게 공유하고 타 조직이나 팀에게 인사이트를 제공하는 선순환 구조를 만드는것 또한 SRE의 기본 원칙이라고 볼 수 있다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="주요-sre원칙--사람측면">주요 SRE원칙 : 사람측면<a class="hash-link" href="#주요-sre원칙--사람측면" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="toil수고스런-일-번거로운-작업">Toil(수고스런 일, 번거로운 작업)<a class="hash-link" href="#toil수고스런-일-번거로운-작업" title="Direct link to heading">​</a></h3><p>항상 SRE에서는 Toil에 초점을 맞춰야 한다. Toil은 사람이 수행하는 운영 작업 중 특정한 패턴이나 특성이 있는 작업을 말한다. 종종 반복적이고 자동화 될 수 있는 작업일지라도 대부분 수동작업으로 처리를 한다. 서비스의 규모가 커지거나 고객이 많아지게 되면 보통 우리가 이야기 하는 티켓(또는 SR)의 수가 많아지고 공수가 많이 필요하게 된다. </p><p>배포때마다 Config를 적용하거나 계정 등록, 볼륨이나 디스크 프로비저닝 등 수동으로 처리해야하는 모든 작업이 운영자에게는 부하로 다가올수 있다. 이러한 반복적인 작업을 티켓시스템을 통해 처리를 하게 되면 티켓 생성, 작업계획서 작성, 검토, 승인 단계를 그때 마다 해야하는 아주 번거로운 작업(Toil)을 해야한다.</p><p>SRE는 최대한 이러한 반복적이고 번거로운 작업을 제거하기 위해 노력해야하고 자동화와 Self-Service로 개발자가 편하게 직접 사용할수 있도록 환경을 제공해 주어야 한다. 이러한 요청이나 티켓을 자동으로 처리할 수 있으면 조금 더 생산적인 일을 수행할수 있다. </p><p>위에서 이야기한 적절한 안정성과 비슷한 맥락으로 생각하면 될 것 같다. 번거로운 작업을 없애는것이 다른 중요한 작업보다 우선순위가 떨어지기도 하지만 서비스 상에서 Toil을 제거하는것도 SRE의 주된 업무이다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="운영작업의-비율">운영작업의 비율<a class="hash-link" href="#운영작업의-비율" title="Direct link to heading">​</a></h2><p>Toil을 제거하거나 서비스/시스템 안정성을 개선하기 위해 SRE는 장애를 해결하고 티켓을 처리하는 시간 비중을 50%를 넘겨서는 안된다. 티켓이 필요하지 않도록 개발자 Self-Service를 구성/제공하고 효율성을 증대시키기 위해서 IaC등(Shell, Ansible, Terraform)과 같이 자동화를 위한 코드를 만드는데에도 집중을 해야한다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="정리">정리<a class="hash-link" href="#정리" title="Direct link to heading">​</a></h2><p>지금까지 SRE에 대해서 간단하게 소개하고 이해하는 측면에서 정리해 봤다. </p><p><a href="https://landing.google.com/sre/sre-book/chapters/part3/" target="_blank" rel="noopener noreferrer">Service Reliability Hierarchy</a></p><p><img loading="lazy" src="https://lh3.googleusercontent.com/3gX2qgys2I-9HnEIvXUA10ed3AILvg5MclnKWBquEkJKP3g5_kD6WR7Ptwp3TwAGla1DuSmHv64MdTtACNLlArFVq7BwbTrTVhigsA=s0" alt="hierarchy" class="img_E7b_"></p><p>그림과 같이 서비스 안정성 계층 구조에서는 기본적으로 모든 서비스를 모니터링 하는 시스템을 갖추어야 한다고 말한다. 모니터링 시스템이 준비가 되면 서비스에 대한 SLI, SLO를 만들고 모니터링 시스템에서 구현하는것이 첫번째 SRE를 적용하는 방법이라고 할 수 있을 것이다.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="참고-서적">참고 서적<a class="hash-link" href="#참고-서적" title="Direct link to heading">​</a></h2><ul><li><a href="http://shop.oreilly.com/product/0636920041528.do" target="_blank" rel="noopener noreferrer">Site Reliability Engineering: How Google Runs Production Systems(“The SRE Book”)</a></li><li><a href="http://landing.google.com/sre/workbook/toc/" target="_blank" rel="noopener noreferrer">The Site Reliability Workbook: Practical Ways to Implement SRE(“The SRE Workbook”)</a></li><li><a href="http://shop.oreilly.com/product/0636920063964.do" target="_blank" rel="noopener noreferrer">Seeking SRE: Conversations About Running Production Systems at Scale</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/sre/">SRE</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/dev-ops/">DevOps</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/retrospective/newyear-plan/">2018 Retrospective</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-01-03T00:00:00.000Z" itemprop="datePublished">January 3, 2019</time> · <!-- -->6 min read</div></header><div class="markdown" itemprop="articleBody"><p>한해가 또 훅 가버렸다. 18년도 Retrospective 시작한다.</p><ul><li><p>Work</p><ul><li>17년까지 팀 막내였지만 새로운 부서로 이동하여 서비스개발 파트장을 맞게 되었음. 17년도에 개발이라고는 python를 사용하여 vmware vm을 openstack instance로 migration하는 프로젝트 및 kubernetes 기반 tensorflow 플랫폼을 개발하는 초보개발자 수준이였던 내가 인프라와 클라우드 플랫폼(openstack, vsphere, kubernetes) 경력이 인정되어 서비스 개발 파트를 맡게 되었다. 인생에서 가장 큰 변혁중 하나였다고 생각하고 항상 감사하는 마음으로 일을 하고 있다.  </li><li>CNCF OpenSource들을 활용하여 FaaS(Function as a Service), IaC(Infra as Code) 플랫폼 개발을 진행하였다. 서비스 기획 및 두개 프로젝트의 Scrum Master 역할을 수행하였고 메인 업무는 SRE역할로 Kubernetes 설계 구축, 클러스터 및 스토리지 관리, LB, 인증서 등 클라우드 인프라 자원관리 정도였던것 같다. </li></ul></li><li><p>Tech.</p><ul><li>Public Cloud : AWS, DigitalOcean, IBM Cloud, GCP, Azure, nCloud</li><li>Provisioning : Harbor, Ansible, Portus, Clair, Kubicorn, Terraform, Vault</li><li>Runtime : Rook, Minio, OpenEBS, Calico, REX-ray, WeaveNet, Cilium</li><li>Orchestration : Kubernetes, Envoy, etcd, gRPC, Kong, HAProxy, Istio, Kong, NGINX, Traefik</li><li>App : NATS, Helm, Kafka, Docker-compose, Draft, Gitlab, minikube, Operator, Jenkins, JenkisX, Packer, RabbitMQ, Spinnaker</li><li>Serverless : Dispatch, Fission, Knative, Nuclio, OpenWhisk, OpenFaas</li><li>Monitoring, Logging : Prometheus, Fluentd, Elastic, Grafana, influx, WeaveScope</li><li>기타 : Cert-Manager, Dex, Agones</li></ul></li><li><p>Speak
쓰다보니 사내외 발표를 10번을 넘게 한거 같다.</p><ul><li>4월 사내 Cloud Tech : 컨테이너 기반 SaaS 개발을 위한 고려사항</li><li>5월 사내 DT 솔루션 행사, 클라우드사업부 세션 : Advanced Cloud (Road to Serverless)</li><li>5월 사내 통신사업부문 Tech세션 : Road to Serverless (Functions as Applications)</li><li>6월 Open Infra Days Korea 2018 : <a href="https://www.slideshare.net/JinwoongKim8/provisioning-dedicated-game-server-on-kubernetes-cluster" target="_blank" rel="noopener noreferrer">Provisioning Dedicated Game Server on Kubernetes Cluster</a></li><li>8월 SK DNA 2018 : <a href="https://www.slideshare.net/JinwoongKim8/cloud-z-serverless-118143924" target="_blank" rel="noopener noreferrer">Cloud Z 의 오픈소스 서비스 소개 및 Serverless로 게임 개발하기</a></li><li>10월 DT Labs Meetup : <a href="https://www.slideshare.net/JinwoongKim8/continuous-delivery-with-spinnaker-on-k8skubernetes-cluster-118140930" target="_blank" rel="noopener noreferrer">Continuous Delivery with Spinnaker on K8s(kubernetes) Cluster</a></li><li>10월 NCsoft IO : <a href="https://www.slideshare.net/JinwoongKim8/cloud-native-serverless/JinwoongKim8/cloud-native-serverless" target="_blank" rel="noopener noreferrer">Cloud Native 오픈소스 서비스 소개 및 Serverless로 실제 게임 개발하기</a></li><li>11월 IBM Developer Day : <a href="http://public.dhe.ibm.com/software/kr/TrackB/B3.pdf" target="_blank" rel="noopener noreferrer">Continuous Delivery using Spinnaker on Kubernetes Multi Cluster</a></li><li>11월 &quot;Kubernetes Meetup&quot; 1Day : <a href="https://www.slideshare.net/JinwoongKim8/spinnaker-on-kubernetes-123752186" target="_blank" rel="noopener noreferrer">Spinnaker on Kubernetes</a></li></ul></li></ul><p>쓰고나서 보니 2018년도 회고라기 보다 거의 개발에 필요한 잡일(DevOps라고 두둔하면서)과 발표만 한거 같네...
19년도 부터는 다른업무를 하게 될거 같은데 초심을 잃지 말아야 하겠다.</p><p>최근 화두가 되었던 <code>노력중독</code> 이였던것 같은 18년은 털어버리고
내가 진짜로 좋아하고 하고 싶은 공부와 업무, 그리고 가족을 위해서 로드밸런싱 하면서 지내야 하겠다. </p><p>2006년에 쓴 미래의 내 모습과 어느정도 일치하는거 같지만 목표를 좀더 높이 잡아야할듯 하다.</p><p>번역에 참여하거나 책을 써본다던지 커뮤니티 활동을 좀더 적극적으로 해보고
회사에서 시키는 밋업이 아닌 자발적으로 참여하는 외부 강연이나 밋업을 위주로 해봐야겠다. </p><p>또한 점점 개발영역과 멀어지는거 같은 내모습이 나이가 들면서 더 심화될거 같아서 지인들과 별도의 개발 프로젝트를 진행해보려고 한다.</p><p>내 13년간 직장 생활중 가장 바쁘고 다이내믹하면서 바빴던 한해이자 많은 경험과 공부가 되었던 일년이였던것 같다.</p><p>나를 땡겨주셨던 <code>June</code>, 항상 분위기를 리드했던 <code>Joonbum</code>, 언제나 열정가득하고 최고의 DevOps 플레이어 <code>Jeongho</code>, 든든한 Backender <code>Donghun</code>, Excellent/Free/Kind(a.k.a EFK)한 <code>Minyoung</code>, 내가 인정하는 Frontier <code>Sanghun</code>, Best Rookie <code>Minsoo</code>, sorry because the hy <code>HyunSang</code>, Moontoring <code>Jinsoo</code>, Forever Mentor <code>Jaemoon</code>, Guru of CNI <code>Youngchae</code> 모두에게 감사의 말씀을 전하고 싶다. (무슨 수상소감도 아니고 ㅋㅋ)</p><p>19년에도 남들에게 존경을 받는 사람보다는 무슨일을 하든지 대중에게 욕먹지 않고 필요할때 도움을 요청을 할수 있는 그런 편한 사람이 되어야 겠다.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/retrospective/">Retrospective</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/2018/">2018</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/planning/">Planning</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/change/">Change</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/cloud/cloud/">Cloud Enginner</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2018-12-25T00:00:00.000Z" itemprop="datePublished">December 25, 2018</time> · <!-- -->5 min read</div></header><div class="markdown" itemprop="articleBody"><p>오늘은 쓸데없는 이야기를 주저리 적어본다. </p><p>페친한분이 말씀하신 구절이 떠오른다.
<code>&quot;엔지니어라고 해서 정치력이 필요없는것이 아니다. 오히려 혁신적인 기술은 정치력, 권력이 없으면 적용될 수 없다&quot;</code> - 제프리 페퍼교수의 &quot;권력의 기술&quot;</p><p>나이 40을 넘긴 엔지니어로서 나는 어떤 위치인가?</p><p>Cloud 관련 오픈소스로 비즈니스를 진행하면서 현 직장에서 2년을 보냈다.
보람도 있었고 실패도 있었다.<br>
<!-- -->올해는 기획한 오픈소스 기반 프로젝트로 여러사람의 힘을 합쳐서 서비스를 런칭하기도 하였지만 몇년간 글로벌 플레이어들을 보면서 느낀점은  </p><p>회사가 글로벌 플레이어가 되기위해 노력하는 방법은 다양하지만<br>
<!-- -->결국 이윤을 목적으로 회사에서 허용하고 투자하는것이고<br>
<!-- -->그걸로 돈을 못벌면 바로 쳐낼수 있다는 경영층의 생각은 변함이 없을것이다. </p><p>이런 마음가짐을 변화시키지 않는다면 훌륭한 프로젝트라도 성공이든 실패든 끝까지 가는것은 어렵다고 생각한다. </p><p>처음 클라우드 관련 업무를 시작할때를 생각해본다.</p><ul><li><p>2010년<br>
<!-- -->팀장: 너 클라우드 할래?<br>
<!-- -->나 : 무슨일하는데요?<br>
<!-- -->팀장: 가상화 프로젝트하는데 같이 한번 비즈니스 만들어보자, 너가 하고 싶은대로 기획하고 해봐~<br>
<!-- -->나 : 네^^ 열심히 하겠습니다.  </p></li><li><p><code>개인 성과 및 팀의 목표는 어느정도 달성하였으나 ROI 달성은 쉽지 않았음</code></p></li><li><p>2016년<br>
<!-- -->팀장: 너 주간보고 똑바로 안해?, 지난번 장애보고는 어떻게 된거야?<br>
<!-- -->나: ㅠㅠ<br>
<!-- -->팀장: 우리 팀 수치가 이게 뭐냐... 좀 잘좀 해봐<br>
<!-- -->나: ㅠㅠ<br>
</p></li><li><p><code>결국 퇴사</code></p></li><li><p>2017년<br>
<!-- -->팀장: 하고 싶은대로 해봐
나: 진짜요? 뚝딱뚝딱<br>
<!-- -->회사: 수익모델이 뭐지?<br>
<!-- -->나: ...  </p></li><li><p><code>출시하기도 전에 서비스 종료</code></p></li><li><p>2018년<br>
<!-- -->팀장: 하고 싶은거 해봐요. 대신 돈벌어와야해<br>
<!-- -->나: 진짜요? 뚝딱뚝딱<br>
<!-- -->회사: 흠 좀 부족하지만 앞으로 좀더 잘해주세요. 레퍼런스 확보에 힘써주세요.<br>
<!-- -->나: 서비스 기획자가 필요합니다.<br>
<!-- -->회사: ... 본인이 해야하는거 아닌가요?<br>
<!-- -->나: ...<br>
</p></li><li><p><code>기획을 해야하나 아직 기술력도 부족한데...</code>  </p></li></ul><p>벌써 직장생활 13년차에 마흔살이 넘어가고 있다. </p><p>엔지니어로 살아온날보다 살아가야할날이 적게 남았고 얼마 남지 않았다는 생각이 드는 우울한 하루다.
10년간 공부해왔던 것들보다 2년동안 공부한게 더 파격적이고 다양하고 복잡했다.</p><p>여러모로 아쉬운 한해였다...</p><p>앞으로 내가 부족한 부분을 기술력으로 메꿀것이냐? 협상과 정치력으로 메꿀것이냐?</p><p>잠이 안오는 12월이다.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/cloud/">Cloud</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/enginner/">Enginner</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/page/5/"><div class="pagination-nav__label">Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/page/7/"><div class="pagination-nav__label">Older Entries</div></a></div></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/archive/">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/tags/">Tags</a></li></ul></div><div class="col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/pang4u/">Pang4U</a></li><li class="footer__item"><a href="https://ko-fi.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Buy Me a Coffee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kr.linkedin.com/in/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.0de6f75a.js"></script>
<script src="/assets/js/main.df906855.js"></script>
</body>
</html>