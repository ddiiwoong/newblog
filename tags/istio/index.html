<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Act as a catalyst RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Act as a catalyst Atom Feed">
<link rel="alternate" type="application/json" href="/feed.json" title="Act as a catalyst JSON Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-4ZT898XDT2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4ZT898XDT2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4ZT898XDT2",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Cloud Catalyst" href="/opensearch.xml">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4362752107119680" crossorigin="anonymous"></script><title data-rh="true">4 posts tagged with &quot;istio&quot; | Cloud Catalyst</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ddii.dev/tags/istio/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="naver-site-verification" content="cbcc03783e5594725d3951f4e7f16ede80e69881"><meta data-rh="true" property="og:title" content="4 posts tagged with &quot;istio&quot; | Cloud Catalyst"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ddii.dev/tags/istio/"><link data-rh="true" rel="alternate" href="https://ddii.dev/tags/istio/" hreflang="en"><link data-rh="true" rel="alternate" href="https://ddii.dev/tags/istio/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UTLA0DRN66-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.1e7a31ee.css">
<link rel="preload" href="/assets/js/runtime~main.b94385cb.js" as="script">
<link rel="preload" href="/assets/js/main.0346262c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_ObN2"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-catalyst.svg" alt="Cloud Catalyst" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo-catalyst.svg" alt="Cloud Catalyst" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Cloud Catalyst</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Posts</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" docid="introduction" href="/docs/prometheus/introduction/">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/prometheus/introduction/">Prometheus</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/tags/">Tags</a><a class="navbar__item navbar__link" href="/presentation/">Presentation</a><a class="navbar__item navbar__link" href="/archive/">Archive</a><a class="navbar__item navbar__link" href="/about/">About</a><a class="navbar__item navbar__link" href="/pang4u/">Pang4u</a><a href="https://github.com/ddiiwoong/newblog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">Recent Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/eks-anywhere-adv/">EKS Anywhere Advanced Usages</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/eks-anywhere/">EKS Anywhere on vSphere Homelab</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/what-is-tailscale/">What is Tailscale?</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/prometheus/synology-prometheus/">Synology monitoring with Prometheus and snmp exporter</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kubernetes/vSphere-with-Tanzu-homelab-2/">vSphere with Tanzu homelab running on ASUS PN50 (2/2)</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>4 posts tagged with &quot;istio&quot;</h1><a href="/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/kubernetes/eks-anywhere-adv/">EKS Anywhere Advanced Usages</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-03-18T00:00:00.000Z" itemprop="datePublished">March 18, 2022</time> Â· <!-- -->18 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://www.linkedin.com/in/ddiiwoong/" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://s.gravatar.com/avatar/e8bfebcbeacb5b9a0c90614e792febf2?s=80" alt="Jinwoong Kim"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.linkedin.com/in/ddiiwoong/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jinwoong Kim</span></a></div><small class="avatar__subtitle" itemprop="description">Technologist and Cloud Consultant</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>ì§ëê¸ì ì´ì´ ì´ë²ìë íë©ì¼ë¡ êµ¬ì±í EKS Anywhere í´ë¬ì¤í°ìì ì´ì, ê°ë°íê²½ êµ¬ì±ì ìí ì¬ë¬ê°ì§ ëêµ¬ë¥¼ ì¤ì¹í´ë³´ë ê³¼ì ì ì ë¦¬íê³ ì íë¤. </p><p>ì§ë í¬ì¤íì ë¤ì ë§í¬ìì íì¸í  ì ìë¤.</p><blockquote><p>ì´ì ê¸ - <a href="https://ddii.dev/kubernetes/eks-anywhere/" target="_blank" rel="noopener noreferrer">vSphere homelab íê²½ìì EKS Anywhere êµ¬ì±íê¸°</a></p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kubernetes/">Kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/vsphere/">vsphere</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/eks-anywhere/">eks anywhere</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/eks-connector/">eks connector</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/eks/">eks</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/opentelemetry/">opentelemetry</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/cilium/">cilium</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/observability/">observability</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/prometheus/">prometheus</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/grafana/">grafana</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/loki/">loki</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/microservice/">microservice</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/istio/">istio</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about EKS Anywhere Advanced Usages" href="/kubernetes/eks-anywhere-adv/"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/kubernetes/microservices-demo/">Cloud-Native Microservices Demo Application with OpenCensus</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2019-03-07T00:00:00.000Z" itemprop="datePublished">March 7, 2019</time> Â· <!-- -->14 min read</div></header><div class="markdown" itemprop="articleBody"><p><a href="https://github.com/GoogleCloudPlatform/microservices-demo" target="_blank" rel="noopener noreferrer">https://github.com/GoogleCloudPlatform/microservices-demo</a>ìì ìê°ë Demo Applicationì¸ <code>Hipster Shop</code>ì Kubernetes ê¸°ë°ì¼ë¡ ë°°í¬íê³  ê´ë ¨ ì¤íìì¤ë¤ì ë ììë³´ê³ ì íë¤.</p><p>ì ë§í¬ì ê°ì ë³´ë©´ ìì ìì§ë§ <code>Hipster Shop</code> ìë ê·¸ë¦¼ì²ë¼ 10ê°ì Microserviceë¡ êµ¬ì±ëì´ ìê³  ìíì ê²ì ë° êµ¬ë§¤í  ììë ì¹ ê¸°ë° ì´ì»¤ë¨¸ì¤ Applicationì¼ë¡ êµ¬ì± ëì´ìë¤.</p><p><img loading="lazy" src="https://github.com/GoogleCloudPlatform/microservices-demo/raw/master/docs/img/architecture-diagram.png" alt="arch" class="img_E7b_"></p><p>ê°ê°ì ìë¹ì¤ë <strong>gRPC</strong> ë¡ íµì íê³  ì¸ë¶ ì¬ì©ìë§ HTTPë¡ ì ê·¼íë¤. ëª¨ë  ìë¹ì¤ë ìë¡ ë¤ë¥¸ ì¸ì´(Go, C#, Node.js, Python, Java)ë¡ êµ¬ì±ëì´ ìê³  ëë¶ë¶ì Microserviceë¤ì <code>Istio</code> service mesh ííë¡ êµ¬ì±í ì ìëë¡ ëì´ìë¤. <code>Skaffold</code>ë¥¼ íµí´ ë°°í¬íê³  <code>OpenCensus</code>ë¼ê³  íë gRPC/HTTPê¸°ë° Tracing toolì íì©íì¬ Google <code>Stackdriver</code>ë¡ ë³´ë´ëë¡ ëì´ìì§ë§  Prometheusì íµí©íë ë°©í¥ì¼ë¡ ìì±íê¸° ìí´ì Prometheus ê¸°ë°ì¼ë¡ Metricì ìì§íë Forkë ë°ëª¨ Applicationì ê²ìì íµí´ ì°¾ìì ììë¤.<br>
<a href="https://github.com/census-ecosystem/opencensus-microservices-demo" target="_blank" rel="noopener noreferrer">https://github.com/census-ecosystem/opencensus-microservices-demo</a>  </p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="opencensus">OpenCensus<a class="hash-link" href="#opencensus" title="Direct link to heading">â</a></h2><p><a href="https://opencensus.io/" target="_blank" rel="noopener noreferrer">OpenCensus(OC)</a>ë Microservice ë° Monolith ìë¹ì¤ë¥¼ Tracing ë° Metric Monitoring í  ì ìë ë¼ì´ë¸ë¬ë¦¬ë¥¼ ì ê³µíë ì¤íìì¤ì´ë¤.</p><p>ìëì ê°ì´ ë¤ìí ì¸ì´ë¥¼ ì§ì íë¤.</p><ul><li>Java , Go, Python, C++, Nodejs, Erlang, Ruby, PHP, C#</li></ul><p>ëí ìì§ë ë°ì´í°ë¥¼ Prometheus, Stackdriver Tracing and Monitoring, DataDog, Graphite, Zipkin, Jaeger, Azure Insights ë± ê³¼ ê°ì ë°±ìë Applicationì¼ë¡ ë´ë³´ë¼ ì ìê¸° ëë¬¸ì ê°ë°ì, ì´ìì ì¸¡ë©´ìì ì¢ì ì íì¬í­ì´ ë  ì ìë¤.  </p><p>Microserviceì ê°ì ë¶ì° ìì¤íìì ê°ë°ì/ì´ìì ê´ì ì ê°ì¥ ì¤ìí ë¯¸ìì ê°ê°ì ìíëë ìë¹ì¤ë¤ì ì¤í ìê°ì íì¸íê³  ìí¸ APIê° íµì ì´ ì¼ë§ë ê±¸ë¦¬ëì§ë¥¼ íì¸íê³  Span(ìë ê·¸ë¦¼ì°¸ì¡°)ìì ê°ì¥ ì§ì°ì´ ë°ìíë ìë¹ì¤ë¥¼ ë¹¨ë¦¬ ì°¾ìë´ íì¸íê³  ì¡°ì¹íë ê²ì´ë¼ í  ì ìë¤.</p><p><img loading="lazy" src="https://www.jaegertracing.io/img/spans-traces.png" alt="span" class="img_E7b_"></p><p>OpenCensusë ì£¼ë¡ ëê°ì§ ê¸°ë¥ì¼ë¡ íì©ëë¤.<br>
<!-- -->ì²«ë²ì§¸ë Metric ìì§ì´ê³  ëë²ì§¸ë Tracing ê¸°ë¥ì´ë¤.<br>
<!-- -->Logê°ì ê²½ì° íì¬ ë¯¸ì§ìì´ì§ë§ ë¤ì ë©ì´ì  ë¦´ë¦¬ì¦ì ì¶ê°ë  ìì ì´ë¼ê³  íë ì¡°ê¸ë ì§ì¼ë³´ë©´ ì¢ìê² ê°ë¤.</p><ul><li><p>Metrics</p><ul><li>ë°ì´í°ë² ì´ì¤ ë° APIì ìëµìê°, ìì²­ content length, open file descriptor ìì ê°ì´ ì¶ì íê³ ìíë ì ë ë°ì´í°ë¥¼ ë§íë¤. Metric ì ìê°íí´ì ë³´ë©´ ìì© íë¡ê·¸ë¨ ë° ìë¹ì¤ì ì±ë¥ê³¼ íì§ì ì¸¡ì íë ë° ëìì´ ë  ì ìë¤. ìë¥¼ ë¤ë©´ ìì²­ ìëµìê°ì íê· ê°ì´ë cache hit/miss ìì ê°ì ê²ë¤ì´ ë  ì ìë¤. </li></ul></li><li><p>Traces</p><ul><li>ìë¹ì¤ ìì²­ì ëí ì íë¦¬ì¼ì´ì ëë ìë¹ì¤ êµ¬ì¡°ë¥¼ íì¸í ì ìê³  ëª¨ë  ìë¹ì¤ ê° ë°ì´í° íë¦ì ìê°ííì¬ ìí¤íì²ìì ë³ëª© íìì íìíë ë° ëìì´ ëë¤.</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="hipster-shop-demo">Hipster Shop Demo<a class="hash-link" href="#hipster-shop-demo" title="Direct link to heading">â</a></h2><p>ììì ì¸ê¸íë ë´ì©ì²ë¼ GCPìì ìì±í <a href="https://github.com/GoogleCloudPlatform/microservices-demo" target="_blank" rel="noopener noreferrer">Hipster Shop Demo</a>ë minikube ë° GCP ë°ëª¨ë¡ ëì´ìê³  ì½ëìì ê¸°ë³¸ Metric ì¤ì ì´ Stackdriverì¼ë¡ ëì´ìì´ Prometheus Exporter ì ì©ì íë ¤ë©´ ì½ë ìì ì´ íìíê¸° ëë¬¸ì Prometheusê¸°ë°ì¼ë¡ ìì±ë <a href="https://github.com/census-ecosystem/opencensus-microservices-demo" target="_blank" rel="noopener noreferrer">Forked Repo</a>ë¥¼ ì´í´ë³´ê¸°ë¡ íìë¤.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="requirement">Requirement<a class="hash-link" href="#requirement" title="Direct link to heading">â</a></h3><p>íì¬ ê°ì§ê³  ìë MacOS íê²½ìì êµ¬ëíìë¤. ìµì ì¤íì ë°ë¡ ê¸°ì¬íì§ ììì¼ë K8s 1.11 ì´ìì ê¶ì¥íë¤.</p><ul><li>kubectl : v1.10.7</li><li>Minikube : v0.34.1</li><li>Kubernetes : v1.13.3</li><li><a href="https://github.com/GoogleContainerTools/skaffold/#installation" target="_blank" rel="noopener noreferrer">skaffold</a> : v0.24</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="minikube-ê¸°ë">minikube ê¸°ë<a class="hash-link" href="#minikube-ê¸°ë" title="Direct link to heading">â</a></h3><p>ìµì 3 CPU, 6Gb Memoryê° íìíë¤. ê·¸ë¥ minikubeë¥¼ êµ¬ëìê¸°ë©´ 4 CPU, 8Gb ë¡ êµ¬ëì´ ëê¸° ëë¬¸ì ë³ë¤ë¥¸ ìµì ìì´ defaultë¡ êµ¬ëíë©´ ëë¤. </p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ minikube start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME       STATUS    ROLES     AGE       VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">minikube   Ready     master    6h        v1.13.3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="repository-clone">Repository Clone<a class="hash-link" href="#repository-clone" title="Direct link to heading">â</a></h3><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/census-ecosystem/opencensus-microservices-demo.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token builtin class-name">cd</span><span class="token plain"> opencensus-microservices-demo</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ë´ë¶ êµ¬ì¡°ë¥¼ ì´í´ë³´ë©´ ê¸°ë³¸ì ì¼ë¡ <a href="https://github.com/GoogleContainerTools/skaffold" target="_blank" rel="noopener noreferrer">skaffold</a>ë¥¼ íì©íì¬ ë°°í¬ë¥¼ ì§íì íë ê²ì ìììë¤.<br>
<code>skaffold</code>ë ë¡ì»¬ìì Kubernetes ê¸°ë° ì´íë¦¬ì¼ì´ì ê°ë°ê³¼ ë°°í¬(CD)ë¥¼ ë¹ ë¥´ê² ëìì£¼ë CLI toolì´ë¤. ìì¤ì½ëì ë³íë¥¼ ê°ì§íì¬ build, registry push/tagging, deployê¹ì§ ìëì¼ë¡ í  ì ìë ë¡ì»¬ ê¸°ë° ëêµ¬ì´ë¤.</p><p><code>skaffold dev</code>ë ë¡ì»¬ íê²½ì ë°ë³µì ì¸ ê°ë°ì íì©íê³  ì¤ì  ë°°í¬ë CI Processìì <code>skaffold run</code>ì íµí´ ë°°í¬ë¥¼ ì§íí  ì ìë¤.  </p><p><img loading="lazy" src="https://github.com/GoogleContainerTools/skaffold/raw/master/docs/static/img/intro.gif" alt="skaffold demo" class="img_E7b_"></p><p>Kubernetes ë°°í¬í´ì ëí´ ë¹êµí ê¸ì <a href="https://blog.hasura.io/draft-vs-gitkube-vs-helm-vs-ksonnet-vs-metaparticle-vs-skaffold-f5aa9561f948/" target="_blank" rel="noopener noreferrer">ë¸ë¡ê·¸ ë§í¬</a>ë¥¼ íµí´ íì¸í  ì ìë¤.</p><p>ìëììë <code>skaffold</code>ì ëí ìì¸í ë´ì©ì ë¯¸ë¤ëê³  ë°°í¬íë ëêµ¬ë¡ìë§ ì¤ëªíë¤.  </p><p>ê¸°ë³¸ì ì¼ë¡ êµ¬ì±ì íê³ ì íë ë´ì©ì helmì²ë¼ template íì¼ì ì¬ì©íê² ëëë° íë¡ì í¸ rootì <code>skaffold.yaml</code> ì buildë¥¼ ìí image name, tag, src ìì¹ë± ê¸°ë³¸ì ì¸ ë´ì©ì ê¸°ì¬íë¤. íì¼ë´ì©ì ì´í´ë³´ë©´ buildì ê´ë ¨ë ë´ì©ë¤ì ìì±íê³  deployí  manifestsì ìì¹ê¹ì§ ì§ì íëë¡ ëì´ìë¤. ë¡ì»¬íê²½ìì íì¸ì ìí´ grafana, prometheus, jaegerê° ì¶ê°ë ê²ì íì¸í  ì ìë¤.</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> skaffold/v1alpha2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tagPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">gitCommit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">artifacts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/emailservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/emailservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/productcatalogservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/productcatalogservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/recommendationservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/recommendationservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/shippingservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/shippingservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/checkoutservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/checkoutservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/paymentservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/paymentservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/currencyservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/currencyservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/cartservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/cartservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/loadgenerator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/loadgenerator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/adservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/adservice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">imageName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gcr.io/opencensus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">microservices</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo/jaeger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">workspace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> src/jaeger</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">deploy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kubectl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">manifests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ./kubernetes</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">manifests/</span><span class="token important">**.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Goë¡ ìì±ë Frontend microserviceì ì´í´ë³´ì. <!-- -->[<strong>./src/frontend/main.go</strong>]</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="library-ì¶ê°-ë°-http-handler-ì´ê¸°í">library ì¶ê° ë° http handler ì´ê¸°í<a class="hash-link" href="#library-ì¶ê°-ë°-http-handler-ì´ê¸°í" title="Direct link to heading">â</a></h3><p>Goê¸°ë° exporter í¨í¤ì§(jaeger,prometheus)ë¥¼ ì¶ê°ì ì¼ë¡ import íê³  http handlerë¥¼ ìí <a href="https://godoc.org/go.opencensus.io/plugin/ochttp" target="_blank" rel="noopener noreferrer">ochttp í¨í¤ì§</a>ë¥¼ ì¶ê°íìë¤. </p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;go.opencensus.io/exporter/jaeger&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;go.opencensus.io/exporter/prometheus&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;go.opencensus.io/plugin/ochttp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;go.opencensus.io/plugin/ochttp/propagation/b3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> handler http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Handler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">logHandler</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> next</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ensureSessionID</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// add opencensus instrumentation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        handler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ochttp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Handler</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Handler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">     handler</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Propagation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">b3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HTTPFormat</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Infof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;starting server on &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> addr </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> srvPort</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ListenAndServe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr</span><span class="token operator" style="color:#393A34">+</span><span class="token string" style="color:#e3116c">&quot;:&quot;</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">srvPort</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="exporter-ë±ë¡jaeger-tracing-ë°-prometheus-exporter">exporter ë±ë¡(Jaeger Tracing ë° Prometheus exporter)<a class="hash-link" href="#exporter-ë±ë¡jaeger-tracing-ë°-prometheus-exporter" title="Direct link to heading">â</a></h3><p>ììì²ë¼ ê°ê°ì ìë¹ì¤ì jaegerì prometheus exporter Endpointë¥¼ ì½ê² ë±ë¡í ì ìë¤.<br>
<!-- -->ëí initTracing() ììë ë°ëª¨ë¥¼ ìí´ trace.AlwaysSample()ì ì¬ì©íìë¤. ì¤ì  ì´ìíê²½ììë <a href="https://github.com/census-instrumentation/opencensus-specs/blob/master/trace/Sampling.md" target="_blank" rel="noopener noreferrer">ë¤ì ë§í¬</a>ë¥¼ ì°¸ê³ í´ì ì¬ì©íë ê²ì ê¶ê³ íê³  ìë¤. </p><div class="codeBlockContainer_I0IT language-go theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-go codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initJaegerTracing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log logrus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FieldLogger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Register the Jaeger exporter to be able to retrieve</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// the collected spans.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exporter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> jaeger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewExporter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jaeger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Endpoint</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://jaeger:14268&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Process</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jaeger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Process</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ServiceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;frontend&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        trace</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RegisterExporter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exporter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initTracing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log logrus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FieldLogger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// This is a demo app with low QPS. trace.AlwaysSample() is used here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// to make sure traces are available for observation and analysis.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// In a production environment or high QPS setup please use</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// trace.ProbabilitySampler set at the desired probability.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        trace</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ApplyConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trace</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                DefaultSampler</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trace</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AlwaysSample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">initJaegerTracing</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initPrometheusStatsExporter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log logrus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FieldLogger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Exporter </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    exporter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> prometheus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewExporter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Options</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;error registering prometheus exporter&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    view</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RegisterExporter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exporter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> exporter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">startPrometheusExporter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log logrus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">FieldLogger</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exporter </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">prometheus</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Exporter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addr </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:9090&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Infof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;starting prometheus server at %s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Handle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/metrics&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exporter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ListenAndServe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="demo-application-ë°°í¬">Demo Application ë°°í¬<a class="hash-link" href="#demo-application-ë°°í¬" title="Direct link to heading">â</a></h3><p>minikubeì Hipster Shop Demoë¥¼ ë°°í¬íë¤. ë¨ìíê² <code>skaffold run</code> ëªë ¹ì¼ë¡ ì§ííë©´ ëë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ skaffold run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>íì¬ ì¬ì©ì¤ì¸ 2018 Macbook Pro(3.1 GHz Intel Core i7, 16GB) ìì Dockerê¸°ë° minikube íê²½ì¼ë¡ë ë°°í¬ë¥¼ íìëë° ìê°ì´ ê½¤ ììëìë¤.(20ë¶ì´ì)<br>
<!-- -->ì½ëë¥¼ ì¤ìê°ì¼ë¡ ìì íê³  ë¹ë, ë°°í¬ëë ê²ì <code>skaffold dev</code> ëªë ¹ì¼ë¡ íì¸í  ì ìë¤. ì§íëë ê³¼ì ì ë³´ë©´ <a href="https://draft.sh/" target="_blank" rel="noopener noreferrer">draft.sh</a> íë¡ì í¸ìë ê½¤ ì ì¬íë¤ê³  ë³¼ ì ìë¤.  </p><p>ìë¬ìì´ runì´ ì¤íëê³  ëí minikubeì ë°°í¬ë podì serviceë¥¼ íì¸íë¤. ì¤ê°ì loadgeneratorê° initì¸ ì´ì ë minikube ììì´ ë¶ì¡±í´ì ë°ìíë íìì´ë¤.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                     READY     STATUS     RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adservice-7c7d687dcb-xzr4m               </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cartservice-f54bcb9ff-tcfgn              </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">checkoutservice-576446687b-95bwj         </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currencyservice-5bd99bf97d-28mtz         </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">emailservice-6cb587798d-wwzdh            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frontend-6bf9796f7b-ch9pl                </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grafana-6678c5c5d9-2qx75                 </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jaeger-5b66bdf7f7-csdzx                  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loadgenerator-7c4f446774-68djg           </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1       Init:0/1   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paymentservice-fc4c8589-wrfg7            </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">productcatalogservice-84878c8b9c-jhgnw   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus-58d98b7578-87td6              </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">recommendationservice-8564f9d894-smlpf   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis-cart-798bc66d58-xn6ff              </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shippingservice-789656f6bc-rgzrp         </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP   PORT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">S</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                                                            AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adservice               ClusterIP      </span><span class="token number" style="color:#36acaa">10.107</span><span class="token plain">.196.115   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">9555</span><span class="token plain">/TCP,9090/TCP                                                  4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cartservice             ClusterIP      </span><span class="token number" style="color:#36acaa">10.98</span><span class="token plain">.151.164    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">7070</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">checkoutservice         ClusterIP      </span><span class="token number" style="color:#36acaa">10.97</span><span class="token plain">.9.197      </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">5050</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">currencyservice         ClusterIP      </span><span class="token number" style="color:#36acaa">10.103</span><span class="token plain">.112.225   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">7000</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">emailservice            ClusterIP      </span><span class="token number" style="color:#36acaa">10.97</span><span class="token plain">.184.174    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">5000</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frontend                ClusterIP      </span><span class="token number" style="color:#36acaa">10.103</span><span class="token plain">.40.138    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">/TCP,9090/TCP                                                    4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frontend-external       LoadBalancer   </span><span class="token number" style="color:#36acaa">10.108</span><span class="token plain">.170.241   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">pending</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">80</span><span class="token plain">:31944/TCP                                                       4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grafana                 ClusterIP      </span><span class="token number" style="color:#36acaa">10.104</span><span class="token plain">.141.254   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">3000</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grafana-external        LoadBalancer   </span><span class="token number" style="color:#36acaa">10.102</span><span class="token plain">.166.138   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">pending</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">3000</span><span class="token plain">:30459/TCP                                                     4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jaeger                  ClusterIP      </span><span class="token number" style="color:#36acaa">10.98</span><span class="token plain">.71.173     </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">9411</span><span class="token plain">/TCP,5775/UDP,6831/UDP,6832/UDP,5778/TCP,16686/TCP,14268/TCP   4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jaeger-external         LoadBalancer   </span><span class="token number" style="color:#36acaa">10.96</span><span class="token plain">.164.126    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">pending</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">16686</span><span class="token plain">:32362/TCP                                                    4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubernetes              ClusterIP      </span><span class="token number" style="color:#36acaa">10.96</span><span class="token plain">.0.1        </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">443</span><span class="token plain">/TCP                                                            6h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paymentservice          ClusterIP      </span><span class="token number" style="color:#36acaa">10.109</span><span class="token plain">.31.241    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">50051</span><span class="token plain">/TCP                                                          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">productcatalogservice   ClusterIP      </span><span class="token number" style="color:#36acaa">10.101</span><span class="token plain">.124.106   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">3550</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">prometheus              ClusterIP      </span><span class="token number" style="color:#36acaa">10.103</span><span class="token plain">.107.213   </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">9090</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">recommendationservice   ClusterIP      </span><span class="token number" style="color:#36acaa">10.104</span><span class="token plain">.225.28    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">8080</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redis-cart              ClusterIP      </span><span class="token number" style="color:#36acaa">10.101</span><span class="token plain">.24.157    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">6379</span><span class="token plain">/TCP                                                           4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shippingservice         ClusterIP      </span><span class="token number" style="color:#36acaa">10.104</span><span class="token plain">.224.18    </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">none</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">50051</span><span class="token plain">/TCP                                                          4h</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ìë¹ì¤-ì ì-ë°-metrictracing-íì¸">ìë¹ì¤ ì ì ë° Metric/Tracing íì¸<a class="hash-link" href="#ìë¹ì¤-ì ì-ë°-metrictracing-íì¸" title="Direct link to heading">â</a></h3><p>ë¡ì»¬ minikubeíê²½ì´ê¸° ëë¬¸ì external serviceê° pendingì´ë¯ë¡ serviceë¥¼ minikube NAT IPë¡ expose ìí¨ë¤.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ minikube </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> frontend-external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ minikube </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> grafana-external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ minikube </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> jaeger-external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ minikube </span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-------------</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-----------------------</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-----------------------------</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  NAMESPACE  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">         NAME          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">             URL             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-------------</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-----------------------</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-----------------------------</span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> adservice             </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cartservice           </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> checkoutservice       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> currencyservice       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> emailservice          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> frontend              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> frontend-external     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> http://192.168.99.101:31944 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> grafana               </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> grafana-external      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> http://192.168.99.101:30459 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jaeger                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> jaeger-external       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> http://192.168.99.101:32362 </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubernetes            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> paymentservice        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> productcatalogservice </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> prometheus            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> recommendationservice </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> redis-cart            </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> default     </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> shippingservice       </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kube-system </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kube-dns              </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> No </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> port                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-------------</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-----------------------</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">-----------------------------</span><span class="token operator" style="color:#393A34">|</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>3ê°ì ìë¹ì¤ë¡ ê°ê° ì ìì´ ëëê²ì íì¸í ì ìë¤.
Grafana ëìë³´ëë¡ ë¤ì´ê°ë©´ íì¬ ìì§ëë prometheus source(http://prometheus:9090)ë¥¼ íµí´ OpenCensusê¸°ë° Application Metricì íì¸í  ì ìë¤.</p><p><img loading="lazy" alt="hipster_grafana" src="/assets/images/hipster_grafana-13ab198ab40c06a5c6ba6bc61e3725ad.png" width="2878" height="1488" class="img_E7b_"></p><p>ê·¸ë¦¼ìì ë³´ë©´ ì ì²´ ìë¹ì¤ ìëµì ëí 99% ë°±ë¶ì ì§ì°ìê°ì´ 944ms ì¸ê²ì íì¸í  ì ìë¤. </p><p>ëí Jaegerë¥¼ íµí´ DAG(Directed acyclic graph) ë° ìë¹ì¤ê° Tracing ì íì¸í  ì ìë¤.</p><p><img loading="lazy" alt="DAG" src="/assets/images/dag-0e49356be3f8676a292785832fbc1981.png" width="3146" height="1782" class="img_E7b_"></p><p><img loading="lazy" alt="tracing" src="/assets/images/tracing-b9038c7a3151b467c5f7d4dc08786f75.png" width="3172" height="1442" class="img_E7b_"></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ì ë¦¬">ì ë¦¬<a class="hash-link" href="#ì ë¦¬" title="Direct link to heading">â</a></h2><p>OpenCensus ê¸°ë°ì¼ë¡ ê°ë°ìê° ì½ëë¥¼ ìì±íê³  Microserviceë¥¼ minikubeìì ë°°í¬íê³  Prometheus, Jaeger Exporter ì°ëì íµí´ ìì¤íë¿ë§ì´ ìë Applicationê¸°ë° Metrics/Statsì ìì§íê³  ê°ë°ìê° ìì±í ì½ëë¥¼ ì§ì  Tracingíë ê°ë¨í ë°ëª¨ë¥¼ ì§ííìë¤. (Istioë¥¼ í¬í¨í´ì Publicíê²½ì ë°°í¬í´ë´ë ì¢ì ê³µë¶ê° ë  ê² ê°ë¤)  </p><p>í¥í <a href="https://openmetrics.io/" target="_blank" rel="noopener noreferrer">OpenMetric</a>ê³¼ <a href="https://opencensus.io/" target="_blank" rel="noopener noreferrer">Opencensus</a>ê° ì¤ì  ê°ë°ì ê¸°ë°ì¼ë¡ íì±íëê³  ì ì©ì´ ëë¤ë©´ Telemetric ì¸¡ë©´ìì ë§ì Use-Caseê° ëì¶ë  ì ììê² ê°ë¤.  </p><p>ììì ì¸ê¸íë¯ì´ Prometheusê¸°ë° Kubernetes í´ë¬ì¤í°ë¥¼ ì´ìíê³  ìë íì ê²½ì° ê°ë°ìì ìì± ì½ëë¥¼ ìµìíí  ì ìë ëêµ¬ë¡ì ì¶©ë¶í íì©ë  ì ìì´ ë³´ì¸ë¤.  </p><p>ê¼­ Cloud Native ê¸°ë° Web ê°ë°ì´ ìëëë¼ë ê¸°ì¡´ ê³µì¥, ê¸ìµ, ë³ì ë± ì IoTë ì¼ì/ì¤ë¹ë¥¼ ìí ë¹ì¦ëì¤ìë Backendë¡ì íì¥ì±ìë ëêµ¬ë¡ì íì©ì´ ë  ì ììê² ê°ë¤.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kubernetes/">Kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/istio/">Istio</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/stackdriver/">Stackdriver</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/prometheus/">Prometheus</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/g-rpc/">gRPC</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/open-census/">OpenCensus</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/skaffold/">skaffold</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Cloud-Native Microservices Demo Application with OpenCensus" href="/kubernetes/microservices-demo/"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/kubernetes/cilium-1/">Cilium</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2018-07-06T00:00:00.000Z" itemprop="datePublished">July 6, 2018</time> Â· <!-- -->17 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="cilium-ëêµ¬ë-ë">Cilium ëêµ¬ë ë?<a class="hash-link" href="#cilium-ëêµ¬ë-ë" title="Direct link to heading">â</a></h2><p>ì²ìì ëëë¤. ë²ì­íë©´ &#x27;ìê¶&#x27;, &#x27;ì¬ëª¨&#x27;, &#x27;ìëì¹&#x27;ë± ìµìì¹ ìì ë¨ì´ë¼ì ëëì§ë§ ì°¨ê·¼í ë³´ë¤ë³´ë ê²°êµ­ OSë´ë¶(ë¦¬ëì¤ ì»¤ë)ììë¶í° ì»¨íì´ëê° ëë ì¸ë¶ìì ì°ê²°ì ë³´í¸íë ì­í ì´ë¼ê³  íë ì´í´ê° ëë ê² ê°ë¤.</p><p>ííì´ì§ì ì ìë ë´ì©ì ë³´ë©´ ìë ë´ì©ê³¼ ê°ë¤. </p><blockquote><p><a href="https://cilium.readthedocs.io/en/v1.1/intro/#what-is-cilium" target="_blank" rel="noopener noreferrer">Cilium</a> - Docker ë° Kubernetesì ê°ì Linux ì»¨íì´ë ê´ë¦¬ íë«í¼ì ì¬ì©íì¬ ë°°í¬ë ìì© íë¡ê·¸ë¨ ìë¹ì¤ ê°ì ë¤í¸ìí¬ ì°ê²°ì ë³´í¸íë ì¤í ìì¤ ìíí¸ì¨ì´</p></blockquote><p>íë¶ì <a href="https://www.facebook.com/groups/korelnxuser/" target="_blank" rel="noopener noreferrer">íêµ­ ë¦¬ëì¤ ì¬ì©ì ê·¸ë£¹</a>ììë <a href="https://www.facebook.com/tommy.lee.98229" target="_blank" rel="noopener noreferrer">Tommy Lee</a>ëì´ë <a href="https://www.facebook.com/changan.song" target="_blank" rel="noopener noreferrer">ì¡ì°½ì</a>ëì´ ëªëª ê²ìë¬¼ì ì¬ë ¤ì£¼ìì ê´ì¬ìê² ë³´ëì¤ì ìëì ê°ì ë´ì©ì ë³´ê³  ì´ê±°ë¤ íê³  íë³´ê¸° ììíë¤.</p><blockquote><p>Ciliumì Docker ë° Kubernetesì ê°ì ë¦¬ëì¤ ì»¨íì´ë íë ì ìí¬ì API ê¸°ë°ì ë¤í¸ìí¬ ë³´ì íí°ë§ì ì ê³µíë©°,
ëí, BPFë¼ë ìë¡ì´ Linux ì»¤ë ê¸°ì ì ì¬ì©íì¬ ì»¨íì´ë/POD IDë¥¼ ê¸°ë°ì¼ë¡ ë¤í¸ìí¬ ê³ì¸µ ë° ìì© íë¡ê·¸ë¨ ê³ì¸µ ë³´ì ì ì±ì ì ì ë° ì ì©íë ê²ì ìì´ì ê°ë¨íë©´ì í¨ì¨ì ì¸ ë°©ë²ì ì ê³µíê³  ììµëë¤.</p></blockquote><p>ìë¶ë¤ì²ë¼ ì»¤ë ìì²´ë¥¼ ë¶ìíê³  ê³µë¶íê³  ê¸°ì¬íë ¤ë©´ ììëë ìê°ì´ ë ê±¸ë¦´ê±° ê°ê³  ìë¹ì¤ë¥¼ ì´ìíê³  ê°ë°íë ìì¥ììë ë´ íë¡ì í¸ì ì ì© ê°ë¥ì±ì ê²ì¦íëê²ì´ ëìê² ê°ì ì ë¦¬ë¥¼ í´ë³¸ë¤.</p><p>iptablesì ê¸°ë°ì¼ë¡ IPì Portê¸°ë°ì ì íµì ì¸ í¬ìë© ê¸°ì ì ë²ì¨ 20ëì´ë¼ë ì¸ìëì ëë¦¬ ì¬ì©ëì´ ìë¤. í¹í í¼ë¸ë¦­/íë¼ì´ë¹ í´ë¼ì°ë ì íêµ°ë¤ ëª¨ë iptablesê¸°ë°ì Security Groupë±ì ê¸°ë³¸ì¼ë¡ ì ê³µíê³  ìê³  Kubernetes ë§ì ë CNI íµì¬ì¼ë¡ iptablesì íì©íê³  ìë¤.  </p><p>ëì ì¼ë¡ ë³ííê³  ë§¤ì° ë³µì¡í ë§ì´í¬ë¡ìë¹ì¤ë¥¼ ì¬ì©íë ìëì ì íµì ì¸ ë°©ìì IP, Portê´ë¦¬ë ë¹í¨ì¨ì ì¸ ì¸¡ë©´ì´ ìì§ ìë¤. BPF(ìëì¸ì©)ì íì©íì¬ ë¦¬ëì¤ ì»¤ëë´ìì ë°ì´í° í¬ìë©ì í  ì ìê³  Kubernetes Serviceê¸°ë° Load Balancingì´ë istioì ê°ì Service Meshë¥¼ ìí Proxy Injection ì íµí´ ì¬ë¬ íì©ì í  ì ììê±°ë¼ê³  Cilium íë¡ì í¸ë ì´ì¼ê¸° íê³  ìë¤. </p><blockquote><p>ë²í´ë¦¬ í¨í· íí°(Berkeley Packet Filter, BPF)</p><p>BPFë ë²í´ë¦¬ í¨í· íí°(Berkeley Packet Filter)ì ì¤ìë§ì´ë¤. ì´ë¦ ê·¸ëë¡ í¨í·ì ê±¸ë¬ë´ë íí°ì´ë¤. ê·¸ë°ë° BSDììì BPFë ë¤í¸ìí¬ í­(ë¦¬ëì¤ì PF_PACKET)ê¹ì§ ìì°ë¥´ë ê°ëì´ë¤. ìë  ìì ì ì ëì¤ìë CSPF(CMU/Stanford Packet Filter)ë¼ë ê² ììëë° BPFë¼ë ì êµ¬ì¡°ê° ì´ë¥¼ ëì²´íë¤. ì´í ë¦¬ëì¤ììë ë¤í¸ìí¬ í­ì ëë¦ì ë°©ìì¼ë¡ êµ¬ííê³  í¨í· íí° ë¶ë¶ë§ ê°ì ¸ìë¤. ë¦¬ëì¤ì í¨í· íí°ë¥¼ ë¦¬ëì¤ ìì¼ íí°ë§(LSF: Linux Socket Filtering)ì´ë¼ê³ ë íë¤.<br>
<!-- -->(ë°ì·) <a href="https://wariua.github.io/facility/extended-bpf.html" target="_blank" rel="noopener noreferrer">https://wariua.github.io/facility/extended-bpf.html</a> </p></blockquote><p>Ciliumì Dockercon 2017ìì ìµì´ <a href="https://www.youtube.com/watch?v=ilKlmTDdFgk" target="_blank" rel="noopener noreferrer">announce</a>ë¥¼ íìê³  2018ë 4ì 24ì¼ì 1.0ì´ ì ì Releaseë ì´í ë§ì ê´ì¬ì ë°ìê²ì¼ë¡ ììëì´ ì¤ì  ìë¹ì¤ì ì ì©í´ë³¼ íìê° ììê±° ê°ì minikubeë¡ íì¤í¸í ë´ì©ì ëì ¹ì¬ ë³¸ë¤. </p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="cilium-architecture">Cilium Architecture<a class="hash-link" href="#cilium-architecture" title="Direct link to heading">â</a></h2><p><img loading="lazy" alt="Cilium Architecture" src="/assets/images/cilium_arch-96f6efd4a70465e9cbfd890e9da1f159.png" width="700" height="624" class="img_E7b_"></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="main-feature">Main Feature<a class="hash-link" href="#main-feature" title="Direct link to heading">â</a></h2><ul><li>ê³ í¨ì¨ BPF Datapath  <ul><li>ëª¨ë  ë°ì´í° ê²½ë¡ê° í´ë¬ì¤í° ì ì²´ì ìì  ë¶ì°</li><li>Envoyê°ì proxy injection ì ê³µ, ì¶í sidecar proxy íí ì ê³µìì </li></ul></li><li>CNI, CMM plugins  <ul><li>Kubernetes, Mesos, Dockerì ì½ê² íµí©ê°ë¥</li></ul></li><li>Packet, API ë¤í¸ìí¬ ë³´ì<br>í¨í·ê¸°ë° ë¤í¸ìí¬ ë³´ìê³¼ API ì¸ì¦ì ê²°í©íì¬ ì íµì ì¸ í¨í·ê¸°ë° ë¤í¸ìí¬ ë³´ìê³¼ ë§ì´í¬ë¡ìë¹ì¤ ìí¤íì² ëª¨ëìê² ë³´ì ì ê³µê°ë¥  <ul><li><a href="http://docs.cilium.io/en/doc-1.0/concepts/#arch-id-security" target="_blank" rel="noopener noreferrer">IDê¸°ë°</a> - Source IPìë§ ìì¡´íì§ ìê³  ëª¨ë í¨í·ì workload identityë¥¼ encodingíì¬ ìë³ì± ê°í  </li><li><a href="http://docs.cilium.io/en/doc-1.0/policy/language/#ip-cidr-based" target="_blank" rel="noopener noreferrer">IP/CIDRê¸°ë°</a>ì´ì¸ìë <a href="http://docs.cilium.io/en/doc-1.0/policy/language/#services-based" target="_blank" rel="noopener noreferrer">Kubernetes Serviceê¸°ë°</a>ì¼ë¡ ì ì± ì¤ì ê°ë¥</li><li>L7ê¸°ë° <a href="http://docs.cilium.io/en/doc-1.0/policy/language/#layer-7-examples" target="_blank" rel="noopener noreferrer">APIë³´ì</a> ì ì©ê°ë¥</li></ul></li><li>ë¶ì°,íì¥ê°ë¥í Load Balacing
BPFë¥¼ ì¬ì©í ê³ ì±ë¥ L3,L4 Load Balancer ì ê³µ
(Hasing, Weighted round-robin)<ul><li>kube-proxy ëì²´ - Kubernetes ClusterIPê° ìì±ë ë BPFê¸°ë°ì¼ë¡ ìëì¼ë¡ ì ì©ë¨ </li><li><a href="http://docs.cilium.io/en/doc-1.0/api/" target="_blank" rel="noopener noreferrer">API driven</a> - ì§ì  APIë¥¼ íì©íì¬ íì¥ê°ë¥</li></ul></li><li>ë¨ìíë ë¤í¸ìí¬ ëª¨ë¸<br>Overlay/VXLAN, Direct/Native Routing ì§ì</li><li>ê°ìì±  <ul><li><a href="https://github.com/cilium/microscope" target="_blank" rel="noopener noreferrer">Microscope</a> - í´ë¬ì¤í° ë ë²¨ìì ëª¨ë  ì´ë²¤í¸ íí°ë§ ê°ë¥</li><li>APIê¸°ë° ê°ìì± ì ê³µ</li></ul></li><li>ì´ì<ul><li>í´ë¬ì¤í° í¬ì¤ì²´í¬ - HTTP, ICMPê¸°ì¤ í´ë¬ì¤í° latency ì²´í¬ê°ë¥</li><li>Prometheus íµí© - ëª¨ë  ë©í¸ë¦­ì Prometheusë¡ ì ë¬ê°ë¥</li><li>í´ë¬ì¤í° ë¶ì ë° <a href="http://docs.cilium.io/en/doc-1.0/troubleshooting/#cluster-diagnosis-tool" target="_blank" rel="noopener noreferrer">ë¦¬í¬í¸í´</a> </li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="requirement">Requirement<a class="hash-link" href="#requirement" title="Direct link to heading">â</a></h2><ul><li>kubectl &gt;= 1.7.0</li><li>minikube &gt;= 0.22.3</li></ul><p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">kubectl</a> ì¤ì¹ì <a href="https://github.com/kubernetes/minikube/releases" target="_blank" rel="noopener noreferrer">minikube</a> êµ¬ì±ì ë³ëë¡ í´ì¼íë¤.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="start-minikube">Start minikube<a class="hash-link" href="#start-minikube" title="Direct link to heading">â</a></h2><p>ëëíê² 4GB ì´ì ë©ëª¨ë¦¬ë¡ minikubeë¥¼ êµ¬ëíë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ minikube start --kubernetes-version v1.9.0 --network-plugin=cni --extra-config=kubelet.network-plugin=cni --memory=5120 </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="check-minikube-cluster-status">Check minikube cluster status<a class="hash-link" href="#check-minikube-cluster-status" title="Direct link to heading">â</a></h2><p>minikubeêµ¬ì±ì´ ìë£ëë©´ ìëì ê°ì´ í´ë¬ì¤í° ìíë¥¼ íì¸í ì ìë¤. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get cs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                 STATUS    MESSAGE              ERROR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">controller-manager   Healthy   ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scheduler            Healthy   ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">etcd-0               Healthy   {&quot;health&quot;: &quot;true&quot;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="install-etcd-dependency-of-cilium">Install etcd (dependency of cilium)<a class="hash-link" href="#install-etcd-dependency-of-cilium" title="Direct link to heading">â</a></h2><p>cilium ìì¡´ì±ì ìí´ etcdë¥¼ ë³ëë¡ ë°°í¬íë¤. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -n kube-system -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/kubernetes/addons/etcd/standalone-etcd.yaml  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service &quot;etcd-cilium&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">statefulset.apps &quot;etcd-cilium&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="check-all-pods-etcd">Check all pods (etcd)<a class="hash-link" href="#check-all-pods-etcd" title="Direct link to heading">â</a></h2><p>ëª¨ë  podê° <code>Running</code> ìíì¸ì§ íì¸íë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods --all-namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE     NAME                               READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   etcd-cilium-0                      1/1       Running   0          1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   etcd-minikube                      1/1       Running   0          3m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   kube-addon-manager-minikube        1/1       Running   0          4m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   kube-apiserver-minikube            1/1       Running   0          3m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   kube-controller-manager-minikube   1/1       Running   0          3m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   kube-dns-86f4d74b45-lhzfv          3/3       Running   0          4m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   kube-proxy-tcd7h                   1/1       Running   0          4m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   kube-scheduler-minikube            1/1       Running   0          4m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system   storage-provisioner                1/1       Running   0          4m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="install-cilium">Install Cilium<a class="hash-link" href="#install-cilium" title="Direct link to heading">â</a></h2><p>Kubernetes í´ë¬ì¤í°ì Ciliumì ì¸ì¤í¨íë¤. ê¸°ë³¸ì ì¼ë¡ DaemonSet ííë¡ ë°°í¬ëê¸° ëë¬¸ì Nodeë¹ íê°ì Cilium Podë¥¼ ë³¼ ì ìë¤. Ciliumì <code>kube-system</code> namespaceìì ì¤íëë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/kubernetes/1.9/cilium.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap &quot;cilium-config&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secret &quot;cilium-etcd-secrets&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemonset.extensions &quot;cilium&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io &quot;cilium&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io &quot;cilium&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount &quot;cilium&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>kube-system namespaceì RBACì¤ì ê³¼ í¨ê» Ciliumì´ ë°°í¬ëê³ , ConfigMap, DaemonSet ííë¡ ë°°í¬ê° ëë¤. </p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="check-deployment">Check deployment<a class="hash-link" href="#check-deployment" title="Direct link to heading">â</a></h2><p>Cilium Deploymentê° <code>READY</code> ìíë¡ ë°ëëê¹ì§ ê¸°ë¤ë¦°ë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get daemonsets -n kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      DESIRED   CURRENT   READY     UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium    1         1         1         1            0           &lt;none&gt;          2m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="deploy-demo-app">Deploy Demo App.<a class="hash-link" href="#deploy-demo-app" title="Direct link to heading">â</a></h2><p>ìë ë°ëª¨ê·¸ë¦¼ì ë³´ë©´ ì¤íìì¦ì ìê°ì ë°ììì¸ì§ deathstar, xwing ë±ì¼ë¡ êµ¬ë¶íê²ì íì¸í ì ìë¤. deathstar deploymentsì ê²½ì° 80í¬í¸ë¡ http ì¹ìë²ê° 2ê°ì pod replicaë¡ Load Balancingëê³  ìë¤. deathstar ìë¹ì¤ë ì°ì£¼ì ì´ ì°©ë¥í ì ìëë¡ íì£¼ë¡ë¥¼ ìë¹ì¤íê³  ìë¤. íì§ë§ ì êµ­êµ°ì tiefighter ë§ ì°©ë¥íëë¡ í´ì¼íë¯ë¡ ë³´ìì¤ì ì í´ì¼íë ìí©ì´ë¤. </p><p><img loading="lazy" src="https://cilium.readthedocs.io/en/v1.1/_images/cilium_http_gsg.png" alt="starwars" class="img_E7b_"></p><p>ìë <code>http-sw-app.yaml</code> ì ì¸ê°ì§ deploymentë¥¼ ê°ì§ê³  ìê³  ê°ê°ì deploymentë <code>(org=empire, class=deathstar)</code>, <code>(org=empire, class=tiefighter)</code>, <code>(org=alliance, class=xwing)</code>ì ê°ì´ label ì ë³´ë¥¼ ê°ì§ë¤. deathstar Serviceë <code>(org=empire, class=deathstar)</code> labelì ê°ì§ê³  Load Balancingì íë¤. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/http-sw-app.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service &quot;deathstar&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment &quot;deathstar&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment &quot;tiefighter&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment &quot;xwing&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ì´ 4ê°ì podì 1ê°ì ìë¹ì¤ë¥¼ íì¸í ì ìë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods,svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                             READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/deathstar-566c89f458-mqgfs   1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/deathstar-566c89f458-wlc4c   1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/tiefighter                   1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod/xwing                        1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/deathstar    ClusterIP   10.109.80.174   &lt;none&gt;        80/TCP    1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service/kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP   4h</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ê°ê°ì podë Ciliumììë <a href="https://cilium.readthedocs.io/en/v1.1/concepts/#endpoint" target="_blank" rel="noopener noreferrer">Endpoints</a>ííë¡ ííëë¤. ìëì ê°ì´ ingress, egress policyë¥¼ íì¸í ì ìê³  ìì§ ìë¬´ë° network policy ì ì©ì íì§ ììê¸° ëë¬¸ì ëª¨ë <code>Disabled</code> ìíë¡ ë³´ì¸ë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n kube-system get pods -l k8s-app=cilium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME           READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cilium-jmxk2   1/1       Running   0          4h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n kube-system exec cilium-jmxk2 -- cilium endpoint list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ENDPOINT   POLICY (ingress)   POLICY (egress)   IDENTITY   LABELS (source:key[=value])                                                    IPv6                 IPv4            STATUS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           ENFORCEMENT        ENFORCEMENT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5023       Disabled           Disabled          2008       k8s:io.cilium.k8s.policy.serviceaccount=istio-ingress-service-account          f00d::a0f:0:0:139f   10.15.170.241   ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio=ingress</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7415       Disabled           Disabled          9270       k8s:class=deathstar                                                            f00d::a0f:0:0:1cf7   10.15.16.224    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.cilium.k8s.policy.serviceaccount=default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:org=empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7979       Disabled           Disabled          4          reserved:health                                                                f00d::a0f:0:0:1f2b   10.15.96.215    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">17917      Disabled           Disabled          60941      k8s:class=tiefighter                                                           f00d::a0f:0:0:45fd   10.15.58.61     ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.cilium.k8s.policy.serviceaccount=default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:org=empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">22602      Disabled           Disabled          53004      k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:584a   10.15.190.2     ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio-mixer-type=telemetry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio=mixer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">31992      Disabled           Disabled          33709      k8s:io.cilium.k8s.policy.serviceaccount=istio-egressgateway-service-account    f00d::a0f:0:0:7cf8   10.15.85.192    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio=egressgateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">33958      Disabled           Disabled          64389      k8s:io.cilium.k8s.policy.serviceaccount=istio-citadel-service-account          f00d::a0f:0:0:84a6   10.15.59.151    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio=citadel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">49215      Disabled           Disabled          40629      k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:c03f   10.15.48.171    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio-mixer-type=policy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio=mixer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55129      Disabled           Disabled          9270       k8s:class=deathstar                                                            f00d::a0f:0:0:d759   10.15.17.253    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.cilium.k8s.policy.serviceaccount=default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:org=empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">55930      Disabled           Disabled          46893      k8s:app=prometheus                                                             f00d::a0f:0:0:da7a   10.15.196.220   ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.cilium.k8s.policy.serviceaccount=prometheus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">57491      Disabled           Disabled          775        k8s:io.cilium.k8s.policy.serviceaccount=istio-mixer-service-account            f00d::a0f:0:0:e093   10.15.253.210   ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio=statsd-prom-bridge</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">57651      Disabled           Disabled          44171      k8s:io.cilium.k8s.policy.serviceaccount=istio-ingressgateway-service-account   f00d::a0f:0:0:e133   10.15.74.164    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio=ingressgateway</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">61352      Disabled           Disabled          888        k8s:io.cilium.k8s.policy.serviceaccount=istio-pilot-service-account            f00d::a0f:0:0:efa8   10.15.118.68    ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=istio-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:istio=pilot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">61355      Disabled           Disabled          36797      k8s:class=xwing                                                                f00d::a0f:0:0:efab   10.15.56.79     ready</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.cilium.k8s.policy.serviceaccount=default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:io.kubernetes.pod.namespace=default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                           k8s:org=alliance</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>íì¬ ìíììë ëª¨ë  ì°ì£¼ì ì´ deathstarì ì°©ë¥ì´ ê°ë¥íë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec xwing -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ship landed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ship landed</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="l3l4-policy-ì ì©">L3/L4 Policy ì ì©<a class="hash-link" href="#l3l4-policy-ì ì©" title="Direct link to heading">â</a></h2><p>ê²°êµ­ íê³  ì¶ìê±´ ì êµ­êµ° ì°ì£¼ì  ì¦, tiefighterë§ ì ê·¼ì´ ê°ë¥í´ì¼ íë¯ë¡ ìëì²ë¼ ì ì±ì ì¤ì íë¤. </p><p>ì ì±ì ì§ê´ì ì¼ë¡ ì¤ì ì´ ê°ë¥íë¤.</p><p><code>org=empire, class=deathstar</code> labelì ê°ì§ endpointë¡ì ingress ë°©í¥ì 80í¬í¸ ì ê·¼ì <code>org=empire</code> labelì ê°ì§ podë§ ê°ë¥íëë¡ íë¤ë ìë¯¸ì´ë¤. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: &quot;cilium.io/v2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CiliumNetworkPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">description: &quot;L3-L4 policy to restrict deathstar access to empire ships only&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: &quot;rule1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endpointSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      org: empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      class: deathstar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - fromEndpoints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        org: empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toPorts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - port: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ëë </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/sw_l3_l4_policy.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ìì ê°ì´ ì¤ì íê³  ëì tiefighterë¥¼ ì°©ë¥ìì¼ë³´ì.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ship landed</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ì ìì°©ë¥!<br>
<!-- -->ì´ë²ìë xwing ì°¨ë¡</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec xwing -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ì°©ë¥ì¤í¨!</p><p>ì´ì´ì ì ì±ì ë¤ì íì¸í´ë³´ë©´ Enabledë¡ ë³í ì ì± 2ê°ë¥¼ íì¸í  ì ìë¤.<br>
<!-- -->(podê° 2ê°ì´ë¯ë¡ 2ê°ì ì ì±ì ë³¼ ì ìë¤)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n kube-system exec cilium-jmxk2 -- cilium endpoint list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ìì¸ ì ì± íì¸ (Very Simple!!)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get cnp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME            AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">istio-sidecar   2h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rule1           5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$  kubectl describe cnp rule1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name:         rule1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:    default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:       &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">API Version:  cilium.io/v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kind:         CiliumNetworkPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cluster Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Creation Timestamp:  2018-07-06T07:25:15Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Generation:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Resource Version:    30312</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Self Link:           /apis/cilium.io/v2/namespaces/default/ciliumnetworkpolicies/rule1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UID:                 ba0d7964-80ed-11e8-8077-080027b1075c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Endpoint Selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Match Labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Any : Class:  deathstar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Any : Org:    empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    From Endpoints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Match Labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Any : Org:  empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    To Ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Port:      80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Protocol:  TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Nodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Minikube:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Enforcing:              true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Last Updated:           0001-01-01T00:00:00Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Local Policy Revision:  65</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Ok:                     true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:                       &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="l7-ì ì±-ì ì©">L7 ì ì± ì ì©<a class="hash-link" href="#l7-ì ì±-ì ì©" title="Direct link to heading">â</a></h2><p>ë§ì§ë§ì¼ë¡ deathstar APIë¥¼ í¸ì¶íë ìë¹ì¤ì ëí ì ì±ì ì ì´íëê²ì íì¤í¸í´ë³¸ë¤.</p><p>ìë ììì²ë¼ exhaust-port API(í¬í¸ë¥¼ ìì§ìí¤ë API)ë¥¼ ìííë©´ í¹ì  podê° ìë¬ê° ëê³  ì¬ê¸°ë ëëê²ì íì¸í ì ìë¤. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec tiefighter -- curl -s -XPUT deathstar.default.svc.cluster.local/v1/exhaust-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Panic: deathstar exploded</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">goroutine 1 [running]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main.HandleGarbage(0x2080c3f50, 0x2, 0x4, 0x425c0, 0x5, 0xa)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /code/src/github.com/empire/deathstar/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        temp/main.go:9 +0x64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main.main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /code/src/github.com/empire/deathstar/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        temp/main.go:5 +0x85</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                         READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deathstar-566c89f458-mqgfs   0/1       Error     0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deathstar-566c89f458-wlc4c   1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tiefighter                   1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xwing                        1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                         READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deathstar-566c89f458-mqgfs   1/1       Running   1          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deathstar-566c89f458-wlc4c   1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tiefighter                   1/1       Running   0          1h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xwing                        1/1       Running   0          1h</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ê·¸ëì ì´ë²ìë exhaust-port APIë ì°¨ë¨íê³  request-landing APIë§ íì©íë ì ì±ì íì¤í¸í´ë³¸ë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: &quot;cilium.io/v2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: CiliumNetworkPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">description: &quot;L7 policy to restrict access to specific HTTP call&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: &quot;rule1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  endpointSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      org: empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      class: deathstar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - fromEndpoints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        org: empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    toPorts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - port: &quot;80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - method: &quot;POST&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          path: &quot;/v1/request-landing&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ëë</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f https://raw.githubusercontent.com/cilium/cilium/v1.1/examples/minikube/sw_l3_l4_l7_policy.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ciliumnetworkpolicy.cilium.io/rule1 configured</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ì´í ëì¼í íì¤í¸ë¥¼ í´ë³´ë©´ ë¤ë¥¸ ê²°ê³¼ë¥¼ íì¸í  ì ìë¤. </p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec tiefighter -- curl -s -XPOST deathstar.default.svc.cluster.local/v1/request-landing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ship landed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl exec tiefighter -- curl -s -XPUT deathstar.default.svc.cluster.local/v1/exhaust-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Access denied</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ë¤ìíë² ìì¸ ì ì± íì¸ì í´ë³´ë©´ ingress POST íì©ì ì±ì íì¸í  ì ìë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl describe ciliumnetworkpolicies rule1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name:         rule1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:    default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:       &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:  kubectl.kubernetes.io/last-applied-configuration={&quot;apiVersion&quot;:&quot;cilium.io/v2&quot;,&quot;description&quot;:&quot;L7 policy to restrict access to specific HTTP call&quot;,&quot;kind&quot;:&quot;CiliumNetworkPolicy&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">API Version:  cilium.io/v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Kind:         CiliumNetworkPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cluster Name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Creation Timestamp:  2018-07-06T07:25:15Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Generation:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Resource Version:    32814</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Self Link:           /apis/cilium.io/v2/namespaces/default/ciliumnetworkpolicies/rule1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UID:                 ba0d7964-80ed-11e8-8077-080027b1075c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Endpoint Selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Match Labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Any : Class:  deathstar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Any : Org:    empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    From Endpoints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Match Labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Any : Org:  empire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    To Ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Port:      80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Protocol:  TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Http:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Method:  POST</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Path:    /v1/request-landing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Nodes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Minikube:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Kubectl . Kubernetes . Io / Last - Applied - Configuration:  {&quot;apiVersion&quot;:&quot;cilium.io/v2&quot;,&quot;description&quot;:&quot;L7 policy to restrict access to specific HTTP call&quot;,&quot;kind&quot;:&quot;CiliumNetworkPolicy&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;rule1&quot;,&quot;namespace&quot;:&quot;default&quot;},&quot;spec&quot;:{&quot;endpointSelector&quot;:{&quot;matchLabels&quot;:{&quot;class&quot;:&quot;deathstar&quot;,&quot;org&quot;:&quot;empire&quot;}},&quot;ingress&quot;:[{&quot;fromEndpoints&quot;:[{&quot;matchLabels&quot;:{&quot;org&quot;:&quot;empire&quot;}}],&quot;toPorts&quot;:[{&quot;ports&quot;:[{&quot;port&quot;:&quot;80&quot;,&quot;protocol&quot;:&quot;TCP&quot;}],&quot;rules&quot;:{&quot;http&quot;:[{&quot;method&quot;:&quot;POST&quot;,&quot;path&quot;:&quot;/v1/request-landing&quot;}]}}]}]}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Enforcing:              true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Last Updated:           0001-01-01T00:00:00Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Local Policy Revision:  70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Ok:                     true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:                       &lt;none&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>cilium CLIë¡ë íì¸ì´ ê°ë¥íë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">î° kubectl -n kube-system exec cilium-jmxk2 cilium policy get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;endpointSelector&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;matchLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;reserved:init&quot;: &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ingress&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fromEntities&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;host&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;egress&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;toPorts&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ports&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;port&quot;: &quot;53&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;protocol&quot;: &quot;UDP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;toEntities&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;all&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;toEndpoints&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;matchLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;k8s:io.kubernetes.pod.namespace&quot;: &quot;istio-system&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;labels&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;key&quot;: &quot;io.cilium.k8s.policy.name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;istio-sidecar&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source&quot;: &quot;k8s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;key&quot;: &quot;io.cilium.k8s.policy.namespace&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;default&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source&quot;: &quot;k8s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;endpointSelector&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;matchLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;any:class&quot;: &quot;deathstar&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;any:org&quot;: &quot;empire&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;k8s:io.kubernetes.pod.namespace&quot;: &quot;default&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ingress&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fromEndpoints&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;matchLabels&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;any:org&quot;: &quot;empire&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;k8s:io.kubernetes.pod.namespace&quot;: &quot;default&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;toPorts&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;ports&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;port&quot;: &quot;80&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;protocol&quot;: &quot;TCP&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;rules&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;http&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;path&quot;: &quot;/v1/request-landing&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;method&quot;: &quot;POST&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;labels&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;key&quot;: &quot;io.cilium.k8s.policy.name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;rule1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source&quot;: &quot;k8s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;key&quot;: &quot;io.cilium.k8s.policy.namespace&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;value&quot;: &quot;default&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;source&quot;: &quot;k8s&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Revision: 71</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ì´ì¸ìë Cilium Metricì Prometheusìì íì¸íëê²ë ê°ë¨íê² í ì ìë¤ê³  íë¤. </p><p>ì¬ê¸°ê¹ì§ê° ê¸°ë³¸ì ì¼ë¡ L3/L4, L7 ê¸°ë° network policyë¥¼ ì ì©í´ë³¸ê²ì´ê³  ë¤ìë²ìë istioì ì°ê³ ë¶ë¶ì´ë ì¤ì  Cluster êµ¬ì±ë°©ë²ì ëí´ì ë¤ë¤ë³´ëë¡ íê² ë¤.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/cilium/">Cilium</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kubernetes/">Kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/network-policy/">network policy</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/istio/">Istio</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/bpf/">BPF</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/cni/">CNI</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Cilium" href="/kubernetes/cilium-1/"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/kubernetes/mutating-web-hook/">Mutating Webhook</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2018-06-27T00:00:00.000Z" itemprop="datePublished">June 27, 2018</time> Â· <!-- -->9 min read</div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="admission-controller-íì¥">Admission controller íì¥<a class="hash-link" href="#admission-controller-íì¥" title="Direct link to heading">â</a></h2><p>Kubernetes(ì´í k8s)ê¸°ë° ê°ë° ê³¼ì ë¥¼ ìííë¤ë³´ë Custom Resourceë¥¼ ì¬ì©í ì ë°ì ìë ìí©ë¤ì´ ë°ìíìë¤.<br>
<!-- -->ê·¸ë° ìì¤ì istioì ê°ì Service Mesh Layerë¥¼ ë¦¬ìì¹íë ì¤ì íì´ëì¨ MutatingAdmissionWebhook ì©ì´ë¥¼ ì´í´íê¸° ìì ì¡°ì¬í ë´ì©ì ì ë¦¬í´ë³¸ë¤.</p><p><a href="https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/</a></p><p>Admission controllerë ì¿ ë²ë¤í°ì¤ api-serverì ì¤ë¸ì í¸(Pod,ë±) ìì± ìì²­ì ê°ë¡ì²´ì´ ì ì´ë¥¼ í  ì ìë íì¥ ê¸°ë¥ì¼ë¡ íë¬ê·¸ì¸ ííë¡ ì¬ì©ìê° ì¶ê° í  ì ìë¤.<br>
<!-- -->ì¢ë ìì¸í íì¸í´ë³´ì </p><ul><li>í´ë¬ì¤í° ê´ë¦¬ìê° kube-apië¥¼ ì§ì  ì»´íì¼ íê³  êµ¬ì±í´ì¼ íê¸° ëë¬¸ì ì ì°íê² ì¬ì©íê¸° ì´ë ¤ì</li><li>1.7 ë²ì  ì´íë¶í°ë ì´ë¬í ì íì¬í­ì í´ê²°íê¸° ìí´ alpha featureë¡  <a href="https://v1-9.docs.kubernetes.io/docs/admin/extensible-admission-controllers/#initializers" target="_blank" rel="noopener noreferrer">Initializers</a> ì <a href="https://v1-9.docs.kubernetes.io/docs/admin/extensible-admission-controllers/#external-admission-webhooks" target="_blank" rel="noopener noreferrer">External Admission Webhooks</a> ê¸°ë¥ì´ ëìë¨</li><li>External Admission Webhooks ë k8s ë¦¬ìì¤ì ì í¨ì± ê²ì¬ë¥¼ íëë° íì©, ì í¨ì± ê²ì¬ë¥¼ íµê³¼ íì§ ëª»íë©´ í´ ë¹ ë¦¬ìì¤ë ì¿ ë²ë¤í°ì¤ìì ìì±ëì§ ìê² í  ì ìì.</li><li>1.9 ë²ì ììë External Admission Webhooks ì betaë¡ ì¹ê²©ëì´ MutatingAdmissionWebhook ë° ValidatingAdmissionWebhookì¼ë¡ ëë ì¡ì§ë§ Initializers ë alpha ë¡ ì ì§ë¨</li><li>MutatingAdmissionWebhook ì ì í¨ì± ê²ì¬ ì´ì¸ìë ì¹ì¸ ê³¼ì ì k8s objectì ë³ê²½ì í ì ìì<ul><li>ìë¥¼ ë¤ë©´ resource quotaë¥¼ ë³ê²½íë¤ëì§  Agones ë° istioì ê°ì Custom Resource ë¥¼ ìì íì¬ objectë¥¼ ìì±ì´ ê°ë¥í¨</li><li>Webhook ë°©ìì gRPC íë¡í ì½ì ì¬ì©íë ë° ê°ë°ì¸ì´ì êµ¬ì  ë°ì§ ìê³  íì¥ì í  ì ìë¤ë ì¥ì ì´ ìì</li></ul></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="webhookì-ì¸ì -ì°ëê°">Webhookì ì¸ì  ì°ëê°?<a class="hash-link" href="#webhookì-ì¸ì -ì°ëê°" title="Direct link to heading">â</a></h2><p>Webhookì ì¬ì©íì¬ k8s cluster-adminì´ api-serverë¥¼ ë¤ì ì»´íì¼íì§ ìê³ ë objectìì± ìì²­ì mutating(ë³ê²½) ë° validation(ì í¨ì±ê²ì¦) ì íë íë¬ê·¸ì¸ì ë§ë¤ ì ìë¤. </p><p>ì´ë¥¼ íµí´ ê°ë°ìë ëª¨ë  resource ìì ì¬ë¬ ìì ( &quot;CREATE&quot;, &quot;UPDATE&quot;, &quot;DELETE&quot;...)ì ëí ì¹ì¸ ë¡ì§ì ëí´ ì¬ì©ì ì ì í  ììë ì ì°ì±ì ì ê³µë°ëë¤.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="use-case">Use-Case<a class="hash-link" href="#use-case" title="Direct link to heading">â</a></h2><ul><li><p>resourceë¥¼ ìì±íê¸° ì ì ë³ê²½<br>
<!-- -->(ì, Istio ìì ì²ë¼ traffic management ì policy enforcement ì ìí´ Envoy sidecar containerë¥¼ injection)</p></li><li><p>StorageClass Provisioning ìëí<br>
<!-- -->(PersistentVolumeClaim object ìì±ì ëª¨ëí°ë§íê³  ë¯¸ë¦¬ ì ì ë ì ì±ì ë°ë¼ ê°ì²´ì storageë¥¼ ìëì¼ë¡ ì¶ê°. ì¬ì©ìë StorageClass ìì± ì ì ê²½ ì¸ íìê° ìì)</p></li><li><p>ë³µì¡í custom resource ê²ì¦ (Agonesì ê°ì)namespace ì í<br>
<!-- -->ë©í° íëí¸ ìì¤íììë reserved namespaceì resourceìì±ì ê¸ì§ìí¬ë ì¬ì©í ì ìì</p></li><li><p>ì°¸ê³  ìì<br>
<a href="https://github.com/kelseyhightower/denyenv-validating-admission-webhook" target="_blank" rel="noopener noreferrer">https://github.com/kelseyhightower/denyenv-validating-admission-webhook</a></p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ì´ë»ê²-ëìíëê°">ì´ë»ê² ëìíëê°?<a class="hash-link" href="#ì´ë»ê²-ëìíëê°" title="Direct link to heading">â</a></h2><p>MutatingWebhookConfiguration ë´ì ì ìë ë£°ì ë°ë¼ etcdë¡ ì ë¬ëê¸° ì ì requestë¥¼ interceptíë¤.<br>
<!-- -->webhook ìë²ì ì¹ì¸ ìì²­ì ì ì¡íì¬ ë³ì´ë¥¼ ì¤ííë¤.<br>
<!-- -->webhook ìë²ë APIë¥¼ ì¤ìíë ë¨ìí httpìë².</p><p><img loading="lazy" alt="Alt text" src="/assets/images/mutating-b4b8965d675e621d8560c81accf497c7.jpg" width="1600" height="1643" class="img_E7b_"></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="íí ë¦¬ì¼">íí ë¦¬ì¼<a class="hash-link" href="#íí ë¦¬ì¼" title="Direct link to heading">â</a></h2><p><a href="https://github.com/morvencao/kube-mutating-webhook-tutorial" target="_blank" rel="noopener noreferrer">https://github.com/morvencao/kube-mutating-webhook-tutorial</a>  </p><p>ì íí ë¦¬ì¼ì objectê° ìì±ëê¸° ì ì podì nginx sidecar containerë¥¼ injectíë MutatingAdmissionWebhookì ë°°í¬íë ë´ì©ì ë´ê³  ìë¤.</p><p>ì°ì  admissionregistration.k8s.io/v1beta1 APIë¥¼ ì¬ì©í ì ìë k8s 1.9+ ì´ìì í´ë¬ì¤í°ê° íìíë¤.  </p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="íì¸ë°©ë²">íì¸ë°©ë²<a class="hash-link" href="#íì¸ë°©ë²" title="Direct link to heading">â</a></h2><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl api-versions | grep admissionregistration.k8s.io/v1beta1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ìëì ê°ì ê²°ê³¼ê° ëìì¼í¨</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">admissionregistration.k8s.io/v1beta1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="buildíê¸°">Buildíê¸°<a class="hash-link" href="#buildíê¸°" title="Direct link to heading">â</a></h2><p>ì¼ë¨ Goê° ì¤ì¹ëì´ ìì´ì¼ íë¤.
<code>~/go/src</code> ìëì cloneì íìì.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd ~/go/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/morvencao/kube-mutating-webhook-tutorial.git</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ìì¡´ì± ê´ë¦¬ë¥¼ ìí´ repoë depë¥¼ ì¬ì©í¨</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd kube-mutating-webhook-tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ go get -u github.com/golang/dep/cmd/dep</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>build íì¼ íì¸íê³  registry ìì¹ë¥¼ ë°ê¿</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">dep ensure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o kube-mutating-webhook-tutorial .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker build --no-cache -t registry.*****.io/agones/sidecar-injector:v1 .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf kube-mutating-webhook-tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker push registry.*****.io/agones/sidecar-injector:v1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>buildíê³  docker image push</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sending build context to Docker daemon  44.29MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 1/3 : FROM alpine:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 3fd9065eaf02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 2/3 : ADD kube-mutating-webhook-tutorial /kube-mutating-webhook-tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 8679ccbab536</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Step 3/3 : ENTRYPOINT [&quot;./kube-mutating-webhook-tutorial&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; Running in 7699ff5c0885</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Removing intermediate container 7699ff5c0885</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ---&gt; 2014100d460e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully built 2014100d460e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Successfully tagged registry.*****.io/agones/sidecar-injector:v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The push refers to repository [registry.*****.io/agones/sidecar-injector]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2456c1309a51: Pushed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd7100a72410: Layer already exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v1: digest: sha256:15c335daeba40ddcbfbc3631ab6daa7cf623b63420f0ae8b657755322ef0582d size: 739</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>sidecar deploymentì ì¬ì©ëë secret(cert/key)ì ìì±íë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">./deployment/webhook-create-signed-cert.sh \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --service sidecar-injector-webhook-svc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --secret sidecar-injector-webhook-certs \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace default</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ììì ìì±ë í´ë¬ì¤í°ì caBundleê°ì ê°ì§ê³  MutatingWebhookConfiguration ìì±íë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cat deployment/mutatingwebhook.yaml | \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deployment/webhook-patch-ca-bundle.sh &gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    deployment/mutatingwebhook-ca-bundle.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>resourceë¤ deploy</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl create -f deployment/nginxconfigmap.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f deployment/configmap.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f deployment/deployment.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f deployment/service.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f deployment/mutatingwebhook-ca-bundle.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap &quot;nginx-configmap&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configmap &quot;sidecar-injector-webhook-configmap&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.extensions &quot;sidecar-injector-webhook-deployment&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service &quot;sidecar-injector-webhook-svc&quot; created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mutatingwebhookconfiguration.admissionregistration.k8s.io &quot;sidecar-injector-webhook-cfg&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>webhook deployment íì¸</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                   READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sidecar-injector-webhook-deployment-796955558f-js6bb   1/1       Running   0          3m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sidecar-injector-webhook-deployment   1         1         1            1           3m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>default ë¤ìì¤íì´ì¤ì sidecar-injector ë¼ë²¨ë§ì íë¤. ì´ë ê² íë©´ í´ë¹ ë¤ìì¤íì´ì¤ì ìì±ëë ëª¨ë  appì ìëì¼ë¡ injectioníê² ë¨</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get namespace -L sidecar-injector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME             STATUS    AGE       SIDECAR-INJECTOR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">agones-system    Active    1d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default          Active    19d       enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ibm-cert-store   Active    19d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ibm-system       Active    19d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress-test     Active    6d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-public      Active    19d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system      Active    19d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spinnaker        Active    12d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xonotic          Active    1d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>ìíì±ì ëíë¡ì´ í´ë³´ì</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat &lt;&lt;EOF | kubectl create -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: extensions/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sidecar-injector-webhook.morven.me/inject: &quot;yes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: tutum/curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command: [&quot;/bin/sleep&quot;,&quot;infinity&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imagePullPolicy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.extensions &quot;sleep&quot; created</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>sidecar container injection íì¸<br>
<!-- -->ìë ê²°ê³¼ë¥¼ ë³´ë©´ íëì deployment íëì container ìì±ì ìì²­íì§ë§ nginx sidecar ì»¨íì´ëê° injection ëê²ì íì¸í  ì ìë¤.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                                   READY     STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sidecar-injector-webhook-deployment-796955558f-js6bb   1/1       Running   0          2h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sleep-74b46f8bd7-r9l7f                                 2/2       Running   0          42s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl describe pod sleep-74b46f8bd7-r9l7f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name:           sleep-74b46f8bd7-r9l7f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Namespace:      default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node:           10.178.188.16/10.178.188.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Start Time:     Wed, 27 Jun 2018 13:12:47 +0900</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Labels:         app=sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pod-template-hash=3060294683</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Annotations:    kubernetes.io/psp=ibm-privileged-psp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sidecar-injector-webhook.morven.me/inject=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sidecar-injector-webhook.morven.me/status=injected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Status:         Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IP:             172.30.169.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Controlled By:  ReplicaSet/sleep-74b46f8bd7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sleep:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Container ID:  docker://728ca7f8e741ad29369312bc006c79683e7e605f3b04586df2477e233f93e451</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image:         tutum/curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image ID:      docker-pullable://tutum/curl@sha256:b6f16e88387acd4e6326176b212b3dae63f5b2134e69560d0b0673cfb0fb976f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Port:          &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host Port:     &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      /bin/sleep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    State:          Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Started:      Wed, 27 Jun 2018 13:13:01 +0900</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ready:          True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Restart Count:  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment:    &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-czzpj (ro)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sidecar-nginx:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Container ID:   docker://94fd41a0e153de6d5639873ccbd6b6325cee1ea8351dd02ab4a48ab4004d0b58</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image:          nginx:1.12.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Image ID:       docker-pullable://nginx@sha256:72daaf46f11cc753c4eab981cbf869919bd1fee3d2170a2adeac12400f494728</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Port:           80/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Host Port:      0/TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    State:          Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Started:      Wed, 27 Jun 2018 13:13:08 +0900</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ready:          True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Restart Count:  0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Environment:    &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Mounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      /etc/nginx from nginx-conf (rw)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Conditions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type           Status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Initialized    True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Ready          True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PodScheduled   True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default-token-czzpj:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type:        Secret (a volume populated by a Secret)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SecretName:  default-token-czzpj</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Optional:    false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nginx-conf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Type:        ConfigMap (a volume populated by a ConfigMap)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Name:        nginx-configmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Optional:    false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QoS Class:       BestEffort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node-Selectors:  &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type    Reason                 Age   From                    Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ----    ------                 ----  ----                    -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Scheduled              1m    default-scheduler       Successfully assigned sleep-74b46f8bd7-r9l7f to 10.178.188.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  SuccessfulMountVolume  1m    kubelet, 10.178.188.16  MountVolume.SetUp succeeded for volume &quot;nginx-conf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  SuccessfulMountVolume  1m    kubelet, 10.178.188.16  MountVolume.SetUp succeeded for volume &quot;default-token-czzpj&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulling                1m    kubelet, 10.178.188.16  pulling image &quot;tutum/curl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulled                 55s   kubelet, 10.178.188.16  Successfully pulled image &quot;tutum/curl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Created                55s   kubelet, 10.178.188.16  Created container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Started                55s   kubelet, 10.178.188.16  Started container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulling                55s   kubelet, 10.178.188.16  pulling image &quot;nginx:1.12.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Pulled                 48s   kubelet, 10.178.188.16  Successfully pulled image &quot;nginx:1.12.2&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Created                48s   kubelet, 10.178.188.16  Created container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Normal  Started                48s   kubelet, 10.178.188.16  Started container</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ì ë¦¬">ì ë¦¬<a class="hash-link" href="#ì ë¦¬" title="Direct link to heading">â</a></h2><p>ê²°êµ­ ììì ì¸ê¸íê² ì²ë¼ MutationWebhookì istio RouteRuleê°ì ë³ëì CustomResourceë±ì injection íê±°ë agones ë±ê³¼ ê°ì´ ê²ììë²ì¸ì client sdk íµì ì ìí injection ííë¡ ê¸°ì¡´ resourceì ì¶ê°ì ì¸ ë³ê²½(mutation) ëë ê²ì¦(validation)ë±ì ì¶ê°ì ì¸ ììì kube-apiì ì»´íì¼ìì´ ê°ë¥íë¤ëë° ëª©ì ì´ ìë¤ê³  ë³¼ ì ìë¤. ì¶ê°ì ì¼ë¡ ê¸°ë¥ì ëí ë´ì©ì ì´í ë¤ì ì ë¦¬í´ë³¼ ìì ì´ë¤.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/mutating-webhook/">Mutating Webhook</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/kubernetes/">Kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/admission-controller/">Admission Controller</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/istio/">Istio</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/tags/agones/">Agones</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Mutating Webhook" href="/kubernetes/mutating-web-hook/"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Blog</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/archive/">Archive</a></li><li class="footer__item"><a class="footer__link-item" href="/tags/">Tags</a></li></ul></div><div class="col footer__col"><div class="footer__title">Sponsors</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/pang4u/">Pang4U</a></li><li class="footer__item"><a href="https://ko-fi.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Buy Me a Coffee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kr.linkedin.com/in/ddiiwoong" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
<script src="/assets/js/runtime~main.b94385cb.js"></script>
<script src="/assets/js/main.0346262c.js"></script>
</body>
</html>